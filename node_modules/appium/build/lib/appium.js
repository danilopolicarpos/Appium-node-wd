"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.AppiumDriver = void 0;

require("source-map-support/register");

var _lodash = _interopRequireDefault(require("lodash"));

var _logger = _interopRequireDefault(require("./logger"));

var _config = require("./config");

var _appiumBaseDriver = require("appium-base-driver");

var _bluebird = _interopRequireDefault(require("bluebird"));

var _asyncLock = _interopRequireDefault(require("async-lock"));

var _utils = require("./utils");

var _semver = _interopRequireDefault(require("semver"));

var _wordWrap = _interopRequireDefault(require("word-wrap"));

var _os = require("os");

const PLATFORMS = {
  FAKE: 'fake',
  ANDROID: 'android',
  IOS: 'ios',
  APPLE_TVOS: 'tvos',
  WINDOWS: 'windows',
  MAC: 'mac',
  TIZEN: 'tizen'
};
const AUTOMATION_NAMES = {
  APPIUM: 'Appium',
  SELENDROID: 'Selendroid',
  UIAUTOMATOR2: 'UiAutomator2',
  UIAUTOMATOR1: 'UiAutomator1',
  XCUITEST: 'XCUITest',
  YOUIENGINE: 'YouiEngine',
  ESPRESSO: 'Espresso',
  TIZEN: 'Tizen',
  FAKE: 'Fake',
  INSTRUMENTS: 'Instruments',
  WINDOWS: 'Windows',
  MAC: 'Mac'
};
const DRIVER_MAP = {
  [AUTOMATION_NAMES.SELENDROID.toLowerCase()]: {
    driverClassName: 'SelendroidDriver',
    driverPackage: 'appium-selendroid-driver'
  },
  [AUTOMATION_NAMES.UIAUTOMATOR2.toLowerCase()]: {
    driverClassName: 'AndroidUiautomator2Driver',
    driverPackage: 'appium-uiautomator2-driver'
  },
  [AUTOMATION_NAMES.XCUITEST.toLowerCase()]: {
    driverClassName: 'XCUITestDriver',
    driverPackage: 'appium-xcuitest-driver'
  },
  [AUTOMATION_NAMES.YOUIENGINE.toLowerCase()]: {
    driverClassName: 'YouiEngineDriver',
    driverPackage: 'appium-youiengine-driver'
  },
  [AUTOMATION_NAMES.FAKE.toLowerCase()]: {
    driverClassName: 'FakeDriver',
    driverPackage: 'appium-fake-driver'
  },
  [AUTOMATION_NAMES.UIAUTOMATOR1.toLowerCase()]: {
    driverClassName: 'AndroidDriver',
    driverPackage: 'appium-android-driver'
  },
  [AUTOMATION_NAMES.INSTRUMENTS.toLowerCase()]: {
    driverClassName: 'IosDriver',
    driverPackage: 'appium-ios-driver'
  },
  [AUTOMATION_NAMES.WINDOWS.toLowerCase()]: {
    driverClassName: 'WindowsDriver',
    driverPackage: 'appium-windows-driver'
  },
  [AUTOMATION_NAMES.MAC.toLowerCase()]: {
    driverClassName: 'MacDriver',
    driverPackage: 'appium-mac-driver'
  },
  [AUTOMATION_NAMES.ESPRESSO.toLowerCase()]: {
    driverClassName: 'EspressoDriver',
    driverPackage: 'appium-espresso-driver'
  },
  [AUTOMATION_NAMES.TIZEN.toLowerCase()]: {
    driverClassName: 'TizenDriver',
    driverPackage: 'appium-tizen-driver'
  }
};
const PLATFORMS_MAP = {
  [PLATFORMS.FAKE]: () => AUTOMATION_NAMES.FAKE,
  [PLATFORMS.ANDROID]: () => {
    const logDividerLength = 70;
    const automationWarning = [`The 'automationName' capability was not provided in the desired capabilities for this Android session`, `Setting 'automationName=UiAutomator2' by default and using the UiAutomator2 Driver`, `The next major version of Appium (2.x) will **require** the 'automationName' capability to be set for all sessions on all platforms`, `In previous versions (Appium <= 1.13.x), the default was 'automationName=UiAutomator1'`, `If you wish to use that automation instead of UiAutomator2, please add 'automationName=UiAutomator1' to your desired capabilities`, `For more information about drivers, please visit http://appium.io/docs/en/about-appium/intro/ and explore the 'Drivers' menu`];
    let divider = `${_os.EOL}${_lodash.default.repeat('=', logDividerLength)}${_os.EOL}`;
    let automationWarningString = divider;
    automationWarningString += `  DEPRECATION WARNING:` + _os.EOL;

    for (let log of automationWarning) {
      automationWarningString += _os.EOL + (0, _wordWrap.default)(log, {
        width: logDividerLength - 2
      }) + _os.EOL;
    }

    automationWarningString += divider;

    _logger.default.warn(automationWarningString);

    return AUTOMATION_NAMES.UIAUTOMATOR2;
  },
  [PLATFORMS.IOS]: caps => {
    const platformVersion = _semver.default.valid(_semver.default.coerce(caps.platformVersion));

    _logger.default.warn(`DeprecationWarning: 'automationName' capability was not provided. ` + `Future versions of Appium will require 'automationName' capability to be set for iOS sessions.`);

    if (platformVersion && _semver.default.satisfies(platformVersion, '>=10.0.0')) {
      _logger.default.info('Requested iOS support with version >= 10, ' + `using '${AUTOMATION_NAMES.XCUITEST}' ` + 'driver instead of UIAutomation-based driver, since the ' + 'latter is unsupported on iOS 10 and up.');

      return AUTOMATION_NAMES.XCUITEST;
    }

    return AUTOMATION_NAMES.INSTRUMENTS;
  },
  [PLATFORMS.APPLE_TVOS]: () => AUTOMATION_NAMES.XCUITEST,
  [PLATFORMS.WINDOWS]: () => AUTOMATION_NAMES.WINDOWS,
  [PLATFORMS.MAC]: () => AUTOMATION_NAMES.MAC,
  [PLATFORMS.TIZEN]: () => AUTOMATION_NAMES.TIZEN
};
const desiredCapabilityConstraints = {
  automationName: {
    presence: false,
    isString: true,
    inclusionCaseInsensitive: _lodash.default.values(AUTOMATION_NAMES)
  },
  platformName: {
    presence: true,
    isString: true,
    inclusionCaseInsensitive: _lodash.default.keys(PLATFORMS_MAP)
  }
};
const sessionsListGuard = new _asyncLock.default();
const pendingDriversGuard = new _asyncLock.default();

class AppiumDriver extends _appiumBaseDriver.BaseDriver {
  constructor(args) {
    if (args.tmpDir) {
      process.env.APPIUM_TMP_DIR = args.tmpDir;
    }

    super(args);
    this.desiredCapConstraints = desiredCapabilityConstraints;
    this.newCommandTimeoutMs = 0;
    this.args = Object.assign({}, args);
    this.sessions = {};
    this.pendingDrivers = {};
    (0, _config.updateBuildInfo)();
  }

  get isCommandsQueueEnabled() {
    return false;
  }

  sessionExists(sessionId) {
    const dstSession = this.sessions[sessionId];
    return dstSession && dstSession.sessionId !== null;
  }

  driverForSession(sessionId) {
    return this.sessions[sessionId];
  }

  getDriverAndVersionForCaps(caps) {
    if (!_lodash.default.isString(caps.platformName)) {
      throw new Error('You must include a platformName capability');
    }

    const platformName = caps.platformName.toLowerCase();
    let automationNameCap = caps.automationName;

    if (!_lodash.default.isString(automationNameCap) || automationNameCap.toLowerCase() === 'appium') {
      const driverSelector = PLATFORMS_MAP[platformName];

      if (driverSelector) {
        automationNameCap = driverSelector(caps);
      }
    }

    automationNameCap = automationNameCap.toLowerCase();

    try {
      const {
        driverPackage,
        driverClassName
      } = DRIVER_MAP[automationNameCap];

      const driver = require(driverPackage)[driverClassName];

      return {
        driver,
        version: this.getDriverVersion(driver.name, driverPackage)
      };
    } catch (ign) {}

    const msg = _lodash.default.isString(caps.automationName) ? `Could not find a driver for automationName '${caps.automationName}' and platformName ` + `'${caps.platformName}'.` : `Could not find a driver for platformName '${caps.platformName}'.`;
    throw new Error(`${msg} Please check your desired capabilities.`);
  }

  getDriverVersion(driverName, driverPackage) {
    const version = (0, _utils.getPackageVersion)(driverPackage);

    if (version) {
      return version;
    }

    _logger.default.warn(`Unable to get version of driver '${driverName}'`);
  }

  async getStatus() {
    return {
      build: _lodash.default.clone((0, _config.getBuildInfo)())
    };
  }

  async getSessions() {
    const sessions = await sessionsListGuard.acquire(AppiumDriver.name, () => this.sessions);
    return _lodash.default.toPairs(sessions).map(([id, driver]) => {
      return {
        id,
        capabilities: driver.caps
      };
    });
  }

  printNewSessionAnnouncement(caps, driverName, driverVersion) {
    const introString = driverVersion ? `Appium v${_config.APPIUM_VER} creating new ${driverName} (v${driverVersion}) session` : `Appium v${_config.APPIUM_VER} creating new ${driverName} session`;

    _logger.default.info(introString);

    _logger.default.info('Capabilities:');

    (0, _utils.inspectObject)(caps);
  }

  async createSession(jsonwpCaps, reqCaps, w3cCapabilities) {
    const defaultCapabilities = _lodash.default.cloneDeep(this.args.defaultCapabilities);

    const defaultSettings = (0, _utils.pullSettings)(defaultCapabilities);
    jsonwpCaps = _lodash.default.cloneDeep(jsonwpCaps);
    const jwpSettings = Object.assign({}, defaultSettings, (0, _utils.pullSettings)(jsonwpCaps));
    w3cCapabilities = _lodash.default.cloneDeep(w3cCapabilities);
    const w3cSettings = Object.assign({}, jwpSettings);
    Object.assign(w3cSettings, (0, _utils.pullSettings)((w3cCapabilities || {}).alwaysMatch || {}));

    for (const firstMatchEntry of (w3cCapabilities || {}).firstMatch || []) {
      Object.assign(w3cSettings, (0, _utils.pullSettings)(firstMatchEntry));
    }

    let protocol;
    let innerSessionId, dCaps;

    try {
      const parsedCaps = (0, _utils.parseCapsForInnerDriver)(jsonwpCaps, w3cCapabilities, this.desiredCapConstraints, defaultCapabilities);
      const {
        desiredCaps,
        processedJsonwpCapabilities,
        processedW3CCapabilities,
        error
      } = parsedCaps;
      protocol = parsedCaps.protocol;

      if (error) {
        throw error;
      }

      const {
        driver: InnerDriver,
        version: driverVersion
      } = this.getDriverAndVersionForCaps(desiredCaps);
      this.printNewSessionAnnouncement(desiredCaps, InnerDriver.name, driverVersion);

      if (this.args.sessionOverride) {
        const sessionIdsToDelete = await sessionsListGuard.acquire(AppiumDriver.name, () => _lodash.default.keys(this.sessions));

        if (sessionIdsToDelete.length) {
          _logger.default.info(`Session override is on. Deleting other ${sessionIdsToDelete.length} active session${sessionIdsToDelete.length ? '' : 's'}.`);

          try {
            await _bluebird.default.map(sessionIdsToDelete, id => this.deleteSession(id));
          } catch (ign) {}
        }
      }

      let runningDriversData, otherPendingDriversData;
      const d = new InnerDriver(this.args);

      if (this.args.relaxedSecurityEnabled) {
        _logger.default.info(`Applying relaxed security to '${InnerDriver.name}' as per ` + `server command line argument. All insecure features will be ` + `enabled unless explicitly disabled by --deny-insecure`);

        d.relaxedSecurityEnabled = true;
      }

      if (!_lodash.default.isEmpty(this.args.denyInsecure)) {
        _logger.default.info('Explicitly preventing use of insecure features:');

        this.args.denyInsecure.map(a => _logger.default.info(`    ${a}`));
        d.denyInsecure = this.args.denyInsecure;
      }

      if (!_lodash.default.isEmpty(this.args.allowInsecure)) {
        _logger.default.info('Explicitly enabling use of insecure features:');

        this.args.allowInsecure.map(a => _logger.default.info(`    ${a}`));
        d.allowInsecure = this.args.allowInsecure;
      }

      d.server = this.server;

      try {
        runningDriversData = await this.curSessionDataForDriver(InnerDriver);
      } catch (e) {
        throw new _appiumBaseDriver.errors.SessionNotCreatedError(e.message);
      }

      await pendingDriversGuard.acquire(AppiumDriver.name, () => {
        this.pendingDrivers[InnerDriver.name] = this.pendingDrivers[InnerDriver.name] || [];
        otherPendingDriversData = this.pendingDrivers[InnerDriver.name].map(drv => drv.driverData);
        this.pendingDrivers[InnerDriver.name].push(d);
      });

      try {
        [innerSessionId, dCaps] = await d.createSession(processedJsonwpCapabilities, reqCaps, processedW3CCapabilities, [...runningDriversData, ...otherPendingDriversData]);
        protocol = d.protocol;
        await sessionsListGuard.acquire(AppiumDriver.name, () => {
          this.sessions[innerSessionId] = d;
        });
      } finally {
        await pendingDriversGuard.acquire(AppiumDriver.name, () => {
          _lodash.default.pull(this.pendingDrivers[InnerDriver.name], d);
        });
      }

      this.attachUnexpectedShutdownHandler(d, innerSessionId);

      _logger.default.info(`New ${InnerDriver.name} session created successfully, session ` + `${innerSessionId} added to master session list`);

      d.startNewCommandTimeout();

      if (d.isW3CProtocol() && !_lodash.default.isEmpty(w3cSettings)) {
        _logger.default.info(`Applying the initial values to Appium settings parsed from W3C caps: ` + JSON.stringify(w3cSettings));

        await d.updateSettings(w3cSettings);
      } else if (d.isMjsonwpProtocol() && !_lodash.default.isEmpty(jwpSettings)) {
        _logger.default.info(`Applying the initial values to Appium settings parsed from MJSONWP caps: ` + JSON.stringify(jwpSettings));

        await d.updateSettings(jwpSettings);
      }
    } catch (error) {
      return {
        protocol,
        error
      };
    }

    return {
      protocol,
      value: [innerSessionId, dCaps, protocol]
    };
  }

  async attachUnexpectedShutdownHandler(driver, innerSessionId) {
    try {
      await driver.onUnexpectedShutdown;
      throw new Error('Unexpected shutdown');
    } catch (e) {
      if (e instanceof _bluebird.default.CancellationError) {
        return;
      }

      _logger.default.warn(`Closing session, cause was '${e.message}'`);

      _logger.default.info(`Removing session ${innerSessionId} from our master session list`);

      await sessionsListGuard.acquire(AppiumDriver.name, () => {
        delete this.sessions[innerSessionId];
      });
    }
  }

  async curSessionDataForDriver(InnerDriver) {
    const sessions = await sessionsListGuard.acquire(AppiumDriver.name, () => this.sessions);

    const data = _lodash.default.values(sessions).filter(s => s.constructor.name === InnerDriver.name).map(s => s.driverData);

    for (let datum of data) {
      if (!datum) {
        throw new Error(`Problem getting session data for driver type ` + `${InnerDriver.name}; does it implement 'get ` + `driverData'?`);
      }
    }

    return data;
  }

  async deleteSession(sessionId) {
    let protocol;

    try {
      let otherSessionsData = null;
      let dstSession = null;
      await sessionsListGuard.acquire(AppiumDriver.name, () => {
        if (!this.sessions[sessionId]) {
          return;
        }

        const curConstructorName = this.sessions[sessionId].constructor.name;
        otherSessionsData = _lodash.default.toPairs(this.sessions).filter(([key, value]) => value.constructor.name === curConstructorName && key !== sessionId).map(([, value]) => value.driverData);
        dstSession = this.sessions[sessionId];
        protocol = dstSession.protocol;

        _logger.default.info(`Removing session ${sessionId} from our master session list`);

        delete this.sessions[sessionId];
      });
      return {
        protocol,
        value: await dstSession.deleteSession(sessionId, otherSessionsData)
      };
    } catch (e) {
      _logger.default.error(`Had trouble ending session ${sessionId}: ${e.message}`);

      return {
        protocol,
        error: e
      };
    }
  }

  async executeCommand(cmd, ...args) {
    if (cmd === 'getStatus') {
      return await this.getStatus();
    }

    if (isAppiumDriverCommand(cmd)) {
      return await super.executeCommand(cmd, ...args);
    }

    const sessionId = _lodash.default.last(args);

    const dstSession = await sessionsListGuard.acquire(AppiumDriver.name, () => this.sessions[sessionId]);

    if (!dstSession) {
      throw new Error(`The session with id '${sessionId}' does not exist`);
    }

    let res = {
      protocol: dstSession.protocol
    };

    try {
      res.value = await dstSession.executeCommand(cmd, ...args);
    } catch (e) {
      res.error = e;
    }

    return res;
  }

  proxyActive(sessionId) {
    const dstSession = this.sessions[sessionId];
    return dstSession && _lodash.default.isFunction(dstSession.proxyActive) && dstSession.proxyActive(sessionId);
  }

  getProxyAvoidList(sessionId) {
    const dstSession = this.sessions[sessionId];
    return dstSession ? dstSession.getProxyAvoidList() : [];
  }

  canProxy(sessionId) {
    const dstSession = this.sessions[sessionId];
    return dstSession && dstSession.canProxy(sessionId);
  }

}

exports.AppiumDriver = AppiumDriver;

function isAppiumDriverCommand(cmd) {
  return !(0, _appiumBaseDriver.isSessionCommand)(cmd) || cmd === 'deleteSession';
}require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9hcHBpdW0uanMiXSwibmFtZXMiOlsiUExBVEZPUk1TIiwiRkFLRSIsIkFORFJPSUQiLCJJT1MiLCJBUFBMRV9UVk9TIiwiV0lORE9XUyIsIk1BQyIsIlRJWkVOIiwiQVVUT01BVElPTl9OQU1FUyIsIkFQUElVTSIsIlNFTEVORFJPSUQiLCJVSUFVVE9NQVRPUjIiLCJVSUFVVE9NQVRPUjEiLCJYQ1VJVEVTVCIsIllPVUlFTkdJTkUiLCJFU1BSRVNTTyIsIklOU1RSVU1FTlRTIiwiRFJJVkVSX01BUCIsInRvTG93ZXJDYXNlIiwiZHJpdmVyQ2xhc3NOYW1lIiwiZHJpdmVyUGFja2FnZSIsIlBMQVRGT1JNU19NQVAiLCJsb2dEaXZpZGVyTGVuZ3RoIiwiYXV0b21hdGlvbldhcm5pbmciLCJkaXZpZGVyIiwiRU9MIiwiXyIsInJlcGVhdCIsImF1dG9tYXRpb25XYXJuaW5nU3RyaW5nIiwibG9nIiwid2lkdGgiLCJ3YXJuIiwiY2FwcyIsInBsYXRmb3JtVmVyc2lvbiIsInNlbXZlciIsInZhbGlkIiwiY29lcmNlIiwic2F0aXNmaWVzIiwiaW5mbyIsImRlc2lyZWRDYXBhYmlsaXR5Q29uc3RyYWludHMiLCJhdXRvbWF0aW9uTmFtZSIsInByZXNlbmNlIiwiaXNTdHJpbmciLCJpbmNsdXNpb25DYXNlSW5zZW5zaXRpdmUiLCJ2YWx1ZXMiLCJwbGF0Zm9ybU5hbWUiLCJrZXlzIiwic2Vzc2lvbnNMaXN0R3VhcmQiLCJBc3luY0xvY2siLCJwZW5kaW5nRHJpdmVyc0d1YXJkIiwiQXBwaXVtRHJpdmVyIiwiQmFzZURyaXZlciIsImNvbnN0cnVjdG9yIiwiYXJncyIsInRtcERpciIsInByb2Nlc3MiLCJlbnYiLCJBUFBJVU1fVE1QX0RJUiIsImRlc2lyZWRDYXBDb25zdHJhaW50cyIsIm5ld0NvbW1hbmRUaW1lb3V0TXMiLCJPYmplY3QiLCJhc3NpZ24iLCJzZXNzaW9ucyIsInBlbmRpbmdEcml2ZXJzIiwiaXNDb21tYW5kc1F1ZXVlRW5hYmxlZCIsInNlc3Npb25FeGlzdHMiLCJzZXNzaW9uSWQiLCJkc3RTZXNzaW9uIiwiZHJpdmVyRm9yU2Vzc2lvbiIsImdldERyaXZlckFuZFZlcnNpb25Gb3JDYXBzIiwiRXJyb3IiLCJhdXRvbWF0aW9uTmFtZUNhcCIsImRyaXZlclNlbGVjdG9yIiwiZHJpdmVyIiwicmVxdWlyZSIsInZlcnNpb24iLCJnZXREcml2ZXJWZXJzaW9uIiwibmFtZSIsImlnbiIsIm1zZyIsImRyaXZlck5hbWUiLCJnZXRTdGF0dXMiLCJidWlsZCIsImNsb25lIiwiZ2V0U2Vzc2lvbnMiLCJhY3F1aXJlIiwidG9QYWlycyIsIm1hcCIsImlkIiwiY2FwYWJpbGl0aWVzIiwicHJpbnROZXdTZXNzaW9uQW5ub3VuY2VtZW50IiwiZHJpdmVyVmVyc2lvbiIsImludHJvU3RyaW5nIiwiQVBQSVVNX1ZFUiIsImNyZWF0ZVNlc3Npb24iLCJqc29ud3BDYXBzIiwicmVxQ2FwcyIsInczY0NhcGFiaWxpdGllcyIsImRlZmF1bHRDYXBhYmlsaXRpZXMiLCJjbG9uZURlZXAiLCJkZWZhdWx0U2V0dGluZ3MiLCJqd3BTZXR0aW5ncyIsInczY1NldHRpbmdzIiwiYWx3YXlzTWF0Y2giLCJmaXJzdE1hdGNoRW50cnkiLCJmaXJzdE1hdGNoIiwicHJvdG9jb2wiLCJpbm5lclNlc3Npb25JZCIsImRDYXBzIiwicGFyc2VkQ2FwcyIsImRlc2lyZWRDYXBzIiwicHJvY2Vzc2VkSnNvbndwQ2FwYWJpbGl0aWVzIiwicHJvY2Vzc2VkVzNDQ2FwYWJpbGl0aWVzIiwiZXJyb3IiLCJJbm5lckRyaXZlciIsInNlc3Npb25PdmVycmlkZSIsInNlc3Npb25JZHNUb0RlbGV0ZSIsImxlbmd0aCIsIkIiLCJkZWxldGVTZXNzaW9uIiwicnVubmluZ0RyaXZlcnNEYXRhIiwib3RoZXJQZW5kaW5nRHJpdmVyc0RhdGEiLCJkIiwicmVsYXhlZFNlY3VyaXR5RW5hYmxlZCIsImlzRW1wdHkiLCJkZW55SW5zZWN1cmUiLCJhIiwiYWxsb3dJbnNlY3VyZSIsInNlcnZlciIsImN1clNlc3Npb25EYXRhRm9yRHJpdmVyIiwiZSIsImVycm9ycyIsIlNlc3Npb25Ob3RDcmVhdGVkRXJyb3IiLCJtZXNzYWdlIiwiZHJ2IiwiZHJpdmVyRGF0YSIsInB1c2giLCJwdWxsIiwiYXR0YWNoVW5leHBlY3RlZFNodXRkb3duSGFuZGxlciIsInN0YXJ0TmV3Q29tbWFuZFRpbWVvdXQiLCJpc1czQ1Byb3RvY29sIiwiSlNPTiIsInN0cmluZ2lmeSIsInVwZGF0ZVNldHRpbmdzIiwiaXNNanNvbndwUHJvdG9jb2wiLCJ2YWx1ZSIsIm9uVW5leHBlY3RlZFNodXRkb3duIiwiQ2FuY2VsbGF0aW9uRXJyb3IiLCJkYXRhIiwiZmlsdGVyIiwicyIsImRhdHVtIiwib3RoZXJTZXNzaW9uc0RhdGEiLCJjdXJDb25zdHJ1Y3Rvck5hbWUiLCJrZXkiLCJleGVjdXRlQ29tbWFuZCIsImNtZCIsImlzQXBwaXVtRHJpdmVyQ29tbWFuZCIsImxhc3QiLCJyZXMiLCJwcm94eUFjdGl2ZSIsImlzRnVuY3Rpb24iLCJnZXRQcm94eUF2b2lkTGlzdCIsImNhblByb3h5Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUdBOztBQUNBOztBQUNBOztBQUdBLE1BQU1BLFNBQVMsR0FBRztBQUNoQkMsRUFBQUEsSUFBSSxFQUFFLE1BRFU7QUFFaEJDLEVBQUFBLE9BQU8sRUFBRSxTQUZPO0FBR2hCQyxFQUFBQSxHQUFHLEVBQUUsS0FIVztBQUloQkMsRUFBQUEsVUFBVSxFQUFFLE1BSkk7QUFLaEJDLEVBQUFBLE9BQU8sRUFBRSxTQUxPO0FBTWhCQyxFQUFBQSxHQUFHLEVBQUUsS0FOVztBQU9oQkMsRUFBQUEsS0FBSyxFQUFFO0FBUFMsQ0FBbEI7QUFVQSxNQUFNQyxnQkFBZ0IsR0FBRztBQUN2QkMsRUFBQUEsTUFBTSxFQUFFLFFBRGU7QUFFdkJDLEVBQUFBLFVBQVUsRUFBRSxZQUZXO0FBR3ZCQyxFQUFBQSxZQUFZLEVBQUUsY0FIUztBQUl2QkMsRUFBQUEs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QU9DLFVBQVUsSUFBSUEsVUFBVSxDQUFDZ0csUUFBWCxDQUFvQmpHLFNBQXBCLENBQXJCO0FBQ0Q7O0FBdFhtQzs7OztBQTJYdEMsU0FBUzJGLHFCQUFULENBQWdDRCxHQUFoQyxFQUFxQztBQUNuQyxTQUFPLENBQUMsd0NBQWlCQSxHQUFqQixDQUFELElBQTBCQSxHQUFHLEtBQUssZUFBekM7QUFDRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgbG9nIGZyb20gJy4vbG9nZ2VyJztcbmltcG9ydCB7IGdldEJ1aWxkSW5mbywgdXBkYXRlQnVpbGRJbmZvLCBBUFBJVU1fVkVSIH0gZnJvbSAnLi9jb25maWcnO1xuaW1wb3J0IHsgQmFzZURyaXZlciwgZXJyb3JzLCBpc1Nlc3Npb25Db21tYW5kIH0gZnJvbSAnYXBwaXVtLWJhc2UtZHJpdmVyJztcbmltcG9ydCBCIGZyb20gJ2JsdWViaXJkJztcbmltcG9ydCBBc3luY0xvY2sgZnJvbSAnYXN5bmMtbG9jayc7XG5pbXBvcnQge1xuICBpbnNwZWN0T2JqZWN0LCBwYXJzZUNhcHNGb3JJbm5lckRyaXZlciwgZ2V0UGFja2FnZVZlcnNpb24sXG4gIHB1bGxTZXR0aW5ncyB9IGZyb20gJy4vdXRpbHMnO1xuaW1wb3J0IHNlbXZlciBmcm9tICdzZW12ZXInO1xuaW1wb3J0IHdyYXAgZnJvbSAnd29yZC13cmFwJztcbmltcG9ydCB7IEVPTCB9IGZyb20gJ29zJztcblxuXG5jb25zdCBQTEFURk9STVMgPSB7XG4gIEZBS0U6ICdmYWtlJyxcbiAgQU5EUk9JRDogJ2FuZHJvaWQnLFxuICBJT1M6ICdpb3MnLFxuICBBUFBMRV9UVk9TOiAndHZvcycsXG4gIFdJTkRPV1M6ICd3aW5kb3dzJyxcbiAgTUFDOiAnbWFjJyxcbiAgVElaRU46ICd0aXplbicsXG59O1xuXG5jb25zdCBBVVRPTUFUSU9OX05BTUVTID0ge1xuICBBUFBJVU06ICdBcHBpdW0nLFxuICBTRUxFTkRST0lEOiAnU2VsZW5kcm9pZCcsXG4gIFVJQVVUT01BVE9SMjogJ1VpQXV0b21hdG9yMicsXG4gIFVJQVVUT01BVE9SMTogJ1VpQXV0b21hdG9yMScsXG4gIFhDVUlURVNUOiAnWENVSVRlc3QnLFxuICBZT1VJRU5HSU5FOiAnWW91aUVuZ2luZScsXG4gIEVTUFJFU1NPOiAnRXNwcmVzc28nLFxuICBUSVpFTjogJ1RpemVuJyxcbiAgRkFLRTogJ0Zha2UnLFxuICBJTlNUUlVNRU5UUzogJ0luc3RydW1lbnRzJyxcbiAgV0lORE9XUzogJ1dpbmRvd3MnLFxuICBNQUM6ICdNYWMnLFxufTtcbmNvbnN0IERSSVZFUl9NQVAgPSB7XG4gIFtBVVRPTUFUSU9OX05BTUVTLlNFTEVORFJPSUQudG9Mb3dlckNhc2UoKV06IHtcbiAgICBkcml2ZXJDbGFzc05hbWU6ICdTZWxlbmRyb2lkRHJpdmVyJyxcbiAgICBkcml2ZXJQYWNrYWdlOiAnYXBwaXVtLXNlbGVuZHJvaWQtZHJpdmVyJyxcbiAgfSxcbiAgW0FVVE9NQVRJT05fTkFNRVMuVUlBVVRPTUFUT1IyLnRvTG93ZXJDYXNlKCldOiB7XG4gICAgZHJpdmVyQ2xhc3NOYW1lOiAnQW5kcm9pZFVpYXV0b21hdG9yMkRyaXZlcicsXG4gICAgZHJpdmVyUGFja2FnZTogJ2FwcGl1bS11aWF1dG9tYXRvcjItZHJpdmVyJyxcbiAgfSxcbiAgW0FVVE9NQVRJT05fTkFNRVMuWENVSVRFU1QudG9Mb3dlckNhc2UoKV06IHtcbiAgICBkcml2ZXJDbGFzc05hbWU6ICdYQ1VJVGVzdERyaXZlcicsXG4gICAgZHJpdmVyUGFja2FnZTogJ2FwcGl1bS14Y3VpdGVzdC1kcml2ZXInLFxuICB9LFxuICBbQVVUT01BVElPTl9OQU1FUy5ZT1VJRU5HSU5FLnRvTG93ZXJDYXNlKCldOiB7XG4gICAgZHJpdmVyQ2xhc3NOYW1lOiAnWW91aUVuZ2luZURyaXZlcicsXG4gICAgZHJpdmVyUGFja2FnZTogJ2FwcGl1bS15b3VpZW5naW5lLWRyaXZlcicsXG4gIH0sXG4gIFtBVVRPTUFUSU9OX05BTUVTLkZBS0UudG9Mb3dlckNhc2UoKV06IHtcbiAgICBkcml2ZXJDbGFzc05hbWU6ICdGYWtlRHJpdmVyJyxcbiAgICBkcml2ZXJQYWNrYWdlOiAnYXBwaXVtLWZha2UtZHJpdmVyJyxcbiAgfSxcbiAgW0FVVE9NQVRJT05fTkFNRVMuVUlBVVRPTUFUT1IxLnRvTG93ZXJDYXNlKCldOiB7XG4gICAgZHJpdmVyQ2xhc3NOYW1lOiAnQW5kcm9pZERyaXZlcicsXG4gICAgZHJpdmVyUGFja2FnZTogJ2FwcGl1bS1hbmRyb2lkLWRyaXZlcicsXG4gIH0sXG4gIFtBVVRPTUFUSU9OX05BTUVTLklOU1RSVU1FTlRTLnRvTG93ZXJDYXNlKCldOiB7XG4gICAgZHJpdmVyQ2xhc3NOYW1lOiAnSW9zRHJpdmVyJyxcbiAgICBkcml2ZXJQYWNrYWdlOiAnYXBwaXVtLWlvcy1kcml2ZXInLFxuICB9LFxuICBbQVVUT01BVElPTl9OQU1FUy5XSU5ET1dTLnRvTG93ZXJDYXNlKCldOiB7XG4gICAgZHJpdmVyQ2xhc3NOYW1lOiAnV2luZG93c0RyaXZlcicsXG4gICAgZHJpdmVyUGFja2FnZTogJ2FwcGl1bS13aW5kb3dzLWRyaXZlcicsXG4gIH0sXG4gIFtBVVRPTUFUSU9OX05BTUVTLk1BQy50b0xvd2VyQ2FzZSgpXToge1xuICAgIGRyaXZlckNsYXNzTmFtZTogJ01hY0RyaXZlcicsXG4gICAgZHJpdmVyUGFja2FnZTogJ2FwcGl1bS1tYWMtZHJpdmVyJyxcbiAgfSxcbiAgW0FVVE9NQVRJT05fTkFNRVMuRVNQUkVTU08udG9Mb3dlckNhc2UoKV06IHtcbiAgICBkcml2ZXJDbGFzc05hbWU6ICdFc3ByZXNzb0RyaXZlcicsXG4gICAgZHJpdmVyUGFja2FnZTogJ2FwcGl1bS1lc3ByZXNzby1kcml2ZXInLFxuICB9LFxuICBbQVVUT01BVElPTl9OQU1FUy5USVpFTi50b0xvd2VyQ2FzZSgpXToge1xuICAgIGRyaXZlckNsYXNzTmFtZTogJ1RpemVuRHJpdmVyJyxcbiAgICBkcml2ZXJQYWNrYWdlOiAnYXBwaXVtLXRpemVuLWRyaXZlcicsXG4gIH0sXG59O1xuXG5jb25zdCBQTEFURk9STVNfTUFQID0ge1xuICBbUExBVEZPUk1TLkZBS0VdOiAoKSA9PiBBVVRPTUFUSU9OX05BTUVTLkZBS0UsXG4gIFtQTEFURk9STVMuQU5EUk9JRF06ICgpID0+IHtcbiAgICAvLyBXYXJuIHVzZXJzIHRoYXQgZGVmYXVsdCBhdXRvbWF0aW9uIGlzIGdvaW5nIHRvIGNoYW5nZSB0byBVaUF1dG9tYXRvcjIgZm9yIDEuMTRcbiAgICAvLyBhbmQgd2lsbCBiZWNvbWUgcmVxdWlyZWQgb24gQXBwaXVtIDIuMFxuICAgIGNvbnN0IGxvZ0RpdmlkZXJMZW5ndGggPSA3MDsgLy8gRml0IGluIGNvbW1hbmQgbGluZVxuXG4gICAgY29uc3QgYXV0b21hdGlvbldhcm5pbmcgPSBbXG4gICAgICBgVGhlICdhdXRvbWF0aW9uTmFtZScgY2FwYWJpbGl0eSB3YXMgbm90IHByb3ZpZGVkIGluIHRoZSBkZXNpcmVkIGNhcGFiaWxpdGllcyBmb3IgdGhpcyBBbmRyb2lkIHNlc3Npb25gLFxuICAgICAgYFNldHRpbmcgJ2F1dG9tYXRpb25OYW1lPVVpQXV0b21hdG9yMicgYnkgZGVmYXVsdCBhbmQgdXNpbmcgdGhlIFVpQXV0b21hdG9yMiBEcml2ZXJgLFxuICAgICAgYFRoZSBuZXh0IG1ham9yIHZlcnNpb24gb2YgQXBwaXVtICgyLngpIHdpbGwgKipyZXF1aXJlKiogdGhlICdhdXRvbWF0aW9uTmFtZScgY2FwYWJpbGl0eSB0byBiZSBzZXQgZm9yIGFsbCBzZXNzaW9ucyBvbiBhbGwgcGxhdGZvcm1zYCxcbiAgICAgIGBJbiBwcmV2aW91cyB2ZXJzaW9ucyAoQXBwaXVtIDw9IDEuMTMueCksIHRoZSBkZWZhdWx0IHdhcyAnYXV0b21hdGlvbk5hbWU9VWlBdXRvbWF0b3IxJ2AsXG4gICAgICBgSWYgeW91IHdpc2ggdG8gdXNlIHRoYXQgYXV0b21hdGlvbiBpbnN0ZWFkIG9mIFVpQXV0b21hdG9yMiwgcGxlYXNlIGFkZCAnYXV0b21hdGlvbk5hbWU9VWlBdXRvbWF0b3IxJyB0byB5b3VyIGRlc2lyZWQgY2FwYWJpbGl0aWVzYCxcbiAgICAgIGBGb3IgbW9yZSBpbmZvcm1hdGlvbiBhYm91dCBkcml2ZXJzLCBwbGVhc2UgdmlzaXQgaHR0cDovL2FwcGl1bS5pby9kb2NzL2VuL2Fib3V0LWFwcGl1bS9pbnRyby8gYW5kIGV4cGxvcmUgdGhlICdEcml2ZXJzJyBtZW51YFxuICAgIF07XG5cbiAgICBsZXQgZGl2aWRlciA9IGAke0VPTH0ke18ucmVwZWF0KCc9JywgbG9nRGl2aWRlckxlbmd0aCl9JHtFT0x9YDtcbiAgICBsZXQgYXV0b21hdGlvbldhcm5pbmdTdHJpbmcgPSBkaXZpZGVyO1xuICAgIGF1dG9tYXRpb25XYXJuaW5nU3RyaW5nICs9IGAgIERFUFJFQ0FUSU9OIFdBUk5JTkc6YCArIEVPTDtcbiAgICBmb3IgKGxldCBsb2cgb2YgYXV0b21hdGlvbldhcm5pbmcpIHtcbiAgICAgIGF1dG9tYXRpb25XYXJuaW5nU3RyaW5nICs9IEVPTCArIHdyYXAobG9nLCB7d2lkdGg6IGxvZ0RpdmlkZXJMZW5ndGggLSAyfSkgKyBFT0w7XG4gICAgfVxuICAgIGF1dG9tYXRpb25XYXJuaW5nU3RyaW5nICs9IGRpdmlkZXI7XG5cbiAgICAvLyBSZWNvbW1lbmQgdXNlcnMgdG8gdXBncmFkZSB0byBVaUF1dG9tYXRvcjIgaWYgdGhleSdyZSB1c2luZyBBbmRyb2lkID49IDZcbiAgICBsb2cud2FybihhdXRvbWF0aW9uV2FybmluZ1N0cmluZyk7XG5cbiAgICByZXR1cm4gQVVUT01BVElPTl9OQU1FUy5VSUFVVE9NQVRPUjI7XG4gIH0sXG4gIFtQTEFURk9STVMuSU9TXTogKGNhcHMpID0+IHtcbiAgICBjb25zdCBwbGF0Zm9ybVZlcnNpb24gPSBzZW12ZXIudmFsaWQoc2VtdmVyLmNvZXJjZShjYXBzLnBsYXRmb3JtVmVyc2lvbikpO1xuICAgIGxvZy53YXJuKGBEZXByZWNhdGlvbldhcm5pbmc6ICdhdXRvbWF0aW9uTmFtZScgY2FwYWJpbGl0eSB3YXMgbm90IHByb3ZpZGVkLiBgICtcbiAgICAgIGBGdXR1cmUgdmVyc2lvbnMgb2YgQXBwaXVtIHdpbGwgcmVxdWlyZSAnYXV0b21hdGlvbk5hbWUnIGNhcGFiaWxpdHkgdG8gYmUgc2V0IGZvciBpT1Mgc2Vzc2lvbnMuYCk7XG4gICAgaWYgKHBsYXRmb3JtVmVyc2lvbiAmJiBzZW12ZXIuc2F0aXNmaWVzKHBsYXRmb3JtVmVyc2lvbiwgJz49MTAuMC4wJykpIHtcbiAgICAgIGxvZy5pbmZvKCdSZXF1ZXN0ZWQgaU9TIHN1cHBvcnQgd2l0aCB2ZXJzaW9uID49IDEwLCAnICtcbiAgICAgICAgYHVzaW5nICcke0FVVE9NQVRJT05fTkFNRVMuWENVSVRFU1R9JyBgICtcbiAgICAgICAgJ2RyaXZlciBpbnN0ZWFkIG9mIFVJQXV0b21hdGlvbi1iYXNlZCBkcml2ZXIsIHNpbmNlIHRoZSAnICtcbiAgICAgICAgJ2xhdHRlciBpcyB1bnN1cHBvcnRlZCBvbiBpT1MgMTAgYW5kIHVwLicpO1xuICAgICAgcmV0dXJuIEFVVE9NQVRJT05fTkFNRVMuWENVSVRFU1Q7XG4gICAgfVxuXG4gICAgcmV0dXJuIEFVVE9NQVRJT05fTkFNRVMuSU5TVFJVTUVOVFM7XG4gIH0sXG4gIFtQTEFURk9STVMuQVBQTEVfVFZPU106ICgpID0+IEFVVE9NQVRJT05fTkFNRVMuWENVSVRFU1QsXG4gIFtQTEFURk9STVMuV0lORE9XU106ICgpID0+IEFVVE9NQVRJT05fTkFNRVMuV0lORE9XUyxcbiAgW1BMQVRGT1JNUy5NQUNdOiAoKSA9PiBBVVRPTUFUSU9OX05BTUVTLk1BQyxcbiAgW1BMQVRGT1JNUy5USVpFTl06ICgpID0+IEFVVE9NQVRJT05fTkFNRVMuVElaRU4sXG59O1xuXG5jb25zdCBkZXNpcmVkQ2FwYWJpbGl0eUNvbnN0cmFpbnRzID0ge1xuICBhdXRvbWF0aW9uTmFtZToge1xuICAgIHByZXNlbmNlOiBmYWxzZSxcbiAgICBpc1N0cmluZzogdHJ1ZSxcbiAgICBpbmNsdXNpb25DYXNlSW5zZW5zaXRpdmU6IF8udmFsdWVzKEFVVE9NQVRJT05fTkFNRVMpLFxuICB9LFxuICBwbGF0Zm9ybU5hbWU6IHtcbiAgICBwcmVzZW5jZTogdHJ1ZSxcbiAgICBpc1N0cmluZzogdHJ1ZSxcbiAgICBpbmNsdXNpb25DYXNlSW5zZW5zaXRpdmU6IF8ua2V5cyhQTEFURk9STVNfTUFQKSxcbiAgfSxcbn07XG5cbmNvbnN0IHNlc3Npb25zTGlzdEd1YXJkID0gbmV3IEFzeW5jTG9jaygpO1xuY29uc3QgcGVuZGluZ0RyaXZlcnNHdWFyZCA9IG5ldyBBc3luY0xvY2soKTtcblxuY2xhc3MgQXBwaXVtRHJpdmVyIGV4dGVuZHMgQmFzZURyaXZlciB7XG4gIGNvbnN0cnVjdG9yIChhcmdzKSB7XG4gICAgLy8gSXQgaXMgbmVjZXNzYXJ5IHRvIHNldCBgLS10bXBgIGhlcmUgc2luY2UgaXQgc2hvdWxkIGJlIHNldCB0b1xuICAgIC8vIHByb2Nlc3MuZW52LkFQUElVTV9UTVBfRElSIG9uY2UgYXQgYW4gaW5pdGlhbCBwb2ludCBpbiB0aGUgQXBwaXVtIGxpZmVjeWNsZS5cbiAgICAvLyBUaGUgcHJvY2VzcyBhcmd1bWVudCB3aWxsIGJlIHJlZmVyZW5jZWQgYnkgQmFzZURyaXZlci5cbiAgICAvLyBQbGVhc2UgY2FsbCBhcHBpdW0tc3VwcG9ydC50ZW1wRGlyIG1vZHVsZSB0byBhcHBseSB0aGlzIGJlbmVmaXQuXG4gICAgaWYgKGFyZ3MudG1wRGlyKSB7XG4gICAgICBwcm9jZXNzLmVudi5BUFBJVU1fVE1QX0RJUiA9IGFyZ3MudG1wRGlyO1xuICAgIH1cblxuICAgIHN1cGVyKGFyZ3MpO1xuXG4gICAgdGhpcy5kZXNpcmVkQ2FwQ29uc3RyYWludHMgPSBkZXNpcmVkQ2FwYWJpbGl0eUNvbnN0cmFpbnRzO1xuXG4gICAgLy8gdGhlIG1haW4gQXBwaXVtIERyaXZlciBoYXMgbm8gbmV3IGNvbW1hbmQgdGltZW91dFxuICAgIHRoaXMubmV3Q29tbWFuZFRpbWVvdXRNcyA9IDA7XG5cbiAgICB0aGlzLmFyZ3MgPSBPYmplY3QuYXNzaWduKHt9LCBhcmdzKTtcblxuICAgIC8vIEFjY2VzcyB0byBzZXNzaW9ucyBsaXN0IG11c3QgYmUgZ3VhcmRlZCB3aXRoIGEgU2VtYXBob3JlLCBiZWNhdXNlXG4gICAgLy8gaXQgbWlnaHQgYmUgY2hhbmdlZCBieSBvdGhlciBhc3luYyBjYWxscyBhdCBhbnkgdGltZVxuICAgIC8vIEl0IGlzIG5vdCByZWNvbW1lbmRlZCB0byBhY2Nlc3MgdGhpcyBwcm9wZXJ0eSBkaXJlY3RseSBmcm9tIHRoZSBvdXRzaWRlXG4gICAgdGhpcy5zZXNzaW9ucyA9IHt9O1xuXG4gICAgLy8gQWNjZXNzIHRvIHBlbmRpbmcgZHJpdmVycyBsaXN0IG11c3QgYmUgZ3VhcmRlZCB3aXRoIGEgU2VtYXBob3JlLCBiZWNhdXNlXG4gICAgLy8gaXQgbWlnaHQgYmUgY2hhbmdlZCBieSBvdGhlciBhc3luYyBjYWxscyBhdCBhbnkgdGltZVxuICAgIC8vIEl0IGlzIG5vdCByZWNvbW1lbmRlZCB0byBhY2Nlc3MgdGhpcyBwcm9wZXJ0eSBkaXJlY3RseSBmcm9tIHRoZSBvdXRzaWRlXG4gICAgdGhpcy5wZW5kaW5nRHJpdmVycyA9IHt9O1xuXG4gICAgLy8gYWxsb3cgdGhpcyB0byBoYXBwZW4gaW4gdGhlIGJhY2tncm91bmQsIHNvIG5vIGBhd2FpdGBcbiAgICB1cGRhdGVCdWlsZEluZm8oKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDYW5jZWwgY29tbWFuZHMgcXVldWVpbmcgZm9yIHRoZSB1bWJyZWxsYSBBcHBpdW0gZHJpdmVyXG4gICAqL1xuICBnZXQgaXNDb21tYW5kc1F1ZXVlRW5hYmxlZCAoKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgc2Vzc2lvbkV4aXN0cyAoc2Vzc2lvbklkKSB7XG4gICAgY29uc3QgZHN0U2Vzc2lvbiA9IHRoaXMuc2Vzc2lvbnNbc2Vzc2lvbklkXTtcbiAgICByZXR1cm4gZHN0U2Vzc2lvbiAmJiBkc3RTZXNzaW9uLnNlc3Npb25JZCAhPT0gbnVsbDtcbiAgfVxuXG4gIGRyaXZlckZvclNlc3Npb24gKHNlc3Npb25JZCkge1xuICAgIHJldHVybiB0aGlzLnNlc3Npb25zW3Nlc3Npb25JZF07XG4gIH1cblxuICBnZXREcml2ZXJBbmRWZXJzaW9uRm9yQ2FwcyAoY2Fwcykge1xuICAgIGlmICghXy5pc1N0cmluZyhjYXBzLnBsYXRmb3JtTmFtZSkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignWW91IG11c3QgaW5jbHVkZSBhIHBsYXRmb3JtTmFtZSBjYXBhYmlsaXR5Jyk7XG4gICAgfVxuXG4gICAgY29uc3QgcGxhdGZvcm1OYW1lID0gY2Fwcy5wbGF0Zm9ybU5hbWUudG9Mb3dlckNhc2UoKTtcblxuICAgIC8vIHdlIGRvbid0IG5lY2Vzc2FyaWx5IGhhdmUgYW4gYGF1dG9tYXRpb25OYW1lYCBjYXBhYmlsaXR5XG4gICAgbGV0IGF1dG9tYXRpb25OYW1lQ2FwID0gY2Fwcy5hdXRvbWF0aW9uTmFtZTtcbiAgICBpZiAoIV8uaXNTdHJpbmcoYXV0b21hdGlvbk5hbWVDYXApIHx8IGF1dG9tYXRpb25OYW1lQ2FwLnRvTG93ZXJDYXNlKCkgPT09ICdhcHBpdW0nKSB7XG4gICAgICBjb25zdCBkcml2ZXJTZWxlY3RvciA9IFBMQVRGT1JNU19NQVBbcGxhdGZvcm1OYW1lXTtcbiAgICAgIGlmIChkcml2ZXJTZWxlY3Rvcikge1xuICAgICAgICBhdXRvbWF0aW9uTmFtZUNhcCA9IGRyaXZlclNlbGVjdG9yKGNhcHMpO1xuICAgICAgfVxuICAgIH1cbiAgICBhdXRvbWF0aW9uTmFtZUNhcCA9IGF1dG9tYXRpb25OYW1lQ2FwLnRvTG93ZXJDYXNlKCk7XG5cbiAgICB0cnkge1xuICAgICAgY29uc3Qge2RyaXZlclBhY2thZ2UsIGRyaXZlckNsYXNzTmFtZX0gPSBEUklWRVJfTUFQW2F1dG9tYXRpb25OYW1lQ2FwXTtcbiAgICAgIGNvbnN0IGRyaXZlciA9IHJlcXVpcmUoZHJpdmVyUGFja2FnZSlbZHJpdmVyQ2xhc3NOYW1lXTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGRyaXZlcixcbiAgICAgICAgdmVyc2lvbjogdGhpcy5nZXREcml2ZXJWZXJzaW9uKGRyaXZlci5uYW1lLCBkcml2ZXJQYWNrYWdlKSxcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoaWduKSB7XG4gICAgICAvLyBlcnJvciB3aWxsIGJlIHJlcG9ydGVkIGJlbG93LCBhbmQgaGVyZSB3b3VsZCBjb21lIG91dCBhcyBhbiB1bmNsZWFyXG4gICAgICAvLyBwcm9ibGVtIHdpdGggZGVzdHJ1Y3R1cmluZyB1bmRlZmluZWRcbiAgICB9XG5cbiAgICBjb25zdCBtc2cgPSBfLmlzU3RyaW5nKGNhcHMuYXV0b21hdGlvbk5hbWUpXG4gICAgICA/IGBDb3VsZCBub3QgZmluZCBhIGRyaXZlciBmb3IgYXV0b21hdGlvbk5hbWUgJyR7Y2Fwcy5hdXRvbWF0aW9uTmFtZX0nIGFuZCBwbGF0Zm9ybU5hbWUgYCArXG4gICAgICAgICAgICBgJyR7Y2Fwcy5wbGF0Zm9ybU5hbWV9Jy5gXG4gICAgICA6IGBDb3VsZCBub3QgZmluZCBhIGRyaXZlciBmb3IgcGxhdGZvcm1OYW1lICcke2NhcHMucGxhdGZvcm1OYW1lfScuYDtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYCR7bXNnfSBQbGVhc2UgY2hlY2sgeW91ciBkZXNpcmVkIGNhcGFiaWxpdGllcy5gKTtcbiAgfVxuXG4gIGdldERyaXZlclZlcnNpb24gKGRyaXZlck5hbWUsIGRyaXZlclBhY2thZ2UpIHtcbiAgICBjb25zdCB2ZXJzaW9uID0gZ2V0UGFja2FnZVZlcnNpb24oZHJpdmVyUGFja2FnZSk7XG4gICAgaWYgKHZlcnNpb24pIHtcbiAgICAgIHJldHVybiB2ZXJzaW9uO1xuICAgIH1cbiAgICBsb2cud2FybihgVW5hYmxlIHRvIGdldCB2ZXJzaW9uIG9mIGRyaXZlciAnJHtkcml2ZXJOYW1lfSdgKTtcbiAgfVxuXG4gIGFzeW5jIGdldFN0YXR1cyAoKSB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgcmVxdWlyZS1hd2FpdFxuICAgIHJldHVybiB7XG4gICAgICBidWlsZDogXy5jbG9uZShnZXRCdWlsZEluZm8oKSksXG4gICAgfTtcbiAgfVxuXG4gIGFzeW5jIGdldFNlc3Npb25zICgpIHtcbiAgICBjb25zdCBzZXNzaW9ucyA9IGF3YWl0IHNlc3Npb25zTGlzdEd1YXJkLmFjcXVpcmUoQXBwaXVtRHJpdmVyLm5hbWUsICgpID0+IHRoaXMuc2Vzc2lvbnMpO1xuICAgIHJldHVybiBfLnRvUGFpcnMoc2Vzc2lvbnMpXG4gICAgICAubWFwKChbaWQsIGRyaXZlcl0pID0+IHtcbiAgICAgICAgcmV0dXJuIHtpZCwgY2FwYWJpbGl0aWVzOiBkcml2ZXIuY2Fwc307XG4gICAgICB9KTtcbiAgfVxuXG4gIHByaW50TmV3U2Vzc2lvbkFubm91bmNlbWVudCAoY2FwcywgZHJpdmVyTmFtZSwgZHJpdmVyVmVyc2lvbikge1xuICAgIGNvbnN0IGludHJvU3RyaW5nID0gZHJpdmVyVmVyc2lvblxuICAgICAgPyBgQXBwaXVtIHYke0FQUElVTV9WRVJ9IGNyZWF0aW5nIG5ldyAke2RyaXZlck5hbWV9ICh2JHtkcml2ZXJWZXJzaW9ufSkgc2Vzc2lvbmBcbiAgICAgIDogYEFwcGl1bSB2JHtBUFBJVU1fVkVSfSBjcmVhdGluZyBuZXcgJHtkcml2ZXJOYW1lfSBzZXNzaW9uYDtcbiAgICBsb2cuaW5mbyhpbnRyb1N0cmluZyk7XG4gICAgbG9nLmluZm8oJ0NhcGFiaWxpdGllczonKTtcbiAgICBpbnNwZWN0T2JqZWN0KGNhcHMpO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBhIG5ldyBzZXNzaW9uXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBqc29ud3BDYXBzIEpTT05XUCBmb3JtYXR0ZWQgZGVzaXJlZCBjYXBhYmlsaXRpZXNcbiAgICogQHBhcmFtIHtPYmplY3R9IHJlcUNhcHMgUmVxdWlyZWQgY2FwYWJpbGl0aWVzIChKU09OV1Agc3RhbmRhcmQpXG4gICAqIEBwYXJhbSB7T2JqZWN0fSB3M2NDYXBhYmlsaXRpZXMgVzNDIGNhcGFiaWxpdGllc1xuICAgKiBAcmV0dXJuIHtBcnJheX0gVW5pcXVlIHNlc3Npb24gSUQgYW5kIGNhcGFiaWxpdGllc1xuICAgKi9cbiAgYXN5bmMgY3JlYXRlU2Vzc2lvbiAoanNvbndwQ2FwcywgcmVxQ2FwcywgdzNjQ2FwYWJpbGl0aWVzKSB7XG4gICAgY29uc3QgZGVmYXVsdENhcGFiaWxpdGllcyA9IF8uY2xvbmVEZWVwKHRoaXMuYXJncy5kZWZhdWx0Q2FwYWJpbGl0aWVzKTtcbiAgICBjb25zdCBkZWZhdWx0U2V0dGluZ3MgPSBwdWxsU2V0dGluZ3MoZGVmYXVsdENhcGFiaWxpdGllcyk7XG4gICAganNvbndwQ2FwcyA9IF8uY2xvbmVEZWVwKGpzb253cENhcHMpO1xuICAgIGNvbnN0IGp3cFNldHRpbmdzID0gT2JqZWN0LmFzc2lnbih7fSwgZGVmYXVsdFNldHRpbmdzLCBwdWxsU2V0dGluZ3MoanNvbndwQ2FwcykpO1xuICAgIHczY0NhcGFiaWxpdGllcyA9IF8uY2xvbmVEZWVwKHczY0NhcGFiaWxpdGllcyk7XG4gICAgLy8gSXQgaXMgcG9zc2libGUgdGhhdCB0aGUgY2xpZW50IG9ubHkgcHJvdmlkZXMgY2FwcyB1c2luZyBKU09OV1Agc3RhbmRhcmQsXG4gICAgLy8gYWx0aG91Z2ggZmlyc3RNYXRjaC9hbHdheXNNYXRjaCBwcm9wZXJ0aWVzIGFyZSBzdGlsbCBwcmVzZW50LlxuICAgIC8vIEluIHN1Y2ggY2FzZSB3ZSBhc3N1bWUgdGhlIGNsaWVudCB1bmRlcnN0YW5kcyBXM0MgcHJvdG9jb2wgYW5kIG1lcmdlIHRoZSBnaXZlblxuICAgIC8vIEpTT05XUCBjYXBzIHRvIFczQyBjYXBzXG4gICAgY29uc3QgdzNjU2V0dGluZ3MgPSBPYmplY3QuYXNzaWduKHt9LCBqd3BTZXR0aW5ncyk7XG4gICAgT2JqZWN0LmFzc2lnbih3M2NTZXR0aW5ncywgcHVsbFNldHRpbmdzKCh3M2NDYXBhYmlsaXRpZXMgfHwge30pLmFsd2F5c01hdGNoIHx8IHt9KSk7XG4gICAgZm9yIChjb25zdCBmaXJzdE1hdGNoRW50cnkgb2YgKCh3M2NDYXBhYmlsaXRpZXMgfHwge30pLmZpcnN0TWF0Y2ggfHwgW10pKSB7XG4gICAgICBPYmplY3QuYXNzaWduKHczY1NldHRpbmdzLCBwdWxsU2V0dGluZ3MoZmlyc3RNYXRjaEVudHJ5KSk7XG4gICAgfVxuXG4gICAgbGV0IHByb3RvY29sO1xuICAgIGxldCBpbm5lclNlc3Npb25JZCwgZENhcHM7XG4gICAgdHJ5IHtcbiAgICAgIC8vIFBhcnNlIHRoZSBjYXBzIGludG8gYSBmb3JtYXQgdGhhdCB0aGUgSW5uZXJEcml2ZXIgd2lsbCBhY2NlcHRcbiAgICAgIGNvbnN0IHBhcnNlZENhcHMgPSBwYXJzZUNhcHNGb3JJbm5lckRyaXZlcihcbiAgICAgICAganNvbndwQ2FwcyxcbiAgICAgICAgdzNjQ2FwYWJpbGl0aWVzLFxuICAgICAgICB0aGlzLmRlc2lyZWRDYXBDb25zdHJhaW50cyxcbiAgICAgICAgZGVmYXVsdENhcGFiaWxpdGllc1xuICAgICAgKTtcblxuICAgICAgY29uc3Qge2Rlc2lyZWRDYXBzLCBwcm9jZXNzZWRKc29ud3BDYXBhYmlsaXRpZXMsIHByb2Nlc3NlZFczQ0NhcGFiaWxpdGllcywgZXJyb3J9ID0gcGFyc2VkQ2FwcztcbiAgICAgIHByb3RvY29sID0gcGFyc2VkQ2Fwcy5wcm90b2NvbDtcblxuICAgICAgLy8gSWYgdGhlIHBhcnNpbmcgb2YgdGhlIGNhcHMgcHJvZHVjZWQgYW4gZXJyb3IsIHRocm93IGl0IGluIGhlcmVcbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgIH1cblxuICAgICAgY29uc3Qge2RyaXZlcjogSW5uZXJEcml2ZXIsIHZlcnNpb246IGRyaXZlclZlcnNpb259ID0gdGhpcy5nZXREcml2ZXJBbmRWZXJzaW9uRm9yQ2FwcyhkZXNpcmVkQ2Fwcyk7XG4gICAgICB0aGlzLnByaW50TmV3U2Vzc2lvbkFubm91bmNlbWVudChkZXNpcmVkQ2FwcywgSW5uZXJEcml2ZXIubmFtZSwgZHJpdmVyVmVyc2lvbik7XG5cbiAgICAgIGlmICh0aGlzLmFyZ3Muc2Vzc2lvbk92ZXJyaWRlKSB7XG4gICAgICAgIGNvbnN0IHNlc3Npb25JZHNUb0RlbGV0ZSA9IGF3YWl0IHNlc3Npb25zTGlzdEd1YXJkLmFjcXVpcmUoQXBwaXVtRHJpdmVyLm5hbWUsICgpID0+IF8ua2V5cyh0aGlzLnNlc3Npb25zKSk7XG4gICAgICAgIGlmIChzZXNzaW9uSWRzVG9EZWxldGUubGVuZ3RoKSB7XG4gICAgICAgICAgbG9nLmluZm8oYFNlc3Npb24gb3ZlcnJpZGUgaXMgb24uIERlbGV0aW5nIG90aGVyICR7c2Vzc2lvbklkc1RvRGVsZXRlLmxlbmd0aH0gYWN0aXZlIHNlc3Npb24ke3Nlc3Npb25JZHNUb0RlbGV0ZS5sZW5ndGggPyAnJyA6ICdzJ30uYCk7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGF3YWl0IEIubWFwKHNlc3Npb25JZHNUb0RlbGV0ZSwgKGlkKSA9PiB0aGlzLmRlbGV0ZVNlc3Npb24oaWQpKTtcbiAgICAgICAgICB9IGNhdGNoIChpZ24pIHt9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgbGV0IHJ1bm5pbmdEcml2ZXJzRGF0YSwgb3RoZXJQZW5kaW5nRHJpdmVyc0RhdGE7XG4gICAgICBjb25zdCBkID0gbmV3IElubmVyRHJpdmVyKHRoaXMuYXJncyk7XG5cbiAgICAgIC8vIFdlIHdhbnQgdG8gYXNzaWduIHNlY3VyaXR5IHZhbHVlcyBkaXJlY3RseSBvbiB0aGUgZHJpdmVyLiBUaGUgZHJpdmVyXG4gICAgICAvLyBzaG91bGQgbm90IHJlYWQgc2VjdXJpdHkgdmFsdWVzIGZyb20gYHRoaXMub3B0c2AgYmVjYXVzZSB0aG9zZSB2YWx1ZXNcbiAgICAgIC8vIGNvdWxkIGhhdmUgYmVlbiBzZXQgYnkgYSBtYWxpY2lvdXMgdXNlciB2aWEgY2FwYWJpbGl0aWVzLCB3aGVyZWFzIHdlXG4gICAgICAvLyB3YW50IGEgZ3VhcmFudGVlIHRoZSB2YWx1ZXMgd2VyZSBzZXQgYnkgdGhlIGFwcGl1bSBzZXJ2ZXIgYWRtaW5cbiAgICAgIGlmICh0aGlzLmFyZ3MucmVsYXhlZFNlY3VyaXR5RW5hYmxlZCkge1xuICAgICAgICBsb2cuaW5mbyhgQXBwbHlpbmcgcmVsYXhlZCBzZWN1cml0eSB0byAnJHtJbm5lckRyaXZlci5uYW1lfScgYXMgcGVyIGAgK1xuICAgICAgICAgICAgICAgICBgc2VydmVyIGNvbW1hbmQgbGluZSBhcmd1bWVudC4gQWxsIGluc2VjdXJlIGZlYXR1cmVzIHdpbGwgYmUgYCArXG4gICAgICAgICAgICAgICAgIGBlbmFibGVkIHVubGVzcyBleHBsaWNpdGx5IGRpc2FibGVkIGJ5IC0tZGVueS1pbnNlY3VyZWApO1xuICAgICAgICBkLnJlbGF4ZWRTZWN1cml0eUVuYWJsZWQgPSB0cnVlO1xuICAgICAgfVxuXG4gICAgICBpZiAoIV8uaXNFbXB0eSh0aGlzLmFyZ3MuZGVueUluc2VjdXJlKSkge1xuICAgICAgICBsb2cuaW5mbygnRXhwbGljaXRseSBwcmV2ZW50aW5nIHVzZSBvZiBpbnNlY3VyZSBmZWF0dXJlczonKTtcbiAgICAgICAgdGhpcy5hcmdzLmRlbnlJbnNlY3VyZS5tYXAoKGEpID0+IGxvZy5pbmZvKGAgICAgJHthfWApKTtcbiAgICAgICAgZC5kZW55SW5zZWN1cmUgPSB0aGlzLmFyZ3MuZGVueUluc2VjdXJlO1xuICAgICAgfVxuXG4gICAgICBpZiAoIV8uaXNFbXB0eSh0aGlzLmFyZ3MuYWxsb3dJbnNlY3VyZSkpIHtcbiAgICAgICAgbG9nLmluZm8oJ0V4cGxpY2l0bHkgZW5hYmxpbmcgdXNlIG9mIGluc2VjdXJlIGZlYXR1cmVzOicpO1xuICAgICAgICB0aGlzLmFyZ3MuYWxsb3dJbnNlY3VyZS5tYXAoKGEpID0+IGxvZy5pbmZvKGAgICAgJHthfWApKTtcbiAgICAgICAgZC5hbGxvd0luc2VjdXJlID0gdGhpcy5hcmdzLmFsbG93SW5zZWN1cmU7XG4gICAgICB9XG5cbiAgICAgIC8vIFRoaXMgYXNzaWdubWVudCBpcyByZXF1aXJlZCBmb3IgY29ycmVjdCB3ZWIgc29ja2V0cyBmdW5jdGlvbmFsaXR5IGluc2lkZSB0aGUgZHJpdmVyXG4gICAgICBkLnNlcnZlciA9IHRoaXMuc2VydmVyO1xuICAgICAgdHJ5IHtcbiAgICAgICAgcnVubmluZ0RyaXZlcnNEYXRhID0gYXdhaXQgdGhpcy5jdXJTZXNzaW9uRGF0YUZvckRyaXZlcihJbm5lckRyaXZlcik7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIHRocm93IG5ldyBlcnJvcnMuU2Vzc2lvbk5vdENyZWF0ZWRFcnJvcihlLm1lc3NhZ2UpO1xuICAgICAgfVxuICAgICAgYXdhaXQgcGVuZGluZ0RyaXZlcnNHdWFyZC5hY3F1aXJlKEFwcGl1bURyaXZlci5uYW1lLCAoKSA9PiB7XG4gICAgICAgIHRoaXMucGVuZGluZ0RyaXZlcnNbSW5uZXJEcml2ZXIubmFtZV0gPSB0aGlzLnBlbmRpbmdEcml2ZXJzW0lubmVyRHJpdmVyLm5hbWVdIHx8IFtdO1xuICAgICAgICBvdGhlclBlbmRpbmdEcml2ZXJzRGF0YSA9IHRoaXMucGVuZGluZ0RyaXZlcnNbSW5uZXJEcml2ZXIubmFtZV0ubWFwKChkcnYpID0+IGRydi5kcml2ZXJEYXRhKTtcbiAgICAgICAgdGhpcy5wZW5kaW5nRHJpdmVyc1tJbm5lckRyaXZlci5uYW1lXS5wdXNoKGQpO1xuICAgICAgfSk7XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIFtpbm5lclNlc3Npb25JZCwgZENhcHNdID0gYXdhaXQgZC5jcmVhdGVTZXNzaW9uKFxuICAgICAgICAgIHByb2Nlc3NlZEpzb253cENhcGFiaWxpdGllcyxcbiAgICAgICAgICByZXFDYXBzLFxuICAgICAgICAgIHByb2Nlc3NlZFczQ0NhcGFiaWxpdGllcyxcbiAgICAgICAgICBbLi4ucnVubmluZ0RyaXZlcnNEYXRhLCAuLi5vdGhlclBlbmRpbmdEcml2ZXJzRGF0YV1cbiAgICAgICAgKTtcbiAgICAgICAgcHJvdG9jb2wgPSBkLnByb3RvY29sO1xuICAgICAgICBhd2FpdCBzZXNzaW9uc0xpc3RHdWFyZC5hY3F1aXJlKEFwcGl1bURyaXZlci5uYW1lLCAoKSA9PiB7XG4gICAgICAgICAgdGhpcy5zZXNzaW9uc1tpbm5lclNlc3Npb25JZF0gPSBkO1xuICAgICAgICB9KTtcbiAgICAgIH0gZmluYWxseSB7XG4gICAgICAgIGF3YWl0IHBlbmRpbmdEcml2ZXJzR3VhcmQuYWNxdWlyZShBcHBpdW1Ecml2ZXIubmFtZSwgKCkgPT4ge1xuICAgICAgICAgIF8ucHVsbCh0aGlzLnBlbmRpbmdEcml2ZXJzW0lubmVyRHJpdmVyLm5hbWVdLCBkKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIHRoaXMgaXMgYW4gYXN5bmMgZnVuY3Rpb24gYnV0IHdlIGRvbid0IGF3YWl0IGl0IGJlY2F1c2UgaXQgaGFuZGxlc1xuICAgICAgLy8gYW4gb3V0LW9mLWJhbmQgcHJvbWlzZSB3aGljaCBpcyBmdWxmaWxsZWQgaWYgdGhlIGlubmVyIGRyaXZlclxuICAgICAgLy8gdW5leHBlY3RlZGx5IHNodXRzIGRvd25cbiAgICAgIHRoaXMuYXR0YWNoVW5leHBlY3RlZFNodXRkb3duSGFuZGxlcihkLCBpbm5lclNlc3Npb25JZCk7XG5cbiAgICAgIGxvZy5pbmZvKGBOZXcgJHtJbm5lckRyaXZlci5uYW1lfSBzZXNzaW9uIGNyZWF0ZWQgc3VjY2Vzc2Z1bGx5LCBzZXNzaW9uIGAgK1xuICAgICAgICAgICAgICBgJHtpbm5lclNlc3Npb25JZH0gYWRkZWQgdG8gbWFzdGVyIHNlc3Npb24gbGlzdGApO1xuXG4gICAgICAvLyBzZXQgdGhlIE5ldyBDb21tYW5kIFRpbWVvdXQgZm9yIHRoZSBpbm5lciBkcml2ZXJcbiAgICAgIGQuc3RhcnROZXdDb21tYW5kVGltZW91dCgpO1xuXG4gICAgICAvLyBhcHBseSBpbml0aWFsIHZhbHVlcyB0byBBcHBpdW0gc2V0dGluZ3MgKGlmIHByb3ZpZGVkKVxuICAgICAgaWYgKGQuaXNXM0NQcm90b2NvbCgpICYmICFfLmlzRW1wdHkodzNjU2V0dGluZ3MpKSB7XG4gICAgICAgIGxvZy5pbmZvKGBBcHBseWluZyB0aGUgaW5pdGlhbCB2YWx1ZXMgdG8gQXBwaXVtIHNldHRpbmdzIHBhcnNlZCBmcm9tIFczQyBjYXBzOiBgICtcbiAgICAgICAgICBKU09OLnN0cmluZ2lmeSh3M2NTZXR0aW5ncykpO1xuICAgICAgICBhd2FpdCBkLnVwZGF0ZVNldHRpbmdzKHczY1NldHRpbmdzKTtcbiAgICAgIH0gZWxzZSBpZiAoZC5pc01qc29ud3BQcm90b2NvbCgpICYmICFfLmlzRW1wdHkoandwU2V0dGluZ3MpKSB7XG4gICAgICAgIGxvZy5pbmZvKGBBcHBseWluZyB0aGUgaW5pdGlhbCB2YWx1ZXMgdG8gQXBwaXVtIHNldHRpbmdzIHBhcnNlZCBmcm9tIE1KU09OV1AgY2FwczogYCArXG4gICAgICAgICAgSlNPTi5zdHJpbmdpZnkoandwU2V0dGluZ3MpKTtcbiAgICAgICAgYXdhaXQgZC51cGRhdGVTZXR0aW5ncyhqd3BTZXR0aW5ncyk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHByb3RvY29sLFxuICAgICAgICBlcnJvcixcbiAgICAgIH07XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIHByb3RvY29sLFxuICAgICAgdmFsdWU6IFtpbm5lclNlc3Npb25JZCwgZENhcHMsIHByb3RvY29sXVxuICAgIH07XG4gIH1cblxuICBhc3luYyBhdHRhY2hVbmV4cGVjdGVkU2h1dGRvd25IYW5kbGVyIChkcml2ZXIsIGlubmVyU2Vzc2lvbklkKSB7XG4gICAgLy8gUmVtb3ZlIHRoZSBzZXNzaW9uIG9uIHVuZXhwZWN0ZWQgc2h1dGRvd24sIHNvIHRoYXQgd2UgYXJlIGluIGEgcG9zaXRpb25cbiAgICAvLyB0byBvcGVuIGFub3RoZXIgc2Vzc2lvbiBsYXRlciBvbi5cbiAgICAvLyBUT0RPOiB0aGlzIHNob3VsZCBiZSByZW1vdmVkIGFuZCByZXBsYWNlZCBieSBhIG9uU2h1dGRvd24gY2FsbGJhY2suXG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IGRyaXZlci5vblVuZXhwZWN0ZWRTaHV0ZG93bjsgLy8gdGhpcyBpcyBhIGNhbmNlbGxhYmxlIHByb21pc2VcbiAgICAgIC8vIGlmIHdlIGdldCBoZXJlLCB3ZSd2ZSBoYWQgYW4gdW5leHBlY3RlZCBzaHV0ZG93biwgc28gZXJyb3JcbiAgICAgIHRocm93IG5ldyBFcnJvcignVW5leHBlY3RlZCBzaHV0ZG93bicpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGlmIChlIGluc3RhbmNlb2YgQi5DYW5jZWxsYXRpb25FcnJvcikge1xuICAgICAgICAvLyBpZiB3ZSBjYW5jZWxsZWQgdGhlIHVuZXhwZWN0ZWQgc2h1dGRvd24gcHJvbWlzZSwgdGhhdCBtZWFucyB3ZVxuICAgICAgICAvLyBubyBsb25nZXIgY2FyZSBhYm91dCBpdCwgYW5kIGNhbiBzYWZlbHkgaWdub3JlIGl0XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGxvZy53YXJuKGBDbG9zaW5nIHNlc3Npb24sIGNhdXNlIHdhcyAnJHtlLm1lc3NhZ2V9J2ApO1xuICAgICAgbG9nLmluZm8oYFJlbW92aW5nIHNlc3Npb24gJHtpbm5lclNlc3Npb25JZH0gZnJvbSBvdXIgbWFzdGVyIHNlc3Npb24gbGlzdGApO1xuICAgICAgYXdhaXQgc2Vzc2lvbnNMaXN0R3VhcmQuYWNxdWlyZShBcHBpdW1Ecml2ZXIubmFtZSwgKCkgPT4ge1xuICAgICAgICBkZWxldGUgdGhpcy5zZXNzaW9uc1tpbm5lclNlc3Npb25JZF07XG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBjdXJTZXNzaW9uRGF0YUZvckRyaXZlciAoSW5uZXJEcml2ZXIpIHtcbiAgICBjb25zdCBzZXNzaW9ucyA9IGF3YWl0IHNlc3Npb25zTGlzdEd1YXJkLmFjcXVpcmUoQXBwaXVtRHJpdmVyLm5hbWUsICgpID0+IHRoaXMuc2Vzc2lvbnMpO1xuICAgIGNvbnN0IGRhdGEgPSBfLnZhbHVlcyhzZXNzaW9ucylcbiAgICAgICAgICAgICAgICAgICAuZmlsdGVyKChzKSA9PiBzLmNvbnN0cnVjdG9yLm5hbWUgPT09IElubmVyRHJpdmVyLm5hbWUpXG4gICAgICAgICAgICAgICAgICAgLm1hcCgocykgPT4gcy5kcml2ZXJEYXRhKTtcbiAgICBmb3IgKGxldCBkYXR1bSBvZiBkYXRhKSB7XG4gICAgICBpZiAoIWRhdHVtKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgUHJvYmxlbSBnZXR0aW5nIHNlc3Npb24gZGF0YSBmb3IgZHJpdmVyIHR5cGUgYCArXG4gICAgICAgICAgICAgICAgICAgICAgICBgJHtJbm5lckRyaXZlci5uYW1lfTsgZG9lcyBpdCBpbXBsZW1lbnQgJ2dldCBgICtcbiAgICAgICAgICAgICAgICAgICAgICAgIGBkcml2ZXJEYXRhJz9gKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGRhdGE7XG4gIH1cblxuICBhc3luYyBkZWxldGVTZXNzaW9uIChzZXNzaW9uSWQpIHtcbiAgICBsZXQgcHJvdG9jb2w7XG4gICAgdHJ5IHtcbiAgICAgIGxldCBvdGhlclNlc3Npb25zRGF0YSA9IG51bGw7XG4gICAgICBsZXQgZHN0U2Vzc2lvbiA9IG51bGw7XG4gICAgICBhd2FpdCBzZXNzaW9uc0xpc3RHdWFyZC5hY3F1aXJlKEFwcGl1bURyaXZlci5uYW1lLCAoKSA9PiB7XG4gICAgICAgIGlmICghdGhpcy5zZXNzaW9uc1tzZXNzaW9uSWRdKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGN1ckNvbnN0cnVjdG9yTmFtZSA9IHRoaXMuc2Vzc2lvbnNbc2Vzc2lvbklkXS5jb25zdHJ1Y3Rvci5uYW1lO1xuICAgICAgICBvdGhlclNlc3Npb25zRGF0YSA9IF8udG9QYWlycyh0aGlzLnNlc3Npb25zKVxuICAgICAgICAgICAgICAuZmlsdGVyKChba2V5LCB2YWx1ZV0pID0+IHZhbHVlLmNvbnN0cnVjdG9yLm5hbWUgPT09IGN1ckNvbnN0cnVjdG9yTmFtZSAmJiBrZXkgIT09IHNlc3Npb25JZClcbiAgICAgICAgICAgICAgLm1hcCgoWywgdmFsdWVdKSA9PiB2YWx1ZS5kcml2ZXJEYXRhKTtcbiAgICAgICAgZHN0U2Vzc2lvbiA9IHRoaXMuc2Vzc2lvbnNbc2Vzc2lvbklkXTtcbiAgICAgICAgcHJvdG9jb2wgPSBkc3RTZXNzaW9uLnByb3RvY29sO1xuICAgICAgICBsb2cuaW5mbyhgUmVtb3Zpbmcgc2Vzc2lvbiAke3Nlc3Npb25JZH0gZnJvbSBvdXIgbWFzdGVyIHNlc3Npb24gbGlzdGApO1xuICAgICAgICAvLyByZWdhcmRsZXNzIG9mIHdoZXRoZXIgdGhlIGRlbGV0ZVNlc3Npb24gY29tcGxldGVzIHN1Y2Nlc3NmdWxseSBvciBub3RcbiAgICAgICAgLy8gbWFrZSB0aGUgc2Vzc2lvbiB1bmF2YWlsYWJsZSwgYmVjYXVzZSB3aG8ga25vd3Mgd2hhdCBzdGF0ZSBpdCBtaWdodFxuICAgICAgICAvLyBiZSBpbiBvdGhlcndpc2VcbiAgICAgICAgZGVsZXRlIHRoaXMuc2Vzc2lvbnNbc2Vzc2lvbklkXTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcHJvdG9jb2wsXG4gICAgICAgIHZhbHVlOiBhd2FpdCBkc3RTZXNzaW9uLmRlbGV0ZVNlc3Npb24oc2Vzc2lvbklkLCBvdGhlclNlc3Npb25zRGF0YSksXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGxvZy5lcnJvcihgSGFkIHRyb3VibGUgZW5kaW5nIHNlc3Npb24gJHtzZXNzaW9uSWR9OiAke2UubWVzc2FnZX1gKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHByb3RvY29sLFxuICAgICAgICBlcnJvcjogZSxcbiAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgZXhlY3V0ZUNvbW1hbmQgKGNtZCwgLi4uYXJncykge1xuICAgIC8vIGdldFN0YXR1cyBjb21tYW5kIHNob3VsZCBub3QgYmUgcHV0IGludG8gcXVldWUuIElmIHdlIGRvIGl0IGFzIHBhcnQgb2Ygc3VwZXIuZXhlY3V0ZUNvbW1hbmQsIGl0IHdpbGwgYmUgYWRkZWQgdG8gcXVldWUuXG4gICAgLy8gVGhlcmUgd2lsbCBiZSBsb3Qgb2Ygc3RhdHVzIGNvbW1hbmRzIGluIHF1ZXVlIGR1cmluZyBjcmVhdGVTZXNzaW9uIGNvbW1hbmQsIGFzIGNyZWF0ZVNlc3Npb24gY2FuIHRha2UgdXAgdG8gb3IgbW9yZSB0aGFuIGEgbWludXRlLlxuICAgIGlmIChjbWQgPT09ICdnZXRTdGF0dXMnKSB7XG4gICAgICByZXR1cm4gYXdhaXQgdGhpcy5nZXRTdGF0dXMoKTtcbiAgICB9XG5cbiAgICBpZiAoaXNBcHBpdW1Ecml2ZXJDb21tYW5kKGNtZCkpIHtcbiAgICAgIHJldHVybiBhd2FpdCBzdXBlci5leGVjdXRlQ29tbWFuZChjbWQsIC4uLmFyZ3MpO1xuICAgIH1cblxuICAgIGNvbnN0IHNlc3Npb25JZCA9IF8ubGFzdChhcmdzKTtcbiAgICBjb25zdCBkc3RTZXNzaW9uID0gYXdhaXQgc2Vzc2lvbnNMaXN0R3VhcmQuYWNxdWlyZShBcHBpdW1Ecml2ZXIubmFtZSwgKCkgPT4gdGhpcy5zZXNzaW9uc1tzZXNzaW9uSWRdKTtcbiAgICBpZiAoIWRzdFNlc3Npb24pIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgVGhlIHNlc3Npb24gd2l0aCBpZCAnJHtzZXNzaW9uSWR9JyBkb2VzIG5vdCBleGlzdGApO1xuICAgIH1cblxuICAgIGxldCByZXMgPSB7XG4gICAgICBwcm90b2NvbDogZHN0U2Vzc2lvbi5wcm90b2NvbFxuICAgIH07XG5cbiAgICB0cnkge1xuICAgICAgcmVzLnZhbHVlID0gYXdhaXQgZHN0U2Vzc2lvbi5leGVjdXRlQ29tbWFuZChjbWQsIC4uLmFyZ3MpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIHJlcy5lcnJvciA9IGU7XG4gICAgfVxuICAgIHJldHVybiByZXM7XG4gIH1cblxuICBwcm94eUFjdGl2ZSAoc2Vzc2lvbklkKSB7XG4gICAgY29uc3QgZHN0U2Vzc2lvbiA9IHRoaXMuc2Vzc2lvbnNbc2Vzc2lvbklkXTtcbiAgICByZXR1cm4gZHN0U2Vzc2lvbiAmJiBfLmlzRnVuY3Rpb24oZHN0U2Vzc2lvbi5wcm94eUFjdGl2ZSkgJiYgZHN0U2Vzc2lvbi5wcm94eUFjdGl2ZShzZXNzaW9uSWQpO1xuICB9XG5cbiAgZ2V0UHJveHlBdm9pZExpc3QgKHNlc3Npb25JZCkge1xuICAgIGNvbnN0IGRzdFNlc3Npb24gPSB0aGlzLnNlc3Npb25zW3Nlc3Npb25JZF07XG4gICAgcmV0dXJuIGRzdFNlc3Npb24gPyBkc3RTZXNzaW9uLmdldFByb3h5QXZvaWRMaXN0KCkgOiBbXTtcbiAgfVxuXG4gIGNhblByb3h5IChzZXNzaW9uSWQpIHtcbiAgICBjb25zdCBkc3RTZXNzaW9uID0gdGhpcy5zZXNzaW9uc1tzZXNzaW9uSWRdO1xuICAgIHJldHVybiBkc3RTZXNzaW9uICYmIGRzdFNlc3Npb24uY2FuUHJveHkoc2Vzc2lvbklkKTtcbiAgfVxufVxuXG4vLyBoZWxwIGRlY2lkZSB3aGljaCBjb21tYW5kcyBzaG91bGQgYmUgcHJveGllZCB0byBzdWItZHJpdmVycyBhbmQgd2hpY2hcbi8vIHNob3VsZCBiZSBoYW5kbGVkIGJ5IHRoaXMsIG91ciB1bWJyZWxsYSBkcml2ZXJcbmZ1bmN0aW9uIGlzQXBwaXVtRHJpdmVyQ29tbWFuZCAoY21kKSB7XG4gIHJldHVybiAhaXNTZXNzaW9uQ29tbWFuZChjbWQpIHx8IGNtZCA9PT0gJ2RlbGV0ZVNlc3Npb24nO1xufVxuXG5leHBvcnQgeyBBcHBpdW1Ecml2ZXIgfTtcbiJdLCJmaWxlIjoibGliL2FwcGl1bS5qcyIsInNvdXJjZVJvb3QiOiIuLi8uLiJ9
