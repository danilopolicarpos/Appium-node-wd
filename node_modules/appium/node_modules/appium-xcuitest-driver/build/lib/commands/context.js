"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

require("source-map-support/register");

var _appiumIosDriver = require("appium-ios-driver");

var _appiumRemoteDebugger = require("appium-remote-debugger");

var _appiumSupport = require("appium-support");

let extensions = {};
Object.assign(extensions, _appiumIosDriver.iosCommands.context);

extensions.closeAlertBeforeTest = async function closeAlertBeforeTest() {
  return true;
};

extensions._setContext = extensions.setContext;

extensions.setContext = async function setContext(name, callback, skipReadyCheck) {
  await this._setContext(name, callback, skipReadyCheck);

  if (name && name !== _appiumIosDriver.NATIVE_WIN && this.logs) {
    if (this.logs.safariConsole) {
      await this.remote.startConsole(this.logs.safariConsole.addLogLine.bind(this.logs.safariConsole));
    }

    if (this.logs.safariNetwork) {
      await this.remote.startNetwork(this.logs.safariNetwork.addLogLine.bind(this.logs.safariNetwork));
    }
  }
};

extensions._getLatestWebviewContextForTitle = extensions.getLatestWebviewContextForTitle;

extensions.getLatestWebviewContextForTitle = async function getLatestWebviewContextForTitle(regExp) {
  let currentUrl = this.getCurrentUrl();

  if (!currentUrl) {
    return await this._getLatestWebviewContextForTitle(regExp);
  }

  let contexts = await this.getContextsAndViews();
  let matchingCtx;

  for (let ctx of contexts) {
    if (ctx.view) {
      let url = ctx.view.url || '';

      if (url === this.getCurrentUrl()) {
        matchingCtx = ctx;
        break;
      }
    }
  }

  if (matchingCtx) {
    return matchingCtx.id;
  }

  return await this._getLatestWebviewContextForTitle(regExp);
};

extensions.isWebContext = function isWebContext() {
  return !!this.curContext && this.curContext !== _appiumIosDriver.iosCommands.context.NATIVE_WIN;
};

extensions.isWebview = function isWebview() {
  return this.isWebContext();
};

extensions.getNewRemoteDebugger = async function getNewRemoteDebugger() {
  const socketPath = await this.opts.device.getWebInspectorSocket();
  return new _appiumRemoteDebugger.RemoteDebugger({
    bundleId: this.opts.bundleId,
    isSafari: this.isSafari(),
    useNewSafari: this.useNewSafari(),
    pageLoadMs: this.pageLoadMs,
    platformVersion: this.opts.platformVersion,
    socketPath,
    remoteDebugProxy: this.opts.remoteDebugProxy,
    garbageCollectOnExecute: _appiumSupport.util.hasValue(this.opts.safariGarbageCollect) ? !!this.opts.safariGarbageCollect : false
  });
};

extensions.mobileGetContexts = async function mobileGetContexts() {
  const curOpt = this.opts.fullContextList;

  try {
    this.opts.fullContextList = true;
    return await this.getContexts();
  } finally {
    this.opts.fullContextList = curOpt;
  }
};

extensions.getLatestWebviewContextForTitle = async function getLatestWebviewContextForTitle(regExp) {
  const contexts = await this.getContextsAndViews();
  let matchingCtx;

  for (const ctx of contexts) {
    if (ctx.view && (ctx.view.title && ctx.view.title.match(regExp) || ctx.view.url && ctx.view.url.match(regExp))) {
      matchingCtx = ctx;
      break;
    }
  }

  return matchingCtx ? matchingCtx.id : undefined;
};

var _default = extensions;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jb21tYW5kcy9jb250ZXh0LmpzIl0sIm5hbWVzIjpbImV4dGVuc2lvbnMiLCJPYmplY3QiLCJhc3NpZ24iLCJpb3NDb21tYW5kcyIsImNvbnRleHQiLCJjbG9zZUFsZXJ0QmVmb3JlVGVzdCIsIl9zZXRDb250ZXh0Iiwic2V0Q29udGV4dCIsIm5hbWUiLCJjYWxsYmFjayIsInNraXBSZWFkeUNoZWNrIiwiTkFUSVZFX1dJTiIsImxvZ3MiLCJzYWZhcmlDb25zb2xlIiwicmVtb3RlIiwic3RhcnRDb25zb2xlIiwiYWRkTG9nTGluZSIsImJpbmQiLCJzYWZhcmlOZXR3b3JrIiwic3RhcnROZXR3b3JrIiwiX2dldExhdGVzdFdlYnZpZXdDb250ZXh0Rm9yVGl0bGUiLCJnZXRMYXRlc3RXZWJ2aWV3Q29udGV4dEZvclRpdGxlIiwicmVnRXhwIiwiY3VycmVudFVybCIsImdldEN1cnJlbnRVcmwiLCJjb250ZXh0cyIsImdldENvbnRleHRzQW5kVmlld3MiLCJtYXRjaGluZ0N0eCIsImN0eCIsInZpZXciLCJ1cmwiLCJpZCIsImlzV2ViQ29udGV4dCIsImN1ckNvbnRleHQiLCJpc1dlYnZpZXciLCJnZXROZXdSZW1vdGVEZWJ1Z2dlciIsInNvY2tldFBhdGgiLCJvcHRzIiwiZGV2aWNlIiwiZ2V0V2ViSW5zcGVjdG9yU29ja2V0IiwiUmVtb3RlRGVidWdnZXIiLCJidW5kbGVJZCIsImlzU2FmYXJpIiwidXNlTmV3U2FmYXJpIiwicGFnZUxvYWRNcyIsInBsYXRmb3JtVmVyc2lvbiIsInJlbW90ZURlYnVnUHJveHkiLCJnYXJiYWdlQ29sbGVjdE9uRXhlY3V0ZSIsInV0aWwiLCJoYXNWYWx1ZSIsInNhZmFyaUdhcmJhZ2VDb2xsZWN0IiwibW9iaWxlR2V0Q29udGV4dHMiLCJjdXJPcHQiLCJmdWxsQ29udGV4dExpc3QiLCJnZXRDb250ZXh0cyIsInRpdGxlIiwibWF0Y2giLCJ1bmRlZmluZWQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBOztBQUNBOztB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QVMwQixLQUFULENBQWVDLEtBQWYsQ0FBcUJsQyxNQUFyQixDQUFuQixJQUFxRE0sR0FBRyxDQUFDQyxJQUFKLENBQVNDLEdBQVQsSUFBZ0JGLEdBQUcsQ0FBQ0MsSUFBSixDQUFTQyxHQUFULENBQWEwQixLQUFiLENBQW1CbEMsTUFBbkIsQ0FBbEYsQ0FBSixFQUFvSDtBQUNsSEssTUFBQUEsV0FBVyxHQUFHQyxHQUFkO0FBQ0E7QUFDRDtBQUNGOztBQUNELFNBQU9ELFdBQVcsR0FBR0EsV0FBVyxDQUFDSSxFQUFmLEdBQW9CMEIsU0FBdEM7QUFDRCxDQVZEOztlQWFlekQsVSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGlvc0NvbW1hbmRzLCBOQVRJVkVfV0lOIH0gZnJvbSAnYXBwaXVtLWlvcy1kcml2ZXInO1xuaW1wb3J0IHsgUmVtb3RlRGVidWdnZXIgfSBmcm9tICdhcHBpdW0tcmVtb3RlLWRlYnVnZ2VyJztcbmltcG9ydCB7IHV0aWwgfSBmcm9tICdhcHBpdW0tc3VwcG9ydCc7XG5cbmxldCBleHRlbnNpb25zID0ge307XG5cbk9iamVjdC5hc3NpZ24oZXh0ZW5zaW9ucywgaW9zQ29tbWFuZHMuY29udGV4dCk7XG5cbi8vIG92ZXJyaWRlLCBhcyBhcHBpdW0taW9zLWRyaXZlcidzIHZlcnNpb24gdXNlcyBVSSBBdXRvbWF0aW9uIHRvIGNsb3NlXG5leHRlbnNpb25zLmNsb3NlQWxlcnRCZWZvcmVUZXN0ID0gYXN5bmMgZnVuY3Rpb24gY2xvc2VBbGVydEJlZm9yZVRlc3QgKCkgeyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHJlcXVpcmUtYXdhaXRcbiAgcmV0dXJuIHRydWU7XG59O1xuXG5leHRlbnNpb25zLl9zZXRDb250ZXh0ID0gZXh0ZW5zaW9ucy5zZXRDb250ZXh0O1xuZXh0ZW5zaW9ucy5zZXRDb250ZXh0ID0gYXN5bmMgZnVuY3Rpb24gc2V0Q29udGV4dCAobmFtZSwgY2FsbGJhY2ssIHNraXBSZWFkeUNoZWNrKSB7XG4gIGF3YWl0IHRoaXMuX3NldENvbnRleHQobmFtZSwgY2FsbGJhY2ssIHNraXBSZWFkeUNoZWNrKTtcblxuICAvLyBzdGFydCBzYWZhcmkgbG9nZ2luZyBpZiB0aGUgbG9ncyBoYW5kbGVycyBhcmUgYWN0aXZlXG4gIGlmIChuYW1lICYmIG5hbWUgIT09IE5BVElWRV9XSU4gJiYgdGhpcy5sb2dzKSB7XG4gICAgaWYgKHRoaXMubG9ncy5zYWZhcmlDb25zb2xlKSB7XG4gICAgICBhd2FpdCB0aGlzLnJlbW90ZS5zdGFydENvbnNvbGUodGhpcy5sb2dzLnNhZmFyaUNvbnNvbGUuYWRkTG9nTGluZS5iaW5kKHRoaXMubG9ncy5zYWZhcmlDb25zb2xlKSk7XG4gICAgfVxuICAgIGlmICh0aGlzLmxvZ3Muc2FmYXJpTmV0d29yaykge1xuICAgICAgYXdhaXQgdGhpcy5yZW1vdGUuc3RhcnROZXR3b3JrKHRoaXMubG9ncy5zYWZhcmlOZXR3b3JrLmFkZExvZ0xpbmUuYmluZCh0aGlzLmxvZ3Muc2FmYXJpTmV0d29yaykpO1xuICAgIH1cbiAgfVxufTtcblxuLy8gdGhlIGFwcGl1bS1pb3MtZHJpdmVyIHZlcnNpb24gb2YgdGhpcyBmdW5jdGlvbiBmYWlscyBpbiBDSSxcbi8vIGFuZCB0aGUgd3Jvbmcgd2VidmlldyBpcyBhbG1vc3QgYWx3YXlzIHJldHJpZXZlZFxuZXh0ZW5zaW9ucy5fZ2V0TGF0ZXN0V2Vidmlld0NvbnRleHRGb3JUaXRsZSA9IGV4dGVuc2lvbnMuZ2V0TGF0ZXN0V2Vidmlld0NvbnRleHRGb3JUaXRsZTtcbmV4dGVuc2lvbnMuZ2V0TGF0ZXN0V2Vidmlld0NvbnRleHRGb3JUaXRsZSA9IGFzeW5jIGZ1bmN0aW9uIGdldExhdGVzdFdlYnZpZXdDb250ZXh0Rm9yVGl0bGUgKHJlZ0V4cCkge1xuICBsZXQgY3VycmVudFVybCA9IHRoaXMuZ2V0Q3VycmVudFVybCgpO1xuICBpZiAoIWN1cnJlbnRVcmwpIHtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5fZ2V0TGF0ZXN0V2Vidmlld0NvbnRleHRGb3JUaXRsZShyZWdFeHApO1xuICB9XG5cbiAgbGV0IGNvbnRleHRzID0gYXdhaXQgdGhpcy5nZXRDb250ZXh0c0FuZFZpZXdzKCk7XG4gIGxldCBtYXRjaGluZ0N0eDtcbiAgZm9yIChsZXQgY3R4IG9mIGNvbnRleHRzKSB7XG4gICAgaWYgKGN0eC52aWV3KSB7XG4gICAgICBsZXQgdXJsID0gY3R4LnZpZXcudXJsIHx8ICcnO1xuICAgICAgaWYgKHVybCA9PT0gdGhpcy5nZXRDdXJyZW50VXJsKCkpIHtcbiAgICAgICAgbWF0Y2hpbmdDdHggPSBjdHg7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICBpZiAobWF0Y2hpbmdDdHgpIHtcbiAgICByZXR1cm4gbWF0Y2hpbmdDdHguaWQ7XG4gIH1cbiAgcmV0dXJuIGF3YWl0IHRoaXMuX2dldExhdGVzdFdlYnZpZXdDb250ZXh0Rm9yVGl0bGUocmVnRXhwKTtcbn07XG5cbmV4dGVuc2lvbnMuaXNXZWJDb250ZXh0ID0gZnVuY3Rpb24gaXNXZWJDb250ZXh0ICgpIHtcbiAgcmV0dXJuICEhdGhpcy5jdXJDb250ZXh0ICYmIHRoaXMuY3VyQ29udGV4dCAhPT0gaW9zQ29tbWFuZHMuY29udGV4dC5OQVRJVkVfV0lOO1xufTtcblxuZXh0ZW5zaW9ucy5pc1dlYnZpZXcgPSBmdW5jdGlvbiBpc1dlYnZpZXcgKCkge1xuICByZXR1cm4gdGhpcy5pc1dlYkNvbnRleHQoKTtcbn07XG5cbmV4dGVuc2lvbnMuZ2V0TmV3UmVtb3RlRGVidWdnZXIgPSBhc3luYyBmdW5jdGlvbiBnZXROZXdSZW1vdGVEZWJ1Z2dlciAoKSB7XG4gIGNvbnN0IHNvY2tldFBhdGggPSBhd2FpdCB0aGlzLm9wdHMuZGV2aWNlLmdldFdlYkluc3BlY3RvclNvY2tldCgpO1xuICByZXR1cm4gbmV3IFJlbW90ZURlYnVnZ2VyKHtcbiAgICBidW5kbGVJZDogdGhpcy5vcHRzLmJ1bmRsZUlkLFxuICAgIGlzU2FmYXJpOiB0aGlzLmlzU2FmYXJpKCksXG4gICAgdXNlTmV3U2FmYXJpOiB0aGlzLnVzZU5ld1NhZmFyaSgpLFxuICAgIHBhZ2VMb2FkTXM6IHRoaXMucGFnZUxvYWRNcyxcbiAgICBwbGF0Zm9ybVZlcnNpb246IHRoaXMub3B0cy5wbGF0Zm9ybVZlcnNpb24sXG4gICAgc29ja2V0UGF0aCxcbiAgICByZW1vdGVEZWJ1Z1Byb3h5OiB0aGlzLm9wdHMucmVtb3RlRGVidWdQcm94eSxcbiAgICBnYXJiYWdlQ29sbGVjdE9uRXhlY3V0ZTogdXRpbC5oYXNWYWx1ZSh0aGlzLm9wdHMuc2FmYXJpR2FyYmFnZUNvbGxlY3QpXG4gICAgICA/ICEhdGhpcy5vcHRzLnNhZmFyaUdhcmJhZ2VDb2xsZWN0XG4gICAgICA6IGZhbHNlLFxuICB9KTtcbn07XG5cbi8qKlxuICogQHR5cGVkZWYge09iamVjdH0gQ29udGV4dFxuICpcbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBpZCAtIFRoZSBpZGVudGlmaWVyIG9mIHRoZSBjb250ZXh0LiBUaGUgbmF0aXZlIGNvbnRleHRcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICB3aWxsIGJlICdOQVRJVkVfQVBQJyBhbmQgdGhlIHdlYnZpZXdzIHdpbGwgYmVcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAnV0VCVklFV194eHgnXG4gKiBAcHJvcGVydHkgez9zdHJpbmd9IHRpdGxlIC0gVGhlIHRpdGxlIGFzc29jaWF0ZWQgd2l0aCB0aGUgd2VidmlldyBjb250ZW50XG4gKiBAcHJvcGVydHkgez9zdHJpbmd9IHVybCAtIFRoZSB1cmwgYXNzb2NpYXRlZCB3aXRoIHRoZSB3ZWJ2aWV3IGNvbnRlbnRcbiAqL1xuXG4vKipcbiAqIEdldCB0aGUgY29udGV4dHMgYXZhaWxhYmxlLCB3aXRoIGluZm9ybWF0aW9uIGFib3V0IHRoZSB1cmwgYW5kIHRpdGxlIG9mIGVhY2hcbiAqIHdlYnZpZXdcbiAqIEByZXR1cm5zIHtBcnJheX0gTGlzdCBvZiBDb250ZXh0IG9iamVjdHNcbiAqL1xuZXh0ZW5zaW9ucy5tb2JpbGVHZXRDb250ZXh0cyA9IGFzeW5jIGZ1bmN0aW9uIG1vYmlsZUdldENvbnRleHRzICgpIHtcbiAgY29uc3QgY3VyT3B0ID0gdGhpcy5vcHRzLmZ1bGxDb250ZXh0TGlzdDtcbiAgdHJ5IHtcbiAgICAvLyBgYXBwaXVtLWlvcy1kcml2ZXIjZ2V0Q29udGV4dHNgIHJldHVybnMgdGhlIGZ1bGwgbGlzdCBvZiBjb250ZXh0c1xuICAgIC8vIGlmIHRoaXMgb3B0aW9uIGlzIG9uXG4gICAgdGhpcy5vcHRzLmZ1bGxDb250ZXh0TGlzdCA9IHRydWU7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuZ2V0Q29udGV4dHMoKTtcbiAgfSBmaW5hbGx5IHtcbiAgICAvLyByZXNldCB0aGUgb3B0aW9uIHNvIHRoZXJlIGFyZSBubyBzaWRlIGVmZmVjdHNcbiAgICB0aGlzLm9wdHMuZnVsbENvbnRleHRMaXN0ID0gY3VyT3B0O1xuICB9XG59O1xuXG4vLyBvdmVycmlkZSBzbyB0aGF0IHRoZSBjYXNlIHdoZXJlIHRoZSBTREsgdmVyc2lvbiBpcyBub3Qgc2V0IGRvZXMgbm90IGZhaWxcbmV4dGVuc2lvbnMuZ2V0TGF0ZXN0V2Vidmlld0NvbnRleHRGb3JUaXRsZSA9IGFzeW5jIGZ1bmN0aW9uIGdldExhdGVzdFdlYnZpZXdDb250ZXh0Rm9yVGl0bGUgKHJlZ0V4cCkge1xuICBjb25zdCBjb250ZXh0cyA9IGF3YWl0IHRoaXMuZ2V0Q29udGV4dHNBbmRWaWV3cygpO1xuICBsZXQgbWF0Y2hpbmdDdHg7XG4gIGZvciAoY29uc3QgY3R4IG9mIGNvbnRleHRzKSB7XG4gICAgaWYgKGN0eC52aWV3ICYmICgoY3R4LnZpZXcudGl0bGUgJiYgY3R4LnZpZXcudGl0bGUubWF0Y2gocmVnRXhwKSkgfHwgKGN0eC52aWV3LnVybCAmJiBjdHgudmlldy51cmwubWF0Y2gocmVnRXhwKSkpKSB7XG4gICAgICBtYXRjaGluZ0N0eCA9IGN0eDtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuICByZXR1cm4gbWF0Y2hpbmdDdHggPyBtYXRjaGluZ0N0eC5pZCA6IHVuZGVmaW5lZDtcbn07XG5cblxuZXhwb3J0IGRlZmF1bHQgZXh0ZW5zaW9ucztcbiJdLCJmaWxlIjoibGliL2NvbW1hbmRzL2NvbnRleHQuanMiLCJzb3VyY2VSb290IjoiLi4vLi4vLi4ifQ==
