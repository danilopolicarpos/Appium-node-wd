"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.helpers = exports.commands = void 0;

require("source-map-support/register");

var _logger = _interopRequireDefault(require("../logger"));

var _appiumBaseDriver = require("appium-base-driver");

let commands = {},
    helpers = {},
    extensions = {};
exports.helpers = helpers;
exports.commands = commands;

commands.getCookies = async function getCookies() {
  if (!this.isWebContext()) {
    throw new _appiumBaseDriver.errors.NotImplementedError();
  }

  const cookies = (await this.remote.getCookies()) || {
    cookies: []
  };
  return cookies.cookies.map(function mapCookie(cookie) {
    return Object.assign({}, cookie, {
      value: decodeURI(cookie.value)
    });
  });
};

commands.deleteCookie = async function deleteCookie(cookieName) {
  if (!this.isWebContext()) {
    throw new _appiumBaseDriver.errors.NotImplementedError();
  }

  const cookies = await this.getCookies();
  const cookie = cookies.find(cookie => cookie.name === cookieName);

  if (!cookie) {
    _logger.default.debug(`Cookie '${cookieName}' not found. Ignoring.`);

    return true;
  }

  await this._deleteCookie(cookie);
  return true;
};

commands.deleteCookies = async function deleteCookies() {
  if (!this.isWebContext()) {
    throw new _appiumBaseDriver.errors.NotImplementedError();
  }

  const cookies = await this.getCookies();

  for (const cookie of cookies) {
    await this._deleteCookie(cookie);
  }

  return true;
};

helpers._deleteCookie = async function _deleteCookie(cookie) {
  const url = `http${cookie.secure ? 's' : ''}://${cookie.domain}${cookie.path}`;
  return await this.remote.deleteCookie(cookie.name, url);
};

Object.assign(extensions, commands, helpers);
var _default = extensions;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jb21tYW5kcy9jb29raWVzLmpzIl0sIm5hbWVzIjpbImNvbW1hbmRzIiwiaGVscGVycyIsImV4dGVuc2lvbnMiLCJnZXRDb29raWVzIiwiaXNXZWJDb250ZXh0IiwiZXJyb3JzIiwiTm90SW1wbGVtZW50ZWRFcnJvciIsImNvb2tpZXMiLCJyZW1vdGUiLCJtYXAiLCJtYXBDb29raWUiLCJjb29raWUiLCJPYmplY3QiLCJhc3NpZ24iLCJ2YWx1ZSIsImRlY29kZVVSSSIsImRlbGV0ZUNvb2tpZSIsImNvb2tpZU5hbWUiLCJmaW5kIiwibmFtZSIsImxvZyIsImRlYnVnIiwiX2RlbGV0ZUNvb2tpZSIsImRlbGV0ZUNvb2tpZXMiLCJ1cmwiLCJzZWN1cmUiLCJkb21haW4iLCJwYXRoIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUdBLElBQUlBLFFBQVEsR0FBRyxFQUFmO0FBQUEsSUFBbUJDLE9BQU8sR0FBRyxFQUE3QjtBQUFBLElBQWlDQyxVQUFVLEdBQUcsRUFBOUM7Ozs7QUFFQUYsUUFBUSxDQUFDRyxVQUFULEdBQXNCLGVBQWVBLFVBQWYsR0FBNkI7QUFDakQsTUFBSSxDQUFDLEtBQUtDLFlBQUwsRUFBTCxFQUEwQjtBQUN4QixVQUFNLElBQUlDLHlCQUFPQyxtQkFBWCxFQUFOO0FBQ0Q7O0FBR0QsUUFBTUMsT0FBTyxHQUFHLE9BQU0sS0FBS0MsTUFBTCxDQUFZTCxVQUFaLEVBQU4sS0FBa0M7QUFBQ0ksSUFBQUEsT0FBTyxFQUFFO0FBQVYsR0FBbEQ7QUFHQSxTQUFPQSxPQUFPLENBQUNBLE9BQVIsQ0FBZ0JFLEdBQWhCLENBQW9CLFNBQVNDLFNBQVQsQ0FBb0JDLE1BQXBCLEVBQTRCO0FBQ3JELFdBQU9DLE1BQU0sQ0FBQ0MsTUFBUCxDQUFjLEVBQWQsRUFBa0JGLE1BQWxCLEVBQTBCO0FBQy9CRyxNQUFBQSxLQUFLLEVBQUVDLFNBQVMsQ0FBQ0osTUFBTSxDQUFDRyxLQUFSO0FBRGUsS0FBMUIsQ0FBUDtBQUdELEdBSk0sQ0FBUDtBQUtELENBZEQ7O0FBZ0JBZCxRQUFRLENBQUNnQixZQUFULEdBQXdCLGVBQWVBLFlBQWYsQ0FBNkJDLFVBQTdCLEVBQXlDO0FBQy9ELE1BQUksQ0FBQyxLQUFLYixZQUFMLEVBQUwsRUFBMEI7QUFDeEIsVUFBTSxJQUFJQyx5QkFBT0MsbUJBQVgsRUFBTjtBQUNEOztBQUVELFFBQU1DLE9BQU8sR0FBRyxNQUFNLEtBQUtKLFVBQUwsRUFBdEI7QUFDQSxRQUFNUSxNQUFNLEdBQUdKLE9BQU8sQ0FBQ1csSUFBUixDQUFjUCxNQUFELElBQVlBLE1BQU0sQ0FBQ1EsSUFBUCxLQUFnQkYsVUFBekMsQ0FBZjs7QUFDQSxNQUFJLENBQUNOLE1BQUwsRUFBYTtBQUNYUyxvQkFBSUMsS0FBSixDQUFXLFdBQVVKLFVBQVcsd0JBQWhDOztBQUNBLFdBQU8sSUFBUDtBQUNEOztBQUVELFFBQU0sS0FBS0ssYUFBTCxDQUFtQlgsTUFBbkIsQ0FBTjtBQUNBLFNBQU8sSUFBUDtBQUNELENBZEQ7O0FBZ0JBWCxRQUFRLENBQUN1QixhQUFULEdBQXlCLGVBQWVBLGFBQWYsR0FBZ0M7QUFDdkQsTUFBSSxDQUFDLEtBQUtuQixZQUFMLEVBQUwsRUFBMEI7QUFDeEIsVUFBTSxJQUFJQyx5QkFBT0MsbUJBQVgsRUFBTjtBQUNEOztBQUVELFFBQU1DLE9BQU8sR0FBRyxNQUFNLEtBQUtKLFVBQUwsRUFBdEI7O0FBQ0EsT0FBSyxNQUFNUSxNQUFYLElBQXFCSixPQUFyQixFQUE4QjtBQUM1QixVQUFNLEtBQUtlLGFBQUwsQ0FBbUJYLE1BQW5CLENBQU47QUFDRDs7QUFDRCxTQUFPLElBQVA7QUFDRCxDQVZEOztBQVlBVixPQUFPLENBQUNxQixhQUFSLEdBQXdCLGVBQWVBLGFBQWYsQ0FBOEJYLE1BQTlCLEVBQXNDO0FBQzVELFFBQU1hLEdBQUcsR0FBSSxPQUFNYixNQUFNLENBQUNjLE1BQVAsR0FBZ0IsR0FBaEIsR0FBc0IsRUFBRyxNQUFLZCxNQUFNLENBQUNlLE1BQU8sR0FBRWYsTUFBTSxDQUFDZ0IsSUFBSyxFQUE3RTtBQUNBLFNBQU8sTUFBTSxLQUFLbkIsTUFBTCxDQUFZUSxZQUFaLENBQXlCTCxNQUFNLENBQUNRLElBQWhDLEVBQXNDSyxHQUF0QyxDQUFiO0FBQ0QsQ0FIRDs7QUFLQVosTUFBTSxDQUFDQyxNQUFQLENBQWNYLFVBQWQsRUFBMEJGLFFBQTFCLEVBQW9DQyxPQUFwQztlQUVlQyxVIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGxvZyBmcm9tICcuLi9sb2dnZXInO1xuaW1wb3J0IHsgZXJyb3JzIH0gZnJvbSAnYXBwaXVtLWJhc2UtZHJpdmVyJztcblxuXG5sZXQgY29tbWFuZHMgPSB7fSwgaGVscGVycyA9IHt9LCBleHRlbnNpb25zID0ge307XG5cbmNvbW1hbmRzLmdldENvb2tpZXMgPSBhc3luYyBmdW5jdGlvbiBnZXRDb29raWVzICgpIHtcbiAgaWYgKCF0aGlzLmlzV2ViQ29udGV4dCgpKSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5Ob3RJbXBsZW1lbnRlZEVycm9yKCk7XG4gIH1cblxuICAvLyBnZXQgdGhlIGNvb2tpZXMgZnJvbSB0aGUgcmVtb3RlIGRlYnVnZ2VyLCBvciBhbiBlbXB0eSBvYmplY3RcbiAgY29uc3QgY29va2llcyA9IGF3YWl0IHRoaXMucmVtb3RlLmdldENvb2tpZXMoKSB8fCB7Y29va2llczogW119O1xuICAvLyB0aGUgdmFsdWUgaXMgVVJJIGVuY29kZWQsIHNvIGRlY29kZSBpdFxuICAvLyBidXQga2VlcCBhbGwgdGhlIHJlc3Qgb2YgdGhlIGluZm8gaW50YWN0XG4gIHJldHVybiBjb29raWVzLmNvb2tpZXMubWFwKGZ1bmN0aW9uIG1hcENvb2tpZSAoY29va2llKSB7XG4gICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oe30sIGNvb2tpZSwge1xuICAgICAgdmFsdWU6IGRlY29kZVVSSShjb29raWUudmFsdWUpLFxuICAgIH0pO1xuICB9KTtcbn07XG5cbmNvbW1hbmRzLmRlbGV0ZUNvb2tpZSA9IGFzeW5jIGZ1bmN0aW9uIGRlbGV0ZUNvb2tpZSAoY29va2llTmFtZSkge1xuICBpZiAoIXRoaXMuaXNXZWJDb250ZXh0KCkpIHtcbiAgICB0aHJvdyBuZXcgZXJyb3JzLk5vdEltcGxlbWVudGVkRXJyb3IoKTtcbiAgfVxuXG4gIGNvbnN0IGNvb2tpZXMgPSBhd2FpdCB0aGlzLmdldENvb2tpZXMoKTtcbiAgY29uc3QgY29va2llID0gY29va2llcy5maW5kKChjb29raWUpID0+IGNvb2tpZS5uYW1lID09PSBjb29raWVOYW1lKTtcbiAgaWYgKCFjb29raWUpIHtcbiAgICBsb2cuZGVidWcoYENvb2tpZSAnJHtjb29raWVOYW1lfScgbm90IGZvdW5kLiBJZ25vcmluZy5gKTtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIGF3YWl0IHRoaXMuX2RlbGV0ZUNvb2tpZShjb29raWUpO1xuICByZXR1cm4gdHJ1ZTtcbn07XG5cbmNvbW1hbmRzLmRlbGV0ZUNvb2tpZXMgPSBhc3luYyBmdW5jdGlvbiBkZWxldGVDb29raWVzICgpIHtcbiAgaWYgKCF0aGlzLmlzV2ViQ29udGV4dCgpKSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5Ob3RJbXBsZW1lbnRlZEVycm9yKCk7XG4gIH1cblxuICBjb25zdCBjb29raWVzID0gYXdhaXQgdGhpcy5nZXRDb29raWVzKCk7XG4gIGZvciAoY29uc3QgY29va2llIG9mIGNvb2tpZXMpIHtcbiAgICBhd2FpdCB0aGlzLl9kZWxldGVDb29raWUoY29va2llKTtcbiAgfVxuICByZXR1cm4gdHJ1ZTtcbn07XG5cbmhlbHBlcnMuX2RlbGV0ZUNvb2tpZSA9IGFzeW5jIGZ1bmN0aW9uIF9kZWxldGVDb29raWUgKGNvb2tpZSkge1xuICBjb25zdCB1cmwgPSBgaHR0cCR7Y29va2llLnNlY3VyZSA/ICdzJyA6ICcnfTovLyR7Y29va2llLmRvbWFpbn0ke2Nvb2tpZS5wYXRofWA7XG4gIHJldHVybiBhd2FpdCB0aGlzLnJlbW90ZS5kZWxldGVDb29raWUoY29va2llLm5hbWUsIHVybCk7XG59O1xuXG5PYmplY3QuYXNzaWduKGV4dGVuc2lvbnMsIGNvbW1hbmRzLCBoZWxwZXJzKTtcbmV4cG9ydCB7IGNvbW1hbmRzLCBoZWxwZXJzIH07XG5leHBvcnQgZGVmYXVsdCBleHRlbnNpb25zO1xuIl0sImZpbGUiOiJsaWIvY29tbWFuZHMvY29va2llcy5qcyIsInNvdXJjZVJvb3QiOiIuLi8uLi8uLiJ9
