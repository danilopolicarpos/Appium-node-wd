"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.commands = void 0;

require("source-map-support/register");

var _logger = _interopRequireDefault(require("../logger"));

var _lodash = _interopRequireDefault(require("lodash"));

var _asyncbox = require("asyncbox");

let commands = {},
    extensions = {};
exports.commands = commands;

commands.getAttribute = async function (attribute, elementId) {
  elementId = this.getAutomationId(elementId);
  let params = {
    attribute,
    elementId
  };
  return await this.bootstrap.sendAction("element:getAttribute", params);
};

commands.setAttribute = async function (attribute, value, elementId) {
  elementId = this.getAutomationId(elementId);
  let params = {
    attribute,
    value,
    elementId
  };
  return await this.bootstrap.sendAction("element:setAttribute", params);
};

commands.getLocation = async function (elementId) {
  elementId = this.getAutomationId(elementId);
  return await this.bootstrap.sendAction("element:location", {
    elementId
  });
};

commands.getLocationInView = async function (elementId) {
  return await this.getLocation(elementId);
};

commands.getLocationValueByElementId = async function (elementId) {
  return await this.getLocation(elementId);
};

commands.getText = async function (elementId) {
  elementId = this.getAutomationId(elementId);
  return await this.bootstrap.sendAction("element:getText", {
    elementId
  });
};

commands.elementEnabled = async function (elementId) {
  elementId = this.getAutomationId(elementId);
  return await this.bootstrap.sendAction("element:enabled", {
    elementId
  });
};

commands.elementDisplayed = async function (elementId) {
  elementId = this.getAutomationId(elementId);
  return await this.bootstrap.sendAction("element:displayed", {
    elementId
  });
};

commands.elementSelected = function () {
  _logger.default.info('elementSelected not supported');

  return false;
};

commands.getSize = async function (elementId) {
  elementId = this.getAutomationId(elementId);
  return await this.bootstrap.sendAction("element:size", {
    elementId
  });
};

commands.setValue = async function (keys, elementId) {
  let text = keys.join();
  elementId = this.getAutomationId(elementId);
  let params = {
    elementId,
    text,
    replace: false
  };
  return await this.bootstrap.sendAction("element:setText", params);
};

commands.setValueImmediate = async function (keys, elementId) {
  let text = _lodash.default.isArray(keys) ? keys.join('') : keys;
  elementId = this.getAutomationId(elementId);
  let params = {
    elementId,
    text,
    replace: false
  };
  return await this.bootstrap.sendAction("element:setText", params);
};

commands.clear = async function (elementId) {
  elementId = this.getAutomationId(elementId);
  let params = {
    elementId,
    text: "",
    replace: true
  };
  return await this.bootstrap.sendAction("element:setText", params);
};

commands.replaceValue = async function (value, elementId) {
  elementId = this.getAutomationId(elementId);
  let params = {
    elementId,
    text: value,
    replace: true
  };
  return await this.bootstrap.sendAction("element:setText", params);
};

commands.click = async function (elementId, x = 0, y = 0) {
  if (x === this.sessionId) {
    x = 0;
  }

  if (y === this.sessionId) {
    y = 0;
  }

  if (elementId) {
    elementId = this.getAutomationId(elementId);
  } else {
    elementId = "";
  }

  let params = {
    elementId,
    x: _lodash.default.toInteger(x),
    y: _lodash.default.toInteger(y)
  };
  return await this.bootstrap.sendAction("element:click", params);
};

commands.touchUp = async function (x = 1, y = 1, elementId = "") {
  if (elementId && elementId !== this.sessionId) {
    elementId = this.getAutomationId(elementId);
  } else {
    elementId = "";
  }

  let params = {
    elementId,
    x: _lodash.default.toInteger(x),
    y: _lodash.default.toInteger(y)
  };
  return await this.bootstrap.sendAction("element:touchUp", params);
};

commands.touchDown = async function (x, y, elementId = "") {
  if (elementId && elementId !== this.sessionId) {
    elementId = this.getAutomationId(elementId);
  } else {
    elementId = "";
  }

  let params = {
    elementId,
    x: _lodash.default.toInteger(x),
    y: _lodash.default.toInteger(y)
  };
  return await this.bootstrap.sendAction("element:touchDown", params);
};

commands.touchMove = async function (xDown, yDown, xUp, yUp, steps = 10, elementId = null) {
  if (elementId && elementId !== this.sessionId) {
    elementId = this.getAutomationId(elementId);
  } else {
    elementId = "";
  }

  let params = {
    elementId,
    xDown: _lodash.default.toInteger(xDown),
    yDown: _lodash.default.toInteger(yDown),
    xUp: _lodash.default.toInteger(xUp),
    yUp: _lodash.default.toInteger(yUp),
    steps: _lodash.default.toInteger(steps)
  };
  return await this.bootstrap.sendAction("element:touchMove", params);
};

commands.touchLongClick = async function (elementId, x, y, duration) {
  await this.touchDown(x, y, elementId);
  await (0, _asyncbox.sleep)(duration);
  return await this.touchUp(x, y, elementId);
};

commands.tap = async function (elementId, x = 0, y = 0, count = 1) {
  let result = true;
  let tapResult = false;

  for (let i = 0; i < count; i++) {
    tapResult = await this.click(elementId, x, y);

    if (!tapResult) {
      result = false;
    }
  }

  return result;
};

Object.assign(extensions, commands);
var _default = extensions;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jb21tYW5kcy9lbGVtZW50LmpzIl0sIm5hbWVzIjpbImNvbW1hbmRzIiwiZXh0ZW5zaW9ucyIsImdldEF0dHJpYnV0ZSIsImF0dHJpYnV0ZSIsImVsZW1lbnRJZCIsImdldEF1dG9tYXRpb25JZCIsInBhcmFtcyIsImJvb3RzdHJhcCIsInNlbmRBY3Rpb24iLCJzZXRBdHRyaWJ1dGUiLCJ2YWx1ZSIsImdldExvY2F0aW9uIiwiZ2V0TG9jYXRpb25JblZpZXciLCJnZXRMb2NhdGlvblZhbHVlQnlFbGVtZW50SWQiLCJnZXRUZXh0IiwiZWxlbWVudEVuYWJsZWQiLCJlbGVtZW50RGlzcGxheWVkIiwiZWxlbWVudFNlbGVjdGVkIiwibG9nIiwiaW5mbyIsImdldFNpemUiLCJzZXRWYWx1ZSIsImtleXMiLCJ0ZXh0Iiwiam9pbiIsInJlcGxhY2UiLCJzZXRWYWx1ZUltbWVkaWF0ZSIsIl8iLCJpc0FycmF5IiwiY2xlYXIiLCJyZXBsYWNlVmFsdWUiLCJjbGljayIsIngiLCJ5Iiwic2Vzc2lvbklkIiwidG9JbnRlZ2VyIiwidG91Y2hVcCIsInRvdWNoRG93biIsInRvdWNoTW92ZSIsInhEb3duIiwieURvd24iLCJ4VXAiLCJ5VXAiLCJzdGVwcyIsInRvdWNoTG9uZ0NsaWNrIiwiZHVyYXRpb24iLCJ0YXAiLCJjb3VudCIsInJlc3VsdCIsInRhcFJlc3VsdCIsImkiLCJPYmplY3QiLCJhc3NpZ24iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0EsSUFBSUEsUUFBUSxHQUFHLEVBQWY7QUFBQSxJQUFtQkMsVUFBVSxHQUFHLEVBQWhDOzs7QUFFQUQsUUFBUSxDQUFDRSxZQUFULEdBQXdCLGdCQUFnQkMsU0FBaEIsRUFBMkJDLFNBQTNCLEVBQXNDO0FBQzVEQSxFQUFBQSxTQUFTLEdBQUcsS0FBS0MsZUFBTCxDQUFxQkQsU0FBckIsQ0FBWjtBQUNBLE1BQUlFLE1BQU0sR0FBRztBQUNYSCxJQUFBQSxTQURXO0FBRVhDLElB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YjtBQUNELENBSkQ7O0FBTUFKLFFBQVEsQ0FBQzhDLEdBQVQsR0FBZSxnQkFBZ0IxQyxTQUFoQixFQUEyQjRCLENBQUMsR0FBRyxDQUEvQixFQUFrQ0MsQ0FBQyxHQUFHLENBQXRDLEVBQXlDYyxLQUFLLEdBQUcsQ0FBakQsRUFBb0Q7QUFDakUsTUFBSUMsTUFBTSxHQUFHLElBQWI7QUFDQSxNQUFJQyxTQUFTLEdBQUcsS0FBaEI7O0FBQ0EsT0FBSyxJQUFJQyxDQUFDLEdBQUcsQ0FBYixFQUFnQkEsQ0FBQyxHQUFHSCxLQUFwQixFQUEyQkcsQ0FBQyxFQUE1QixFQUFnQztBQUM5QkQsSUFBQUEsU0FBUyxHQUFHLE1BQU0sS0FBS2xCLEtBQUwsQ0FBVzNCLFNBQVgsRUFBc0I0QixDQUF0QixFQUF5QkMsQ0FBekIsQ0FBbEI7O0FBQ0EsUUFBSSxDQUFDZ0IsU0FBTCxFQUFnQjtBQUNkRCxNQUFBQSxNQUFNLEdBQUcsS0FBVDtBQUNEO0FBQ0Y7O0FBQ0QsU0FBT0EsTUFBUDtBQUNELENBVkQ7O0FBWUFHLE1BQU0sQ0FBQ0MsTUFBUCxDQUFjbkQsVUFBZCxFQUEwQkQsUUFBMUI7ZUFFZUMsVSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBsb2cgZnJvbSAnLi4vbG9nZ2VyJztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgeyBzbGVlcCB9IGZyb20gJ2FzeW5jYm94JztcbmxldCBjb21tYW5kcyA9IHt9LCBleHRlbnNpb25zID0ge307XG5cbmNvbW1hbmRzLmdldEF0dHJpYnV0ZSA9IGFzeW5jIGZ1bmN0aW9uIChhdHRyaWJ1dGUsIGVsZW1lbnRJZCkge1xuICBlbGVtZW50SWQgPSB0aGlzLmdldEF1dG9tYXRpb25JZChlbGVtZW50SWQpO1xuICBsZXQgcGFyYW1zID0ge1xuICAgIGF0dHJpYnV0ZSxcbiAgICBlbGVtZW50SWRcbiAgfTtcbiAgcmV0dXJuIGF3YWl0IHRoaXMuYm9vdHN0cmFwLnNlbmRBY3Rpb24oXCJlbGVtZW50OmdldEF0dHJpYnV0ZVwiLCBwYXJhbXMpO1xufTtcblxuY29tbWFuZHMuc2V0QXR0cmlidXRlID0gYXN5bmMgZnVuY3Rpb24gKGF0dHJpYnV0ZSwgdmFsdWUsIGVsZW1lbnRJZCkge1xuICBlbGVtZW50SWQgPSB0aGlzLmdldEF1dG9tYXRpb25JZChlbGVtZW50SWQpO1xuICBsZXQgcGFyYW1zID0ge1xuICAgIGF0dHJpYnV0ZSxcbiAgICB2YWx1ZSxcbiAgICBlbGVtZW50SWRcbiAgfTtcbiAgcmV0dXJuIGF3YWl0IHRoaXMuYm9vdHN0cmFwLnNlbmRBY3Rpb24oXCJlbGVtZW50OnNldEF0dHJpYnV0ZVwiLCBwYXJhbXMpO1xufTtcblxuY29tbWFuZHMuZ2V0TG9jYXRpb24gPSBhc3luYyBmdW5jdGlvbiAoZWxlbWVudElkKSB7XG4gIGVsZW1lbnRJZCA9IHRoaXMuZ2V0QXV0b21hdGlvbklkKGVsZW1lbnRJZCk7XG4gIHJldHVybiBhd2FpdCB0aGlzLmJvb3RzdHJhcC5zZW5kQWN0aW9uKFwiZWxlbWVudDpsb2NhdGlvblwiLCB7IGVsZW1lbnRJZCB9KTtcbn07XG5cbmNvbW1hbmRzLmdldExvY2F0aW9uSW5WaWV3ID0gYXN5bmMgZnVuY3Rpb24gKGVsZW1lbnRJZCkge1xuICByZXR1cm4gYXdhaXQgdGhpcy5nZXRMb2NhdGlvbihlbGVtZW50SWQpO1xufTtcblxuY29tbWFuZHMuZ2V0TG9jYXRpb25WYWx1ZUJ5RWxlbWVudElkID0gYXN5bmMgZnVuY3Rpb24gKGVsZW1lbnRJZCkge1xuICByZXR1cm4gYXdhaXQgdGhpcy5nZXRMb2NhdGlvbihlbGVtZW50SWQpO1xufTtcblxuY29tbWFuZHMuZ2V0VGV4dCA9IGFzeW5jIGZ1bmN0aW9uIChlbGVtZW50SWQpIHtcbiAgZWxlbWVudElkID0gdGhpcy5nZXRBdXRvbWF0aW9uSWQoZWxlbWVudElkKTtcbiAgcmV0dXJuIGF3YWl0IHRoaXMuYm9vdHN0cmFwLnNlbmRBY3Rpb24oXCJlbGVtZW50OmdldFRleHRcIiwgeyBlbGVtZW50SWQgfSk7XG59O1xuXG5jb21tYW5kcy5lbGVtZW50RW5hYmxlZCA9IGFzeW5jIGZ1bmN0aW9uIChlbGVtZW50SWQpIHtcbiAgZWxlbWVudElkID0gdGhpcy5nZXRBdXRvbWF0aW9uSWQoZWxlbWVudElkKTtcbiAgcmV0dXJuIGF3YWl0IHRoaXMuYm9vdHN0cmFwLnNlbmRBY3Rpb24oXCJlbGVtZW50OmVuYWJsZWRcIiwgeyBlbGVtZW50SWQgfSk7XG59O1xuXG5jb21tYW5kcy5lbGVtZW50RGlzcGxheWVkID0gYXN5bmMgZnVuY3Rpb24gKGVsZW1lbnRJZCkge1xuICBlbGVtZW50SWQgPSB0aGlzLmdldEF1dG9tYXRpb25JZChlbGVtZW50SWQpO1xuICByZXR1cm4gYXdhaXQgdGhpcy5ib290c3RyYXAuc2VuZEFjdGlvbihcImVsZW1lbnQ6ZGlzcGxheWVkXCIsIHsgZWxlbWVudElkIH0pO1xufTtcblxuY29tbWFuZHMuZWxlbWVudFNlbGVjdGVkID0gZnVuY3Rpb24gKCkge1xuICBsb2cuaW5mbygnZWxlbWVudFNlbGVjdGVkIG5vdCBzdXBwb3J0ZWQnKTtcbiAgcmV0dXJuIGZhbHNlO1xufTtcblxuY29tbWFuZHMuZ2V0U2l6ZSA9IGFzeW5jIGZ1bmN0aW9uIChlbGVtZW50SWQpIHtcbiAgZWxlbWVudElkID0gdGhpcy5nZXRBdXRvbWF0aW9uSWQoZWxlbWVudElkKTtcbiAgcmV0dXJuIGF3YWl0IHRoaXMuYm9vdHN0cmFwLnNlbmRBY3Rpb24oXCJlbGVtZW50OnNpemVcIiwgeyBlbGVtZW50SWQgfSk7XG59O1xuXG5jb21tYW5kcy5zZXRWYWx1ZSA9IGFzeW5jIGZ1bmN0aW9uIChrZXlzLCBlbGVtZW50SWQpIHtcbiAgbGV0IHRleHQgPSBrZXlzLmpvaW4oKTtcbiAgZWxlbWVudElkID0gdGhpcy5nZXRBdXRvbWF0aW9uSWQoZWxlbWVudElkKTtcbiAgbGV0IHBhcmFtcyA9IHtcbiAgICBlbGVtZW50SWQsXG4gICAgdGV4dCxcbiAgICByZXBsYWNlOiBmYWxzZVxuICB9O1xuICByZXR1cm4gYXdhaXQgdGhpcy5ib290c3RyYXAuc2VuZEFjdGlvbihcImVsZW1lbnQ6c2V0VGV4dFwiLCBwYXJhbXMpO1xufTtcblxuY29tbWFuZHMuc2V0VmFsdWVJbW1lZGlhdGUgPSBhc3luYyBmdW5jdGlvbiAoa2V5cywgZWxlbWVudElkKSB7XG4gIGxldCB0ZXh0ID0gXy5pc0FycmF5KGtleXMpID8ga2V5cy5qb2luKCcnKSA6IGtleXM7XG4gIGVsZW1lbnRJZCA9IHRoaXMuZ2V0QXV0b21hdGlvbklkKGVsZW1lbnRJZCk7XG4gIGxldCBwYXJhbXMgPSB7XG4gICAgZWxlbWVudElkLFxuICAgIHRleHQsXG4gICAgcmVwbGFjZTogZmFsc2VcbiAgfTtcbiAgcmV0dXJuIGF3YWl0IHRoaXMuYm9vdHN0cmFwLnNlbmRBY3Rpb24oXCJlbGVtZW50OnNldFRleHRcIiwgcGFyYW1zKTtcbn07XG5cbmNvbW1hbmRzLmNsZWFyID0gYXN5bmMgZnVuY3Rpb24gKGVsZW1lbnRJZCkge1xuICBlbGVtZW50SWQgPSB0aGlzLmdldEF1dG9tYXRpb25JZChlbGVtZW50SWQpO1xuICBsZXQgcGFyYW1zID0ge1xuICAgIGVsZW1lbnRJZCxcbiAgICB0ZXh0OiBcIlwiLFxuICAgIHJlcGxhY2U6IHRydWVcbiAgfTtcbiAgcmV0dXJuIGF3YWl0IHRoaXMuYm9vdHN0cmFwLnNlbmRBY3Rpb24oXCJlbGVtZW50OnNldFRleHRcIiwgcGFyYW1zKTtcbn07XG5cbmNvbW1hbmRzLnJlcGxhY2VWYWx1ZSA9IGFzeW5jIGZ1bmN0aW9uICh2YWx1ZSwgZWxlbWVudElkKSB7XG4gIGVsZW1lbnRJZCA9IHRoaXMuZ2V0QXV0b21hdGlvbklkKGVsZW1lbnRJZCk7XG4gIGxldCBwYXJhbXMgPSB7XG4gICAgZWxlbWVudElkLFxuICAgIHRleHQ6IHZhbHVlLFxuICAgIHJlcGxhY2U6IHRydWVcbiAgfTtcbiAgcmV0dXJuIGF3YWl0IHRoaXMuYm9vdHN0cmFwLnNlbmRBY3Rpb24oXCJlbGVtZW50OnNldFRleHRcIiwgcGFyYW1zKTtcbn07XG5cbmNvbW1hbmRzLmNsaWNrID0gYXN5bmMgZnVuY3Rpb24gKGVsZW1lbnRJZCwgeCA9IDAsIHkgPSAwKSB7XG4gIGlmICh4ID09PSB0aGlzLnNlc3Npb25JZCkge1xuICAgIHggPSAwO1xuICB9XG4gIGlmICh5ID09PSB0aGlzLnNlc3Npb25JZCkge1xuICAgIHkgPSAwO1xuICB9XG5cbiAgaWYgKGVsZW1lbnRJZCkge1xuICAgIGVsZW1lbnRJZCA9IHRoaXMuZ2V0QXV0b21hdGlvbklkKGVsZW1lbnRJZCk7XG4gIH0gZWxzZSB7XG4gICAgZWxlbWVudElkID0gXCJcIjtcbiAgfVxuXG4gIGxldCBwYXJhbXMgPSB7XG4gICAgZWxlbWVudElkLFxuICAgIHg6IF8udG9JbnRlZ2VyKHgpLFxuICAgIHk6IF8udG9JbnRlZ2VyKHkpXG4gIH07XG4gIHJldHVybiBhd2FpdCB0aGlzLmJvb3RzdHJhcC5zZW5kQWN0aW9uKFwiZWxlbWVudDpjbGlja1wiLCBwYXJhbXMpO1xufTtcblxuY29tbWFuZHMudG91Y2hVcCA9IGFzeW5jIGZ1bmN0aW9uICh4ID0gMSwgeSA9IDEsIGVsZW1lbnRJZCA9IFwiXCIpIHtcbiAgaWYgKGVsZW1lbnRJZCAmJiBlbGVtZW50SWQgIT09IHRoaXMuc2Vzc2lvbklkKSB7XG4gICAgZWxlbWVudElkID0gdGhpcy5nZXRBdXRvbWF0aW9uSWQoZWxlbWVudElkKTtcbiAgfSBlbHNlIHtcbiAgICBlbGVtZW50SWQgPSBcIlwiO1xuICB9XG5cbiAgbGV0IHBhcmFtcyA9IHtcbiAgICBlbGVtZW50SWQsXG4gICAgeDogXy50b0ludGVnZXIoeCksXG4gICAgeTogXy50b0ludGVnZXIoeSlcbiAgfTtcbiAgcmV0dXJuIGF3YWl0IHRoaXMuYm9vdHN0cmFwLnNlbmRBY3Rpb24oXCJlbGVtZW50OnRvdWNoVXBcIiwgcGFyYW1zKTtcbn07XG5cbmNvbW1hbmRzLnRvdWNoRG93biA9IGFzeW5jIGZ1bmN0aW9uICh4LCB5LCBlbGVtZW50SWQgPSBcIlwiKSB7XG4gIGlmIChlbGVtZW50SWQgJiYgZWxlbWVudElkICE9PSB0aGlzLnNlc3Npb25JZCkge1xuICAgIGVsZW1lbnRJZCA9IHRoaXMuZ2V0QXV0b21hdGlvbklkKGVsZW1lbnRJZCk7XG4gIH0gZWxzZSB7XG4gICAgZWxlbWVudElkID0gXCJcIjtcbiAgfVxuXG4gIGxldCBwYXJhbXMgPSB7XG4gICAgZWxlbWVudElkLFxuICAgIHg6IF8udG9JbnRlZ2VyKHgpLFxuICAgIHk6IF8udG9JbnRlZ2VyKHkpXG4gIH07XG4gIHJldHVybiBhd2FpdCB0aGlzLmJvb3RzdHJhcC5zZW5kQWN0aW9uKFwiZWxlbWVudDp0b3VjaERvd25cIiwgcGFyYW1zKTtcbn07XG5cbmNvbW1hbmRzLnRvdWNoTW92ZSA9IGFzeW5jIGZ1bmN0aW9uICh4RG93biwgeURvd24sIHhVcCwgeVVwLCBzdGVwcyA9IDEwLCBlbGVtZW50SWQgPSBudWxsKSB7XG4gIGlmIChlbGVtZW50SWQgJiYgZWxlbWVudElkICE9PSB0aGlzLnNlc3Npb25JZCkge1xuICAgIGVsZW1lbnRJZCA9IHRoaXMuZ2V0QXV0b21hdGlvbklkKGVsZW1lbnRJZCk7XG4gIH0gZWxzZSB7XG4gICAgZWxlbWVudElkID0gXCJcIjtcbiAgfVxuXG4gIGxldCBwYXJhbXMgPSB7XG4gICAgZWxlbWVudElkLFxuICAgIHhEb3duOiBfLnRvSW50ZWdlcih4RG93biksXG4gICAgeURvd246IF8udG9JbnRlZ2VyKHlEb3duKSxcbiAgICB4VXA6IF8udG9JbnRlZ2VyKHhVcCksXG4gICAgeVVwOiBfLnRvSW50ZWdlcih5VXApLFxuICAgIHN0ZXBzOiBfLnRvSW50ZWdlcihzdGVwcylcbiAgfTtcbiAgcmV0dXJuIGF3YWl0IHRoaXMuYm9vdHN0cmFwLnNlbmRBY3Rpb24oXCJlbGVtZW50OnRvdWNoTW92ZVwiLCBwYXJhbXMpO1xufTtcblxuY29tbWFuZHMudG91Y2hMb25nQ2xpY2sgPSBhc3luYyBmdW5jdGlvbiAoZWxlbWVudElkLCB4LCB5LCBkdXJhdGlvbikge1xuICBhd2FpdCB0aGlzLnRvdWNoRG93bih4LCB5LCBlbGVtZW50SWQpO1xuICBhd2FpdCBzbGVlcChkdXJhdGlvbik7XG4gIHJldHVybiBhd2FpdCB0aGlzLnRvdWNoVXAoeCwgeSwgZWxlbWVudElkKTtcbn07XG5cbmNvbW1hbmRzLnRhcCA9IGFzeW5jIGZ1bmN0aW9uIChlbGVtZW50SWQsIHggPSAwLCB5ID0gMCwgY291bnQgPSAxKSB7XG4gIGxldCByZXN1bHQgPSB0cnVlO1xuICBsZXQgdGFwUmVzdWx0ID0gZmFsc2U7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgY291bnQ7IGkrKykge1xuICAgIHRhcFJlc3VsdCA9IGF3YWl0IHRoaXMuY2xpY2soZWxlbWVudElkLCB4LCB5KTtcbiAgICBpZiAoIXRhcFJlc3VsdCkge1xuICAgICAgcmVzdWx0ID0gZmFsc2U7XG4gICAgfVxuICB9XG4gIHJldHVybiByZXN1bHQ7XG59O1xuXG5PYmplY3QuYXNzaWduKGV4dGVuc2lvbnMsIGNvbW1hbmRzKTtcbmV4cG9ydCB7IGNvbW1hbmRzIH07XG5leHBvcnQgZGVmYXVsdCBleHRlbnNpb25zO1xuIl0sImZpbGUiOiJsaWIvY29tbWFuZHMvZWxlbWVudC5qcyIsInNvdXJjZVJvb3QiOiIuLi8uLi8uLiJ9
