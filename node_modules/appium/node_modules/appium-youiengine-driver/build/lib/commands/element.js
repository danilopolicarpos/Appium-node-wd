"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

require("source-map-support/register");

var _appiumBaseDriver = require("appium-base-driver");

var _utils = require("../utils");

var _appiumSupport = require("appium-support");

let commands = {};

commands.getAttribute = async function (attribute, el) {
  el = (0, _utils.unwrapEl)(el);
  let commandObject = {
    name: 'getAttribute',
    args: [`${el}`, `${attribute}`]
  };
  let commandJSON = JSON.stringify(commandObject);
  let data = await this.executeSocketCommand(commandJSON);
  let result;

  try {
    result = JSON.parse(data);
  } catch (e) {
    throw new Error('Bad response from getAttribute');
  }

  if (result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_STALE_ELEMENT) {
    throw new _appiumBaseDriver.errors.StaleElementReferenceError(result.value);
  }

  if (result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_INVALID_SELECTOR) {
    throw new _appiumBaseDriver.errors.InvalidSelectorError(result.value);
  }

  return result.value;
};

commands.setValue = async function (value, el) {
  el = (0, _utils.unwrapEl)(el);

  if (value instanceof Array) {
    value = value.join('');
  }

  if (typeof value !== 'string') {
    value = `${value}`;
  }

  value = _appiumSupport.util.escapeSpecialChars(value, "'");
  value = value.replace(/\\\\n/g, '\\n');
  let commandObject = {
    name: 'sendkeys',
    args: [`${el}`, `${value}`]
  };
  let commandJSON = JSON.stringify(commandObject);
  let data = await this.executeSocketCommand(commandJSON);
  let result;

  try {
    result = JSON.parse(data);
  } catch (e) {
    throw new Error('Bad response from setValue');
  }

  if (result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_STALE_ELEMENT) {
    throw new _appiumBaseDriver.errors.StaleElementReferenceError(result.value);
  }

  return result.value;
};

commands.getText = async function (el) {
  el = (0, _utils.unwrapEl)(el);
  let commandObject = {
    name: 'getText',
    args: [`${el}`]
  };
  let commandJSON = JSON.stringify(commandObject);
  let data = await this.executeSocketCommand(commandJSON);
  let result;

  try {
    result = JSON.parse(data);
  } catch (e) {
    throw new Error('Bad response from getText');
  }

  if (result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_STALE_ELEMENT) {
    throw new _appiumBaseDriver.errors.StaleElementReferenceError(result.value);
  }

  return result.value;
};

commands.elementEnabled = async function (el) {
  el = (0, _utils.unwrapEl)(el);
  let commandObject = {
    name: 'elementEnabled',
    args: [`${el}`]
  };
  let commandJSON = JSON.stringify(commandObject);
  let data = await this.executeSocketCommand(commandJSON);
  let result;

  try {
    result = JSON.parse(data);
  } catch (e) {
    throw new Error('Bad response from elementEnabled');
  }

  if (result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_UNKNOWN_COMMAND) {
    throw new _appiumBaseDriver.errors.UnknownCommandError(result.value);
  } else if (result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_NO_SUCH_ELEMENT) {
    throw new _appiumBaseDriver.errors.NoSuchElementError(result.value);
  }

  return result.value;
};

commands.elementSelected = async function (el) {
  el = (0, _utils.unwrapEl)(el);
  let commandObject = {
    name: 'elementSelected',
    args: [`${el}`]
  };
  let commandJSON = JSON.stringify(commandObject);
  let data = await this.executeSocketCommand(commandJSON);
  let result;

  try {
    result = JSON.parse(data);
  } catch (e) {
    throw new Error('Bad response from elementSelected');
  }

  if (result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_ELEMENT_IS_NOT_SELECTABLE) {
    throw new _appiumBaseDriver.errors.ElementIsNotSelectableError(result.value);
  } else if (result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_NO_SUCH_ELEMENT) {
    throw new _appiumBaseDriver.errors.NoSuchElementError(result.value);
  }

  return result.value;
};

commands.elementDisplayed = async function (el) {
  el = (0, _utils.unwrapEl)(el);
  let commandObject = {
    name: 'elementDisplayed',
    args: [`${el}`]
  };
  let commandJSON = JSON.stringify(commandObject);
  let data = await this.executeSocketCommand(commandJSON);
  let result;

  try {
    result = JSON.parse(data);
  } catch (e) {
    throw new Error('Bad response from elementDisplayed');
  }

  if (result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_UNKNOWN_COMMAND) {
    throw new _appiumBaseDriver.errors.UnknownCommandError(result.value);
  } else if (result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_NO_SUCH_ELEMENT) {
    throw new _appiumBaseDriver.errors.NoSuchElementError(result.value);
  }

  return result.value;
};

commands.clear = async function (el) {
  el = (0, _utils.unwrapEl)(el);
  let commandObject = {
    name: 'clear',
    args: [`${el}`]
  };
  let commandJSON = JSON.stringify(commandObject);
  let data = await this.executeSocketCommand(commandJSON);
  let result;

  try {
    result = JSON.parse(data);
  } catch (e) {
    throw new Error('Bad response from clear');
  }

  if (result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_NO_SUCH_ELEMENT) {
    throw new _appiumBaseDriver.errors.NoSuchElementError(result.value);
  } else if (result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_UNKNOWN_COMMAND) {
    throw new _appiumBaseDriver.errors.UnknownCommandError(result.value);
  }

  return result.value;
};

commands.getLocation = async function (el) {
  el = (0, _utils.unwrapEl)(el);
  let commandObject = {
    name: 'elementLocation',
    args: [`${el}`]
  };
  let commandJSON = JSON.stringify(commandObject);
  let data = await this.executeSocketCommand(commandJSON);
  let result;

  try {
    result = JSON.parse(data);
  } catch (e) {
    throw new Error('Bad response from elementLocation');
  }

  if (result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_UNKNOWN_COMMAND) {
    throw new _appiumBaseDriver.errors.UnknownCommandError(result.value);
  } else if (result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_NO_SUCH_ELEMENT) {
    throw new _appiumBaseDriver.errors.NoSuchElementError(result.value);
  }

  return result.value;
};

commands.getLocationInView = async function (elementId) {
  return await this.getLocation(elementId);
};

commands.getSize = async function (el) {
  el = (0, _utils.unwrapEl)(el);
  let commandObject = {
    name: 'elementSize',
    args: [`${el}`]
  };
  let commandJSON = JSON.stringify(commandObject);
  let data = await this.executeSocketCommand(commandJSON);
  let result;

  try {
    result = JSON.parse(data);
  } catch (e) {
    throw new Error('Bad response from getSize');
  }

  if (result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_UNKNOWN_COMMAND) {
    throw new _appiumBaseDriver.errors.UnknownCommandError(result.value);
  } else if (result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_NO_SUCH_ELEMENT) {
    throw new _appiumBaseDriver.errors.NoSuchElementError(result.value);
  }

  return result.value;
};

var _default = commands;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jb21tYW5kcy9lbGVtZW50LmpzIl0sIm5hbWVzIjpbImNvbW1hbmRzIiwiZ2V0QXR0cmlidXRlIiwiYXR0cmlidXRlIiwiZWwiLCJjb21tYW5kT2JqZWN0IiwibmFtZSIsImFyZ3MiLCJjb21tYW5kSlNPTiIsIkpTT04iLCJzdHJpbmdpZnkiLCJkYXRhIiwiZXhlY3V0ZVNvY2tldENvbW1hbmQiLCJyZXN1bHQiLCJwYXJzZSIsImUiLCJFcnJvciIsInN0YXR1cyIsInlvdWlFbmdpbmVEcml2ZXJSZXR1cm5WYWx1ZXMiLCJXRUJEUklWRVJfU1RBTEVfRUxFTUVOVCIsImVycm9ycyIsIlN0YWxlRWxlbWVudFJlZmVyZW5jZUVycm9yIiwidmFsdWUiLCJXRUJEUklWRVJfSU5WQUxJRF9TRUxFQ1RPUiIsIkludmFsaWRTZWxlY3RvckVycm9yIiwic2V0VmFsdWUiLCJBcnJheSIsImpvaW4iLCJ1dGlsIiwiZXNjYXBlU3BlY2lhbENoYXJzIiwicmVwbGFjZSIsImdldFRleHQiLCJlbGVtZW50RW5hYmxlZCIsIldFQkRSSVZFUl9VTktOT1dOX0NPTU1BTkQiLCJVbmtub3duQ29tbWFuZEVycm9yIiwiV0VCRFJJVkVSX05PX1NVQ0hfRUxFTUVOVCIsIk5vU3VjaEVsZW1lbnRFcnJvciIsImVsZW1lbnRTZWxlY3RlZCIsIldFQkRSSVZFUl9FTEVNRU5UX0lTX05PVF9TRUxFQ1RBQkxFIiwiRWxlbWVudElzTm90U2VsZWN0YWJsZUVycm9yIiwiZWxlbWVudERpc3BsYXllZCIsImNsZWFyIiwiZ2V0TG9jYXRpb24iLCJnZXRMb2NhdGlvbkluVmlldyIsImVsZW1lbnRJZCIsImdldFNpemUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUVBLElBQUlBLFFBQVEsR0FBRyxFQUFmOztBQUVBQSxRQUFRLENBQUNDLFlBQVQsR0FBd0IsZ0JBQWdCQyxTQUFoQixFQUEyQkMsRUFBM0IsRUFBK0I7QUFDckRBLEVBQUFBLEVBQUUsR0FBRyxx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bEJDLElBQUFBLElBQUksRUFBRSxDQUFFLEdBQUVILEVBQUcsRUFBUDtBQUZZLEdBQXBCO0FBSUEsTUFBSUksV0FBVyxHQUFHQyxJQUFJLENBQUNDLFNBQUwsQ0FBZUwsYUFBZixDQUFsQjtBQUVBLE1BQUlNLElBQUksR0FBRyxNQUFNLEtBQUtDLG9CQUFMLENBQTBCSixXQUExQixDQUFqQjtBQUVBLE1BQUlLLE1BQUo7O0FBQ0EsTUFBSTtBQUNGQSxJQUFBQSxNQUFNLEdBQUdKLElBQUksQ0FBQ0ssS0FBTCxDQUFXSCxJQUFYLENBQVQ7QUFDRCxHQUZELENBRUUsT0FBT0ksQ0FBUCxFQUFVO0FBQ1YsVUFBTSxJQUFJQyxLQUFKLENBQVUsMkJBQVYsQ0FBTjtBQUNEOztBQUdELE1BQUlILE1BQU0sQ0FBQ0ksTUFBUCxLQUFrQkMsb0NBQTZCZSx5QkFBbkQsRUFBOEU7QUFDNUUsVUFBTSxJQUFJYix5QkFBT2MsbUJBQVgsQ0FBK0JyQixNQUFNLENBQUNTLEtBQXRDLENBQU47QUFDRCxHQUZELE1BRU8sSUFBSVQsTUFBTSxDQUFDSSxNQUFQLEtBQWtCQyxvQ0FBNkJpQix5QkFBbkQsRUFBOEU7QUFDbkYsVUFBTSxJQUFJZix5QkFBT2dCLGtCQUFYLENBQThCdkIsTUFBTSxDQUFDUyxLQUFyQyxDQUFOO0FBQ0Q7O0FBRUQsU0FBT1QsTUFBTSxDQUFDUyxLQUFkO0FBQ0QsQ0ExQkQ7O2VBNEJlckIsUSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGVycm9ycyB9IGZyb20gJ2FwcGl1bS1iYXNlLWRyaXZlcic7XG5pbXBvcnQgeyB1bndyYXBFbCwgeW91aUVuZ2luZURyaXZlclJldHVyblZhbHVlcyB9IGZyb20gJy4uL3V0aWxzJztcbmltcG9ydCB7IHV0aWwgfSBmcm9tICdhcHBpdW0tc3VwcG9ydCc7XG5cbmxldCBjb21tYW5kcyA9IHt9O1xuXG5jb21tYW5kcy5nZXRBdHRyaWJ1dGUgPSBhc3luYyBmdW5jdGlvbiAoYXR0cmlidXRlLCBlbCkge1xuICBlbCA9IHVud3JhcEVsKGVsKTtcblxuICBsZXQgY29tbWFuZE9iamVjdCA9IHtcbiAgICBuYW1lOiAnZ2V0QXR0cmlidXRlJyxcbiAgICBhcmdzOiBbYCR7ZWx9YCwgYCR7YXR0cmlidXRlfWBdXG4gIH07XG4gIGxldCBjb21tYW5kSlNPTiA9IEpTT04uc3RyaW5naWZ5KGNvbW1hbmRPYmplY3QpO1xuXG4gIGxldCBkYXRhID0gYXdhaXQgdGhpcy5leGVjdXRlU29ja2V0Q29tbWFuZChjb21tYW5kSlNPTik7XG5cbiAgbGV0IHJlc3VsdDtcbiAgdHJ5IHtcbiAgICByZXN1bHQgPSBKU09OLnBhcnNlKGRhdGEpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdCYWQgcmVzcG9uc2UgZnJvbSBnZXRBdHRyaWJ1dGUnKTtcbiAgfVxuXG4gIC8vIGdldCBzdGF0dXMgcmV0dXJuZWRcbiAgaWYgKHJlc3VsdC5zdGF0dXMgPT09IHlvdWlFbmdpbmVEcml2ZXJSZXR1cm5WYWx1ZXMuV0VCRFJJVkVSX1NUQUxFX0VMRU1FTlQpIHtcbiAgICB0aHJvdyBuZXcgZXJyb3JzLlN0YWxlRWxlbWVudFJlZmVyZW5jZUVycm9yKHJlc3VsdC52YWx1ZSk7XG4gIH1cblxuICBpZiAocmVzdWx0LnN0YXR1cyA9PT0geW91aUVuZ2luZURyaXZlclJldHVyblZhbHVlcy5XRUJEUklWRVJfSU5WQUxJRF9TRUxFQ1RPUikge1xuICAgIHRocm93IG5ldyBlcnJvcnMuSW52YWxpZFNlbGVjdG9yRXJyb3IocmVzdWx0LnZhbHVlKTtcbiAgfVxuXG4gIHJldHVybiByZXN1bHQudmFsdWU7XG59O1xuXG5jb21tYW5kcy5zZXRWYWx1ZSA9IGFzeW5jIGZ1bmN0aW9uICh2YWx1ZSwgZWwpIHtcbiAgZWwgPSB1bndyYXBFbChlbCk7XG5cbiAgaWYgKHZhbHVlIGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICB2YWx1ZSA9IHZhbHVlLmpvaW4oJycpO1xuICB9XG4gIGlmICh0eXBlb2YgdmFsdWUgIT09ICdzdHJpbmcnKSB7XG4gICAgdmFsdWUgPSBgJHt2YWx1ZX1gO1xuICB9XG4gIHZhbHVlID0gdXRpbC5lc2NhcGVTcGVjaWFsQ2hhcnModmFsdWUsIFwiJ1wiKTtcbiAgLy8gZGUtZXNjYXBlIFxcbiBzbyBpdCBjYW4gYmUgdXNlZCBzcGVjaWFsbHlcbiAgdmFsdWUgPSB2YWx1ZS5yZXBsYWNlKC9cXFxcXFxcXG4vZywgJ1xcXFxuJyk7XG5cbiAgbGV0IGNvbW1hbmRPYmplY3QgPSB7XG4gICAgbmFtZTogJ3NlbmRrZXlzJyxcbiAgICBhcmdzOiBbYCR7ZWx9YCwgYCR7dmFsdWV9YF1cbiAgfTtcbiAgbGV0IGNvbW1hbmRKU09OID0gSlNPTi5zdHJpbmdpZnkoY29tbWFuZE9iamVjdCk7XG5cbiAgbGV0IGRhdGEgPSBhd2FpdCB0aGlzLmV4ZWN1dGVTb2NrZXRDb21tYW5kKGNvbW1hbmRKU09OKTtcblxuICBsZXQgcmVzdWx0O1xuICB0cnkge1xuICAgIHJlc3VsdCA9IEpTT04ucGFyc2UoZGF0YSk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0JhZCByZXNwb25zZSBmcm9tIHNldFZhbHVlJyk7XG4gIH1cblxuICAvLyBnZXQgc3RhdHVzIHJldHVybmVkXG4gIGlmIChyZXN1bHQuc3RhdHVzID09PSB5b3VpRW5naW5lRHJpdmVyUmV0dXJuVmFsdWVzLldFQkRSSVZFUl9TVEFMRV9FTEVNRU5UKSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5TdGFsZUVsZW1lbnRSZWZlcmVuY2VFcnJvcihyZXN1bHQudmFsdWUpO1xuICB9XG5cbiAgcmV0dXJuIHJlc3VsdC52YWx1ZTtcblxufTtcblxuY29tbWFuZHMuZ2V0VGV4dCA9IGFzeW5jIGZ1bmN0aW9uIChlbCkge1xuICBlbCA9IHVud3JhcEVsKGVsKTtcblxuICBsZXQgY29tbWFuZE9iamVjdCA9IHtcbiAgICBuYW1lOiAnZ2V0VGV4dCcsXG4gICAgYXJnczogW2Ake2VsfWBdXG4gIH07XG4gIGxldCBjb21tYW5kSlNPTiA9IEpTT04uc3RyaW5naWZ5KGNvbW1hbmRPYmplY3QpO1xuXG4gIGxldCBkYXRhID0gYXdhaXQgdGhpcy5leGVjdXRlU29ja2V0Q29tbWFuZChjb21tYW5kSlNPTik7XG5cbiAgbGV0IHJlc3VsdDtcbiAgdHJ5IHtcbiAgICByZXN1bHQgPSBKU09OLnBhcnNlKGRhdGEpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdCYWQgcmVzcG9uc2UgZnJvbSBnZXRUZXh0Jyk7XG4gIH1cblxuICAvLyBnZXQgc3RhdHVzIHJldHVybmVkXG4gIGlmIChyZXN1bHQuc3RhdHVzID09PSB5b3VpRW5naW5lRHJpdmVyUmV0dXJuVmFsdWVzLldFQkRSSVZFUl9TVEFMRV9FTEVNRU5UKSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5TdGFsZUVsZW1lbnRSZWZlcmVuY2VFcnJvcihyZXN1bHQudmFsdWUpO1xuICB9XG5cbiAgcmV0dXJuIHJlc3VsdC52YWx1ZTtcblxufTtcblxuY29tbWFuZHMuZWxlbWVudEVuYWJsZWQgPSBhc3luYyBmdW5jdGlvbiAoZWwpIHtcbiAgZWwgPSB1bndyYXBFbChlbCk7XG5cbiAgbGV0IGNvbW1hbmRPYmplY3QgPSB7XG4gICAgbmFtZTogJ2VsZW1lbnRFbmFibGVkJyxcbiAgICBhcmdzOiBbYCR7ZWx9YF1cbiAgfTtcbiAgbGV0IGNvbW1hbmRKU09OID0gSlNPTi5zdHJpbmdpZnkoY29tbWFuZE9iamVjdCk7XG5cbiAgbGV0IGRhdGEgPSBhd2FpdCB0aGlzLmV4ZWN1dGVTb2NrZXRDb21tYW5kKGNvbW1hbmRKU09OKTtcblxuICBsZXQgcmVzdWx0O1xuICB0cnkge1xuICAgIHJlc3VsdCA9IEpTT04ucGFyc2UoZGF0YSk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0JhZCByZXNwb25zZSBmcm9tIGVsZW1lbnRFbmFibGVkJyk7XG4gIH1cblxuICAvLyBnZXQgc3RhdHVzIHJldHVybmVkIGFuZCBoYW5kbGUgZXJyb3JzIHJldHVybmVkIGZyb20gc2VydmVyXG4gIGlmIChyZXN1bHQuc3RhdHVzID09PSB5b3VpRW5naW5lRHJpdmVyUmV0dXJuVmFsdWVzLldFQkRSSVZFUl9VTktOT1dOX0NPTU1BTkQpIHtcbiAgICB0aHJvdyBuZXcgZXJyb3JzLlVua25vd25Db21tYW5kRXJyb3IocmVzdWx0LnZhbHVlKTtcbiAgfSBlbHNlIGlmIChyZXN1bHQuc3RhdHVzID09PSB5b3VpRW5naW5lRHJpdmVyUmV0dXJuVmFsdWVzLldFQkRSSVZFUl9OT19TVUNIX0VMRU1FTlQpIHtcbiAgICB0aHJvdyBuZXcgZXJyb3JzLk5vU3VjaEVsZW1lbnRFcnJvcihyZXN1bHQudmFsdWUpO1xuICB9XG5cbiAgcmV0dXJuIHJlc3VsdC52YWx1ZTtcbn07XG5cbmNvbW1hbmRzLmVsZW1lbnRTZWxlY3RlZCA9IGFzeW5jIGZ1bmN0aW9uIChlbCkge1xuICBlbCA9IHVud3JhcEVsKGVsKTtcblxuICBsZXQgY29tbWFuZE9iamVjdCA9IHtcbiAgICBuYW1lOiAnZWxlbWVudFNlbGVjdGVkJyxcbiAgICBhcmdzOiBbYCR7ZWx9YF1cbiAgfTtcbiAgbGV0IGNvbW1hbmRKU09OID0gSlNPTi5zdHJpbmdpZnkoY29tbWFuZE9iamVjdCk7XG5cbiAgbGV0IGRhdGEgPSBhd2FpdCB0aGlzLmV4ZWN1dGVTb2NrZXRDb21tYW5kKGNvbW1hbmRKU09OKTtcblxuICBsZXQgcmVzdWx0O1xuICB0cnkge1xuICAgIHJlc3VsdCA9IEpTT04ucGFyc2UoZGF0YSk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0JhZCByZXNwb25zZSBmcm9tIGVsZW1lbnRTZWxlY3RlZCcpO1xuICB9XG5cbiAgLy8gZ2V0IHN0YXR1cyByZXR1cm5lZCBhbmQgaGFuZGxlIGVycm9ycyByZXR1cm5lZCBmcm9tIHNlcnZlclxuICBpZiAocmVzdWx0LnN0YXR1cyA9PT0geW91aUVuZ2luZURyaXZlclJldHVyblZhbHVlcy5XRUJEUklWRVJfRUxFTUVOVF9JU19OT1RfU0VMRUNUQUJMRSkge1xuICAgIHRocm93IG5ldyBlcnJvcnMuRWxlbWVudElzTm90U2VsZWN0YWJsZUVycm9yKHJlc3VsdC52YWx1ZSk7XG4gIH0gZWxzZSBpZiAocmVzdWx0LnN0YXR1cyA9PT0geW91aUVuZ2luZURyaXZlclJldHVyblZhbHVlcy5XRUJEUklWRVJfTk9fU1VDSF9FTEVNRU5UKSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5Ob1N1Y2hFbGVtZW50RXJyb3IocmVzdWx0LnZhbHVlKTtcbiAgfVxuXG4gIHJldHVybiByZXN1bHQudmFsdWU7XG59O1xuXG5jb21tYW5kcy5lbGVtZW50RGlzcGxheWVkID0gYXN5bmMgZnVuY3Rpb24gKGVsKSB7XG5cbiAgZWwgPSB1bndyYXBFbChlbCk7XG5cbiAgbGV0IGNvbW1hbmRPYmplY3QgPSB7XG4gICAgbmFtZTogJ2VsZW1lbnREaXNwbGF5ZWQnLFxuICAgIGFyZ3M6IFtgJHtlbH1gXVxuICB9O1xuICBsZXQgY29tbWFuZEpTT04gPSBKU09OLnN0cmluZ2lmeShjb21tYW5kT2JqZWN0KTtcblxuICBsZXQgZGF0YSA9IGF3YWl0IHRoaXMuZXhlY3V0ZVNvY2tldENvbW1hbmQoY29tbWFuZEpTT04pO1xuXG4gIGxldCByZXN1bHQ7XG4gIHRyeSB7XG4gICAgcmVzdWx0ID0gSlNPTi5wYXJzZShkYXRhKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIHRocm93IG5ldyBFcnJvcignQmFkIHJlc3BvbnNlIGZyb20gZWxlbWVudERpc3BsYXllZCcpO1xuICB9XG5cbiAgLy8gZ2V0IHN0YXR1cyByZXR1cm5lZCBhbmQgaGFuZGxlIGVycm9ycyByZXR1cm5lZCBmcm9tIHNlcnZlclxuICBpZiAocmVzdWx0LnN0YXR1cyA9PT0geW91aUVuZ2luZURyaXZlclJldHVyblZhbHVlcy5XRUJEUklWRVJfVU5LTk9XTl9DT01NQU5EKSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5Vbmtub3duQ29tbWFuZEVycm9yKHJlc3VsdC52YWx1ZSk7XG4gIH0gZWxzZSBpZiAocmVzdWx0LnN0YXR1cyA9PT0geW91aUVuZ2luZURyaXZlclJldHVyblZhbHVlcy5XRUJEUklWRVJfTk9fU1VDSF9FTEVNRU5UKSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5Ob1N1Y2hFbGVtZW50RXJyb3IocmVzdWx0LnZhbHVlKTtcbiAgfVxuXG4gIHJldHVybiByZXN1bHQudmFsdWU7XG59O1xuXG5jb21tYW5kcy5jbGVhciA9IGFzeW5jIGZ1bmN0aW9uIChlbCkge1xuICBlbCA9IHVud3JhcEVsKGVsKTtcblxuICBsZXQgY29tbWFuZE9iamVjdCA9IHtcbiAgICBuYW1lOiAnY2xlYXInLFxuICAgIGFyZ3M6IFtgJHtlbH1gXVxuICB9O1xuXG4gIGxldCBjb21tYW5kSlNPTiA9IEpTT04uc3RyaW5naWZ5KGNvbW1hbmRPYmplY3QpO1xuXG4gIGxldCBkYXRhID0gYXdhaXQgdGhpcy5leGVjdXRlU29ja2V0Q29tbWFuZChjb21tYW5kSlNPTik7XG5cbiAgbGV0IHJlc3VsdDtcbiAgdHJ5IHtcbiAgICByZXN1bHQgPSBKU09OLnBhcnNlKGRhdGEpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdCYWQgcmVzcG9uc2UgZnJvbSBjbGVhcicpO1xuICB9XG5cbiAgaWYgKHJlc3VsdC5zdGF0dXMgPT09IHlvdWlFbmdpbmVEcml2ZXJSZXR1cm5WYWx1ZXMuV0VCRFJJVkVSX05PX1NVQ0hfRUxFTUVOVCkge1xuICAgIHRocm93IG5ldyBlcnJvcnMuTm9TdWNoRWxlbWVudEVycm9yKHJlc3VsdC52YWx1ZSk7XG4gIH0gZWxzZSBpZiAocmVzdWx0LnN0YXR1cyA9PT0geW91aUVuZ2luZURyaXZlclJldHVyblZhbHVlcy5XRUJEUklWRVJfVU5LTk9XTl9DT01NQU5EKSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5Vbmtub3duQ29tbWFuZEVycm9yKHJlc3VsdC52YWx1ZSk7XG4gIH1cblxuICByZXR1cm4gcmVzdWx0LnZhbHVlO1xufTtcblxuY29tbWFuZHMuZ2V0TG9jYXRpb24gPSBhc3luYyBmdW5jdGlvbiAoZWwpIHtcbiAgZWwgPSB1bndyYXBFbChlbCk7XG5cbiAgbGV0IGNvbW1hbmRPYmplY3QgPSB7XG4gICAgbmFtZTogJ2VsZW1lbnRMb2NhdGlvbicsXG4gICAgYXJnczogW2Ake2VsfWBdXG4gIH07XG4gIGxldCBjb21tYW5kSlNPTiA9IEpTT04uc3RyaW5naWZ5KGNvbW1hbmRPYmplY3QpO1xuXG4gIGxldCBkYXRhID0gYXdhaXQgdGhpcy5leGVjdXRlU29ja2V0Q29tbWFuZChjb21tYW5kSlNPTik7XG5cbiAgbGV0IHJlc3VsdDtcbiAgdHJ5IHtcbiAgICByZXN1bHQgPSBKU09OLnBhcnNlKGRhdGEpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdCYWQgcmVzcG9uc2UgZnJvbSBlbGVtZW50TG9jYXRpb24nKTtcbiAgfVxuXG4gIC8vIGdldCBzdGF0dXMgcmV0dXJuZWQgYW5kIGhhbmRsZSBlcnJvcnMgcmV0dXJuZWQgZnJvbSBzZXJ2ZXJcbiAgaWYgKHJlc3VsdC5zdGF0dXMgPT09IHlvdWlFbmdpbmVEcml2ZXJSZXR1cm5WYWx1ZXMuV0VCRFJJVkVSX1VOS05PV05fQ09NTUFORCkge1xuICAgIHRocm93IG5ldyBlcnJvcnMuVW5rbm93bkNvbW1hbmRFcnJvcihyZXN1bHQudmFsdWUpO1xuICB9IGVsc2UgaWYgKHJlc3VsdC5zdGF0dXMgPT09IHlvdWlFbmdpbmVEcml2ZXJSZXR1cm5WYWx1ZXMuV0VCRFJJVkVSX05PX1NVQ0hfRUxFTUVOVCkge1xuICAgIHRocm93IG5ldyBlcnJvcnMuTm9TdWNoRWxlbWVudEVycm9yKHJlc3VsdC52YWx1ZSk7XG4gIH1cblxuICByZXR1cm4gcmVzdWx0LnZhbHVlO1xufTtcblxuY29tbWFuZHMuZ2V0TG9jYXRpb25JblZpZXcgPSBhc3luYyBmdW5jdGlvbiAoZWxlbWVudElkKSB7XG4gIHJldHVybiBhd2FpdCB0aGlzLmdldExvY2F0aW9uKGVsZW1lbnRJZCk7XG59O1xuXG5jb21tYW5kcy5nZXRTaXplID0gYXN5bmMgZnVuY3Rpb24gKGVsKSB7XG4gIGVsID0gdW53cmFwRWwoZWwpO1xuXG4gIGxldCBjb21tYW5kT2JqZWN0ID0ge1xuICAgIG5hbWU6ICdlbGVtZW50U2l6ZScsXG4gICAgYXJnczogW2Ake2VsfWBdXG4gIH07XG4gIGxldCBjb21tYW5kSlNPTiA9IEpTT04uc3RyaW5naWZ5KGNvbW1hbmRPYmplY3QpO1xuXG4gIGxldCBkYXRhID0gYXdhaXQgdGhpcy5leGVjdXRlU29ja2V0Q29tbWFuZChjb21tYW5kSlNPTik7XG5cbiAgbGV0IHJlc3VsdDtcbiAgdHJ5IHtcbiAgICByZXN1bHQgPSBKU09OLnBhcnNlKGRhdGEpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdCYWQgcmVzcG9uc2UgZnJvbSBnZXRTaXplJyk7XG4gIH1cblxuICAvLyBnZXQgc3RhdHVzIHJldHVybmVkIGFuZCBoYW5kbGUgZXJyb3JzIHJldHVybmVkIGZyb20gc2VydmVyXG4gIGlmIChyZXN1bHQuc3RhdHVzID09PSB5b3VpRW5naW5lRHJpdmVyUmV0dXJuVmFsdWVzLldFQkRSSVZFUl9VTktOT1dOX0NPTU1BTkQpIHtcbiAgICB0aHJvdyBuZXcgZXJyb3JzLlVua25vd25Db21tYW5kRXJyb3IocmVzdWx0LnZhbHVlKTtcbiAgfSBlbHNlIGlmIChyZXN1bHQuc3RhdHVzID09PSB5b3VpRW5naW5lRHJpdmVyUmV0dXJuVmFsdWVzLldFQkRSSVZFUl9OT19TVUNIX0VMRU1FTlQpIHtcbiAgICB0aHJvdyBuZXcgZXJyb3JzLk5vU3VjaEVsZW1lbnRFcnJvcihyZXN1bHQudmFsdWUpO1xuICB9XG5cbiAgcmV0dXJuIHJlc3VsdC52YWx1ZTtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IGNvbW1hbmRzO1xuIl0sImZpbGUiOiJsaWIvY29tbWFuZHMvZWxlbWVudC5qcyIsInNvdXJjZVJvb3QiOiIuLi8uLi8uLiJ9
