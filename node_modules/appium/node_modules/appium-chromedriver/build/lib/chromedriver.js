"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getMostRecentChromedriver = getMostRecentChromedriver;
exports.default = exports.CD_VER = exports.CHROMEDRIVER_CHROME_MAPPING = exports.Chromedriver = void 0;

require("source-map-support/register");

var _events = _interopRequireDefault(require("events"));

var _appiumBaseDriver = require("appium-base-driver");

var _child_process = _interopRequireDefault(require("child_process"));

var _appiumSupport = require("appium-support");

var _asyncbox = require("asyncbox");

var _teen_process = require("teen_process");

var _bluebird = _interopRequireDefault(require("bluebird"));

var _utils = require("./utils");

var _semver = _interopRequireDefault(require("semver"));

var _lodash = _interopRequireDefault(require("lodash"));

var _path = _interopRequireDefault(require("path"));

var _compareVersions = _interopRequireDefault(require("compare-versions"));

const log = _appiumSupport.logger.getLogger('Chromedriver');

const NEW_CD_VERSION_FORMAT_MAJOR_VERSION = 73;
const DEFAULT_HOST = '127.0.0.1';
const DEFAULT_PORT = 9515;
const CHROMEDRIVER_CHROME_MAPPING = {
  '75.0.3770.90': '75.0.3770.90',
  '75.0.3770.8': '75.0.3770.8',
  '74.0.3729.6': '74.0.3729',
  '73.0.3683.68': '70.0.3538',
  '2.46': '71.0.3578',
  '2.45': '70.0.0',
  '2.44': '69.0.3497',
  '2.43': '69.0.3497',
  '2.42': '68.0.3440',
  '2.41': '67.0.3396',
  '2.40': '66.0.3359',
  '2.39': '66.0.3359',
  '2.38': '65.0.3325',
  '2.37': '64.0.3282',
  '2.36': '63.0.3239',
  '2.35': '62.0.3202',
  '2.34': '61.0.3163',
  '2.33': '60.0.3112',
  '2.32': '59.0.3071',
  '2.31': '58.0.3029',
  '2.30': '58.0.3029',
  '2.29': '57.0.2987',
  '2.28': '55.0.2883',
  '2.27': '54.0.2840',
  '2.26': '53.0.2785',
  '2.25': '53.0.2785',
  '2.24': '52.0.2743',
  '2.23': '51.0.2704',
  '2.22': '49.0.2623',
  '2.21': '46.0.2490',
  '2.20': '43.0.2357',
  '2.19': '43.0.2357',
  '2.18': '43.0.2357',
  '2.17': '42.0.2311',
  '2.16': '42.0.2311',
  '2.15': '40.0.2214',
  '2.14': '39.0.2171',
  '2.13': '38.0.2125',
  '2.12': '36.0.1985',
  '2.11': '36.0.1985',
  '2.10': '33.0.1751',
  '2.9': '31.0.1650',
  '2.8': '30.0.1573',
  '2.7': '30.0.1573',
  '2.6': '29.0.1545',
  '2.5': '29.0.1545',
  '2.4': '29.0.1545',
  '2.3': '28.0.1500',
  '2.2': '27.0.1453',
  '2.1': '27.0.1453',
  '2.0': '27.0.1453'
};
exports.CHROMEDRIVER_CHROME_MAPPING = CHROMEDRIVER_CHROME_MAPPING;
const CHROME_BUNDLE_ID = 'com.android.chrome';
const WEBVIEW_BUNDLE_IDS = ['com.google.android.webview', 'com.android.webview'];
const CHROMEDRIVER_TUTORIAL = 'https://github.com/appium/appium/blob/master/docs/en/writing-running-appium/web/chromedriver.md';
const CD_VER = process.env.npm_config_chromedriver_version || process.env.CHROMEDRIVER_VERSION || getMostRecentChromedriver();
exports.CD_VER = CD_VER;
const CD_VERSION_TIMEOUT = 5000;

function getMostRecentChromedriver(mapping = CHROMEDRIVER_CHROME_MAPPING) {
  if (_lodash.default.isEmpty(mapping)) {
    throw new Error('Unable to get most recent Chromedriver from empty mapping');
  }

  return _lodash.default.last(_lodash.default.keys(mapping).sort(_compareVersions.default));
}

class Chromedriver extends _events.default.EventEmitter {
  constructor(args = {}) {
    super();
    const {
      host = DEFAULT_HOST,
      port = DEFAULT_PORT,
      useSystemExecutable = false,
      executable,
      executableDir = (0, _utils.getChromedriverDir)(),
      bundleId,
      mappingPath,
      cmdArgs,
      adb,
      verbose,
      logPath,
      disableBuildCheck
    } = args;
    this.proxyHost = host;
    this.proxyPort = port;
    this.adb = adb;
    this.cmdArgs = cmdArgs;
    this.proc = null;
    this.useSystemExecutable = useSystemExecutable;
    this.chromedriver = executable;
    this.executableDir = executableDir;
    this.mappingPath = mappingPath;
    this.bundleId = bundleId;
    this.executableVerified = false;
    this.state = Chromedriver.STATE_STOPPED;
    this.jwproxy = new _appiumBaseDriver.JWProxy({
      server: this.proxyHost,
      port: this.proxyPort
    });
    this.verbose = verbose;
    this.logPath = logPath;
    this.disableBuildCheck = !!disableBuildCheck;
  }

  async getMapping() {
    let mapping = CHROMEDRIVER_CHROME_MAPPING;

    if (this.mappingPath) {
      log.debug(`Attempting to use Chromedriver-Chrome mapping from '${this.mappingPath}'`);

      if (!(await _appiumSupport.fs.exists(this.mappingPath))) {
        log.warn(`No file found at '${this.mappingPath}'. Using default mapping`);
      } else {
        try {
          mapping = JSON.parse((await _appiumSupport.fs.readFile(this.mappingPath)));
        } catch (err) {
          log.error(`Error parsing mapping from '${this.mappingPath}': ${err.message}`);
          log.warn('Using default mapping');
        }
      }
    }

    for (const [cdVersion, chromeVersion] of _lodash.default.toPairs(mapping)) {
      mapping[cdVersion] = _semver.default.coerce(chromeVersion);
    }

    return mapping;
  }

  async getChromedrivers(mapping) {
    const executables = await _appiumSupport.fs.glob(`${this.executableDir}/*`);
    log.debug(`Found ${executables.length} executable${executables.length === 1 ? '' : 's'} ` + `in '${this.executableDir}'`);
    const cds = (await (0, _asyncbox.asyncmap)(executables, async function mapChromedriver(executable) {
      const logError = ({
        message,
        stdout = null,
        stderr = null
      }) => {
        let errMsg = `Cannot retrieve version number from '${_path.default.basename(executable)}' Chromedriver binary. ` + `Make sure it returns a valid version string in response to '--version' command line argument. ${message}`;

        if (stdout) {
          errMsg += `\nStdout: ${stdout}`;
        }

        if (stderr) {
          errMsg += `\nStderr: ${stderr}`;
        }

        log.warn(errMsg);
        return null;
      };

      let stdout;
      let stderr;

      try {
        ({
          stdout,
          stderr
        } = await (0, _teen_process.exec)(executable, ['--version'], {
          timeout: CD_VERSION_TIMEOUT
        }));
      } catch (err) {
        if (!(err.message || '').includes('timed out') && !(err.stdout || '').includes('Starting ChromeDriver')) {
          return logError(err);
        }

        stdout = err.stdout;
      }

      const match = /ChromeDriver\s+\(?v?([\d.]+)\)?/i.exec(stdout);

      if (!match) {
        return logError({
          message: 'Cannot parse the version string',
          stdout,
          stderr
        });
      }

      let version = match[1];

      const coercedVersion = _semver.default.coerce(version, true);

      if (coercedVersion) {
        if (coercedVersion.major < NEW_CD_VERSION_FORMAT_MAJOR_VERSION) {
          version = `${coercedVersion.major}.${coercedVersion.minor}`;
        }
      }

      return {
        executable,
        version,
        minChromeVersion: mapping[version]
      };
    })).filter(cd => !!cd).sort((a, b) => (0, _compareVersions.default)(b.version, a.version));

    if (_lodash.default.isEmpty(cds)) {
      log.errorAndThrow(`No Chromedrivers found in '${this.executableDir}'`);
    }

    log.debug(`The following Chromedriver executables were found:`);

    for (const cd of cds) {
      log.debug(`    '${cd.executable}' (version '${cd.version}', minimum Chrome version '${cd.minChromeVersion ? cd.minChromeVersion : 'Unknown'}')`);
    }

    return cds;
  }

  async getChromeVersion() {
    let chromeVersion;

    if (this.adb && (await this.adb.getApiLevel()) >= 24) {
      this.bundleId = CHROME_BUNDLE_ID;
    }

    if (!this.bundleId) {
      this.bundleId = CHROME_BUNDLE_ID;

      for (const bundleId of WEBVIEW_BUNDLE_IDS) {
        chromeVersion = await (0, _utils.getChromeVersion)(this.adb, bundleId);

        if (chromeVersion) {
          this.bundleId = bundleId;
          break;
        }
      }
    }

    if (!chromeVersion) {
      chromeVersion = await (0, _utils.getChromeVersion)(this.adb, this.bundleId);
    }

    return chromeVersion ? _semver.default.coerce(chromeVersion) : null;
  }

  async getCompatibleChromedriver() {
    if (!this.adb) {
      return await (0, _utils.getChromedriverBinaryPath)();
    }

    const mapping = await this.getMapping();
    const cds = await this.getChromedrivers(mapping);

    if (this.disableBuildCheck) {
      const cd = cds[0];
      log.warn(`Chrome build check disabled. Using most recent Chromedriver version (${cd.version}, at '${cd.executable}')`);
      log.warn(`If this is wrong, set 'chromedriverDisableBuildCheck' capability to 'false'`);
      return cd.executable;
    }

    const chromeVersion = await this.getChromeVersion();

    if (!chromeVersion) {
      let cd = cds[0];
      log.warn(`Unable to discover Chrome version. Using Chromedriver ${cd.version} at '${cd.executable}'`);
      return cd.executable;
    }

    log.debug(`Found Chrome bundle '${this.bundleId}' version '${chromeVersion}'`);

    if (_semver.default.gt(chromeVersion, _lodash.default.values(mapping)[0]) && !_lodash.default.isUndefined(cds[0]) && _lodash.default.isUndefined(cds[0].minChromeVersion)) {
      let cd = cds[0];
      log.warn(`No known Chromedriver available to automate Chrome version '${chromeVersion}'.\n` + `Using Chromedriver version '${cd.version}', which has not been tested with Appium.`);
      return cd.executable;
    }

    const workingCds = cds.filter(cd => {
      return !_lodash.default.isUndefined(cd.minChromeVersion) && _semver.default.gte(chromeVersion, cd.minChromeVersion);
    });

    if (_lodash.default.isEmpty(workingCds)) {
      log.errorAndThrow(`No Chromedriver found that can automate Chrome '${chromeVersion}'. ` + `See ${CHROMEDRIVER_TUTORIAL} for more details.`);
    }

    const binPath = workingCds[0].executable;
    log.debug(`Found ${workingCds.length} Chromedriver executable${workingCds.length === 1 ? '' : 's'} ` + `capable of automating Chrome '${chromeVersion}'.\n` + `Choosing the most recent, '${binPath}'.`);
    log.debug('If a specific version is required, specify it with the `chromedriverExecutable`' + 'desired capability.');
    return binPath;
  }

  async initChromedriverPath() {
    if (this.executableVerified) return;

    if (!this.chromedriver) {
      this.chromedriver = this.useSystemExecutable ? await (0, _utils.getChromedriverBinaryPath)() : await this.getCompatibleChromedriver();
    }

    if (!(await _appiumSupport.fs.exists(this.chromedriver))) {
      throw new Error(`Trying to use a chromedriver binary at the path ` + `${this.chromedriver}, but it doesn't exist!`);
    }

    this.executableVerified = true;
    log.info(`Set chromedriver binary as: ${this.chromedriver}`);
  }

  async start(caps, emitStartingState = true) {
    this.capabilities = _lodash.default.cloneDeep(caps);
    this.capabilities.loggingPrefs = this.capabilities.loggingPrefs || {};

    if (_lodash.default.isEmpty(this.capabilities.loggingPrefs.browser)) {
      this.capabilities.loggingPrefs.browser = 'ALL';
    }

    if (emitStartingState) {
      this.changeState(Chromedriver.STATE_STARTING);
    }

    let args = ['--url-base=wd/hub', `--port=${this.proxyPort}`];

    if (this.adb && this.adb.adbPort) {
      args = args.concat([`--adb-port=${this.adb.adbPort}`]);
    }

    if (this.cmdArgs) {
      args = args.concat(this.cmdArgs);
    }

    if (this.logPath) {
      args = args.concat([`--log-path=${this.logPath}`]);
    }

    if (this.disableBuildCheck) {
      args = args.concat(['--disable-build-check']);
    }

    args = args.concat(['--verbose']);

    const startDetector = stdout => {
      return stdout.indexOf('Starting ') === 0;
    };

    let processIsAlive = false;
    let webviewVersion;

    try {
      await this.initChromedriverPath();
      await this.killAll();
      this.proc = new _teen_process.SubProcess(this.chromedriver, args);
      processIsAlive = true;
      this.proc.on('output', (stdout, stderr) => {
        const out = stdout + stderr;
        let match = /"Browser": "(.*)"/.exec(out);

        if (match) {
          webviewVersion = match[1];
          log.debug(`Webview version: '${webviewVersion}'`);
        }

        match = /Starting ChromeDriver ([.\d]+)/.exec(out);

        if (match) {
          log.debug(`Chromedriver version: '${match[1]}'`);
        }

        if (this.verbose) {
          for (let line of (stdout || '').trim().split('\n')) {
            if (!line.trim().length) continue;
            log.debug(`[STDOUT] ${line}`);
          }

          for (let line of (stderr || '').trim().split('\n')) {
            if (!line.trim().length) continue;
            log.error(`[STDERR] ${line}`);
          }
        }
      });
      this.proc.on('exit', (code, signal) => {
        processIsAlive = false;

        if (this.state !== Chromedriver.STATE_STOPPED && this.state !== Chromedriver.STATE_STOPPING && this.state !== Chromedriver.STATE_RESTARTING) {
          let msg = `Chromedriver exited unexpectedly with code ${code}, ` + `signal ${signal}`;
          log.error(msg);
          this.changeState(Chromedriver.STATE_STOPPED);
        }
      });
      log.info(`Spawning chromedriver with: ${this.chromedriver} ` + `${args.join(' ')}`);
      await this.proc.start(startDetector);
      await this.waitForOnline();
      await this.startSession();
    } catch (e) {
      this.emit(Chromedriver.EVENT_ERROR, e);

      if (processIsAlive) {
        await this.proc.stop();
      }

      let message = '';

      if (e.message.includes('Chrome version must be')) {
        message += 'Unable to automate Chrome version because it is too old for this version of Chromedriver.\n';

        if (webviewVersion) {
          message += `Chrome version on the device: ${webviewVersion}\n`;
        }

        message += `Visit '${CHROMEDRIVER_TUTORIAL}' to troubleshoot the problem.\n`;
      }

      message += e.message;
      log.errorAndThrow(message);
    }
  }

  sessionId() {
    if (this.state !== Chromedriver.STATE_ONLINE) {
      return null;
    }

    return this.jwproxy.sessionId;
  }

  async restart() {
    log.info('Restarting chromedriver');

    if (this.state !== Chromedriver.STATE_ONLINE) {
      throw new Error("Can't restart when we're not online");
    }

    this.changeState(Chromedriver.STATE_RESTARTING);
    await this.stop(false);
    await this.start(this.capabilities, false);
  }

  async waitForOnline() {
    let chromedriverStopped = false;
    await (0, _asyncbox.retryInterval)(20, 200, async () => {
      if (this.state === Chromedriver.STATE_STOPPED) {
        chromedriverStopped = true;
        return;
      }

      await this.getStatus();
    });

    if (chromedriverStopped) {
      throw new Error('ChromeDriver crashed during startup.');
    }
  }

  async getStatus() {
    return await this.jwproxy.command('/status', 'GET');
  }

  async startSession() {
    await (0, _asyncbox.retryInterval)(4, 200, async () => {
      try {
        const res = await this.jwproxy.command('/session', 'POST', {
          desiredCapabilities: this.capabilities
        });

        if (res.status) {
          throw new Error(res.value.message);
        }
      } catch (err) {
        log.errorAndThrow(`Failed to start Chromedriver session: ${err.message}`);
      }
    });
    this.changeState(Chromedriver.STATE_ONLINE);
  }

  async stop(emitStates = true) {
    if (emitStates) {
      this.changeState(Chromedriver.STATE_STOPPING);
    }

    try {
      await this.jwproxy.command('', 'DELETE');
      await this.proc.stop('SIGTERM', 20000);

      if (emitStates) {
        this.changeState(Chromedriver.STATE_STOPPED);
      }
    } catch (e) {
      log.error(e);
    }
  }

  changeState(state) {
    this.state = state;
    log.debug(`Changed state to '${state}'`);
    this.emit(Chromedriver.EVENT_CHANGED, {
      state
    });
  }

  async sendCommand(url, method, body) {
    return await this.jwproxy.command(url, method, body);
  }

  async proxyReq(req, res) {
    return await this.jwproxy.proxyReqRes(req, res);
  }

  async killAll() {
    let cmd = _appiumSupport.system.isWindows() ? `wmic process where "commandline like '%chromedriver.exe%--port=${this.proxyPort}%'" delete` : `pkill -15 -f "${this.chromedriver}.*--port=${this.proxyPort}"`;
    log.debug(`Killing any old chromedrivers, running: ${cmd}`);

    try {
      await _bluebird.default.promisify(_child_process.default.exec)(cmd);
      log.debug('Successfully cleaned up old chromedrivers');
    } catch (err) {
      log.warn('No old chromedrivers seem to exist');
    }

    if (this.adb) {
      log.debug(`Cleaning any old adb forwarded port socket connections`);

      try {
        for (let conn of await this.adb.getForwardList()) {
          if (conn.indexOf('webview_devtools') !== -1) {
            let params = conn.split(/\s+/);

            if (params.length > 1) {
              await this.adb.removePortForward(params[1].replace(/[\D]*/, ''));
            }
          }
        }
      } catch (err) {
        log.warn(`Unable to clean forwarded ports. Error: '${err.message}'. Continuing.`);
      }
    }
  }

  async hasWorkingWebview() {
    try {
      await this.jwproxy.command('/url', 'GET');
      return true;
    } catch (e) {
      return false;
    }
  }

}

exports.Chromedriver = Chromedriver;
Chromedriver.EVENT_ERROR = 'chromedriver_error';
Chromedriver.EVENT_CHANGED = 'stateChanged';
Chromedriver.STATE_STOPPED = 'stopped';
Chromedriver.STATE_STARTING = 'starting';
Chromedriver.STATE_ONLINE = 'online';
Chromedriver.STATE_STOPPING = 'stopping';
Chromedriver.STATE_RESTARTING = 'restarting';
var _default = Chromedriver;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jaHJvbWVkcml2ZXIuanMiXSwibmFtZXMiOlsibG9nIiwibG9nZ2VyIiwiZ2V0TG9nZ2VyIiwiTkVXX0NEX1ZFUlNJT05fRk9STUFUX01BSk9SX1ZFUlNJT04iLCJERUZBVUxUX0hPU1QiLCJERUZBVUxUX1BPUlQiLCJDSFJPTUVEUklWRVJfQ0hST01FX01BUFBJTkciLCJDSFJPTUVfQlVORExFX0lEIiwiV0VCVklFV19CVU5ETEVfSURTIiwiQ0hST01FRFJJVkVSX1RVVE9SSUFMIiwiQ0RfVkVSIiwicHJvY2VzcyIsImVudiIsIm5wbV9jb25maWdfY2hyb21lZHJpdmVyX3ZlcnNpb24iLCJDSFJPTUVEUklWRVJfVkVSU0lPTiIsImdldE1vc3RSZWNlbnRDaHJvbWVkcml2ZXIiLCJDRF9WRVJTSU9OX1RJTUVPVVQiLCJtYXBwaW5nIiwiXyIsImlzRW1wdHkiLCJFcnJvciIsImxhc3QiLCJrZXlzIiwic29ydCIsImNvbXBhcmVWZXJzaW9ucyIsIkNocm9tZWRyaXZlciIsImV2ZW50cyIsIkV2ZW50RW1pdHRlciIsImNvbnN0cnVjdG9yIiwiYXJncyIsImhvc3QiLCJwb3J0IiwidXNlU3lzdGVtRXhlY3V0YWJsZSIsImV4ZWN1dGFibGUiLCJleGVjdXRhYmxlRGlyIiwiYnVuZGxlSWQiLCJtYXBwaW5nUGF0aCIsImNtZEFyZ3MiLCJhZGIiLCJ2ZXJib3NlIiwibG9nUGF0aCIsImRpc2FibGVCdWlsZENoZWNrIiwicHJveHlIb3N0IiwicHJveHlQb3J0IiwicHJvYyIsImNocm9tZWRyaXZlciIsImV4ZWN1dGFibGVWZXJpZmllZCIsInN0YXRlIiwiU1RBVEVfU1RPUFBFRCIsImp3cHJveHkiLCJKV1Byb3h5Iiwic2VydmVyIiwiZ2V0TWFwcGluZyIsImRlYnVnIiwiZnMiLCJleGlzdHMiLCJ3YXJuIiwiSlNPTiIsInBhcnNlIiwicmVhZEZpbGUiLCJlcnIiLCJlcnJvciIsIm1lc3NhZ2UiLCJjZFZlcnNpb24iLCJjaHJvbWVWZXJzaW9uIiwidG9QYWlycyIsInNlbXZlciIsImNvZXJjZSIsImdldENocm9tZWRyaXZlcnMiLCJleGVjdXRhYmxlcyIsImdsb2IiLCJsZW5ndGgiLCJjZHMiLCJtYXBDaHJvbWVkcml2ZXIiLCJsb2dFcnJvciIsInN0ZG91dCIsInN0ZGVyciIsImVyck1zZyIsInBhdGgiLCJiYXNlbmFtZSIsInRpbWVvdXQiLCJpbmNsdWRlcyIsIm1hdGNoIiwiZXhlYyIsInZlcnNpb24iLCJjb2VyY2VkVmVyc2lvbiIsIm1ham9yIiwibWlub3IiLCJtaW5DaHJvbWVWZXJzaW9uIiwiZmlsdGVyIiwiY2QiLCJhIiwiYiIsImVycm9yQW5kVGhyb3ciLCJnZXRDaHJvbWVWZXJzaW9uIiwiZ2V0QXBpTGV2ZWwiLCJnZXRDb21wYXRpYmxlQ2hyb21lZHJpdmVyIiwiZ3QiLCJ2YWx1ZXMiLCJpc1VuZGVmaW5lZCIsIndvcmtpbmdDZHMiLCJndGUiLCJiaW5QYXRoIiwiaW5pdENocm9tZWRyaXZlclBhdGgiLCJpbmZvIiwic3RhcnQiLCJjYXBzIiwiZW1pdFN0YXJ0aW5nU3RhdGUiLCJjYXBhYmlsaXRpZXMiLCJjbG9uZURlZXAiLCJsb2dnaW5nUHJlZnMiLCJicm93c2VyIiwiY2hhbmdlU3RhdGUiLCJTVEFURV9TVEFSVElORyIsImFkYlBvcnQiLCJjb25jYXQiLCJzdGFydERldGVjdG9yIiwiaW5kZXhPZiIsInByb2Nlc3NJc0FsaXZlIiwid2Vidmlld1ZlcnNpb24iLCJraWxsQWxsIiwiU3ViUHJvY2VzcyIsIm9uIiwib3V0IiwibGluZSIsInRyaW0iLCJzcGxpdCIsImNvZGUiLCJzaWduYWwiLCJTVEFURV9TVE9QUElORyIsIlNUQVRFX1JFU1RBUlRJTkciLCJtc2ciLCJqb2luIiwid2FpdEZvck9ubGluZSIsInN0YXJ0U2Vzc2lvbiIsImUiLCJlbWl0IiwiRVZFTlRfRVJST1IiLCJzdG9wIiwic2Vzc2lvbklkIiwiU1RBVEVfT05MSU5FIiwicmVzdGFydCIsImNocm9tZWRyaXZlclN0b3BwZWQiLCJnZXRTdGF0dXMiLCJjb21tYW5kIiwicmVzIiwiZGVzaXJlZENhcGFiaWxpdGllcyIsInN0YXR1cyIsInZhbHVlIiwiZW1pdFN0YXRlcyIsIkVWRU5UX0NIQU5HRUQiLCJzZW5kQ29tbWFuZCIsInVybCIsIm1ldGhvZCIsImJvZHkiLCJwcm94eVJlcSIsInJlcSIsInByb3h5UmVxUmVzIiwiY21kIiwic3lzdGVtIiwiaXNXaW5kb3dzIiwiQiIsInByb21pc2lmeSIsImNwIiwiY29ubiIsImdldEZvcndhcmRMaXN0IiwicGFyYW1zIiwicmVtb3ZlUG9ydEZvcndhcmQiLCJyZXBsYWNlIiwiaGFzV29ya2luZ1dlYnZpZXciXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztBQUVBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUdBLE1BQU1BLEdBQUcsR0FBR0Msc0JBQU9DLFNBQVAsQ0FBaUIsY0FBakIsQ0FBWjs7QUFFQSxNQUFNQyxtQ0FBbUMsR0FBRyxFQUE1QztBQUNBLE1BQU1DLFlBQVksR0FBRyxXQUFyQjtBQUNBLE1BQU1DLFlBQVksR0FBRyxJQUFyQjtBQUNBLE1BQU1DLDJCQUEyQixHQUFHO0FBRWxDLGtCQUFnQixjQUZrQjtBQUdsQyxpQkFBZSxhQUhtQjtBQUlsQyxpQkFBZSxXQUptQjtBQUtsQyxrQkFBZ0IsV0FMa0I7QUFNbEMsVUFBUSxXQU4wQjtBQU9sQyxVQUFRLFFBUDBCO0FBUWxDLFVBQVEsV0FSMEI7QUFTbEMsVUFBUSxXQVQwQjtBQVVsQyxVQUFRLFdBVjBCO0FBV2xDLFVBQVEsV0FYMEI7QUFZbEMsVUFBUSxXQVowQjtBQWFsQyxVQUFRLFdBYjBCO0FBY2xDLFVBQVEsV0FkMEI7QUFlbEMsVUFBUSxXQWYwQjtBQWdCbEMsVUFBUSxXQWhCMEI7QUFpQmxDLFVBQVEsV0FqQjBCO0FBa0JsQyxVQUFRLFdBbEIwQjtBQW1CbEMsVUFBUSxXQW5CMEI7QUFvQmxDLFVBQVEsV0FwQjBCO0FBcUJsQyxVQUFRLFdBckIwQjtBQXNCbEMsVUFBUSxXQXRCMEI7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QUFyQixFQUE2QixLQUE3QixDQUFOO0FBQ0EsYUFBTyxJQUFQO0FBQ0QsS0FIRCxDQUdFLE9BQU9ULENBQVAsRUFBVTtBQUNWLGFBQU8sS0FBUDtBQUNEO0FBQ0Y7O0FBN2Q0Qzs7O0FBZ2UvQzlHLFlBQVksQ0FBQ2dILFdBQWIsR0FBMkIsb0JBQTNCO0FBQ0FoSCxZQUFZLENBQUM2SCxhQUFiLEdBQTZCLGNBQTdCO0FBQ0E3SCxZQUFZLENBQUN1QixhQUFiLEdBQTZCLFNBQTdCO0FBQ0F2QixZQUFZLENBQUN3RixjQUFiLEdBQThCLFVBQTlCO0FBQ0F4RixZQUFZLENBQUNtSCxZQUFiLEdBQTRCLFFBQTVCO0FBQ0FuSCxZQUFZLENBQUN3RyxjQUFiLEdBQThCLFVBQTlCO0FBQ0F4RyxZQUFZLENBQUN5RyxnQkFBYixHQUFnQyxZQUFoQztlQUtlekcsWSIsInNvdXJjZXNDb250ZW50IjpbIi8vIHRyYW5zcGlsZTptYWluXG5cbmltcG9ydCBldmVudHMgZnJvbSAnZXZlbnRzJztcbmltcG9ydCB7IEpXUHJveHkgfSBmcm9tICdhcHBpdW0tYmFzZS1kcml2ZXInO1xuaW1wb3J0IGNwIGZyb20gJ2NoaWxkX3Byb2Nlc3MnO1xuaW1wb3J0IHsgc3lzdGVtLCBmcywgbG9nZ2VyIH0gZnJvbSAnYXBwaXVtLXN1cHBvcnQnO1xuaW1wb3J0IHsgcmV0cnlJbnRlcnZhbCwgYXN5bmNtYXAgfSBmcm9tICdhc3luY2JveCc7XG5pbXBvcnQgeyBTdWJQcm9jZXNzLCBleGVjIH0gZnJvbSAndGVlbl9wcm9jZXNzJztcbmltcG9ydCBCIGZyb20gJ2JsdWViaXJkJztcbmltcG9ydCB7IGdldENocm9tZVZlcnNpb24sIGdldENocm9tZWRyaXZlckRpciwgZ2V0Q2hyb21lZHJpdmVyQmluYXJ5UGF0aCB9IGZyb20gJy4vdXRpbHMnO1xuaW1wb3J0IHNlbXZlciBmcm9tICdzZW12ZXInO1xuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IGNvbXBhcmVWZXJzaW9ucyBmcm9tICdjb21wYXJlLXZlcnNpb25zJztcblxuXG5jb25zdCBsb2cgPSBsb2dnZXIuZ2V0TG9nZ2VyKCdDaHJvbWVkcml2ZXInKTtcblxuY29uc3QgTkVXX0NEX1ZFUlNJT05fRk9STUFUX01BSk9SX1ZFUlNJT04gPSA3MztcbmNvbnN0IERFRkFVTFRfSE9TVCA9ICcxMjcuMC4wLjEnO1xuY29uc3QgREVGQVVMVF9QT1JUID0gOTUxNTtcbmNvbnN0IENIUk9NRURSSVZFUl9DSFJPTUVfTUFQUElORyA9IHtcbiAgLy8gQ2hyb21lZHJpdmVyIHZlcnNpb246IG1pbnVtdW0gQ2hyb21lIHZlcnNpb25cbiAgJzc1LjAuMzc3MC45MCc6ICc3NS4wLjM3NzAuOTAnLFxuICAnNzUuMC4zNzcwLjgnOiAnNzUuMC4zNzcwLjgnLFxuICAnNzQuMC4zNzI5LjYnOiAnNzQuMC4zNzI5JyxcbiAgJzczLjAuMzY4My42OCc6ICc3MC4wLjM1MzgnLFxuICAnMi40Nic6ICc3MS4wLjM1NzgnLFxuICAnMi40NSc6ICc3MC4wLjAnLFxuICAnMi40NCc6ICc2OS4wLjM0OTcnLFxuICAnMi40Myc6ICc2OS4wLjM0OTcnLFxuICAnMi40Mic6ICc2OC4wLjM0NDAnLFxuICAnMi40MSc6ICc2Ny4wLjMzOTYnLFxuICAnMi40MCc6ICc2Ni4wLjMzNTknLFxuICAnMi4zOSc6ICc2Ni4wLjMzNTknLFxuICAnMi4zOCc6ICc2NS4wLjMzMjUnLFxuICAnMi4zNyc6ICc2NC4wLjMyODInLFxuICAnMi4zNic6ICc2My4wLjMyMzknLFxuICAnMi4zNSc6ICc2Mi4wLjMyMDInLFxuICAnMi4zNCc6ICc2MS4wLjMxNjMnLFxuICAnMi4zMyc6ICc2MC4wLjMxMTInLFxuICAnMi4zMic6ICc1OS4wLjMwNzEnLFxuICAnMi4zMSc6ICc1OC4wLjMwMjknLFxuICAnMi4zMCc6ICc1OC4wLjMwMjknLFxuICAnMi4yOSc6ICc1Ny4wLjI5ODcnLFxuICAnMi4yOCc6ICc1NS4wLjI4ODMnLFxuICAnMi4yNyc6ICc1NC4wLjI4NDAnLFxuICAnMi4yNic6ICc1My4wLjI3ODUnLFxuICAnMi4yNSc6ICc1My4wLjI3ODUnLFxuICAnMi4yNCc6ICc1Mi4wLjI3NDMnLFxuICAnMi4yMyc6ICc1MS4wLjI3MDQnLFxuICAnMi4yMic6ICc0OS4wLjI2MjMnLFxuICAnMi4yMSc6ICc0Ni4wLjI0OTAnLFxuICAnMi4yMCc6ICc0My4wLjIzNTcnLFxuICAnMi4xOSc6ICc0My4wLjIzNTcnLFxuICAnMi4xOCc6ICc0My4wLjIzNTcnLFxuICAnMi4xNyc6ICc0Mi4wLjIzMTEnLFxuICAnMi4xNic6ICc0Mi4wLjIzMTEnLFxuICAnMi4xNSc6ICc0MC4wLjIyMTQnLFxuICAnMi4xNCc6ICczOS4wLjIxNzEnLFxuICAnMi4xMyc6ICczOC4wLjIxMjUnLFxuICAnMi4xMic6ICczNi4wLjE5ODUnLFxuICAnMi4xMSc6ICczNi4wLjE5ODUnLFxuICAnMi4xMCc6ICczMy4wLjE3NTEnLFxuICAnMi45JzogJzMxLjAuMTY1MCcsXG4gICcyLjgnOiAnMzAuMC4xNTczJyxcbiAgJzIuNyc6ICczMC4wLjE1NzMnLFxuICAnMi42JzogJzI5LjAuMTU0NScsXG4gICcyLjUnOiAnMjkuMC4xNTQ1JyxcbiAgJzIuNCc6ICcyOS4wLjE1NDUnLFxuICAnMi4zJzogJzI4LjAuMTUwMCcsXG4gICcyLjInOiAnMjcuMC4xNDUzJyxcbiAgJzIuMSc6ICcyNy4wLjE0NTMnLFxuICAnMi4wJzogJzI3LjAuMTQ1MycsXG59O1xuY29uc3QgQ0hST01FX0JVTkRMRV9JRCA9ICdjb20uYW5kcm9pZC5jaHJvbWUnO1xuY29uc3QgV0VCVklFV19CVU5ETEVfSURTID0gW1xuICAnY29tLmdvb2dsZS5hbmRyb2lkLndlYnZpZXcnLFxuICAnY29tLmFuZHJvaWQud2VidmlldycsXG5dO1xuY29uc3QgQ0hST01FRFJJVkVSX1RVVE9SSUFMID0gJ2h0dHBzOi8vZ2l0aHViLmNvbS9hcHBpdW0vYXBwaXVtL2Jsb2IvbWFzdGVyL2RvY3MvZW4vd3JpdGluZy1ydW5uaW5nLWFwcGl1bS93ZWIvY2hyb21lZHJpdmVyLm1kJztcblxuY29uc3QgQ0RfVkVSID0gcHJvY2Vzcy5lbnYubnBtX2NvbmZpZ19jaHJvbWVkcml2ZXJfdmVyc2lvbiB8fFxuICAgICAgICAgICAgICAgcHJvY2Vzcy5lbnYuQ0hST01FRFJJVkVSX1ZFUlNJT04gfHxcbiAgICAgICAgICAgICAgIGdldE1vc3RSZWNlbnRDaHJvbWVkcml2ZXIoKTtcblxuY29uc3QgQ0RfVkVSU0lPTl9USU1FT1VUID0gNTAwMDtcblxuZnVuY3Rpb24gZ2V0TW9zdFJlY2VudENocm9tZWRyaXZlciAobWFwcGluZyA9IENIUk9NRURSSVZFUl9DSFJPTUVfTUFQUElORykge1xuICBpZiAoXy5pc0VtcHR5KG1hcHBpbmcpKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdVbmFibGUgdG8gZ2V0IG1vc3QgcmVjZW50IENocm9tZWRyaXZlciBmcm9tIGVtcHR5IG1hcHBpbmcnKTtcbiAgfVxuICByZXR1cm4gXy5sYXN0KF8ua2V5cyhtYXBwaW5nKS5zb3J0KGNvbXBhcmVWZXJzaW9ucykpO1xufVxuXG5jbGFzcyBDaHJvbWVkcml2ZXIgZXh0ZW5kcyBldmVudHMuRXZlbnRFbWl0dGVyIHtcbiAgY29uc3RydWN0b3IgKGFyZ3MgPSB7fSkge1xuICAgIHN1cGVyKCk7XG5cbiAgICBjb25zdCB7XG4gICAgICBob3N0ID0gREVGQVVMVF9IT1NULFxuICAgICAgcG9ydCA9IERFRkFVTFRfUE9SVCxcbiAgICAgIHVzZVN5c3RlbUV4ZWN1dGFibGUgPSBmYWxzZSxcbiAgICAgIGV4ZWN1dGFibGUsXG4gICAgICBleGVjdXRhYmxlRGlyID0gZ2V0Q2hyb21lZHJpdmVyRGlyKCksXG4gICAgICBidW5kbGVJZCxcbiAgICAgIG1hcHBpbmdQYXRoLFxuICAgICAgY21kQXJncyxcbiAgICAgIGFkYixcbiAgICAgIHZlcmJvc2UsXG4gICAgICBsb2dQYXRoLFxuICAgICAgZGlzYWJsZUJ1aWxkQ2hlY2ssXG4gICAgfSA9IGFyZ3M7XG5cbiAgICB0aGlzLnByb3h5SG9zdCA9IGhvc3Q7XG4gICAgdGhpcy5wcm94eVBvcnQgPSBwb3J0O1xuICAgIHRoaXMuYWRiID0gYWRiO1xuICAgIHRoaXMuY21kQXJncyA9IGNtZEFyZ3M7XG4gICAgdGhpcy5wcm9jID0gbnVsbDtcbiAgICB0aGlzLnVzZVN5c3RlbUV4ZWN1dGFibGUgPSB1c2VTeXN0ZW1FeGVjdXRhYmxlO1xuICAgIHRoaXMuY2hyb21lZHJpdmVyID0gZXhlY3V0YWJsZTtcbiAgICB0aGlzLmV4ZWN1dGFibGVEaXIgPSBleGVjdXRhYmxlRGlyO1xuICAgIHRoaXMubWFwcGluZ1BhdGggPSBtYXBwaW5nUGF0aDtcbiAgICB0aGlzLmJ1bmRsZUlkID0gYnVuZGxlSWQ7XG4gICAgdGhpcy5leGVjdXRhYmxlVmVyaWZpZWQgPSBmYWxzZTtcbiAgICB0aGlzLnN0YXRlID0gQ2hyb21lZHJpdmVyLlNUQVRFX1NUT1BQRUQ7XG4gICAgdGhpcy5qd3Byb3h5ID0gbmV3IEpXUHJveHkoe3NlcnZlcjogdGhpcy5wcm94eUhvc3QsIHBvcnQ6IHRoaXMucHJveHlQb3J0fSk7XG4gICAgdGhpcy52ZXJib3NlID0gdmVyYm9zZTtcbiAgICB0aGlzLmxvZ1BhdGggPSBsb2dQYXRoO1xuICAgIHRoaXMuZGlzYWJsZUJ1aWxkQ2hlY2sgPSAhIWRpc2FibGVCdWlsZENoZWNrO1xuICB9XG5cbiAgYXN5bmMgZ2V0TWFwcGluZyAoKSB7XG4gICAgbGV0IG1hcHBpbmcgPSBDSFJPTUVEUklWRVJfQ0hST01FX01BUFBJTkc7XG4gICAgaWYgKHRoaXMubWFwcGluZ1BhdGgpIHtcbiAgICAgIGxvZy5kZWJ1ZyhgQXR0ZW1wdGluZyB0byB1c2UgQ2hyb21lZHJpdmVyLUNocm9tZSBtYXBwaW5nIGZyb20gJyR7dGhpcy5tYXBwaW5nUGF0aH0nYCk7XG4gICAgICBpZiAoIWF3YWl0IGZzLmV4aXN0cyh0aGlzLm1hcHBpbmdQYXRoKSkge1xuICAgICAgICBsb2cud2FybihgTm8gZmlsZSBmb3VuZCBhdCAnJHt0aGlzLm1hcHBpbmdQYXRofScuIFVzaW5nIGRlZmF1bHQgbWFwcGluZ2ApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBtYXBwaW5nID0gSlNPTi5wYXJzZShhd2FpdCBmcy5yZWFkRmlsZSh0aGlzLm1hcHBpbmdQYXRoKSk7XG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgIGxvZy5lcnJvcihgRXJyb3IgcGFyc2luZyBtYXBwaW5nIGZyb20gJyR7dGhpcy5tYXBwaW5nUGF0aH0nOiAke2Vyci5tZXNzYWdlfWApO1xuICAgICAgICAgIGxvZy53YXJuKCdVc2luZyBkZWZhdWx0IG1hcHBpbmcnKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIG1ha2Ugc3VyZSB0aGF0IHRoZSB2YWx1ZXMgZm9yIG1pbmltdW0gY2hyb21lIHZlcnNpb24gYXJlIHNlbXZlciBjb21wbGlhbnRcbiAgICBmb3IgKGNvbnN0IFtjZFZlcnNpb24sIGNocm9tZVZlcnNpb25dIG9mIF8udG9QYWlycyhtYXBwaW5nKSkge1xuICAgICAgbWFwcGluZ1tjZFZlcnNpb25dID0gc2VtdmVyLmNvZXJjZShjaHJvbWVWZXJzaW9uKTtcbiAgICB9XG4gICAgcmV0dXJuIG1hcHBpbmc7XG4gIH1cblxuICBhc3luYyBnZXRDaHJvbWVkcml2ZXJzIChtYXBwaW5nKSB7XG4gICAgLy8gZ28gdGhyb3VnaCB0aGUgdmVyc2lvbnMgYXZhaWxhYmxlXG4gICAgY29uc3QgZXhlY3V0YWJsZXMgPSBhd2FpdCBmcy5nbG9iKGAke3RoaXMuZXhlY3V0YWJsZURpcn0vKmApO1xuICAgIGxvZy5kZWJ1ZyhgRm91bmQgJHtleGVjdXRhYmxlcy5sZW5ndGh9IGV4ZWN1dGFibGUke2V4ZWN1dGFibGVzLmxlbmd0aCA9PT0gMSA/ICcnIDogJ3MnfSBgICtcbiAgICAgIGBpbiAnJHt0aGlzLmV4ZWN1dGFibGVEaXJ9J2ApO1xuICAgIGNvbnN0IGNkcyA9IChhd2FpdCBhc3luY21hcChleGVjdXRhYmxlcywgYXN5bmMgZnVuY3Rpb24gbWFwQ2hyb21lZHJpdmVyIChleGVjdXRhYmxlKSB7XG4gICAgICBjb25zdCBsb2dFcnJvciA9ICh7bWVzc2FnZSwgc3Rkb3V0ID0gbnVsbCwgc3RkZXJyID0gbnVsbH0pID0+IHtcbiAgICAgICAgbGV0IGVyck1zZyA9IGBDYW5ub3QgcmV0cmlldmUgdmVyc2lvbiBudW1iZXIgZnJvbSAnJHtwYXRoLmJhc2VuYW1lKGV4ZWN1dGFibGUpfScgQ2hyb21lZHJpdmVyIGJpbmFyeS4gYCArXG4gICAgICAgICAgYE1ha2Ugc3VyZSBpdCByZXR1cm5zIGEgdmFsaWQgdmVyc2lvbiBzdHJpbmcgaW4gcmVzcG9uc2UgdG8gJy0tdmVyc2lvbicgY29tbWFuZCBsaW5lIGFyZ3VtZW50LiAke21lc3NhZ2V9YDtcbiAgICAgICAgaWYgKHN0ZG91dCkge1xuICAgICAgICAgIGVyck1zZyArPSBgXFxuU3Rkb3V0OiAke3N0ZG91dH1gO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzdGRlcnIpIHtcbiAgICAgICAgICBlcnJNc2cgKz0gYFxcblN0ZGVycjogJHtzdGRlcnJ9YDtcbiAgICAgICAgfVxuICAgICAgICBsb2cud2FybihlcnJNc2cpO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH07XG5cbiAgICAgIGxldCBzdGRvdXQ7XG4gICAgICBsZXQgc3RkZXJyO1xuICAgICAgdHJ5IHtcbiAgICAgICAgKHtzdGRvdXQsIHN0ZGVycn0gPSBhd2FpdCBleGVjKGV4ZWN1dGFibGUsIFsnLS12ZXJzaW9uJ10sIHtcbiAgICAgICAgICB0aW1lb3V0OiBDRF9WRVJTSU9OX1RJTUVPVVQsXG4gICAgICAgIH0pKTtcbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICBpZiAoIShlcnIubWVzc2FnZSB8fCAnJykuaW5jbHVkZXMoJ3RpbWVkIG91dCcpICYmICEoZXJyLnN0ZG91dCB8fCAnJykuaW5jbHVkZXMoJ1N0YXJ0aW5nIENocm9tZURyaXZlcicpKSB7XG4gICAgICAgICAgcmV0dXJuIGxvZ0Vycm9yKGVycik7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBpZiB0aGlzIGhhcyB0aW1lZCBvdXQsIGl0IGhhcyBhY3R1YWxseSBzdGFydGVkIENocm9tZWRyaXZlcixcbiAgICAgICAgLy8gaW4gd2hpY2ggY2FzZSB0aGVyZSB3aWxsIGFsc28gYmUgdGhlIHZlcnNpb24gc3RyaW5nIGluIHRoZSBvdXRwdXRcbiAgICAgICAgc3Rkb3V0ID0gZXJyLnN0ZG91dDtcbiAgICAgIH1cblxuICAgICAgY29uc3QgbWF0Y2ggPSAvQ2hyb21lRHJpdmVyXFxzK1xcKD92PyhbXFxkLl0rKVxcKT8vaS5leGVjKHN0ZG91dCk7IC8vIGh0dHBzOi8vcmVnZXgxMDEuY29tL3IvenBqNXdBLzFcbiAgICAgIGlmICghbWF0Y2gpIHtcbiAgICAgICAgcmV0dXJuIGxvZ0Vycm9yKHttZXNzYWdlOiAnQ2Fubm90IHBhcnNlIHRoZSB2ZXJzaW9uIHN0cmluZycsIHN0ZG91dCwgc3RkZXJyfSk7XG4gICAgICB9XG4gICAgICBsZXQgdmVyc2lvbiA9IG1hdGNoWzFdO1xuICAgICAgY29uc3QgY29lcmNlZFZlcnNpb24gPSBzZW12ZXIuY29lcmNlKHZlcnNpb24sIHRydWUpO1xuICAgICAgaWYgKGNvZXJjZWRWZXJzaW9uKSB7XG4gICAgICAgIC8vIGJlZm9yZSAyMDE5LTAzLTA2IHZlcnNpb25zIHdlcmUgb2YgdGhlIGZvcm0gbWFqb3IubWlub3JcbiAgICAgICAgaWYgKGNvZXJjZWRWZXJzaW9uLm1ham9yIDwgTkVXX0NEX1ZFUlNJT05fRk9STUFUX01BSk9SX1ZFUlNJT04pIHtcbiAgICAgICAgICB2ZXJzaW9uID0gYCR7Y29lcmNlZFZlcnNpb24ubWFqb3J9LiR7Y29lcmNlZFZlcnNpb24ubWlub3J9YDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZXhlY3V0YWJsZSxcbiAgICAgICAgdmVyc2lvbixcbiAgICAgICAgbWluQ2hyb21lVmVyc2lvbjogbWFwcGluZ1t2ZXJzaW9uXSxcbiAgICAgIH07XG4gICAgfSkpXG4gICAgICAuZmlsdGVyKChjZCkgPT4gISFjZClcbiAgICAgIC5zb3J0KChhLCBiKSA9PiBjb21wYXJlVmVyc2lvbnMoYi52ZXJzaW9uLCBhLnZlcnNpb24pKTtcbiAgICBpZiAoXy5pc0VtcHR5KGNkcykpIHtcbiAgICAgIGxvZy5lcnJvckFuZFRocm93KGBObyBDaHJvbWVkcml2ZXJzIGZvdW5kIGluICcke3RoaXMuZXhlY3V0YWJsZURpcn0nYCk7XG4gICAgfVxuICAgIGxvZy5kZWJ1ZyhgVGhlIGZvbGxvd2luZyBDaHJvbWVkcml2ZXIgZXhlY3V0YWJsZXMgd2VyZSBmb3VuZDpgKTtcbiAgICBmb3IgKGNvbnN0IGNkIG9mIGNkcykge1xuICAgICAgbG9nLmRlYnVnKGAgICAgJyR7Y2QuZXhlY3V0YWJsZX0nICh2ZXJzaW9uICcke2NkLnZlcnNpb259JywgbWluaW11bSBDaHJvbWUgdmVyc2lvbiAnJHtjZC5taW5DaHJvbWVWZXJzaW9uID8gY2QubWluQ2hyb21lVmVyc2lvbiA6ICdVbmtub3duJ30nKWApO1xuICAgIH1cbiAgICByZXR1cm4gY2RzO1xuICB9XG5cbiAgYXN5bmMgZ2V0Q2hyb21lVmVyc2lvbiAoKSB7XG4gICAgbGV0IGNocm9tZVZlcnNpb247XG5cbiAgICAvLyBvbiBBbmRyb2lkIDcrIHdlYnZpZXdzIGFyZSBiYWNrZWQgYnkgdGhlIG1haW4gQ2hyb21lLCBub3QgdGhlIHN5c3RlbSB3ZWJ2aWV3XG4gICAgaWYgKHRoaXMuYWRiICYmIGF3YWl0IHRoaXMuYWRiLmdldEFwaUxldmVsKCkgPj0gMjQpIHtcbiAgICAgIHRoaXMuYnVuZGxlSWQgPSBDSFJPTUVfQlVORExFX0lEO1xuICAgIH1cblxuICAgIC8vIHRyeSBvdXQgd2Vidmlld3Mgd2hlbiBubyBidW5kbGUgaWQgaXMgc2VudCBpblxuICAgIGlmICghdGhpcy5idW5kbGVJZCkge1xuICAgICAgLy8gZGVmYXVsdCB0byB0aGUgZ2VuZXJpYyBDaHJvbWUgYnVuZGxlXG4gICAgICB0aGlzLmJ1bmRsZUlkID0gQ0hST01FX0JVTkRMRV9JRDtcblxuICAgICAgLy8gd2UgaGF2ZSBhIHdlYnZpZXcgb2Ygc29tZSBzb3J0LCBzbyB0cnkgdG8gZmluZCB0aGUgYnVuZGxlIHZlcnNpb25cbiAgICAgIGZvciAoY29uc3QgYnVuZGxlSWQgb2YgV0VCVklFV19CVU5ETEVfSURTKSB7XG4gICAgICAgIGNocm9tZVZlcnNpb24gPSBhd2FpdCBnZXRDaHJvbWVWZXJzaW9uKHRoaXMuYWRiLCBidW5kbGVJZCk7XG4gICAgICAgIGlmIChjaHJvbWVWZXJzaW9uKSB7XG4gICAgICAgICAgdGhpcy5idW5kbGVJZCA9IGJ1bmRsZUlkO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gaWYgd2UgZG8gbm90IGhhdmUgYSBjaHJvbWUgdmVyc2lvbiwgaXQgbXVzdCBub3QgYmUgYSB3ZWJ2aWV3XG4gICAgaWYgKCFjaHJvbWVWZXJzaW9uKSB7XG4gICAgICBjaHJvbWVWZXJzaW9uID0gYXdhaXQgZ2V0Q2hyb21lVmVyc2lvbih0aGlzLmFkYiwgdGhpcy5idW5kbGVJZCk7XG4gICAgfVxuXG4gICAgLy8gbWFrZSBzdXJlIGl0IGlzIHNlbXZlciwgc28gbGF0ZXIgY2hlY2tzIHdvbid0IGZhaWxcbiAgICByZXR1cm4gY2hyb21lVmVyc2lvbiA/IHNlbXZlci5jb2VyY2UoY2hyb21lVmVyc2lvbikgOiBudWxsO1xuICB9XG5cbiAgYXN5bmMgZ2V0Q29tcGF0aWJsZUNocm9tZWRyaXZlciAoKSB7XG4gICAgaWYgKCF0aGlzLmFkYikge1xuICAgICAgcmV0dXJuIGF3YWl0IGdldENocm9tZWRyaXZlckJpbmFyeVBhdGgoKTtcbiAgICB9XG5cbiAgICBjb25zdCBtYXBwaW5nID0gYXdhaXQgdGhpcy5nZXRNYXBwaW5nKCk7XG4gICAgY29uc3QgY2RzID0gYXdhaXQgdGhpcy5nZXRDaHJvbWVkcml2ZXJzKG1hcHBpbmcpO1xuXG4gICAgaWYgKHRoaXMuZGlzYWJsZUJ1aWxkQ2hlY2spIHtcbiAgICAgIGNvbnN0IGNkID0gY2RzWzBdO1xuICAgICAgbG9nLndhcm4oYENocm9tZSBidWlsZCBjaGVjayBkaXNhYmxlZC4gVXNpbmcgbW9zdCByZWNlbnQgQ2hyb21lZHJpdmVyIHZlcnNpb24gKCR7Y2QudmVyc2lvbn0sIGF0ICcke2NkLmV4ZWN1dGFibGV9JylgKTtcbiAgICAgIGxvZy53YXJuKGBJZiB0aGlzIGlzIHdyb25nLCBzZXQgJ2Nocm9tZWRyaXZlckRpc2FibGVCdWlsZENoZWNrJyBjYXBhYmlsaXR5IHRvICdmYWxzZSdgKTtcbiAgICAgIHJldHVybiBjZC5leGVjdXRhYmxlO1xuICAgIH1cblxuICAgIGNvbnN0IGNocm9tZVZlcnNpb24gPSBhd2FpdCB0aGlzLmdldENocm9tZVZlcnNpb24oKTtcblxuICAgIGlmICghY2hyb21lVmVyc2lvbikge1xuICAgICAgLy8gdW5hYmxlIHRvIGdldCB0aGUgY2hyb21lIHZlcnNpb25cbiAgICAgIGxldCBjZCA9IGNkc1swXTtcbiAgICAgIGxvZy53YXJuKGBVbmFibGUgdG8gZGlzY292ZXIgQ2hyb21lIHZlcnNpb24uIFVzaW5nIENocm9tZWRyaXZlciAke2NkLnZlcnNpb259IGF0ICcke2NkLmV4ZWN1dGFibGV9J2ApO1xuICAgICAgcmV0dXJuIGNkLmV4ZWN1dGFibGU7XG4gICAgfVxuXG4gICAgbG9nLmRlYnVnKGBGb3VuZCBDaHJvbWUgYnVuZGxlICcke3RoaXMuYnVuZGxlSWR9JyB2ZXJzaW9uICcke2Nocm9tZVZlcnNpb259J2ApO1xuXG4gICAgaWYgKHNlbXZlci5ndChjaHJvbWVWZXJzaW9uLCBfLnZhbHVlcyhtYXBwaW5nKVswXSkgJiZcbiAgICAgICAgIV8uaXNVbmRlZmluZWQoY2RzWzBdKSAmJiBfLmlzVW5kZWZpbmVkKGNkc1swXS5taW5DaHJvbWVWZXJzaW9uKSkge1xuICAgICAgLy8gdGhpcyBpcyBhIGNocm9tZSBhYm92ZSB0aGUgbGF0ZXN0IHZlcnNpb24gd2Uga25vdyBhYm91dCxcbiAgICAgIC8vIGFuZCB3ZSBoYXZlIGEgY2hyb21lZHJpdmVyIHRoYXQgaXMgYmV5b25kIHdoYXQgd2Uga25vdyxcbiAgICAgIC8vIHNvIHVzZSB0aGUgbW9zdCByZWNlbnQgY2hyb21lZHJpdmVyIHRoYXQgd2UgZm91bmRcbiAgICAgIGxldCBjZCA9IGNkc1swXTtcbiAgICAgIGxvZy53YXJuKGBObyBrbm93biBDaHJvbWVkcml2ZXIgYXZhaWxhYmxlIHRvIGF1dG9tYXRlIENocm9tZSB2ZXJzaW9uICcke2Nocm9tZVZlcnNpb259Jy5cXG5gICtcbiAgICAgICAgICAgICAgIGBVc2luZyBDaHJvbWVkcml2ZXIgdmVyc2lvbiAnJHtjZC52ZXJzaW9ufScsIHdoaWNoIGhhcyBub3QgYmVlbiB0ZXN0ZWQgd2l0aCBBcHBpdW0uYCk7XG4gICAgICByZXR1cm4gY2QuZXhlY3V0YWJsZTtcbiAgICB9XG5cbiAgICBjb25zdCB3b3JraW5nQ2RzID0gY2RzLmZpbHRlcigoY2QpID0+IHtcbiAgICAgIHJldHVybiAhXy5pc1VuZGVmaW5lZChjZC5taW5DaHJvbWVWZXJzaW9uKSAmJiBzZW12ZXIuZ3RlKGNocm9tZVZlcnNpb24sIGNkLm1pbkNocm9tZVZlcnNpb24pO1xuICAgIH0pO1xuXG4gICAgaWYgKF8uaXNFbXB0eSh3b3JraW5nQ2RzKSkge1xuICAgICAgbG9nLmVycm9yQW5kVGhyb3coYE5vIENocm9tZWRyaXZlciBmb3VuZCB0aGF0IGNhbiBhdXRvbWF0ZSBDaHJvbWUgJyR7Y2hyb21lVmVyc2lvbn0nLiBgICtcbiAgICAgICAgICAgICAgICAgICAgICAgIGBTZWUgJHtDSFJPTUVEUklWRVJfVFVUT1JJQUx9IGZvciBtb3JlIGRldGFpbHMuYCk7XG4gICAgfVxuXG4gICAgY29uc3QgYmluUGF0aCA9IHdvcmtpbmdDZHNbMF0uZXhlY3V0YWJsZTtcbiAgICBsb2cuZGVidWcoYEZvdW5kICR7d29ya2luZ0Nkcy5sZW5ndGh9IENocm9tZWRyaXZlciBleGVjdXRhYmxlJHt3b3JraW5nQ2RzLmxlbmd0aCA9PT0gMSA/ICcnIDogJ3MnfSBgICtcbiAgICAgICAgICAgICAgYGNhcGFibGUgb2YgYXV0b21hdGluZyBDaHJvbWUgJyR7Y2hyb21lVmVyc2lvbn0nLlxcbmAgK1xuICAgICAgICAgICAgICBgQ2hvb3NpbmcgdGhlIG1vc3QgcmVjZW50LCAnJHtiaW5QYXRofScuYCk7XG4gICAgbG9nLmRlYnVnKCdJZiBhIHNwZWNpZmljIHZlcnNpb24gaXMgcmVxdWlyZWQsIHNwZWNpZnkgaXQgd2l0aCB0aGUgYGNocm9tZWRyaXZlckV4ZWN1dGFibGVgJyArXG4gICAgICAgICAgICAgICdkZXNpcmVkIGNhcGFiaWxpdHkuJyk7XG4gICAgcmV0dXJuIGJpblBhdGg7XG4gIH1cblxuICBhc3luYyBpbml0Q2hyb21lZHJpdmVyUGF0aCAoKSB7XG4gICAgaWYgKHRoaXMuZXhlY3V0YWJsZVZlcmlmaWVkKSByZXR1cm47IC8vZXNsaW50LWRpc2FibGUtbGluZSBjdXJseVxuXG4gICAgLy8gdGhlIGV4ZWN1dGFibGUgbWlnaHQgYmUgc2V0IChpZiBwYXNzZWQgaW4pXG4gICAgLy8gb3Igd2UgbWlnaHQgd2FudCB0byB1c2UgdGhlIGJhc2ljIG9uZSBpbnN0YWxsZWQgd2l0aCB0aGlzIGRyaXZlclxuICAgIC8vIG9yIHdlIHdhbnQgdG8gZmlndXJlIG91dCB0aGUgYmVzdCBvbmVcbiAgICBpZiAoIXRoaXMuY2hyb21lZHJpdmVyKSB7XG4gICAgICB0aGlzLmNocm9tZWRyaXZlciA9IHRoaXMudXNlU3lzdGVtRXhlY3V0YWJsZVxuICAgICAgICA/IGF3YWl0IGdldENocm9tZWRyaXZlckJpbmFyeVBhdGgoKVxuICAgICAgICA6IGF3YWl0IHRoaXMuZ2V0Q29tcGF0aWJsZUNocm9tZWRyaXZlcigpO1xuICAgIH1cblxuICAgIGlmICghYXdhaXQgZnMuZXhpc3RzKHRoaXMuY2hyb21lZHJpdmVyKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBUcnlpbmcgdG8gdXNlIGEgY2hyb21lZHJpdmVyIGJpbmFyeSBhdCB0aGUgcGF0aCBgICtcbiAgICAgICAgICAgICAgICAgICAgICBgJHt0aGlzLmNocm9tZWRyaXZlcn0sIGJ1dCBpdCBkb2Vzbid0IGV4aXN0IWApO1xuICAgIH1cbiAgICB0aGlzLmV4ZWN1dGFibGVWZXJpZmllZCA9IHRydWU7XG4gICAgbG9nLmluZm8oYFNldCBjaHJvbWVkcml2ZXIgYmluYXJ5IGFzOiAke3RoaXMuY2hyb21lZHJpdmVyfWApO1xuICB9XG5cbiAgYXN5bmMgc3RhcnQgKGNhcHMsIGVtaXRTdGFydGluZ1N0YXRlID0gdHJ1ZSkge1xuICAgIHRoaXMuY2FwYWJpbGl0aWVzID0gXy5jbG9uZURlZXAoY2Fwcyk7XG5cbiAgICAvLyBzZXQgdGhlIGxvZ2dpbmcgcHJlZmVyZW5jZXMgdG8gQUxMIHRoZSBjb25zb2xlIGxvZ3NcbiAgICB0aGlzLmNhcGFiaWxpdGllcy5sb2dnaW5nUHJlZnMgPSB0aGlzLmNhcGFiaWxpdGllcy5sb2dnaW5nUHJlZnMgfHwge307XG4gICAgaWYgKF8uaXNFbXB0eSh0aGlzLmNhcGFiaWxpdGllcy5sb2dnaW5nUHJlZnMuYnJvd3NlcikpIHtcbiAgICAgIHRoaXMuY2FwYWJpbGl0aWVzLmxvZ2dpbmdQcmVmcy5icm93c2VyID0gJ0FMTCc7XG4gICAgfVxuXG4gICAgaWYgKGVtaXRTdGFydGluZ1N0YXRlKSB7XG4gICAgICB0aGlzLmNoYW5nZVN0YXRlKENocm9tZWRyaXZlci5TVEFURV9TVEFSVElORyk7XG4gICAgfVxuXG4gICAgbGV0IGFyZ3MgPSBbJy0tdXJsLWJhc2U9d2QvaHViJywgYC0tcG9ydD0ke3RoaXMucHJveHlQb3J0fWBdO1xuICAgIGlmICh0aGlzLmFkYiAmJiB0aGlzLmFkYi5hZGJQb3J0KSB7XG4gICAgICBhcmdzID0gYXJncy5jb25jYXQoW2AtLWFkYi1wb3J0PSR7dGhpcy5hZGIuYWRiUG9ydH1gXSk7XG4gICAgfVxuICAgIGlmICh0aGlzLmNtZEFyZ3MpIHtcbiAgICAgIGFyZ3MgPSBhcmdzLmNvbmNhdCh0aGlzLmNtZEFyZ3MpO1xuICAgIH1cbiAgICBpZiAodGhpcy5sb2dQYXRoKSB7XG4gICAgICBhcmdzID0gYXJncy5jb25jYXQoW2AtLWxvZy1wYXRoPSR7dGhpcy5sb2dQYXRofWBdKTtcbiAgICB9XG4gICAgaWYgKHRoaXMuZGlzYWJsZUJ1aWxkQ2hlY2spIHtcbiAgICAgIGFyZ3MgPSBhcmdzLmNvbmNhdChbJy0tZGlzYWJsZS1idWlsZC1jaGVjayddKTtcbiAgICB9XG4gICAgYXJncyA9IGFyZ3MuY29uY2F0KFsnLS12ZXJib3NlJ10pO1xuICAgIC8vIHdoYXQgYXJlIHRoZSBwcm9jZXNzIHN0ZG91dC9zdGRlcnIgY29uZGl0aW9ucyB3aGVyZWluIHdlIGtub3cgdGhhdFxuICAgIC8vIHRoZSBwcm9jZXNzIGhhcyBzdGFydGVkIHRvIG91ciBzYXRpc2ZhY3Rpb24/XG4gICAgY29uc3Qgc3RhcnREZXRlY3RvciA9IChzdGRvdXQpID0+IHtcbiAgICAgIHJldHVybiBzdGRvdXQuaW5kZXhPZignU3RhcnRpbmcgJykgPT09IDA7XG4gICAgfTtcblxuICAgIGxldCBwcm9jZXNzSXNBbGl2ZSA9IGZhbHNlO1xuICAgIGxldCB3ZWJ2aWV3VmVyc2lvbjtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5pbml0Q2hyb21lZHJpdmVyUGF0aCgpO1xuICAgICAgYXdhaXQgdGhpcy5raWxsQWxsKCk7XG5cbiAgICAgIC8vIHNldCB1cCBvdXIgc3VicHJvY2VzcyBvYmplY3RcbiAgICAgIHRoaXMucHJvYyA9IG5ldyBTdWJQcm9jZXNzKHRoaXMuY2hyb21lZHJpdmVyLCBhcmdzKTtcbiAgICAgIHByb2Nlc3NJc0FsaXZlID0gdHJ1ZTtcblxuICAgICAgLy8gaGFuZGxlIGxvZyBvdXRwdXRcbiAgICAgIHRoaXMucHJvYy5vbignb3V0cHV0JywgKHN0ZG91dCwgc3RkZXJyKSA9PiB7XG4gICAgICAgIC8vIGlmIHRoZSBjZCBvdXRwdXQgaXMgbm90IHByaW50ZWQsIGZpbmQgdGhlIGNocm9tZSB2ZXJzaW9uIGFuZCBwcmludFxuICAgICAgICAvLyB3aWxsIGdldCBhIHJlc3BvbnNlIGxpa2VcbiAgICAgICAgLy8gICBEZXZUb29scyByZXNwb25zZToge1xuICAgICAgICAvLyAgICAgIFwiQW5kcm9pZC1QYWNrYWdlXCI6IFwiaW8uYXBwaXVtLnNhbXBsZWFwcFwiLFxuICAgICAgICAvLyAgICAgIFwiQnJvd3NlclwiOiBcIkNocm9tZS81NS4wLjI4ODMuOTFcIixcbiAgICAgICAgLy8gICAgICBcIlByb3RvY29sLVZlcnNpb25cIjogXCIxLjJcIixcbiAgICAgICAgLy8gICAgICBcIlVzZXItQWdlbnRcIjogXCIuLi5cIixcbiAgICAgICAgLy8gICAgICBcIldlYktpdC1WZXJzaW9uXCI6IFwiNTM3LjM2XCJcbiAgICAgICAgLy8gICB9XG4gICAgICAgIGNvbnN0IG91dCA9IHN0ZG91dCArIHN0ZGVycjtcbiAgICAgICAgbGV0IG1hdGNoID0gL1wiQnJvd3NlclwiOiBcIiguKilcIi8uZXhlYyhvdXQpO1xuICAgICAgICBpZiAobWF0Y2gpIHtcbiAgICAgICAgICB3ZWJ2aWV3VmVyc2lvbiA9IG1hdGNoWzFdO1xuICAgICAgICAgIGxvZy5kZWJ1ZyhgV2VidmlldyB2ZXJzaW9uOiAnJHt3ZWJ2aWV3VmVyc2lvbn0nYCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBhbHNvIHByaW50IGNocm9tZWRyaXZlciB2ZXJzaW9uIHRvIGxvZ3NcbiAgICAgICAgLy8gd2lsbCBvdXRwdXQgc29tZXRoaW5nIGxpa2VcbiAgICAgICAgLy8gIFN0YXJ0aW5nIENocm9tZURyaXZlciAyLjMzLjUwNjEwNiAoOGEwNmMzOWM0NTgyZmJmYmFiNjk2NmRiYjFjMzhhOTE3M2JmYjFhMikgb24gcG9ydCA5NTE1XG4gICAgICAgIG1hdGNoID0gL1N0YXJ0aW5nIENocm9tZURyaXZlciAoWy5cXGRdKykvLmV4ZWMob3V0KTtcbiAgICAgICAgaWYgKG1hdGNoKSB7XG4gICAgICAgICAgbG9nLmRlYnVnKGBDaHJvbWVkcml2ZXIgdmVyc2lvbjogJyR7bWF0Y2hbMV19J2ApO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gZ2l2ZSB0aGUgb3V0cHV0IGlmIGl0IGlzIHJlcXVlc3RlZFxuICAgICAgICBpZiAodGhpcy52ZXJib3NlKSB7XG4gICAgICAgICAgZm9yIChsZXQgbGluZSBvZiAoc3Rkb3V0IHx8ICcnKS50cmltKCkuc3BsaXQoJ1xcbicpKSB7XG4gICAgICAgICAgICBpZiAoIWxpbmUudHJpbSgpLmxlbmd0aCkgY29udGludWU7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgY3VybHlcbiAgICAgICAgICAgIGxvZy5kZWJ1ZyhgW1NURE9VVF0gJHtsaW5lfWApO1xuICAgICAgICAgIH1cbiAgICAgICAgICBmb3IgKGxldCBsaW5lIG9mIChzdGRlcnIgfHwgJycpLnRyaW0oKS5zcGxpdCgnXFxuJykpIHtcbiAgICAgICAgICAgIGlmICghbGluZS50cmltKCkubGVuZ3RoKSBjb250aW51ZTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBjdXJseVxuICAgICAgICAgICAgbG9nLmVycm9yKGBbU1RERVJSXSAke2xpbmV9YCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgLy8gaGFuZGxlIG91dC1vZi1ib3VuZCBleGl0IGJ5IHNpbXBseSBlbWl0dGluZyBhIHN0b3BwZWQgc3RhdGVcbiAgICAgIHRoaXMucHJvYy5vbignZXhpdCcsIChjb2RlLCBzaWduYWwpID0+IHtcbiAgICAgICAgcHJvY2Vzc0lzQWxpdmUgPSBmYWxzZTtcbiAgICAgICAgaWYgKHRoaXMuc3RhdGUgIT09IENocm9tZWRyaXZlci5TVEFURV9TVE9QUEVEICYmXG4gICAgICAgICAgICB0aGlzLnN0YXRlICE9PSBDaHJvbWVkcml2ZXIuU1RBVEVfU1RPUFBJTkcgJiZcbiAgICAgICAgICAgIHRoaXMuc3RhdGUgIT09IENocm9tZWRyaXZlci5TVEFURV9SRVNUQVJUSU5HKSB7XG4gICAgICAgICAgbGV0IG1zZyA9IGBDaHJvbWVkcml2ZXIgZXhpdGVkIHVuZXhwZWN0ZWRseSB3aXRoIGNvZGUgJHtjb2RlfSwgYCArXG4gICAgICAgICAgICAgICAgICAgIGBzaWduYWwgJHtzaWduYWx9YDtcbiAgICAgICAgICBsb2cuZXJyb3IobXNnKTtcbiAgICAgICAgICB0aGlzLmNoYW5nZVN0YXRlKENocm9tZWRyaXZlci5TVEFURV9TVE9QUEVEKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICBsb2cuaW5mbyhgU3Bhd25pbmcgY2hyb21lZHJpdmVyIHdpdGg6ICR7dGhpcy5jaHJvbWVkcml2ZXJ9IGAgK1xuICAgICAgICAgICAgICAgYCR7YXJncy5qb2luKCcgJyl9YCk7XG4gICAgICAvLyBzdGFydCBzdWJwcm9jIGFuZCB3YWl0IGZvciBzdGFydERldGVjdG9yXG4gICAgICBhd2FpdCB0aGlzLnByb2Muc3RhcnQoc3RhcnREZXRlY3Rvcik7XG4gICAgICBhd2FpdCB0aGlzLndhaXRGb3JPbmxpbmUoKTtcbiAgICAgIGF3YWl0IHRoaXMuc3RhcnRTZXNzaW9uKCk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgdGhpcy5lbWl0KENocm9tZWRyaXZlci5FVkVOVF9FUlJPUiwgZSk7XG4gICAgICAvLyBqdXN0IGJlY2F1c2Ugd2UgaGFkIGFuIGVycm9yIGRvZXNuJ3QgbWVhbiB0aGUgY2hyb21lZHJpdmVyIHByb2Nlc3NcbiAgICAgIC8vIGZpbmlzaGVkOyB3ZSBzaG91bGQgY2xlYW4gdXAgaWYgbmVjZXNzYXJ5XG4gICAgICBpZiAocHJvY2Vzc0lzQWxpdmUpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5wcm9jLnN0b3AoKTtcbiAgICAgIH1cblxuICAgICAgbGV0IG1lc3NhZ2UgPSAnJztcbiAgICAgIC8vIG9mdGVuIHRoZSB1c2VyJ3MgQ2hyb21lIHZlcnNpb24gaXMgdG9vIGxvdyBmb3IgdGhlIHZlcnNpb24gb2YgQ2hyb21lZHJpdmVyXG4gICAgICBpZiAoZS5tZXNzYWdlLmluY2x1ZGVzKCdDaHJvbWUgdmVyc2lvbiBtdXN0IGJlJykpIHtcbiAgICAgICAgbWVzc2FnZSArPSAnVW5hYmxlIHRvIGF1dG9tYXRlIENocm9tZSB2ZXJzaW9uIGJlY2F1c2UgaXQgaXMgdG9vIG9sZCBmb3IgdGhpcyB2ZXJzaW9uIG9mIENocm9tZWRyaXZlci5cXG4nO1xuICAgICAgICBpZiAod2Vidmlld1ZlcnNpb24pIHtcbiAgICAgICAgICBtZXNzYWdlICs9IGBDaHJvbWUgdmVyc2lvbiBvbiB0aGUgZGV2aWNlOiAke3dlYnZpZXdWZXJzaW9ufVxcbmA7XG4gICAgICAgIH1cbiAgICAgICAgbWVzc2FnZSArPSBgVmlzaXQgJyR7Q0hST01FRFJJVkVSX1RVVE9SSUFMfScgdG8gdHJvdWJsZXNob290IHRoZSBwcm9ibGVtLlxcbmA7XG4gICAgICB9XG5cbiAgICAgIG1lc3NhZ2UgKz0gZS5tZXNzYWdlO1xuICAgICAgbG9nLmVycm9yQW5kVGhyb3cobWVzc2FnZSk7XG4gICAgfVxuICB9XG5cbiAgc2Vzc2lvbklkICgpIHtcbiAgICBpZiAodGhpcy5zdGF0ZSAhPT0gQ2hyb21lZHJpdmVyLlNUQVRFX09OTElORSkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMuandwcm94eS5zZXNzaW9uSWQ7XG4gIH1cblxuICBhc3luYyByZXN0YXJ0ICgpIHtcbiAgICBsb2cuaW5mbygnUmVzdGFydGluZyBjaHJvbWVkcml2ZXInKTtcbiAgICBpZiAodGhpcy5zdGF0ZSAhPT0gQ2hyb21lZHJpdmVyLlNUQVRFX09OTElORSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQ2FuJ3QgcmVzdGFydCB3aGVuIHdlJ3JlIG5vdCBvbmxpbmVcIik7XG4gICAgfVxuICAgIHRoaXMuY2hhbmdlU3RhdGUoQ2hyb21lZHJpdmVyLlNUQVRFX1JFU1RBUlRJTkcpO1xuICAgIGF3YWl0IHRoaXMuc3RvcChmYWxzZSk7XG4gICAgYXdhaXQgdGhpcy5zdGFydCh0aGlzLmNhcGFiaWxpdGllcywgZmFsc2UpO1xuICB9XG5cbiAgYXN5bmMgd2FpdEZvck9ubGluZSAoKSB7XG4gICAgLy8gd2UgbmVlZCB0byBtYWtlIHN1cmUgdGhhdCBDRCBoYXNuJ3QgY3Jhc2hlZFxuICAgIGxldCBjaHJvbWVkcml2ZXJTdG9wcGVkID0gZmFsc2U7XG4gICAgYXdhaXQgcmV0cnlJbnRlcnZhbCgyMCwgMjAwLCBhc3luYyAoKSA9PiB7XG4gICAgICBpZiAodGhpcy5zdGF0ZSA9PT0gQ2hyb21lZHJpdmVyLlNUQVRFX1NUT1BQRUQpIHtcbiAgICAgICAgLy8gd2UgYXJlIGVpdGhlciBzdG9wcGVkIG9yIHN0b3BwaW5nLCBzbyBzb21ldGhpbmcgd2VudCB3cm9uZ1xuICAgICAgICBjaHJvbWVkcml2ZXJTdG9wcGVkID0gdHJ1ZTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgYXdhaXQgdGhpcy5nZXRTdGF0dXMoKTtcbiAgICB9KTtcbiAgICBpZiAoY2hyb21lZHJpdmVyU3RvcHBlZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdDaHJvbWVEcml2ZXIgY3Jhc2hlZCBkdXJpbmcgc3RhcnR1cC4nKTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBnZXRTdGF0dXMgKCkge1xuICAgIHJldHVybiBhd2FpdCB0aGlzLmp3cHJveHkuY29tbWFuZCgnL3N0YXR1cycsICdHRVQnKTtcbiAgfVxuXG4gIGFzeW5jIHN0YXJ0U2Vzc2lvbiAoKSB7XG4gICAgLy8gcmV0cnkgc2Vzc2lvbiBzdGFydCA0IHRpbWVzLCBzb21ldGltZXMgdGhpcyBmYWlscyBkdWUgdG8gYWRiXG4gICAgYXdhaXQgcmV0cnlJbnRlcnZhbCg0LCAyMDAsIGFzeW5jICgpID0+IHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHRoaXMuandwcm94eS5jb21tYW5kKCcvc2Vzc2lvbicsICdQT1NUJywge2Rlc2lyZWRDYXBhYmlsaXRpZXM6IHRoaXMuY2FwYWJpbGl0aWVzfSk7XG4gICAgICAgIC8vIENocm9tZURyaXZlciBjYW4gcmV0dXJuIGEgcG9zaXRpdmUgc3RhdHVzIGRlc3BpdGUgZmFpbGluZ1xuICAgICAgICBpZiAocmVzLnN0YXR1cykge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihyZXMudmFsdWUubWVzc2FnZSk7XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICBsb2cuZXJyb3JBbmRUaHJvdyhgRmFpbGVkIHRvIHN0YXJ0IENocm9tZWRyaXZlciBzZXNzaW9uOiAke2Vyci5tZXNzYWdlfWApO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHRoaXMuY2hhbmdlU3RhdGUoQ2hyb21lZHJpdmVyLlNUQVRFX09OTElORSk7XG4gIH1cblxuICBhc3luYyBzdG9wIChlbWl0U3RhdGVzID0gdHJ1ZSkge1xuICAgIGlmIChlbWl0U3RhdGVzKSB7XG4gICAgICB0aGlzLmNoYW5nZVN0YXRlKENocm9tZWRyaXZlci5TVEFURV9TVE9QUElORyk7XG4gICAgfVxuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0aGlzLmp3cHJveHkuY29tbWFuZCgnJywgJ0RFTEVURScpO1xuICAgICAgYXdhaXQgdGhpcy5wcm9jLnN0b3AoJ1NJR1RFUk0nLCAyMDAwMCk7XG4gICAgICBpZiAoZW1pdFN0YXRlcykge1xuICAgICAgICB0aGlzLmNoYW5nZVN0YXRlKENocm9tZWRyaXZlci5TVEFURV9TVE9QUEVEKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBsb2cuZXJyb3IoZSk7XG4gICAgfVxuICB9XG5cbiAgY2hhbmdlU3RhdGUgKHN0YXRlKSB7XG4gICAgdGhpcy5zdGF0ZSA9IHN0YXRlO1xuICAgIGxvZy5kZWJ1ZyhgQ2hhbmdlZCBzdGF0ZSB0byAnJHtzdGF0ZX0nYCk7XG4gICAgdGhpcy5lbWl0KENocm9tZWRyaXZlci5FVkVOVF9DSEFOR0VELCB7c3RhdGV9KTtcbiAgfVxuXG4gIGFzeW5jIHNlbmRDb21tYW5kICh1cmwsIG1ldGhvZCwgYm9keSkge1xuICAgIHJldHVybiBhd2FpdCB0aGlzLmp3cHJveHkuY29tbWFuZCh1cmwsIG1ldGhvZCwgYm9keSk7XG4gIH1cblxuICBhc3luYyBwcm94eVJlcSAocmVxLCByZXMpIHtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5qd3Byb3h5LnByb3h5UmVxUmVzKHJlcSwgcmVzKTtcbiAgfVxuXG4gIGFzeW5jIGtpbGxBbGwgKCkge1xuICAgIGxldCBjbWQgPSBzeXN0ZW0uaXNXaW5kb3dzKClcbiAgICAgID8gYHdtaWMgcHJvY2VzcyB3aGVyZSBcImNvbW1hbmRsaW5lIGxpa2UgJyVjaHJvbWVkcml2ZXIuZXhlJS0tcG9ydD0ke3RoaXMucHJveHlQb3J0fSUnXCIgZGVsZXRlYFxuICAgICAgOiBgcGtpbGwgLTE1IC1mIFwiJHt0aGlzLmNocm9tZWRyaXZlcn0uKi0tcG9ydD0ke3RoaXMucHJveHlQb3J0fVwiYDtcbiAgICBsb2cuZGVidWcoYEtpbGxpbmcgYW55IG9sZCBjaHJvbWVkcml2ZXJzLCBydW5uaW5nOiAke2NtZH1gKTtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgKEIucHJvbWlzaWZ5KGNwLmV4ZWMpKShjbWQpO1xuICAgICAgbG9nLmRlYnVnKCdTdWNjZXNzZnVsbHkgY2xlYW5lZCB1cCBvbGQgY2hyb21lZHJpdmVycycpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgbG9nLndhcm4oJ05vIG9sZCBjaHJvbWVkcml2ZXJzIHNlZW0gdG8gZXhpc3QnKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5hZGIpIHtcbiAgICAgIGxvZy5kZWJ1ZyhgQ2xlYW5pbmcgYW55IG9sZCBhZGIgZm9yd2FyZGVkIHBvcnQgc29ja2V0IGNvbm5lY3Rpb25zYCk7XG4gICAgICB0cnkge1xuICAgICAgICBmb3IgKGxldCBjb25uIG9mIGF3YWl0IHRoaXMuYWRiLmdldEZvcndhcmRMaXN0KCkpIHtcbiAgICAgICAgICAvLyBjaHJvbWVkcml2ZXIgd2lsbCBhc2sgQURCIHRvIGZvcndhcmQgYSBwb3J0IGxpa2UgXCJkZXZpY2VJZCB0Y3A6cG9ydCBsb2NhbGFic3RyYWN0OndlYnZpZXdfZGV2dG9vbHNfcmVtb3RlX3BvcnRcIlxuICAgICAgICAgIGlmIChjb25uLmluZGV4T2YoJ3dlYnZpZXdfZGV2dG9vbHMnKSAhPT0gLTEpIHtcbiAgICAgICAgICAgIGxldCBwYXJhbXMgPSBjb25uLnNwbGl0KC9cXHMrLyk7XG4gICAgICAgICAgICBpZiAocGFyYW1zLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgICAgYXdhaXQgdGhpcy5hZGIucmVtb3ZlUG9ydEZvcndhcmQocGFyYW1zWzFdLnJlcGxhY2UoL1tcXERdKi8sICcnKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgbG9nLndhcm4oYFVuYWJsZSB0byBjbGVhbiBmb3J3YXJkZWQgcG9ydHMuIEVycm9yOiAnJHtlcnIubWVzc2FnZX0nLiBDb250aW51aW5nLmApO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGhhc1dvcmtpbmdXZWJ2aWV3ICgpIHtcbiAgICAvLyBzb21ldGltZXMgY2hyb21lZHJpdmVyIHN0b3BzIGF1dG9tYXRpbmcgd2Vidmlld3MuIHRoaXMgbWV0aG9kIHJ1bnMgYVxuICAgIC8vIHNpbXBsZSBjb21tYW5kIHRvIGRldGVybWluZSBvdXIgc3RhdGUsIGFuZCByZXNwb25kcyBhY2NvcmRpbmdseVxuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0aGlzLmp3cHJveHkuY29tbWFuZCgnL3VybCcsICdHRVQnKTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cbn1cblxuQ2hyb21lZHJpdmVyLkVWRU5UX0VSUk9SID0gJ2Nocm9tZWRyaXZlcl9lcnJvcic7XG5DaHJvbWVkcml2ZXIuRVZFTlRfQ0hBTkdFRCA9ICdzdGF0ZUNoYW5nZWQnO1xuQ2hyb21lZHJpdmVyLlNUQVRFX1NUT1BQRUQgPSAnc3RvcHBlZCc7XG5DaHJvbWVkcml2ZXIuU1RBVEVfU1RBUlRJTkcgPSAnc3RhcnRpbmcnO1xuQ2hyb21lZHJpdmVyLlNUQVRFX09OTElORSA9ICdvbmxpbmUnO1xuQ2hyb21lZHJpdmVyLlNUQVRFX1NUT1BQSU5HID0gJ3N0b3BwaW5nJztcbkNocm9tZWRyaXZlci5TVEFURV9SRVNUQVJUSU5HID0gJ3Jlc3RhcnRpbmcnO1xuXG5leHBvcnQge1xuICBDaHJvbWVkcml2ZXIsIENIUk9NRURSSVZFUl9DSFJPTUVfTUFQUElORywgZ2V0TW9zdFJlY2VudENocm9tZWRyaXZlciwgQ0RfVkVSLFxufTtcbmV4cG9ydCBkZWZhdWx0IENocm9tZWRyaXZlcjtcbiJdLCJmaWxlIjoibGliL2Nocm9tZWRyaXZlci5qcyIsInNvdXJjZVJvb3QiOiIuLi8uLiJ9
