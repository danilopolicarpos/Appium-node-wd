"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.BASEDRIVER_HANDLED_SETTINGS = exports.DeviceSettings = exports.default = void 0;

require("source-map-support/register");

var _lodash = _interopRequireDefault(require("lodash"));

var _logger = _interopRequireDefault(require("./logger"));

var _images = require("./commands/images");

var _imageElement = require("./image-element");

const GLOBAL_DEFAULT_SETTINGS = {
  imageMatchThreshold: _images.DEFAULT_MATCH_THRESHOLD,
  fixImageFindScreenshotDims: true,
  fixImageTemplateSize: false,
  fixImageTemplateScale: false,
  defaultImageTemplateScale: _imageElement.DEFAULT_TEMPLATE_IMAGE_SCALE,
  checkForImageElementStaleness: true,
  autoUpdateImageElementPosition: false,
  imageElementTapStrategy: _imageElement.IMAGE_EL_TAP_STRATEGY_W3C
};
const BASEDRIVER_HANDLED_SETTINGS = ['imageMatchThreshold', 'fixImageFindScreenshotDims', 'fixImageTemplateSize', 'fixImageTemplateScale', 'defaultImageTemplateScale', 'checkForImageElementStaleness', 'autoUpdateImageElementPosition', 'imageElementTapStrategy'];
exports.BASEDRIVER_HANDLED_SETTINGS = BASEDRIVER_HANDLED_SETTINGS;

class DeviceSettings {
  constructor(defaultSettings = {}, onSettingsUpdate = null) {
    this._settings = Object.assign({}, GLOBAL_DEFAULT_SETTINGS, defaultSettings);
    this.onSettingsUpdate = onSettingsUpdate;
  }

  async update(newSettings) {
    if (!_lodash.default.isObject(newSettings)) {
      throw new Error('Settings update should be called with valid JSON');
    }

    for (let prop of _lodash.default.keys(newSettings)) {
      if (_lodash.default.isUndefined(this._settings[prop])) {
        _logger.default.warn(`Didn't know about setting '${prop}'. Are you sure you ` + `spelled it correctly? Proceeding anyway. Valid settings: ${_lodash.default.keys(this._settings)}`);
      }

      if (this._settings[prop] !== newSettings[prop]) {
        if (this.onSettingsUpdate) {
          await this.onSettingsUpdate(prop, newSettings[prop], this._settings[prop]);
          this._settings[prop] = newSettings[prop];
        } else {
          _logger.default.errorAndThrow('Unable to update settings; onSettingsUpdate method not found');
        }
      }
    }
  }

  getSettings() {
    return this._settings;
  }

}

exports.DeviceSettings = DeviceSettings;
var _default = DeviceSettings;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9iYXNlZHJpdmVyL2RldmljZS1zZXR0aW5ncy5qcyJdLCJuYW1lcyI6WyJHTE9CQUxfREVGQVVMVF9TRVRUSU5HUyIsImltYWdlTWF0Y2hUaHJlc2hvbGQiLCJERUZBVUxUX01BVENIX1RIUkVTSE9MRCIsImZpeEltYWdlRmluZFNjcmVlbnNob3REaW1zIiwiZml4SW1hZ2VUZW1wbGF0ZVNpemUiLCJmaXhJbWFnZVRlbXBsYXRlU2NhbGUiLCJkZWZhdWx0SW1hZ2VUZW1wbGF0ZVNjYWxlIiwiREVGQVVMVF9URU1QTEFURV9JTUFHRV9TQ0FMRSIsImNoZWNrRm9ySW1hZ2VFbGVtZW50U3RhbGVuZXNzIiwiYXV0b1VwZGF0ZUltYWdlRWxlbWVudFBvc2l0aW9uIiwiaW1hZ2VFbGVtZW50VGFwU3RyYXRlZ3kiLCJJTUFHRV9FTF9UQVBfU1RSQVRFR1lfVzNDIiwiQkFTRURSSVZFUl9IQU5ETEVEX1NFVFRJTkdTIiwiRGV2aWNlU2V0dGluZ3MiLCJjb25zdHJ1Y3RvciIsImRlZmF1bHRTZXR0aW5ncyIsIm9uU2V0dGluZ3NVcGRhdGUiLCJfc2V0dGluZ3MiLCJPYmplY3QiLCJhc3NpZ24iLCJ1cGRhdGUiLCJuZXdTZXR0aW5ncyIsIl8iLCJpc09iamVjdCIsIkVycm9yIiwicHJvcCIsImtleXMiLCJpc1VuZGVmaW5lZCIsImxvZyIsIndhcm4iLCJlcnJvckFuZFRocm93IiwiZ2V0U2V0dGluZ3MiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBRUEsTUFBTUEsdUJBQXVCLEdBQUc7QUFHOUJDLEVBQUFBLG1CQUFtQixFQUFFQywrQkFIUztBQU85QkMsRUFBQUEsMEJBQTBCLEVBQUUsSUFQRTtBQVk5QkMsRUFBQUEsb0JBQW9CLEVBQUUsS0FaUTtBQW9COUJDLEVBQUFBLHFCQUFxQixFQUFFLEtBcEJPO0FBNEI5QkMsRUFBQUEseUJBQXlCLEVBQUVDLDBDQTVCRztBQWdDOUJDLEVBQUFBLDZCQUE2QixFQUFFLElBaENEO0FBb0M5QkMsRUFBQUEsOEJBQThCLEVBQUUsS0FwQ0Y7QUF3QzlCQyxFQUFBQSx1QkFBdUIsRUFBRUM7QUF4Q0ssQ0FBaEM7QUE2Q0EsTUFBTUMsMkJBQTJCLEdBQUcsQ0FDbEMscUJBRGtDLEVBRWxDLDRCQUZrQyxFQUdsQyxzQkFIa0MsRUFJbEMsdUJBSmtDLEVBS2xDLDJCQUxrQyxFQU1sQywrQkFOa0MsRUFPbEMsZ0NBUGtDLEVBUWxDLHlCQVJrQyxDQUFwQzs7O0FBV0EsTUFBTUMsY0FBTixDQUFxQjtBQUVuQkMsRUFBQUEsV0FBVyxDQUFFQyxlQUFlLEdBQUcsRUFBcEIsRUFBd0JDLGdCQUFnQixHQUFHLElBQTNDLEVBQWlEO0FBQzFELFNBQUtDLFNBQUwsR0FBaUJDLE1BQU0sQ0FBQ0MsTUFBUCxDQUFjLEVBQWQsRUFBa0JuQix1QkFBbEIsRUFBMkNlLGVBQTNDLENBQWpCO0FBQ0EsU0FBS0MsZ0JBQUwsR0FBd0JBLGdCQUF4QjtBQUNEOztBQUdELFFBQU1JLE1BQU4sQ0FBY0MsV0FBZCxFQUEyQjtBQUN6QixRQUFJLENBQUNDLGdCQUFFQyxRQUFGLENBQVdGLFdBQVgsQ0FBTCxFQUE4QjtBQUM1QixZQUFNLElBQUlHLEtBQUosQ0FBVSxrREFBVixDQUFOO0FBQ0Q7O0FBQ0QsU0FBSyxJQUFJQyxJQUFULElBQWlCSCxnQkFBRUksSUFBRixDQUFPTCxXQUFQLENBQWpCLEVBQXNDO0FBQ3BDLFVBQUlDLGdCQUFFSyxXQUFGLENBQWMsS0FBS1YsU0FBTCxDQUFlUSxJQUFmLENBQWQsQ0FBSixFQUF5QztBQUN2Q0csd0JBQUlDLElBQUosQ0FBVSw4QkFBNkJKLElBQUssc0JBQW5DLEdBQ0MsNERBQTJESCxnQkFBRUksSUFBRixDQUFPLEtBQUtULFNBQVosQ0FBdUIsRUFENUY7QUFFRDs7QUFDRCxVQUFJLEtBQUtBLFNBQUwsQ0FBZVEsSUFBZixNQUF5QkosV0FBVyxDQUFDSSxJQUFELENBQXhDLEVBQWdEO0FBRTlDLFlBQUksS0FBS1QsZ0JBQVQsRUFBMkI7QUFDekIsZ0JBQU0sS0FBS0EsZ0JBQUwsQ0FBc0JTLElBQXRCLEVBQTRCSixXQUFXLENBQUNJLElBQUQsQ0FBdkMsRUFBK0MsS0FBS1IsU0FBTCxDQUFlUSxJQUFmLENBQS9DLENBQU47QUFDQSxlQUFLUixTQUFMLENBQWVRLElBQWYsSUFBdUJKLFdBQVcsQ0FBQ0ksSUFBRCxDQUFsQztBQUNELFNBSEQsTUFHTztBQUNMRywwQkFBSUUsYUFBSixDQUFrQiw4REFBbEI7QUFDRDtBQUNGO0FBQ0Y7QUFDRjs7QUFFREMsRUFBQUEsV0FBVyxHQUFJO0FBQ2IsV0FBTyxLQUFLZCxTQUFaO0FBQ0Q7O0FBL0JrQjs7O2VBa0NOSixjIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCBsb2cgZnJvbSAnLi9sb2dnZXInO1xuaW1wb3J0IHsgREVGQVVMVF9NQVRDSF9USFJFU0hPTEQgfSBmcm9tICcuL2NvbW1hbmRzL2ltYWdlcyc7XG5pbXBvcnQgeyBJTUFHRV9FTF9UQVBfU1RSQVRFR1lfVzNDLCBERUZBVUxUX1RFTVBMQVRFX0lNQUdFX1NDQUxFIH0gZnJvbSAnLi9pbWFnZS1lbGVtZW50JztcblxuY29uc3QgR0xPQkFMX0RFRkFVTFRfU0VUVElOR1MgPSB7XG4gIC8vIHZhbHVlIGJldHdlZW4gMCBhbmQgMSByZXByZXNlbnRpbmcgbWF0Y2ggc3RyZW5ndGgsIGJlbG93IHdoaWNoIGFuIGltYWdlXG4gIC8vIGVsZW1lbnQgd2lsbCBub3QgYmUgZm91bmRcbiAgaW1hZ2VNYXRjaFRocmVzaG9sZDogREVGQVVMVF9NQVRDSF9USFJFU0hPTEQsXG5cbiAgLy8gaWYgdGhlIGltYWdlIHJldHVybmVkIGJ5IGdldFNjcmVlbnNob3QgZGlmZmVycyBpbiBzaXplIG9yIGFzcGVjdCByYXRpb1xuICAvLyBmcm9tIHRoZSBzY3JlZW4sIGF0dGVtcHQgdG8gZml4IGl0IGF1dG9tYXRpY2FsbHlcbiAgZml4SW1hZ2VGaW5kU2NyZWVuc2hvdERpbXM6IHRydWUsXG5cbiAgLy8gd2hldGhlciBBcHBpdW0gc2hvdWxkIGVuc3VyZSB0aGF0IGFuIGltYWdlIHRlbXBsYXRlIHNlbnQgaW4gZHVyaW5nIGltYWdlXG4gIC8vIGVsZW1lbnQgZmluZCBzaG91bGQgaGF2ZSBpdHMgc2l6ZSBhZGp1c3RlZCBzbyB0aGUgbWF0Y2ggYWxnb3JpdGhtIHdpbGwgbm90XG4gIC8vIGNvbXBsYWluXG4gIGZpeEltYWdlVGVtcGxhdGVTaXplOiBmYWxzZSxcblxuICAvLyB3aGV0aGVyIEFwcGl1bSBzaG91bGQgZW5zdXJlIHRoYXQgYW4gaW1hZ2UgdGVtcGxhdGUgc2VudCBpbiBkdXJpbmcgaW1hZ2VcbiAgLy8gZWxlbWVudCBmaW5kIHNob3VsZCBoYXZlIGl0cyBzY2FsZSBhZGp1c3RlZCB0byBkaXNwbGF5IHNpemUgc28gdGhlIG1hdGNoXG4gIC8vIGFsZ29yaXRobSB3aWxsIG5vdCBjb21wbGFpbi5cbiAgLy8gZS5nLiBpT1MgaGFzIGB3aWR0aD0zNzUsIGhlaWdodD02NjdgIHdpbmRvdyByZWN0LCBidXQgaXRzIHNjcmVlbnNob3QgaXNcbiAgLy8gICAgICBgd2lkdGg9NzUwIMOXIGhlaWdodD0xMzM0YCBwaXhlbHMuIFRoaXMgc2V0dGluZyBoZWxwIHRvIGFkanVzdCB0aGUgc2NhbGVcbiAgLy8gICAgICBpZiBhIHVzZXIgdXNlIGB3aWR0aD03NTAgw5cgaGVpZ2h0PTEzMzRgIHBpeGVscydzIGJhc2UgdGVtcGxhdGUgaW1hZ2UuXG4gIGZpeEltYWdlVGVtcGxhdGVTY2FsZTogZmFsc2UsXG5cbiAgLy8gVXNlcnMgbWlnaHQgaGF2ZSBzY2FsZWQgdGVtcGxhdGUgaW1hZ2UgdG8gcmVkdWNlIHRoZWlyIHN0b3JhZ2Ugc2l6ZS5cbiAgLy8gVGhpcyBzZXR0aW5nIGFsbG93cyB1c2VycyB0byBzY2FsZSBhIHRlbXBsYXRlIGltYWdlIHRoZXkgc2VuZCB0byBBcHBpdW0gc2VydmVyXG4gIC8vIHNvIHRoYXQgdGhlIEFwcGl1bSBzZXJ2ZXIgY29tcGFyZXMgdGhlIGFjdHVhbCBzY2FsZSB1c2VycyBvcmlnaW5hbGx5IGhhZC5cbiAgLy8gZS5nLiBJZiBhIHVzZXIgaGFzIGFuIGltYWdlIG9mIDI3MCB4IDMyIHBpeGVscyB3aGljaCB3YXMgb3JpZ2luYWxseSAxMDgwIHggMTI2IHBpeGVscyxcbiAgLy8gICAgICB0aGUgdXNlciBjYW4gc2V0IHtkZWZhdWx0SW1hZ2VUZW1wbGF0ZVNjYWxlOiA0LjB9IHRvIHNjYWxlIHRoZSBzbWFsbCBpbWFnZVxuICAvLyAgICAgIHRvIHRoZSBvcmlnaW5hbCBvbmUgc28gdGhhdCBBcHBpdW0gY2FuIGNvbXBhcmUgaXQgYXMgdGhlIG9yaWdpbmFsIG9uZS5cbiAgZGVmYXVsdEltYWdlVGVtcGxhdGVTY2FsZTogREVGQVVMVF9URU1QTEFURV9JTUFHRV9TQ0FMRSxcblxuICAvLyB3aGV0aGVyIEFwcGl1bSBzaG91bGQgcmUtY2hlY2sgdGhhdCBhbiBpbWFnZSBlbGVtZW50IGNhbiBiZSBtYXRjaGVkXG4gIC8vIGFnYWluc3QgdGhlIGN1cnJlbnQgc2NyZWVuc2hvdCBiZWZvcmUgY2xpY2tpbmcgaXRcbiAgY2hlY2tGb3JJbWFnZUVsZW1lbnRTdGFsZW5lc3M6IHRydWUsXG5cbiAgLy8gd2hldGhlciBiZWZvcmUgY2xpY2tpbmcgb24gYW4gaW1hZ2UgZWxlbWVudCBBcHBpdW0gc2hvdWxkIHJlLWRldGVybWluZSB0aGVcbiAgLy8gcG9zaXRpb24gb2YgdGhlIGVsZW1lbnQgb24gc2NyZWVuXG4gIGF1dG9VcGRhdGVJbWFnZUVsZW1lbnRQb3NpdGlvbjogZmFsc2UsXG5cbiAgLy8gd2hpY2ggbWV0aG9kIHRvIHVzZSBmb3IgdGFwcGluZyBieSBjb29yZGluYXRlIGZvciBpbWFnZSBlbGVtZW50cy4gdGhlXG4gIC8vIG9wdGlvbnMgYXJlICd3M2MnIG9yICdtanNvbndwJ1xuICBpbWFnZUVsZW1lbnRUYXBTdHJhdGVneTogSU1BR0VfRUxfVEFQX1NUUkFURUdZX1czQyxcbn07XG5cbi8vIGRlY2xhcmUgc2V0dGluZ3MgdGhhdCBhcmUgcmVhbGx5IGhhbmRsZWQgb25seSBieSBiYXNlZHJpdmVyLCBzbyBkb3duc3RyZWFtXG4vLyBkcml2ZXJzIGNhbiBjaG9vc2UgdG8gaWdub3JlIHRoZW0gZm9yIHRoZWlyIG93biBzZXR0aW5ncyB2YWxpZGF0aW9uLCBldGMuLi5cbmNvbnN0IEJBU0VEUklWRVJfSEFORExFRF9TRVRUSU5HUyA9IFtcbiAgJ2ltYWdlTWF0Y2hUaHJlc2hvbGQnLFxuICAnZml4SW1hZ2VGaW5kU2NyZWVuc2hvdERpbXMnLFxuICAnZml4SW1hZ2VUZW1wbGF0ZVNpemUnLFxuICAnZml4SW1hZ2VUZW1wbGF0ZVNjYWxlJyxcbiAgJ2RlZmF1bHRJbWFnZVRlbXBsYXRlU2NhbGUnLFxuICAnY2hlY2tGb3JJbWFnZUVsZW1lbnRTdGFsZW5lc3MnLFxuICAnYXV0b1VwZGF0ZUltYWdlRWxlbWVudFBvc2l0aW9uJyxcbiAgJ2ltYWdlRWxlbWVudFRhcFN0cmF0ZWd5Jyxcbl07XG5cbmNsYXNzIERldmljZVNldHRpbmdzIHtcblxuICBjb25zdHJ1Y3RvciAoZGVmYXVsdFNldHRpbmdzID0ge30sIG9uU2V0dGluZ3NVcGRhdGUgPSBudWxsKSB7XG4gICAgdGhpcy5fc2V0dGluZ3MgPSBPYmplY3QuYXNzaWduKHt9LCBHTE9CQUxfREVGQVVMVF9TRVRUSU5HUywgZGVmYXVsdFNldHRpbmdzKTtcbiAgICB0aGlzLm9uU2V0dGluZ3NVcGRhdGUgPSBvblNldHRpbmdzVXBkYXRlO1xuICB9XG5cbiAgLy8gY2FsbHMgdXBkYXRlU2V0dGluZ3MgZnJvbSBpbXBsZW1lbnRpbmcgZHJpdmVyIGV2ZXJ5IHRpbWUgYSBzZXR0aW5nIGlzIGNoYW5nZWQuXG4gIGFzeW5jIHVwZGF0ZSAobmV3U2V0dGluZ3MpIHtcbiAgICBpZiAoIV8uaXNPYmplY3QobmV3U2V0dGluZ3MpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1NldHRpbmdzIHVwZGF0ZSBzaG91bGQgYmUgY2FsbGVkIHdpdGggdmFsaWQgSlNPTicpO1xuICAgIH1cbiAgICBmb3IgKGxldCBwcm9wIG9mIF8ua2V5cyhuZXdTZXR0aW5ncykpIHtcbiAgICAgIGlmIChfLmlzVW5kZWZpbmVkKHRoaXMuX3NldHRpbmdzW3Byb3BdKSkge1xuICAgICAgICBsb2cud2FybihgRGlkbid0IGtub3cgYWJvdXQgc2V0dGluZyAnJHtwcm9wfScuIEFyZSB5b3Ugc3VyZSB5b3UgYCArXG4gICAgICAgICAgICAgICAgIGBzcGVsbGVkIGl0IGNvcnJlY3RseT8gUHJvY2VlZGluZyBhbnl3YXkuIFZhbGlkIHNldHRpbmdzOiAke18ua2V5cyh0aGlzLl9zZXR0aW5ncyl9YCk7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5fc2V0dGluZ3NbcHJvcF0gIT09IG5ld1NldHRpbmdzW3Byb3BdKSB7XG4gICAgICAgIC8vIHVwZGF0ZSBzZXR0aW5nIG9ubHkgd2hlbiB0aGVyZSBpcyB1cGRhdGVTZXR0aW5ncyBkZWZpbmVkLlxuICAgICAgICBpZiAodGhpcy5vblNldHRpbmdzVXBkYXRlKSB7XG4gICAgICAgICAgYXdhaXQgdGhpcy5vblNldHRpbmdzVXBkYXRlKHByb3AsIG5ld1NldHRpbmdzW3Byb3BdLCB0aGlzLl9zZXR0aW5nc1twcm9wXSk7XG4gICAgICAgICAgdGhpcy5fc2V0dGluZ3NbcHJvcF0gPSBuZXdTZXR0aW5nc1twcm9wXTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBsb2cuZXJyb3JBbmRUaHJvdygnVW5hYmxlIHRvIHVwZGF0ZSBzZXR0aW5nczsgb25TZXR0aW5nc1VwZGF0ZSBtZXRob2Qgbm90IGZvdW5kJyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBnZXRTZXR0aW5ncyAoKSB7XG4gICAgcmV0dXJuIHRoaXMuX3NldHRpbmdzO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IERldmljZVNldHRpbmdzO1xuZXhwb3J0IHsgRGV2aWNlU2V0dGluZ3MsIEJBU0VEUklWRVJfSEFORExFRF9TRVRUSU5HUyB9O1xuIl0sImZpbGUiOiJsaWIvYmFzZWRyaXZlci9kZXZpY2Utc2V0dGluZ3MuanMiLCJzb3VyY2VSb290IjoiLi4vLi4vLi4ifQ==
