"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.server = server;
exports.configureServer = configureServer;

require("source-map-support/register");

var _path = _interopRequireDefault(require("path"));

var _express = _interopRequireDefault(require("express"));

var _http = _interopRequireDefault(require("http"));

var _serveFavicon = _interopRequireDefault(require("serve-favicon"));

var _bodyParser = _interopRequireDefault(require("body-parser"));

var _methodOverride = _interopRequireDefault(require("method-override"));

var _logger = _interopRequireDefault(require("./logger"));

var _expressLogging = require("./express-logging");

var _middleware = require("./middleware");

var _static = require("./static");

var _crash = require("./crash");

var _websocket = require("./websocket");

var _bluebird = _interopRequireDefault(require("bluebird"));

async function server(configureRoutes, port, hostname = null, allowCors = true) {
  let app = (0, _express.default)();

  let httpServer = _http.default.createServer(app);

  httpServer.addWebSocketHandler = _websocket.addWebSocketHandler;
  httpServer.removeWebSocketHandler = _websocket.removeWebSocketHandler;
  httpServer.removeAllWebSocketHandlers = _websocket.removeAllWebSocketHandlers;
  httpServer.getWebSocketHandlers = _websocket.getWebSocketHandlers;
  let close = httpServer.close.bind(httpServer);

  httpServer.close = async () => {
    return await new _bluebird.default((resolve, reject) => {
      httpServer.on('close', resolve);
      close(err => {
        if (err) reject(err);
      });
    });
  };

  return await new _bluebird.default((resolve, reject) => {
    httpServer.on('error', err => {
      if (err.code === 'EADDRNOTAVAIL') {
        _logger.default.error('Could not start REST http interface listener. ' + 'Requested address is not available.');
      } else {
        _logger.default.error('Could not start REST http interface listener. The requested ' + 'port may already be in use. Please make sure there is no ' + 'other instance of this server running already.');
      }

      reject(err);
    });
    httpServer.on('connection', socket => {
      socket.setTimeout(600 * 1000);
      socket.on('error', reject);
    });
    configureServer(app, configureRoutes, allowCors);
    let serverArgs = [port];

    if (hostname) {
      serverArgs.push(hostname);
    }

    httpServer.listen(...serverArgs, err => {
      if (err) {
        reject(err);
      }

      resolve(httpServer);
    });
  });
}

function configureServer(app, configureRoutes, allowCors = true) {
  app.use(_expressLogging.endLogFormatter);
  app.use((0, _serveFavicon.default)(_path.default.resolve(_static.STATIC_DIR, 'favicon.ico')));
  app.use(_express.default.static(_static.STATIC_DIR));
  app.use('/wd/hub/produce_error', _crash.produceError);
  app.use('/wd/hub/crash', _crash.produceCrash);

  if (allowCors) {
    app.use(_middleware.allowCrossDomain);
  }

  app.use(_middleware.fixPythonContentType);
  app.use(_middleware.defaultToJSONContentType);
  app.use(_bodyParser.default.urlencoded({
    extended: true
  }));
  app.use((0, _methodOverride.default)());
  app.use(_middleware.catch4XXHandler);
  app.use(_middleware.catchAllHandler);
  app.use(_bodyParser.default.json({
    limit: '1gb'
  }));
  app.use(_expressLogging.startLogFormatter);
  configureRoutes(app);
  app.all('/welcome', _static.welcome);
  app.all('/test/guinea-pig', _static.guineaPig);
  app.all('/test/guinea-pig-scrollable', _static.guineaPigScrollable);
  app.all('/test/guinea-pig-app-banner', _static.guineaPigAppBanner);
  app.use(_middleware.catch404Handler);
}require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9leHByZXNzL3NlcnZlci5qcyJdLCJuYW1lcyI6WyJzZXJ2ZXIiLCJjb25maWd1cmVSb3V0ZXMiLCJwb3J0IiwiaG9zdG5hbWUiLCJhbGxvd0NvcnMiLCJhcHAiLCJodHRwU2VydmVyIiwiaHR0cCIsImNyZWF0ZVNlcnZlciIsImFkZFdlYlNvY2tldEhhbmRsZXIiLCJyZW1vdmVXZWJTb2NrZXRIYW5kbGVyIiwicmVtb3ZlQWxsV2ViU29ja2V0SGFuZGxlcnMiLCJnZXRXZWJTb2NrZXRIYW5kbGVycyIsImNsb3NlIiwiYmluZCIsIkIiLCJyZXNvbHZlIiwicmVqZWN0Iiwib24iLCJlcnIiLCJjb2RlIiwibG9nIiwiZXJyb3IiLCJzb2NrZXQiLCJzZXRUaW1lb3V0IiwiY29uZmlndXJlU2VydmVyIiwic2VydmVyQXJncyIsInB1c2giLCJsaXN0ZW4iLCJ1c2UiLCJlbmRMb2dGb3JtYXR0ZXIiLCJwYXRoIiwiU1RBVElDX0RJUiIsImV4cHJlc3MiLCJzdGF0aWMiLCJwcm9kdWNlRXJyb3IiLCJwcm9kdWNlQ3Jhc2giLCJhbGxvd0Nyb3NzRG9tYWluIiwiZml4UHl0aG9uQ29udGVudFR5cGUiLCJkZWZhdWx0VG9KU09OQ29udGVudFR5cGUiLCJib2R5UGFyc2VyIiwidXJsZW5jb2RlZCIsImV4dGVuZGVkIiwiY2F0Y2g0WFhIYW5kbGVyIiwiY2F0Y2hBbGxIYW5kbGVyIiwianNvbiIsImxpbWl0Iiwic3RhcnRMb2dGb3JtYXR0ZXIiLCJhbGwiLCJ3ZWxjb21lIiwiZ3VpbmVhUGlnIiwiZ3VpbmVhUGlnU2Nyb2xsYWJsZSIsImd1aW5lYVBpZ0FwcEJhbm5lciIsImNhdGNoNDA0SGFuZGxlciJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBRUE7O0FBQ0E7O0FBQ0E7O0FBRUE7O0FBR0EsZUFBZUEsTUFBZixDQUF1QkMsZUFBdkIsRUFBd0NDLElBQXhDLEVBQThDQyxRQUFRLEdBQUcsSUFBekQsRUFBK0RDLFNBQVMsR0FBRyxJQUEzRSxFQUFpRjtBQUUvRSxNQUFJQyxHQUFHLEdBQUcsdUJBQVY7O0FBQ0EsTUFBSUMsVUFBVSxHQUFHQyxjQUFLQyxZQUFMLENBQWtCSCxHQUFsQixDQUFqQjs7QUFDQUMsRUFBQUEsVUFBVSxDQUFDRyxtQkFBWCxHQUFpQ0EsOEJBQWpDO0FBQ0FILEVBQUFBLFVBQVUsQ0FBQ0ksc0JBQVgsR0FBb0NBLGlDQUFwQztBQUNBSixFQUFBQSxVQUFVLENBQUNLLDBCQUFYLEdBQXdDQSxxQ0FBeEM7QUFDQUwsRUFBQUEsVUFBVSxDQUFDTSxvQkFBWCxHQUFrQ0EsK0JBQWxDO0FBSUEsTUFBSUMsS0FBSyxHQUFHUCxVQUFVLENBQUNPLEtBQVgsQ0FBaUJDLElBQWpCLENBQXNCUixVQUF0QixDQUFaOztBQUNBQSxFQUFBQSxVQUFVLENBQUNPLEtBQVgsR0FBbUIsWUFBWTtBQUM3QixXQUFPLE1BQU0sSUFBSUUsaUJBQUosQ0FBTSxDQUFDQyxPQUFELEVBQVVDLE1BQVYsS0FBcUI7QUFDdENYLE1BQUFBLFVBQVUsQ0FBQ1ksRUFBWCxDQUFjLE9BQWQsRUFBdUJGLE9BQXZCO0FBQ0FILE1BQUFBLEtBQUssQ0FBRU0sR0FBRCxJQUFTO0FBQ2IsWUFBSUEsR0FBSixFQUFTRixNQUFNLENBQUNFLEdBQUQsQ0FBTjtBQUNWLE9BRkksQ0FBTDtBQUdELEtBTFksQ0FBYjtBQU1ELEdBUEQ7O0FBU0EsU0FBTyxNQUFNLElBQUlKLGlCQUFKLENBQU0sQ0FBQ0MsT0FBRCxFQUFVQyxNQUFWLEtBQXFCO0FBQ3RDWCxJQUFBQSxVQUFVLENBQUNZLEVBQVgsQ0FBYyxPQUFkLEVBQXdCQyxHQUFELElBQVM7QUFDOUIsVUFBSUEsR0FBRyxDQUFDQyxJQUFKLEtBQWEsZUFBakIsRUFBa0M7QUFDaENDLHdCQUFJQyxLQUFKLENBQVUsbURBQ0EscUNBRFY7QUFFRCxPQUhELE1BR087QUFDTEQsd0JBQUlDLEtBQUosQ0FBVSxpRUFDQSwyREFEQSxHQUVBLGdEQUZWO0FBR0Q7O0FBQ0RMLE1BQUFBLE1BQU0sQ0FBQ0UsR0FBRCxDQUFOO0FBQ0QsS0FWRDtBQVdBYixJQUFBQSxVQUFVLENBQUNZLEVBQVgsQ0FBYyxZQUFkLEVBQTZCSyxNQUFELElBQVk7QUFDdENBLE1BQUFBLE1BQU0sQ0FBQ0MsVUFBUCxDQUFrQixNQUFNLElBQXhCO0FBQ0FELE1BQUFBLE1BQU0sQ0FBQ0wsRUFBUCxDQUFVLE9BQVYsRUFBbUJELE1BQW5CO0FBQ0QsS0FIRDtBQUlBUSxJQUFBQSxlQUFlLENBQUNwQixHQUFELEVBQU1KLGVBQU4sRUFBdUJHLFNBQXZCLENBQWY7QUFFQSxRQUFJc0IsVUFBVSxHQUFHLENBQUN4QixJQUFELENBQWpCOztBQUNBLFFBQUlDLFFBQUosRUFBYztBQUdadUIsTUFBQUEsVUFBVSxDQUFDQyxJQUFYLENBQWdCeEIsUUFBaEI7QUFDRDs7QUFDREcsSUFBQUEsVUFBVSxDQUFDc0IsTUFBWCxDQUFrQixHQUFHRixVQUFyQixFQUFrQ1AsR0FBRCxJQUFTO0FBQ3hDLFVBQUlBLEdBQUosRUFBUztBQUNQRixRQUFBQSxNQUFNLENBQUNFLEdBQUQsQ0FBTjtBQUNEOztBQUNESCxNQUFBQSxPQUFPLENBQUNWLFVBQUQsQ0FBUDtBQUNELEtBTEQ7QUFNRCxHQTlCWSxDQUFiO0FBK0JEOztBQUVELFNBQVNtQixlQUFULENBQTBCcEIsR0FBMUIsRUFBK0JKLGVBQS9CLEVBQWdERyxTQUFTLEdBQUcsSUFBNUQsRUFBa0U7QUFDaEVDLEVBQUFBLEdBQUcsQ0FBQ3dCLEdBQUosQ0FBUUMsK0JBQVI7QUFHQXpCLEVBQUFBLEdBQUcsQ0FBQ3dCLEdBQUosQ0FBUSwyQkFBUUUsY0FBS2YsT0FBTCxDQUFhZ0Isa0JBQWIsRUFBeUIsYUFBekIsQ0FBUixDQUFSO0FBQ0EzQixFQUFBQSxHQUFHLENBQUN3QixHQUFKLENBQVFJLGlCQUFRQyxNQUFSLENBQWVGLGtCQUFmLENBQVI7QUFHQTNCLEVBQUFBLEdBQUcsQ0FBQ3dCLEdBQUosQ0FBUSx1QkFBUixFQUFpQ00sbUJBQWpDO0FBQ0E5QixFQUFBQSxHQUFHLENBQUN3QixHQUFKLENBQVEsZUFBUixFQUF5Qk8sbUJBQXpCOztBQUdBLE1BQUloQyxTQUFKLEVBQWU7QUFDYkMsSUFBQUEsR0FBRyxDQUFDd0IsR0FBSixDQUFRUSw0QkFBUjtBQUNEOztBQUNEaEMsRUFBQUEsR0FBRyxDQUFDd0IsR0FBSixDQUFRUyxnQ0FBUjtBQUNBakMsRUFBQUEsR0FBRyxDQUFDd0IsR0FBSixDQUFRVSxvQ0FBUjtBQUNBbEMsRUFBQUEsR0FBRyxDQUFDd0IsR0FBSixDQUFRVyxvQkFBV0MsVUFBWCxDQUFzQjtBQUFDQyxJQUFBQSxRQUFRLEVBQUU7QUFBWCxHQUF0QixDQUFSO0FBQ0FyQyxFQUFBQSxHQUFHLENBQUN3QixHQUFKLENBQVEsOEJBQVI7QUFDQXhCLEVBQUFBLEdBQUcsQ0FBQ3dCLEdBQUosQ0FBUWMsMkJBQVI7QUFDQXRDLEVBQUFBLEdBQUcsQ0FBQ3dCLEdBQUosQ0FBUWUsMkJBQVI7QUFHQXZDLEVBQUFBLEdBQUcsQ0FBQ3dCLEdBQUosQ0FBUVcsb0JBQVdLLElBQVgsQ0FBZ0I7QUFBQ0MsSUFBQUEsS0FBSyxFQUFFO0FBQVIsR0FBaEIsQ0FBUjtBQUdBekMsRUFBQUEsR0FBRyxDQUFDd0IsR0FBSixDQUFRa0IsaUNBQVI7QUFFQTlDLEVBQUFBLGVBQWUsQ0FBQ0ksR0FBRCxDQUFmO0FBR0FBLEVBQUFBLEdBQUcsQ0FBQzJDLEdBQUosQ0FBUSxVQUFSLEVBQW9CQyxlQUFwQjtBQUNBNUMsRUFBQUEsR0FBRyxDQUFDMkMsR0FBSixDQUFRLGtCQUFSLEVBQTRCRSxpQkFBNUI7QUFDQTdDLEVBQUFBLEdBQUcsQ0FBQzJDLEdBQUosQ0FBUSw2QkFBUixFQUF1Q0csMkJBQXZDO0FBQ0E5QyxFQUFBQSxHQUFHLENBQUMyQyxHQUFKLENBQVEsNkJBQVIsRUFBdUNJLDBCQUF2QztBQUdBL0MsRUFBQUEsR0FBRyxDQUFDd0IsR0FBSixDQUFRd0IsMkJBQVI7QUFDRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IGV4cHJlc3MgZnJvbSAnZXhwcmVzcyc7XG5pbXBvcnQgaHR0cCBmcm9tICdodHRwJztcbmltcG9ydCBmYXZpY29uIGZyb20gJ3NlcnZlLWZhdmljb24nO1xuaW1wb3J0IGJvZHlQYXJzZXIgZnJvbSAnYm9keS1wYXJzZXInO1xuaW1wb3J0IG1ldGhvZE92ZXJyaWRlIGZyb20gJ21ldGhvZC1vdmVycmlkZSc7XG5pbXBvcnQgbG9nIGZyb20gJy4vbG9nZ2VyJztcbmltcG9ydCB7IHN0YXJ0TG9nRm9ybWF0dGVyLCBlbmRMb2dGb3JtYXR0ZXIgfSBmcm9tICcuL2V4cHJlc3MtbG9nZ2luZyc7XG5pbXBvcnQgeyBhbGxvd0Nyb3NzRG9tYWluLCBmaXhQeXRob25Db250ZW50VHlwZSwgZGVmYXVsdFRvSlNPTkNvbnRlbnRUeXBlLFxuICAgICAgICAgY2F0Y2hBbGxIYW5kbGVyLCBjYXRjaDQwNEhhbmRsZXIsIGNhdGNoNFhYSGFuZGxlciB9IGZyb20gJy4vbWlkZGxld2FyZSc7XG5pbXBvcnQgeyBndWluZWFQaWcsIGd1aW5lYVBpZ1Njcm9sbGFibGUsIGd1aW5lYVBpZ0FwcEJhbm5lciwgd2VsY29tZSwgU1RBVElDX0RJUiB9IGZyb20gJy4vc3RhdGljJztcbmltcG9ydCB7IHByb2R1Y2VFcnJvciwgcHJvZHVjZUNyYXNoIH0gZnJvbSAnLi9jcmFzaCc7XG5pbXBvcnQgeyBhZGRXZWJTb2NrZXRIYW5kbGVyLCByZW1vdmVXZWJTb2NrZXRIYW5kbGVyLCByZW1vdmVBbGxXZWJTb2NrZXRIYW5kbGVycyxcbiAgICAgICAgIGdldFdlYlNvY2tldEhhbmRsZXJzIH0gZnJvbSAnLi93ZWJzb2NrZXQnO1xuaW1wb3J0IEIgZnJvbSAnYmx1ZWJpcmQnO1xuXG5cbmFzeW5jIGZ1bmN0aW9uIHNlcnZlciAoY29uZmlndXJlUm91dGVzLCBwb3J0LCBob3N0bmFtZSA9IG51bGwsIGFsbG93Q29ycyA9IHRydWUpIHtcbiAgLy8gY3JlYXRlIHRoZSBhY3R1YWwgaHR0cCBzZXJ2ZXJcbiAgbGV0IGFwcCA9IGV4cHJlc3MoKTtcbiAgbGV0IGh0dHBTZXJ2ZXIgPSBodHRwLmNyZWF0ZVNlcnZlcihhcHApO1xuICBodHRwU2VydmVyLmFkZFdlYlNvY2tldEhhbmRsZXIgPSBhZGRXZWJTb2NrZXRIYW5kbGVyO1xuICBodHRwU2VydmVyLnJlbW92ZVdlYlNvY2tldEhhbmRsZXIgPSByZW1vdmVXZWJTb2NrZXRIYW5kbGVyO1xuICBodHRwU2VydmVyLnJlbW92ZUFsbFdlYlNvY2tldEhhbmRsZXJzID0gcmVtb3ZlQWxsV2ViU29ja2V0SGFuZGxlcnM7XG4gIGh0dHBTZXJ2ZXIuZ2V0V2ViU29ja2V0SGFuZGxlcnMgPSBnZXRXZWJTb2NrZXRIYW5kbGVycztcblxuICAvLyBodHRwLlNlcnZlci5jbG9zZSgpIG9ubHkgc3RvcHMgbmV3IGNvbm5lY3Rpb25zLCBidXQgd2UgbmVlZCB0byB3YWl0IHVudGlsXG4gIC8vIGFsbCBjb25uZWN0aW9ucyBhcmUgY2xvc2VkIGFuZCB0aGUgYGNsb3NlYCBldmVudCBpcyBlbWl0dGVkXG4gIGxldCBjbG9zZSA9IGh0dHBTZXJ2ZXIuY2xvc2UuYmluZChodHRwU2VydmVyKTtcbiAgaHR0cFNlcnZlci5jbG9zZSA9IGFzeW5jICgpID0+IHtcbiAgICByZXR1cm4gYXdhaXQgbmV3IEIoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgaHR0cFNlcnZlci5vbignY2xvc2UnLCByZXNvbHZlKTtcbiAgICAgIGNsb3NlKChlcnIpID0+IHtcbiAgICAgICAgaWYgKGVycikgcmVqZWN0KGVycik7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgY3VybHlcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9O1xuXG4gIHJldHVybiBhd2FpdCBuZXcgQigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgaHR0cFNlcnZlci5vbignZXJyb3InLCAoZXJyKSA9PiB7XG4gICAgICBpZiAoZXJyLmNvZGUgPT09ICdFQUREUk5PVEFWQUlMJykge1xuICAgICAgICBsb2cuZXJyb3IoJ0NvdWxkIG5vdCBzdGFydCBSRVNUIGh0dHAgaW50ZXJmYWNlIGxpc3RlbmVyLiAnICtcbiAgICAgICAgICAgICAgICAgICdSZXF1ZXN0ZWQgYWRkcmVzcyBpcyBub3QgYXZhaWxhYmxlLicpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbG9nLmVycm9yKCdDb3VsZCBub3Qgc3RhcnQgUkVTVCBodHRwIGludGVyZmFjZSBsaXN0ZW5lci4gVGhlIHJlcXVlc3RlZCAnICtcbiAgICAgICAgICAgICAgICAgICdwb3J0IG1heSBhbHJlYWR5IGJlIGluIHVzZS4gUGxlYXNlIG1ha2Ugc3VyZSB0aGVyZSBpcyBubyAnICtcbiAgICAgICAgICAgICAgICAgICdvdGhlciBpbnN0YW5jZSBvZiB0aGlzIHNlcnZlciBydW5uaW5nIGFscmVhZHkuJyk7XG4gICAgICB9XG4gICAgICByZWplY3QoZXJyKTtcbiAgICB9KTtcbiAgICBodHRwU2VydmVyLm9uKCdjb25uZWN0aW9uJywgKHNvY2tldCkgPT4ge1xuICAgICAgc29ja2V0LnNldFRpbWVvdXQoNjAwICogMTAwMCk7IC8vIDEwIG1pbnV0ZSB0aW1lb3V0XG4gICAgICBzb2NrZXQub24oJ2Vycm9yJywgcmVqZWN0KTtcbiAgICB9KTtcbiAgICBjb25maWd1cmVTZXJ2ZXIoYXBwLCBjb25maWd1cmVSb3V0ZXMsIGFsbG93Q29ycyk7XG5cbiAgICBsZXQgc2VydmVyQXJncyA9IFtwb3J0XTtcbiAgICBpZiAoaG9zdG5hbWUpIHtcbiAgICAgIC8vIElmIHRoZSBob3N0bmFtZSBpcyBvbWl0dGVkLCB0aGUgc2VydmVyIHdpbGwgYWNjZXB0XG4gICAgICAvLyBjb25uZWN0aW9ucyBvbiBhbnkgSVAgYWRkcmVzc1xuICAgICAgc2VydmVyQXJncy5wdXNoKGhvc3RuYW1lKTtcbiAgICB9XG4gICAgaHR0cFNlcnZlci5saXN0ZW4oLi4uc2VydmVyQXJncywgKGVycikgPT4ge1xuICAgICAgaWYgKGVycikge1xuICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgIH1cbiAgICAgIHJlc29sdmUoaHR0cFNlcnZlcik7XG4gICAgfSk7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBjb25maWd1cmVTZXJ2ZXIgKGFwcCwgY29uZmlndXJlUm91dGVzLCBhbGxvd0NvcnMgPSB0cnVlKSB7XG4gIGFwcC51c2UoZW5kTG9nRm9ybWF0dGVyKTtcblxuICAvLyBzZXQgdXAgc3RhdGljIGFzc2V0c1xuICBhcHAudXNlKGZhdmljb24ocGF0aC5yZXNvbHZlKFNUQVRJQ19ESVIsICdmYXZpY29uLmljbycpKSk7XG4gIGFwcC51c2UoZXhwcmVzcy5zdGF0aWMoU1RBVElDX0RJUikpO1xuXG4gIC8vIGNyYXNoIHJvdXRlcywgZm9yIHRlc3RpbmdcbiAgYXBwLnVzZSgnL3dkL2h1Yi9wcm9kdWNlX2Vycm9yJywgcHJvZHVjZUVycm9yKTtcbiAgYXBwLnVzZSgnL3dkL2h1Yi9jcmFzaCcsIHByb2R1Y2VDcmFzaCk7XG5cbiAgLy8gYWRkIG1pZGRsZXdhcmVzXG4gIGlmIChhbGxvd0NvcnMpIHtcbiAgICBhcHAudXNlKGFsbG93Q3Jvc3NEb21haW4pO1xuICB9XG4gIGFwcC51c2UoZml4UHl0aG9uQ29udGVudFR5cGUpO1xuICBhcHAudXNlKGRlZmF1bHRUb0pTT05Db250ZW50VHlwZSk7XG4gIGFwcC51c2UoYm9keVBhcnNlci51cmxlbmNvZGVkKHtleHRlbmRlZDogdHJ1ZX0pKTtcbiAgYXBwLnVzZShtZXRob2RPdmVycmlkZSgpKTtcbiAgYXBwLnVzZShjYXRjaDRYWEhhbmRsZXIpO1xuICBhcHAudXNlKGNhdGNoQWxsSGFuZGxlcik7XG5cbiAgLy8gbWFrZSBzdXJlIGFwcGl1bSBuZXZlciBmYWlscyBiZWNhdXNlIG9mIGEgZmlsZSBzaXplIHVwbG9hZCBsaW1pdFxuICBhcHAudXNlKGJvZHlQYXJzZXIuanNvbih7bGltaXQ6ICcxZ2InfSkpO1xuXG4gIC8vIHNldCB1cCBzdGFydCBsb2dnaW5nICh3aGljaCBkZXBlbmRzIG9uIGJvZHlQYXJzZXIgZG9pbmcgaXRzIHRoaW5nKVxuICBhcHAudXNlKHN0YXJ0TG9nRm9ybWF0dGVyKTtcblxuICBjb25maWd1cmVSb3V0ZXMoYXBwKTtcblxuICAvLyBkeW5hbWljIHJvdXRlcyBmb3IgdGVzdGluZywgZXRjLlxuICBhcHAuYWxsKCcvd2VsY29tZScsIHdlbGNvbWUpO1xuICBhcHAuYWxsKCcvdGVzdC9ndWluZWEtcGlnJywgZ3VpbmVhUGlnKTtcbiAgYXBwLmFsbCgnL3Rlc3QvZ3VpbmVhLXBpZy1zY3JvbGxhYmxlJywgZ3VpbmVhUGlnU2Nyb2xsYWJsZSk7XG4gIGFwcC5hbGwoJy90ZXN0L2d1aW5lYS1waWctYXBwLWJhbm5lcicsIGd1aW5lYVBpZ0FwcEJhbm5lcik7XG5cbiAgLy8gY2F0Y2ggdGhpcyBsYXN0LCBzbyBhbnl0aGluZyB0aGF0IGZhbGxzIHRocm91Z2ggaXMgNDA0ZWRcbiAgYXBwLnVzZShjYXRjaDQwNEhhbmRsZXIpO1xufVxuXG5leHBvcnQgeyBzZXJ2ZXIsIGNvbmZpZ3VyZVNlcnZlciB9O1xuIl0sImZpbGUiOiJsaWIvZXhwcmVzcy9zZXJ2ZXIuanMiLCJzb3VyY2VSb290IjoiLi4vLi4vLi4ifQ==
