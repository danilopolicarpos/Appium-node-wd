"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

require("source-map-support/register");

var _lodash = _interopRequireDefault(require("lodash"));

var _chai = _interopRequireDefault(require("chai"));

var _chaiAsPromised = _interopRequireDefault(require("chai-as-promised"));

var _2 = _interopRequireWildcard(require("../.."));

var _imageElement = require("../../lib/basedriver/image-element");

var _protocol = require("../../lib/protocol/protocol");

var _sinon = _interopRequireDefault(require("sinon"));

_chai.default.should();

_chai.default.use(_chaiAsPromised.default);

const defRect = {
  x: 100,
  y: 110,
  width: 50,
  height: 25
};
const defTemplate = 'iVBORasdf';
describe('ImageElement', function () {
  const driver = new _2.default();
  describe('.size', function () {
    it('should return the width and height of the image el', function () {
      const el = new _2.ImageElement(defTemplate, defRect);
      el.size.should.eql({
        width: defRect.width,
        height: defRect.height
      });
    });
  });
  describe('.location', function () {
    it('should return the location of the image el', function () {
      const el = new _2.ImageElement(defTemplate, defRect);
      el.location.should.eql({
        x: defRect.x,
        y: defRect.y
      });
    });
  });
  describe('.center', function () {
    it('should return the center location of the image el', function () {
      const el = new _2.ImageElement(defTemplate, defRect);
      el.center.should.eql({
        x: defRect.x + defRect.width / 2,
        y: defRect.y + defRect.height / 2
      });
    });
  });
  describe('.asElement', function () {
    it('should get the webdriver object representation of the element', function () {
      const el = new _2.ImageElement(defTemplate, defRect);
      el.asElement('ELEMENT').ELEMENT.should.match(/^appium-image-el/);
    });
  });
  describe('.equals', function () {
    it('should say two image elements with same rect are equal', function () {
      const el1 = new _2.ImageElement('foo', defRect);
      const el2 = new _2.ImageElement('bar', defRect);
      el1.equals(el2).should.be.true;
      el2.equals(el1).should.be.true;
    });
    it('should say two image elements with different rect are not equal', function () {
      const el1 = new _2.ImageElement(defTemplate, { ...defRect,
        x: 0
      });
      const el2 = new _2.ImageElement(defTemplate, defRect);
      el1.equals(el2).should.be.false;
      el2.equals(el1).should.be.false;
    });
  });
  describe('.click', function () {
    it('should reject an invalid tap strategy', async function () {
      const d = new _2.default();
      const el = new _2.ImageElement(defTemplate, defRect);
      await d.settings.update({
        imageElementTapStrategy: 'bad'
      });
      await el.click(d).should.eventually.be.rejectedWith(/Incorrect imageElementTapStrategy/);
    });
    it('should try to check for image element staleness, and throw if stale', async function () {
      const d = new _2.default();

      _sinon.default.stub(d, 'findByImage').throws();

      const el = new _2.ImageElement(defTemplate, defRect);
      await d.settings.update({
        checkForImageElementStaleness: true,
        autoUpdateImageElementPosition: false
      });
      await el.click(d).should.eventually.be.rejectedWith(/no longer attached/);
      await d.settings.update({
        checkForImageElementStaleness: false,
        autoUpdateImageElementPosition: true
      });
      await el.click(d).should.eventually.be.rejectedWith(/no longer attached/);
    });
    it('should auto-update element position if requested', async function () {
      const d = new _2.default();
      d.performActions = _lodash.default.noop;

      _sinon.default.stub(d, 'performActions');

      const el = new _2.ImageElement(defTemplate, defRect);
      const newRect = { ...defRect,
        x: defRect.x + 10,
        y: defRect.y + 5
      };
      const elPos2 = new _2.ImageElement(defTemplate, newRect);

      _sinon.default.stub(d, 'findByImage').returns(elPos2);

      await d.settings.update({
        autoUpdateImageElementPosition: true
      });
      el.rect.should.not.eql(newRect);
      await el.click(d);
      el.rect.should.eql(newRect);
    });
    it('should tap the center of an element using w3c actions by default', async function () {
      const d = new _2.default();
      d.performActions = _lodash.default.noop;

      const actionStub = _sinon.default.stub(d, 'performActions');

      const el = new _2.ImageElement(defTemplate, defRect);
      await d.settings.update({
        checkForImageElementStaleness: false
      });
      await el.click(d);
      const pointerMoveAction = actionStub.args[0][0][0].actions[0];
      pointerMoveAction.x.should.equal(el.center.x);
      pointerMoveAction.y.should.equal(el.center.y);
    });
    it('should fall back to touchactions if w3c actions do not exist on driver', async function () {
      const d = new _2.default();
      d.performTouch = _lodash.default.noop;

      const actionStub = _sinon.default.stub(d, 'performTouch');

      const el = new _2.ImageElement(defTemplate, defRect);
      await d.settings.update({
        checkForImageElementStaleness: false
      });
      await el.click(d);
      const action = actionStub.args[0][0][0].options;
      action.x.should.equal(el.center.x);
      action.y.should.equal(el.center.y);
    });
    it('should use touchactions if requested', async function () {
      const d = new _2.default();
      d.performActions = _lodash.default.noop;

      const w3cStub = _sinon.default.stub(d, 'performActions');

      d.performTouch = _lodash.default.noop;

      const touchStub = _sinon.default.stub(d, 'performTouch');

      const el = new _2.ImageElement(defTemplate, defRect);
      await d.settings.update({
        checkForImageElementStaleness: false,
        imageElementTapStrategy: 'touchActions'
      });
      await el.click(d);
      const action = touchStub.args[0][0][0].options;
      action.x.should.equal(el.center.x);
      action.y.should.equal(el.center.y);
      w3cStub.callCount.should.eql(0);
    });
    it('should throw if driver does not implement any type of action', async function () {
      const d = new _2.default();
      const el = new _2.ImageElement(defTemplate, defRect);
      await d.settings.update({
        checkForImageElementStaleness: false
      });
      await el.click(d).should.eventually.be.rejectedWith(/did not implement/);
    });
  });
  describe('#execute', function () {
    const imgEl = new _2.ImageElement(defTemplate, defRect);

    const clickStub = _sinon.default.stub(imgEl, 'click');

    before(function () {
      driver._imgElCache.set(imgEl.id, imgEl);

      clickStub.returns(true);
    });
    after(function () {
      driver._imgElCache.reset();

      clickStub.restore();
    });
    it('should reject executions on elements not in the cache', async function () {
      await _2.ImageElement.execute(driver, 'click', 'appium-image-element-foo').should.eventually.be.rejectedWith(/element could not be located/);
    });
    it('should reject executions for unsupported commands', async function () {
      await _2.ImageElement.execute(driver, 'foobar', imgEl.id).should.eventually.be.rejectedWith(/not yet been implemented/);
    });
    it('should get displayed status of element', async function () {
      await _2.ImageElement.execute(driver, 'elementDisplayed', imgEl.id).should.eventually.be.true;
    });
    it('should get size of element', async function () {
      await _2.ImageElement.execute(driver, 'getSize', imgEl.id).should.eventually.eql({
        width: defRect.width,
        height: defRect.height
      });
    });
    it('should get location of element', async function () {
      await _2.ImageElement.execute(driver, 'getLocation', imgEl.id).should.eventually.eql({
        x: defRect.x,
        y: defRect.y
      });
    });
    it('should get location in view of element', async function () {
      await _2.ImageElement.execute(driver, 'getLocation', imgEl.id).should.eventually.eql({
        x: defRect.x,
        y: defRect.y
      });
    });
    it('should get rect of element', async function () {
      await _2.ImageElement.execute(driver, 'getElementRect', imgEl.id).should.eventually.eql(defRect);
    });
    it('should click element', async function () {
      await _2.ImageElement.execute(driver, 'click', imgEl.id).should.eventually.be.true;
    });
  });
});
describe('image element LRU cache', function () {
  it('should accept and cache image elements', function () {
    const el1 = new _2.ImageElement(defTemplate, defRect);
    const el2 = new _2.ImageElement(defTemplate, defRect);
    const cache = (0, _imageElement.makeImageElementCache)();
    cache.set(el1.id, el1);
    el1.equals(cache.get(el1.id)).should.be.true;
    _lodash.default.isUndefined(cache.get(el2.id)).should.be.true;
    cache.has(el1.id).should.be.true;
    cache.has(el2.id).should.be.false;
  });
  it('once cache reaches max size, should eject image elements', function () {
    const el1 = new _2.ImageElement(defTemplate, defRect);
    const el2 = new _2.ImageElement(defTemplate, defRect);
    const cache = (0, _imageElement.makeImageElementCache)(defTemplate.length + 1);
    cache.set(el1.id, el1);
    cache.has(el1.id).should.be.true;
    cache.set(el2.id, el2);
    cache.has(el2.id).should.be.true;
    cache.has(el1.id).should.be.false;
  });
});
describe('getImgElFromArgs', function () {
  it('should return the image element id from json obj in args', function () {
    const imgEl = `${_protocol.IMAGE_ELEMENT_PREFIX}foo`;
    const args = [1, 'foo', imgEl];
    (0, _imageElement.getImgElFromArgs)(args).should.eql(imgEl);
  });
  it('should not return anything if image element id not in args', function () {
    const args = [1, 'foo'];
    _lodash.default.isUndefined((0, _imageElement.getImgElFromArgs)(args)).should.be.true;
  });
  it('should not find image element id in anything but prefix', function () {
    const notImgEl = `foo${_protocol.IMAGE_ELEMENT_PREFIX}`;
    const args = [1, 'foo', notImgEl];
    _lodash.default.isUndefined((0, _imageElement.getImgElFromArgs)(args)).should.be.true;
  });
});require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvYmFzZWRyaXZlci9pbWFnZS1lbGVtZW50LXNwZWNzLmpzIl0sIm5hbWVzIjpbImNoYWkiLCJzaG91bGQiLCJ1c2UiLCJjaGFpQXNQcm9taXNlZCIsImRlZlJlY3QiLCJ4IiwieSIsIndpZHRoIiwiaGVpZ2h0IiwiZGVmVGVtcGxhdGUiLCJkZXNjcmliZSIsImRyaXZlciIsIkJhc2VEcml2ZXIiLCJpdCIsImVsIiwiSW1hZ2VFbGVtZW50Iiwic2l6ZSIsImVxbCIsImxvY2F0aW9uIiwiY2VudGVyIiwiYXNFbGVtZW50IiwiRUxFTUVOVCIsIm1hdGNoIiwiZWwxIiwiZWwyIiwiZXF1YWxzIiwiYmUiLCJ0cnVlIiwiZmFsc2UiLCJkIiwic2V0dGluZ3MiLCJ1cGRhdGUiLCJpbWFnZUVsZW1lbnRUYXBTdHJhdGVneSIsImNsaWNrIiwiZXZlbnR1YWxseSIsInJlamVjdGVkV2l0aCIsInNpbm9uIiwic3R1YiIsInRocm93cyIsImNoZWNrRm9ySW1hZ2VFbGVtZW50U3RhbGVuZXNzIiwiYXV0b1VwZGF0ZUltYWdlRWxlbWVudFBvc2l0aW9uIiwicGVyZm9ybUFjdGlvbnMiLCJfIiwibm9vcCIsIm5ld1JlY3QiLCJlbFBvczIiLCJyZXR1cm5zIiwicmVjdCIsIm5vdCIsImFjdGlvblN0dWIiLCJwb2ludGVyTW92ZUFjdGlvbiIsImFyZ3MiLCJhY3Rpb25zIiwiZXF1YWwiLCJwZXJmb3JtVG91Y2giLCJhY3Rpb24iLCJvcHRpb25zIiwidzNjU3R1YiIsInRvdWNoU3R1YiIsImNhbGxDb3VudCIsImltZ0VsIiwiY2xpY2tTdHViIiwiYmVmb3JlIiwiX2ltZ0VsQ2FjaGUiLCJzZXQiLCJpZCIsImFmdGVyIiwicmVzZXQiLCJyZXN0b3JlIiwiZXhlY3V0ZSIsImNhY2hlIiwiZ2V0IiwiaXNVbmRlZmluZWQiLCJoYXMiLCJsZW5ndGgiLCJJTUFHRV9FTEVNRU5UX1BSRUZJWCIsIm5vdEltZ0VsIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBOztBQUNBOztBQUNB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R0FBRyxDQUFDLENBQUQsRUFBSSxLQUFKLENBQWI7QUFDQVQsb0JBQUU4QixXQUFGLENBQWMsb0NBQWlCckIsSUFBakIsQ0FBZCxFQUFzQ2xELE1BQXRDLENBQTZDeUIsRUFBN0MsQ0FBZ0RDLElBQWhEO0FBQ0QsR0FIQyxDQUFGO0FBSUFkLEVBQUFBLEVBQUUsQ0FBQyx5REFBRCxFQUE0RCxZQUFZO0FBQ3hFLFVBQU0rRCxRQUFRLEdBQUksTUFBS0QsOEJBQXFCLEVBQTVDO0FBQ0EsVUFBTXhCLElBQUksR0FBRyxDQUFDLENBQUQsRUFBSSxLQUFKLEVBQVd5QixRQUFYLENBQWI7QUFDQWxDLG9CQUFFOEIsV0FBRixDQUFjLG9DQUFpQnJCLElBQWpCLENBQWQsRUFBc0NsRCxNQUF0QyxDQUE2Q3lCLEVBQTdDLENBQWdEQyxJQUFoRDtBQUNELEdBSkMsQ0FBRjtBQUtELENBZk8sQ0FBUiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgY2hhaSBmcm9tICdjaGFpJztcbmltcG9ydCBjaGFpQXNQcm9taXNlZCBmcm9tICdjaGFpLWFzLXByb21pc2VkJztcbmltcG9ydCBCYXNlRHJpdmVyLCB7IEltYWdlRWxlbWVudCB9IGZyb20gJy4uLy4uJztcbmltcG9ydCB7IG1ha2VJbWFnZUVsZW1lbnRDYWNoZSwgZ2V0SW1nRWxGcm9tQXJncyB9IGZyb20gJy4uLy4uL2xpYi9iYXNlZHJpdmVyL2ltYWdlLWVsZW1lbnQnO1xuaW1wb3J0IHsgSU1BR0VfRUxFTUVOVF9QUkVGSVggfSBmcm9tICcuLi8uLi9saWIvcHJvdG9jb2wvcHJvdG9jb2wnO1xuaW1wb3J0IHNpbm9uIGZyb20gJ3Npbm9uJztcblxuXG5jaGFpLnNob3VsZCgpO1xuY2hhaS51c2UoY2hhaUFzUHJvbWlzZWQpO1xuXG5cbmNvbnN0IGRlZlJlY3QgPSB7eDogMTAwLCB5OiAxMTAsIHdpZHRoOiA1MCwgaGVpZ2h0OiAyNX07XG5jb25zdCBkZWZUZW1wbGF0ZSA9ICdpVkJPUmFzZGYnO1xuXG5kZXNjcmliZSgnSW1hZ2VFbGVtZW50JywgZnVuY3Rpb24gKCkge1xuICBjb25zdCBkcml2ZXIgPSBuZXcgQmFzZURyaXZlcigpO1xuXG4gIGRlc2NyaWJlKCcuc2l6ZScsIGZ1bmN0aW9uICgpIHtcbiAgICBpdCgnc2hvdWxkIHJldHVybiB0aGUgd2lkdGggYW5kIGhlaWdodCBvZiB0aGUgaW1hZ2UgZWwnLCBmdW5jdGlvbiAoKSB7XG4gICAgICBjb25zdCBlbCA9IG5ldyBJbWFnZUVsZW1lbnQoZGVmVGVtcGxhdGUsIGRlZlJlY3QpO1xuICAgICAgZWwuc2l6ZS5zaG91bGQuZXFsKHt3aWR0aDogZGVmUmVjdC53aWR0aCwgaGVpZ2h0OiBkZWZSZWN0LmhlaWdodH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnLmxvY2F0aW9uJywgZnVuY3Rpb24gKCkge1xuICAgIGl0KCdzaG91bGQgcmV0dXJuIHRoZSBsb2NhdGlvbiBvZiB0aGUgaW1hZ2UgZWwnLCBmdW5jdGlvbiAoKSB7XG4gICAgICBjb25zdCBlbCA9IG5ldyBJbWFnZUVsZW1lbnQoZGVmVGVtcGxhdGUsIGRlZlJlY3QpO1xuICAgICAgZWwubG9jYXRpb24uc2hvdWxkLmVxbCh7eDogZGVmUmVjdC54LCB5OiBkZWZSZWN0Lnl9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJy5jZW50ZXInLCBmdW5jdGlvbiAoKSB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gdGhlIGNlbnRlciBsb2NhdGlvbiBvZiB0aGUgaW1hZ2UgZWwnLCBmdW5jdGlvbiAoKSB7XG4gICAgICBjb25zdCBlbCA9IG5ldyBJbWFnZUVsZW1lbnQoZGVmVGVtcGxhdGUsIGRlZlJlY3QpO1xuICAgICAgZWwuY2VudGVyLnNob3VsZC5lcWwoe1xuICAgICAgICB4OiBkZWZSZWN0LnggKyBkZWZSZWN0LndpZHRoIC8gMixcbiAgICAgICAgeTogZGVmUmVjdC55ICsgZGVmUmVjdC5oZWlnaHQgLyAyXG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJy5hc0VsZW1lbnQnLCBmdW5jdGlvbiAoKSB7XG4gICAgaXQoJ3Nob3VsZCBnZXQgdGhlIHdlYmRyaXZlciBvYmplY3QgcmVwcmVzZW50YXRpb24gb2YgdGhlIGVsZW1lbnQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICBjb25zdCBlbCA9IG5ldyBJbWFnZUVsZW1lbnQoZGVmVGVtcGxhdGUsIGRlZlJlY3QpO1xuICAgICAgZWwuYXNFbGVtZW50KCdFTEVNRU5UJykuRUxFTUVOVC5zaG91bGQubWF0Y2goL15hcHBpdW0taW1hZ2UtZWwvKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJy5lcXVhbHMnLCBmdW5jdGlvbiAoKSB7XG4gICAgaXQoJ3Nob3VsZCBzYXkgdHdvIGltYWdlIGVsZW1lbnRzIHdpdGggc2FtZSByZWN0IGFyZSBlcXVhbCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbnN0IGVsMSA9IG5ldyBJbWFnZUVsZW1lbnQoJ2ZvbycsIGRlZlJlY3QpO1xuICAgICAgY29uc3QgZWwyID0gbmV3IEltYWdlRWxlbWVudCgnYmFyJywgZGVmUmVjdCk7XG4gICAgICBlbDEuZXF1YWxzKGVsMikuc2hvdWxkLmJlLnRydWU7XG4gICAgICBlbDIuZXF1YWxzKGVsMSkuc2hvdWxkLmJlLnRydWU7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCBzYXkgdHdvIGltYWdlIGVsZW1lbnRzIHdpdGggZGlmZmVyZW50IHJlY3QgYXJlIG5vdCBlcXVhbCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbnN0IGVsMSA9IG5ldyBJbWFnZUVsZW1lbnQoZGVmVGVtcGxhdGUsIHsuLi5kZWZSZWN0LCB4OiAwfSk7XG4gICAgICBjb25zdCBlbDIgPSBuZXcgSW1hZ2VFbGVtZW50KGRlZlRlbXBsYXRlLCBkZWZSZWN0KTtcbiAgICAgIGVsMS5lcXVhbHMoZWwyKS5zaG91bGQuYmUuZmFsc2U7XG4gICAgICBlbDIuZXF1YWxzKGVsMSkuc2hvdWxkLmJlLmZhbHNlO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnLmNsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgIGl0KCdzaG91bGQgcmVqZWN0IGFuIGludmFsaWQgdGFwIHN0cmF0ZWd5JywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgY29uc3QgZCA9IG5ldyBCYXNlRHJpdmVyKCk7XG4gICAgICBjb25zdCBlbCA9IG5ldyBJbWFnZUVsZW1lbnQoZGVmVGVtcGxhdGUsIGRlZlJlY3QpO1xuICAgICAgYXdhaXQgZC5zZXR0aW5ncy51cGRhdGUoe2ltYWdlRWxlbWVudFRhcFN0cmF0ZWd5OiAnYmFkJ30pO1xuICAgICAgYXdhaXQgZWwuY2xpY2soZCkuc2hvdWxkLmV2ZW50dWFsbHkuYmUucmVqZWN0ZWRXaXRoKC9JbmNvcnJlY3QgaW1hZ2VFbGVtZW50VGFwU3RyYXRlZ3kvKTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIHRyeSB0byBjaGVjayBmb3IgaW1hZ2UgZWxlbWVudCBzdGFsZW5lc3MsIGFuZCB0aHJvdyBpZiBzdGFsZScsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbnN0IGQgPSBuZXcgQmFzZURyaXZlcigpO1xuICAgICAgc2lub24uc3R1YihkLCAnZmluZEJ5SW1hZ2UnKS50aHJvd3MoKTtcbiAgICAgIGNvbnN0IGVsID0gbmV3IEltYWdlRWxlbWVudChkZWZUZW1wbGF0ZSwgZGVmUmVjdCk7XG4gICAgICAvLyB3ZSBuZWVkIHRvIGNoZWNrIGZvciBzdGFsZW5lc3MgaWYgZXhwbGljaXRseSByZXF1ZXN0ZWQgdG8gZG8gc29cbiAgICAgIGF3YWl0IGQuc2V0dGluZ3MudXBkYXRlKHtcbiAgICAgICAgY2hlY2tGb3JJbWFnZUVsZW1lbnRTdGFsZW5lc3M6IHRydWUsXG4gICAgICAgIGF1dG9VcGRhdGVJbWFnZUVsZW1lbnRQb3NpdGlvbjogZmFsc2VcbiAgICAgIH0pO1xuICAgICAgYXdhaXQgZWwuY2xpY2soZCkuc2hvdWxkLmV2ZW50dWFsbHkuYmUucmVqZWN0ZWRXaXRoKC9ubyBsb25nZXIgYXR0YWNoZWQvKTtcblxuICAgICAgLy8gYW5kIGFsc28gaWYgd2UgYXJlIHVwZGF0aW5nIHRoZSBlbGVtZW50IHBvc2l0aW9uXG4gICAgICBhd2FpdCBkLnNldHRpbmdzLnVwZGF0ZSh7XG4gICAgICAgIGNoZWNrRm9ySW1hZ2VFbGVtZW50U3RhbGVuZXNzOiBmYWxzZSxcbiAgICAgICAgYXV0b1VwZGF0ZUltYWdlRWxlbWVudFBvc2l0aW9uOiB0cnVlXG4gICAgICB9KTtcbiAgICAgIGF3YWl0IGVsLmNsaWNrKGQpLnNob3VsZC5ldmVudHVhbGx5LmJlLnJlamVjdGVkV2l0aCgvbm8gbG9uZ2VyIGF0dGFjaGVkLyk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCBhdXRvLXVwZGF0ZSBlbGVtZW50IHBvc2l0aW9uIGlmIHJlcXVlc3RlZCcsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbnN0IGQgPSBuZXcgQmFzZURyaXZlcigpO1xuICAgICAgZC5wZXJmb3JtQWN0aW9ucyA9IF8ubm9vcDtcbiAgICAgIHNpbm9uLnN0dWIoZCwgJ3BlcmZvcm1BY3Rpb25zJyk7XG4gICAgICBjb25zdCBlbCA9IG5ldyBJbWFnZUVsZW1lbnQoZGVmVGVtcGxhdGUsIGRlZlJlY3QpO1xuICAgICAgY29uc3QgbmV3UmVjdCA9IHsuLi5kZWZSZWN0LCB4OiBkZWZSZWN0LnggKyAxMCwgeTogZGVmUmVjdC55ICsgNX07XG4gICAgICBjb25zdCBlbFBvczIgPSBuZXcgSW1hZ2VFbGVtZW50KGRlZlRlbXBsYXRlLCBuZXdSZWN0KTtcbiAgICAgIHNpbm9uLnN0dWIoZCwgJ2ZpbmRCeUltYWdlJykucmV0dXJucyhlbFBvczIpO1xuICAgICAgYXdhaXQgZC5zZXR0aW5ncy51cGRhdGUoe1xuICAgICAgICBhdXRvVXBkYXRlSW1hZ2VFbGVtZW50UG9zaXRpb246IHRydWUsXG4gICAgICB9KTtcbiAgICAgIGVsLnJlY3Quc2hvdWxkLm5vdC5lcWwobmV3UmVjdCk7XG4gICAgICBhd2FpdCBlbC5jbGljayhkKTtcbiAgICAgIGVsLnJlY3Quc2hvdWxkLmVxbChuZXdSZWN0KTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIHRhcCB0aGUgY2VudGVyIG9mIGFuIGVsZW1lbnQgdXNpbmcgdzNjIGFjdGlvbnMgYnkgZGVmYXVsdCcsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbnN0IGQgPSBuZXcgQmFzZURyaXZlcigpO1xuICAgICAgZC5wZXJmb3JtQWN0aW9ucyA9IF8ubm9vcDtcbiAgICAgIGNvbnN0IGFjdGlvblN0dWIgPSBzaW5vbi5zdHViKGQsICdwZXJmb3JtQWN0aW9ucycpO1xuICAgICAgY29uc3QgZWwgPSBuZXcgSW1hZ2VFbGVtZW50KGRlZlRlbXBsYXRlLCBkZWZSZWN0KTtcbiAgICAgIC8vIHNraXAgdGhlIHN0YWxlbmVzcyBjaGVjayBmb3IgdGhpcyB0ZXN0XG4gICAgICBhd2FpdCBkLnNldHRpbmdzLnVwZGF0ZSh7XG4gICAgICAgIGNoZWNrRm9ySW1hZ2VFbGVtZW50U3RhbGVuZXNzOiBmYWxzZSxcbiAgICAgIH0pO1xuICAgICAgYXdhaXQgZWwuY2xpY2soZCk7XG4gICAgICBjb25zdCBwb2ludGVyTW92ZUFjdGlvbiA9IGFjdGlvblN0dWIuYXJnc1swXVswXVswXS5hY3Rpb25zWzBdO1xuICAgICAgcG9pbnRlck1vdmVBY3Rpb24ueC5zaG91bGQuZXF1YWwoZWwuY2VudGVyLngpO1xuICAgICAgcG9pbnRlck1vdmVBY3Rpb24ueS5zaG91bGQuZXF1YWwoZWwuY2VudGVyLnkpO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgZmFsbCBiYWNrIHRvIHRvdWNoYWN0aW9ucyBpZiB3M2MgYWN0aW9ucyBkbyBub3QgZXhpc3Qgb24gZHJpdmVyJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgY29uc3QgZCA9IG5ldyBCYXNlRHJpdmVyKCk7XG4gICAgICBkLnBlcmZvcm1Ub3VjaCA9IF8ubm9vcDtcbiAgICAgIGNvbnN0IGFjdGlvblN0dWIgPSBzaW5vbi5zdHViKGQsICdwZXJmb3JtVG91Y2gnKTtcbiAgICAgIGNvbnN0IGVsID0gbmV3IEltYWdlRWxlbWVudChkZWZUZW1wbGF0ZSwgZGVmUmVjdCk7XG4gICAgICAvLyBza2lwIHRoZSBzdGFsZW5lc3MgY2hlY2sgZm9yIHRoaXMgdGVzdFxuICAgICAgYXdhaXQgZC5zZXR0aW5ncy51cGRhdGUoe1xuICAgICAgICBjaGVja0ZvckltYWdlRWxlbWVudFN0YWxlbmVzczogZmFsc2UsXG4gICAgICB9KTtcbiAgICAgIGF3YWl0IGVsLmNsaWNrKGQpO1xuICAgICAgY29uc3QgYWN0aW9uID0gYWN0aW9uU3R1Yi5hcmdzWzBdWzBdWzBdLm9wdGlvbnM7XG4gICAgICBhY3Rpb24ueC5zaG91bGQuZXF1YWwoZWwuY2VudGVyLngpO1xuICAgICAgYWN0aW9uLnkuc2hvdWxkLmVxdWFsKGVsLmNlbnRlci55KTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIHVzZSB0b3VjaGFjdGlvbnMgaWYgcmVxdWVzdGVkJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgY29uc3QgZCA9IG5ldyBCYXNlRHJpdmVyKCk7XG4gICAgICBkLnBlcmZvcm1BY3Rpb25zID0gXy5ub29wO1xuICAgICAgY29uc3QgdzNjU3R1YiA9IHNpbm9uLnN0dWIoZCwgJ3BlcmZvcm1BY3Rpb25zJyk7XG4gICAgICBkLnBlcmZvcm1Ub3VjaCA9IF8ubm9vcDtcbiAgICAgIGNvbnN0IHRvdWNoU3R1YiA9IHNpbm9uLnN0dWIoZCwgJ3BlcmZvcm1Ub3VjaCcpO1xuICAgICAgY29uc3QgZWwgPSBuZXcgSW1hZ2VFbGVtZW50KGRlZlRlbXBsYXRlLCBkZWZSZWN0KTtcbiAgICAgIC8vIHNraXAgdGhlIHN0YWxlbmVzcyBjaGVjayBmb3IgdGhpcyB0ZXN0XG4gICAgICBhd2FpdCBkLnNldHRpbmdzLnVwZGF0ZSh7XG4gICAgICAgIGNoZWNrRm9ySW1hZ2VFbGVtZW50U3RhbGVuZXNzOiBmYWxzZSxcbiAgICAgICAgaW1hZ2VFbGVtZW50VGFwU3RyYXRlZ3k6ICd0b3VjaEFjdGlvbnMnLFxuICAgICAgfSk7XG4gICAgICBhd2FpdCBlbC5jbGljayhkKTtcbiAgICAgIGNvbnN0IGFjdGlvbiA9IHRvdWNoU3R1Yi5hcmdzWzBdWzBdWzBdLm9wdGlvbnM7XG4gICAgICBhY3Rpb24ueC5zaG91bGQuZXF1YWwoZWwuY2VudGVyLngpO1xuICAgICAgYWN0aW9uLnkuc2hvdWxkLmVxdWFsKGVsLmNlbnRlci55KTtcbiAgICAgIHczY1N0dWIuY2FsbENvdW50LnNob3VsZC5lcWwoMCk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBpZiBkcml2ZXIgZG9lcyBub3QgaW1wbGVtZW50IGFueSB0eXBlIG9mIGFjdGlvbicsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbnN0IGQgPSBuZXcgQmFzZURyaXZlcigpO1xuICAgICAgY29uc3QgZWwgPSBuZXcgSW1hZ2VFbGVtZW50KGRlZlRlbXBsYXRlLCBkZWZSZWN0KTtcbiAgICAgIC8vIHNraXAgdGhlIHN0YWxlbmVzcyBjaGVjayBmb3IgdGhpcyB0ZXN0XG4gICAgICBhd2FpdCBkLnNldHRpbmdzLnVwZGF0ZSh7XG4gICAgICAgIGNoZWNrRm9ySW1hZ2VFbGVtZW50U3RhbGVuZXNzOiBmYWxzZSxcbiAgICAgIH0pO1xuICAgICAgYXdhaXQgZWwuY2xpY2soZCkuc2hvdWxkLmV2ZW50dWFsbHkuYmUucmVqZWN0ZWRXaXRoKC9kaWQgbm90IGltcGxlbWVudC8pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnI2V4ZWN1dGUnLCBmdW5jdGlvbiAoKSB7XG4gICAgY29uc3QgaW1nRWwgPSBuZXcgSW1hZ2VFbGVtZW50KGRlZlRlbXBsYXRlLCBkZWZSZWN0KTtcbiAgICBjb25zdCBjbGlja1N0dWIgPSBzaW5vbi5zdHViKGltZ0VsLCAnY2xpY2snKTtcblxuICAgIGJlZm9yZShmdW5jdGlvbiAoKSB7XG4gICAgICBkcml2ZXIuX2ltZ0VsQ2FjaGUuc2V0KGltZ0VsLmlkLCBpbWdFbCk7XG4gICAgICBjbGlja1N0dWIucmV0dXJucyh0cnVlKTtcbiAgICB9KTtcblxuICAgIGFmdGVyKGZ1bmN0aW9uICgpIHtcbiAgICAgIGRyaXZlci5faW1nRWxDYWNoZS5yZXNldCgpO1xuICAgICAgY2xpY2tTdHViLnJlc3RvcmUoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVqZWN0IGV4ZWN1dGlvbnMgb24gZWxlbWVudHMgbm90IGluIHRoZSBjYWNoZScsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGF3YWl0IEltYWdlRWxlbWVudC5leGVjdXRlKGRyaXZlciwgJ2NsaWNrJywgJ2FwcGl1bS1pbWFnZS1lbGVtZW50LWZvbycpXG4gICAgICAgIC5zaG91bGQuZXZlbnR1YWxseS5iZS5yZWplY3RlZFdpdGgoL2VsZW1lbnQgY291bGQgbm90IGJlIGxvY2F0ZWQvKTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIHJlamVjdCBleGVjdXRpb25zIGZvciB1bnN1cHBvcnRlZCBjb21tYW5kcycsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGF3YWl0IEltYWdlRWxlbWVudC5leGVjdXRlKGRyaXZlciwgJ2Zvb2JhcicsIGltZ0VsLmlkKVxuICAgICAgICAuc2hvdWxkLmV2ZW50dWFsbHkuYmUucmVqZWN0ZWRXaXRoKC9ub3QgeWV0IGJlZW4gaW1wbGVtZW50ZWQvKTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIGdldCBkaXNwbGF5ZWQgc3RhdHVzIG9mIGVsZW1lbnQnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICBhd2FpdCBJbWFnZUVsZW1lbnQuZXhlY3V0ZShkcml2ZXIsICdlbGVtZW50RGlzcGxheWVkJywgaW1nRWwuaWQpXG4gICAgICAgIC5zaG91bGQuZXZlbnR1YWxseS5iZS50cnVlO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgZ2V0IHNpemUgb2YgZWxlbWVudCcsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGF3YWl0IEltYWdlRWxlbWVudC5leGVjdXRlKGRyaXZlciwgJ2dldFNpemUnLCBpbWdFbC5pZClcbiAgICAgICAgLnNob3VsZC5ldmVudHVhbGx5LmVxbCh7d2lkdGg6IGRlZlJlY3Qud2lkdGgsIGhlaWdodDogZGVmUmVjdC5oZWlnaHR9KTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIGdldCBsb2NhdGlvbiBvZiBlbGVtZW50JywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgYXdhaXQgSW1hZ2VFbGVtZW50LmV4ZWN1dGUoZHJpdmVyLCAnZ2V0TG9jYXRpb24nLCBpbWdFbC5pZClcbiAgICAgICAgLnNob3VsZC5ldmVudHVhbGx5LmVxbCh7eDogZGVmUmVjdC54LCB5OiBkZWZSZWN0Lnl9KTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIGdldCBsb2NhdGlvbiBpbiB2aWV3IG9mIGVsZW1lbnQnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICBhd2FpdCBJbWFnZUVsZW1lbnQuZXhlY3V0ZShkcml2ZXIsICdnZXRMb2NhdGlvbicsIGltZ0VsLmlkKVxuICAgICAgICAuc2hvdWxkLmV2ZW50dWFsbHkuZXFsKHt4OiBkZWZSZWN0LngsIHk6IGRlZlJlY3QueX0pO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgZ2V0IHJlY3Qgb2YgZWxlbWVudCcsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGF3YWl0IEltYWdlRWxlbWVudC5leGVjdXRlKGRyaXZlciwgJ2dldEVsZW1lbnRSZWN0JywgaW1nRWwuaWQpXG4gICAgICAgIC5zaG91bGQuZXZlbnR1YWxseS5lcWwoZGVmUmVjdCk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCBjbGljayBlbGVtZW50JywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgYXdhaXQgSW1hZ2VFbGVtZW50LmV4ZWN1dGUoZHJpdmVyLCAnY2xpY2snLCBpbWdFbC5pZClcbiAgICAgICAgLnNob3VsZC5ldmVudHVhbGx5LmJlLnRydWU7XG4gICAgfSk7XG4gIH0pO1xufSk7XG5cbmRlc2NyaWJlKCdpbWFnZSBlbGVtZW50IExSVSBjYWNoZScsIGZ1bmN0aW9uICgpIHtcbiAgaXQoJ3Nob3VsZCBhY2NlcHQgYW5kIGNhY2hlIGltYWdlIGVsZW1lbnRzJywgZnVuY3Rpb24gKCkge1xuICAgIGNvbnN0IGVsMSA9IG5ldyBJbWFnZUVsZW1lbnQoZGVmVGVtcGxhdGUsIGRlZlJlY3QpO1xuICAgIGNvbnN0IGVsMiA9IG5ldyBJbWFnZUVsZW1lbnQoZGVmVGVtcGxhdGUsIGRlZlJlY3QpO1xuICAgIGNvbnN0IGNhY2hlID0gbWFrZUltYWdlRWxlbWVudENhY2hlKCk7XG4gICAgY2FjaGUuc2V0KGVsMS5pZCwgZWwxKTtcbiAgICBlbDEuZXF1YWxzKGNhY2hlLmdldChlbDEuaWQpKS5zaG91bGQuYmUudHJ1ZTtcbiAgICBfLmlzVW5kZWZpbmVkKGNhY2hlLmdldChlbDIuaWQpKS5zaG91bGQuYmUudHJ1ZTtcbiAgICBjYWNoZS5oYXMoZWwxLmlkKS5zaG91bGQuYmUudHJ1ZTtcbiAgICBjYWNoZS5oYXMoZWwyLmlkKS5zaG91bGQuYmUuZmFsc2U7XG4gIH0pO1xuICBpdCgnb25jZSBjYWNoZSByZWFjaGVzIG1heCBzaXplLCBzaG91bGQgZWplY3QgaW1hZ2UgZWxlbWVudHMnLCBmdW5jdGlvbiAoKSB7XG4gICAgY29uc3QgZWwxID0gbmV3IEltYWdlRWxlbWVudChkZWZUZW1wbGF0ZSwgZGVmUmVjdCk7XG4gICAgY29uc3QgZWwyID0gbmV3IEltYWdlRWxlbWVudChkZWZUZW1wbGF0ZSwgZGVmUmVjdCk7XG4gICAgY29uc3QgY2FjaGUgPSBtYWtlSW1hZ2VFbGVtZW50Q2FjaGUoZGVmVGVtcGxhdGUubGVuZ3RoICsgMSk7XG4gICAgY2FjaGUuc2V0KGVsMS5pZCwgZWwxKTtcbiAgICBjYWNoZS5oYXMoZWwxLmlkKS5zaG91bGQuYmUudHJ1ZTtcbiAgICBjYWNoZS5zZXQoZWwyLmlkLCBlbDIpO1xuICAgIGNhY2hlLmhhcyhlbDIuaWQpLnNob3VsZC5iZS50cnVlO1xuICAgIGNhY2hlLmhhcyhlbDEuaWQpLnNob3VsZC5iZS5mYWxzZTtcbiAgfSk7XG59KTtcblxuZGVzY3JpYmUoJ2dldEltZ0VsRnJvbUFyZ3MnLCBmdW5jdGlvbiAoKSB7XG4gIGl0KCdzaG91bGQgcmV0dXJuIHRoZSBpbWFnZSBlbGVtZW50IGlkIGZyb20ganNvbiBvYmogaW4gYXJncycsIGZ1bmN0aW9uICgpIHtcbiAgICBjb25zdCBpbWdFbCA9IGAke0lNQUdFX0VMRU1FTlRfUFJFRklYfWZvb2A7XG4gICAgY29uc3QgYXJncyA9IFsxLCAnZm9vJywgaW1nRWxdO1xuICAgIGdldEltZ0VsRnJvbUFyZ3MoYXJncykuc2hvdWxkLmVxbChpbWdFbCk7XG4gIH0pO1xuICBpdCgnc2hvdWxkIG5vdCByZXR1cm4gYW55dGhpbmcgaWYgaW1hZ2UgZWxlbWVudCBpZCBub3QgaW4gYXJncycsIGZ1bmN0aW9uICgpIHtcbiAgICBjb25zdCBhcmdzID0gWzEsICdmb28nXTtcbiAgICBfLmlzVW5kZWZpbmVkKGdldEltZ0VsRnJvbUFyZ3MoYXJncykpLnNob3VsZC5iZS50cnVlO1xuICB9KTtcbiAgaXQoJ3Nob3VsZCBub3QgZmluZCBpbWFnZSBlbGVtZW50IGlkIGluIGFueXRoaW5nIGJ1dCBwcmVmaXgnLCBmdW5jdGlvbiAoKSB7XG4gICAgY29uc3Qgbm90SW1nRWwgPSBgZm9vJHtJTUFHRV9FTEVNRU5UX1BSRUZJWH1gO1xuICAgIGNvbnN0IGFyZ3MgPSBbMSwgJ2ZvbycsIG5vdEltZ0VsXTtcbiAgICBfLmlzVW5kZWZpbmVkKGdldEltZ0VsRnJvbUFyZ3MoYXJncykpLnNob3VsZC5iZS50cnVlO1xuICB9KTtcbn0pO1xuIl0sImZpbGUiOiJ0ZXN0L2Jhc2Vkcml2ZXIvaW1hZ2UtZWxlbWVudC1zcGVjcy5qcyIsInNvdXJjZVJvb3QiOiIuLi8uLi8uLiJ9
