"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.installApp = installApp;
exports.removeApp = removeApp;
exports.launch = launch;
exports.spawn = spawn;
exports.spawnSubProcess = spawnSubProcess;
exports.openUrl = openUrl;
exports.terminate = terminate;
exports.shutdown = shutdown;
exports.createDevice = createDevice;
exports.getAppContainer = getAppContainer;
exports.getScreenshot = getScreenshot;
exports.deleteDevice = deleteDevice;
exports.eraseDevice = eraseDevice;
exports.getDevices = getDevices;
exports.getRuntimeForPlatformVersion = getRuntimeForPlatformVersion;
exports.bootDevice = bootDevice;
exports.setPasteboard = setPasteboard;
exports.getPasteboard = getPasteboard;
exports.addMedia = addMedia;
exports.appInfo = appInfo;
exports.getDeviceTypes = getDeviceTypes;
exports.startBootMonitor = startBootMonitor;

require("source-map-support/register");

var _teen_process = require("teen_process");

var _asyncbox = require("asyncbox");

var _appiumSupport = require("appium-support");

var _lodash = _interopRequireDefault(require("lodash"));

var _appiumXcode = require("appium-xcode");

const log = _appiumSupport.logger.getLogger('simctl');

const CMDLINE_TOOLS_CLANG_FORMAT_CHANGED_VERSION = '1001.0.46';
const XCODE_FORMAT_CHANGED_VERSION = '10.2';
const SIM_RUNTIME_NAME = 'com.apple.CoreSimulator.SimRuntime.';
const SIM_RUNTIME_NAME_SUFFIX_IOS = 'iOS';
const DEFAULT_CREATE_SIMULATOR_TIMEOUT = 10000;

async function simCommand(command, timeout, args = [], env = {}, executingFunction = _teen_process.exec, logErrors = true) {
  args = ['simctl', command, ...args];
  env = _lodash.default.defaults(_lodash.default.mapKeys(env, (value, key) => {
    return `SIMCTL_CHILD_${key}`;
  }), process.env);

  try {
    return await executingFunction('xcrun', args, {
      timeout,
      env
    });
  } catch (e) {
    if (!logErrors) {
      throw e;
    } else if (e.stderr) {
      log.errorAndThrow(`simctl error running '${command}': ${e.stderr.trim()}`);
    } else {
      log.errorAndThrow(e);
    }
  }
}

async function simExec(command, timeout, args = [], env = {}, logErrors = true) {
  return await simCommand(command, timeout, args, env, async (c, a, ob) => {
    return await (0, _teen_process.exec)(c, a, ob);
  }, logErrors);
}

async function simSubProcess(command, timeout, args = [], env = {}) {
  return await simCommand(command, timeout, args, env, (c, a, ob) => {
    return new _teen_process.SubProcess(c, a, ob);
  });
}

async function installApp(udid, appPath) {
  await simExec('install', 0, [udid, appPath]);
}

async function bootDevice(udid) {
  try {
    await simExec('boot', 0, [udid]);
  } catch (err) {
    if ((err.message || '').indexOf('Unable to boot device in current state: Booted') === -1) {
      throw err;
    }

    log.debug(`Simulator already in 'Booted' state. Continuing`);
  }
}

async function removeApp(udid, bundleId) {
  await simExec('uninstall', 0, [udid, bundleId]);
}

async function launch(udid, bundleId, tries = 5) {
  await (0, _asyncbox.retryInterval)(tries, 1000, async () => {
    await simExec('launch', 0, [udid, bundleId]);
  });
}

async function spawn(udid, args, env = {}) {
  return await simExec('spawn', 0, [udid, ...(_lodash.default.isArray(args) ? args : [args])], env);
}

async function spawnSubProcess(udid, args, env = {}) {
  return await simSubProcess('spawn', 0, [udid, ...(_lodash.default.isArray(args) ? args : [args])], env);
}

async function openUrl(udid, url) {
  return await simExec('openurl', 0, [udid, url]);
}

async function appInfo(udid, bundleId) {
  const {
    stdout
  } = await simExec('appinfo', 0, [udid, bundleId]);
  return (stdout || '').trim();
}

async function addMedia(udid, path) {
  return await simExec('addmedia', 0, [udid, path]);
}

async function terminate(udid, bundleId) {
  await simExec('terminate', 0, [udid, bundleId]);
}

async function getAppContainer(udid, bundleId, logErrors = true, containerType = null) {
  const args = [udid, bundleId];

  if (containerType) {
    args.push(containerType);
  }

  const {
    stdout
  } = await simExec('get_app_container', 0, args, {}, logErrors);
  return (stdout || '').trim();
}

async function shutdown(udid) {
  try {
    await simExec('shutdown', 0, [udid]);
  } catch (err) {
    if (!(err + '').includes('current state: Shutdown')) {
      throw err;
    }

    log.debug(`Simulator already in 'Shutdown' state. Continuing`);
  }
}

async function createDevice(name, deviceTypeId, runtimeId, opts = {}) {
  const {
    platform = SIM_RUNTIME_NAME_SUFFIX_IOS,
    timeout = DEFAULT_CREATE_SIMULATOR_TIMEOUT
  } = opts;

  try {
    runtimeId = await getRuntimeForPlatformVersion(runtimeId, platform);
  } catch (err) {
    log.warn(`Unable to find runtime for iOS '${runtimeId}'. Continuing`);
  }

  const clangVersion = await (0, _appiumXcode.getClangVersion)();

  let isNewerIdFormatRequired = clangVersion && _appiumSupport.util.compareVersions(clangVersion, '>=', CMDLINE_TOOLS_CLANG_FORMAT_CHANGED_VERSION);

  if (!isNewerIdFormatRequired) {
    const xcodeVersion = await (0, _appiumXcode.getVersion)(false);
    isNewerIdFormatRequired = xcodeVersion && _appiumSupport.util.compareVersions(xcodeVersion, '>=', XCODE_FORMAT_CHANGED_VERSION);
  }

  if (isNewerIdFormatRequired) {
    runtimeId = `${SIM_RUNTIME_NAME}${platform}-${runtimeId.replace(/\./g, '-')}`;
  }

  log.debug(`Creating simulator with name '${name}', device type id '${deviceTypeId}' and runtime id '${runtimeId}'`);
  let udid;

  try {
    const out = await simExec('create', 0, [name, deviceTypeId, runtimeId]);
    udid = out.stdout.trim();
  } catch (err) {
    let reason = err.message;

    if (err.stderr) {
      reason = err.stderr.trim();
    }

    log.errorAndThrow(`Could not create simulator with name '${name}', device ` + `type id '${deviceTypeId}' and runtime id '${runtimeId}'. Reason: '${reason}'`);
  }

  let retries = parseInt(timeout / 1000, 10);
  await (0, _asyncbox.retryInterval)(retries, 1000, async () => {
    let devices = await getDevices();

    for (const deviceArr of _lodash.default.values(devices)) {
      for (const device of deviceArr) {
        if (device.udid === udid) {
          if (device.state === 'Creating') {
            throw new Error('Device still being created');
          } else {
            return;
          }
        }
      }
    }
  });
  return udid;
}

async function deleteDevice(udid) {
  await simExec('delete', 0, [udid]);
}

async function eraseDevice(udid, timeout = 1000) {
  let loopFn = async () => {
    await simExec('erase', 10000, [udid]);
  };

  let retries = parseInt(timeout / 200, 10);
  await (0, _asyncbox.retryInterval)(retries, 200, loopFn);
}

async function getDevicesByParsing(platform) {
  const {
    stdout
  } = await simExec('list', 0, ['devices']);
  const deviceSectionRe = _lodash.default.isEmpty(platform) ? new RegExp(`\\-\\-\\s+(\\S+)\\s+(\\S+)\\s+\\-\\-(\\n\\s{4}.+)*`, 'mgi') : new RegExp(`\\-\\-\\s+${_lodash.default.escapeRegExp(platform)}\\s+(\\S+)\\s+\\-\\-(\\n\\s{4}.+)*`, 'mgi');
  const matches = [];
  let match;

  while (match = deviceSectionRe.exec(stdout)) {
    matches.push(match);
  }

  if (_lodash.default.isEmpty(matches)) {
    throw new Error('Could not find device section');
  }

  const lineRe = /([^\s].+) \((\w+-.+\w+)\) \((\w+\s?\w+)\)/;
  const devices = {};

  for (match of matches) {
    const sdk = platform ? match[1] : match[2];
    devices[sdk] = devices[sdk] || [];

    for (const line of match[0].split('\n').slice(1)) {
      if (line.includes('(unavailable, ')) {
        continue;
      }

      const lineMatch = lineRe.exec(line);

      if (!lineMatch) {
        throw new Error(`Could not match line: ${line}`);
      }

      devices[sdk].push({
        name: lineMatch[1],
        udid: lineMatch[2],
        state: lineMatch[3],
        sdk,
        platform: platform || match[1]
      });
    }
  }

  return devices;
}

async function getDevices(forSdk, platform) {
  let devices = {};

  try {
    const {
      stdout
    } = await simExec('list', 0, ['devices', '-j']);
    const versionMatchRe = _lodash.default.isEmpty(platform) ? new RegExp(`^([^\\s-]+)[\\s-](\\S+)`, 'i') : new RegExp(`^${_lodash.default.escapeRegExp(platform)}[\\s-](\\S+)`, 'i');

    for (let [sdkName, entries] of _lodash.default.toPairs(JSON.parse(stdout).devices)) {
      sdkName = sdkName.replace(SIM_RUNTIME_NAME, '');
      const versionMatch = versionMatchRe.exec(sdkName);

      if (!versionMatch) {
        continue;
      }

      const sdk = (platform ? versionMatch[1] : versionMatch[2]).replace('-', '.');
      devices[sdk] = devices[sdk] || [];
      devices[sdk].push(...entries.filter(el => _lodash.default.isUndefined(el.isAvailable) || el.isAvailable).map(el => {
        delete el.availability;
        return {
          sdk,
          ...el,
          platform: platform || versionMatch[1]
        };
      }));
    }
  } catch (err) {
    log.debug(`Unable to get JSON device list: ${err.stack}`);
    log.debug('Falling back to manual parsing');
    devices = await getDevicesByParsing(platform);
  }

  if (!forSdk) {
    return devices;
  }

  if (devices[forSdk]) {
    return devices[forSdk];
  }

  let errMsg = `'${forSdk}' does not exist in the list of simctl SDKs.`;

  const availableSDKs = _lodash.default.keys(devices);

  errMsg += availableSDKs.length ? ` Only the following Simulator SDK versions are available on your system: ${availableSDKs.join(', ')}` : ` No Simulator SDK versions are available on your system. Please install some via Xcode preferences.`;
  throw new Error(errMsg);
}

async function getRuntimeForPlatformVersion(platformVersion, platform = 'iOS') {
  try {
    const {
      stdout
    } = await simExec('list', 0, ['runtimes']);
    const runtimeRe = new RegExp(`${_lodash.default.escapeRegExp(platform)}\\s+(\\d+\\.\\d+)\\s+\\((\\d+\\.\\d+\\.*\\d*)`, 'i');

    for (const line of stdout.split('\n')) {
      const match = runtimeRe.exec(line);

      if (match && match[1] === platformVersion) {
        return match[2];
      }
    }
  } catch (ign) {}

  return platformVersion;
}

async function getScreenshot(udid) {
  let pathToScreenshotPng = await _appiumSupport.tempDir.path({
    prefix: `screenshot-${udid}`,
    suffix: '.png'
  });
  await simExec('io', 0, [udid, 'screenshot', pathToScreenshotPng]);
  let screenshotImg = await _appiumSupport.fs.readFile(pathToScreenshotPng);
  await _appiumSupport.fs.rimraf(pathToScreenshotPng);
  return screenshotImg.toString('base64');
}

async function setPasteboard(udid, content, encoding = 'utf-8') {
  const pbCopySubprocess = new _teen_process.SubProcess('xcrun', ['simctl', 'pbcopy', udid]);
  await pbCopySubprocess.start(0);
  const exitCodeVerifier = pbCopySubprocess.join();
  const stdin = pbCopySubprocess.proc.stdin;
  stdin.setEncoding(encoding);
  stdin.write(content);
  stdin.end();
  await exitCodeVerifier;
}

async function getPasteboard(udid, encoding = 'utf-8') {
  const args = ['simctl', 'pbpaste', udid];

  try {
    const {
      stdout
    } = await (0, _teen_process.exec)('xcrun', args, {
      timeout: 0,
      encoding
    });
    return stdout;
  } catch (e) {
    if (e.stderr) {
      log.errorAndThrow(`Error running 'xcrun ${args.join(' ')}': ${e.stderr.trim()}`);
    } else {
      log.errorAndThrow(e);
    }
  }
}

async function getDeviceTypes() {
  try {
    const {
      stdout
    } = await simExec('list', 0, ['devicetypes', '-j']);
    const deviceTypes = JSON.parse(stdout.trim());
    return deviceTypes.devicetypes.map(type => type.name);
  } catch (err) {
    let msg = `Unable to get list of device types: ${err.message}`;

    if (err.stderr) {
      msg = `${msg}. Stderr: ${err.stderr}`;
    }

    throw new Error(msg);
  }
}

async function startBootMonitor(udid, opts = {}) {
  const {
    timeout = 240000,
    onWaitingDataMigration,
    onWaitingSystemApp,
    onFinished,
    onError
  } = opts;
  let status = '';
  let isBootingFinished = false;
  let error = null;
  let timeoutHandler = null;
  const bootMonitor = await simSubProcess('bootstatus', 0, [udid]);
  bootMonitor.on('output', (stdout, stderr) => {
    status += stdout || stderr;

    if (stdout) {
      if (stdout.includes('Waiting on Data Migration') && onWaitingDataMigration) {
        onWaitingDataMigration();
      } else if (stdout.includes('Waiting on System App') && onWaitingSystemApp) {
        onWaitingSystemApp();
      }
    }
  });
  bootMonitor.on('exit', (code, signal) => {
    if (timeoutHandler) {
      clearTimeout(timeoutHandler);
    }

    if (code === 0) {
      if (onFinished) {
        onFinished();
      }

      isBootingFinished = true;
    } else {
      status = status || signal;
      error = new Error(status);

      if (onError) {
        onError(error);
      }
    }
  });
  await bootMonitor.start(0);

  const stopMonitor = async () => {
    if (bootMonitor.isRunning) {
      try {
        await bootMonitor.stop();
      } catch (e) {
        log.warn(e.message);
      }
    }
  };

  const timeStarted = process.hrtime();

  if (onFinished) {
    timeoutHandler = setTimeout(stopMonitor, timeout);
  } else {
    try {
      await (0, _asyncbox.waitForCondition)(() => {
        if (error) {
          throw error;
        }

        return isBootingFinished;
      }, {
        waitMs: timeout,
        intervalMs: 500
      });
    } catch (err) {
      await stopMonitor();
      throw new Error(`The simulator ${udid} has failed to finish booting after ${process.hrtime(timeStarted)[0]}s. ` + `Original status: ${status}`);
    }
  }

  return bootMonitor;
}require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9zaW1jdGwuanMiXSwibmFtZXMiOlsibG9nIiwibG9nZ2VyIiwiZ2V0TG9nZ2VyIiwiQ01ETElORV9UT09MU19DTEFOR19GT1JNQVRfQ0hBTkdFRF9WRVJTSU9OIiwiWENPREVfRk9STUFUX0NIQU5HRURfVkVSU0lPTiIsIlNJTV9SVU5USU1FX05BTUUiLCJTSU1fUlVOVElNRV9OQU1FX1NVRkZJWF9JT1MiLCJERUZBVUxUX0NSRUFURV9TSU1VTEFUT1JfVElNRU9VVCIsInNpbUNvbW1hbmQiLCJjb21tYW5kIiwidGltZW91dCIsImFyZ3MiLCJlbnYiLCJleGVjdXRpbmdGdW5jdGlvbiIsImV4ZWMiLCJsb2dFcnJvcnMiLCJfIiwiZGVmYXVsdHMiLCJtYXBLZXlzIiwidmFsdWUiLCJrZXkiLCJwcm9jZXNzIiwiZSIsInN0ZGVyciIsImVycm9yQW5kVGhyb3ciLCJ0cmltIiwic2ltRXhlYyIsImMiLCJhIiwib2IiLCJzaW1TdWJQcm9jZXNzIiwiU3ViUHJvY2VzcyIsImluc3RhbGxBcHAiLCJ1ZGlkIiwiYXBwUGF0aCIsImJvb3REZXZpY2UiLCJlcnIiLCJtZXNzYWdlIiwiaW5kZXhPZiIsImRlYnVnIiwicmVtb3ZlQXBwIiwiYnVuZGxlSWQiLCJsYXVuY2giLCJ0cmllcyIsInNwYXduIiwiaXNBcnJheSIsInNwYXduU3ViUHJvY2VzcyIsIm9wZW5VcmwiLCJ1cmwiLCJhcHBJbmZvIiwic3Rkb3V0IiwiYWRkTWVkaWEiLCJwYXRoIiwidGVybWluYXRlIiwiZ2V0QXBwQ29udGFpbmVyIiwiY29udGFpbmVyVHlwZSIsInB1c2giLCJzaHV0ZG93biIsImluY2x1ZGVzIiwiY3JlYXRlRGV2aWNlIiwibmFtZSIsImRldmljZVR5cGVJZCIsInJ1bnRpbWVJZCIsIm9wdHMiLCJwbGF0Zm9ybSIsImdldFJ1bnRpbWVGb3JQbGF0Zm9ybVZlcnNpb24iLCJ3YXJuIiwiY2xhbmdWZXJzaW9uIiwiaXNOZXdlcklkRm9ybWF0UmVxdWlyZWQiLCJ1dGlsIiwiY29tcGFyZVZlcnNpb25zIiwieGNvZGVWZXJzaW9uIiwicmVwbGFjZSIsIm91dCIsInJlYXNvbiIsInJldHJpZXMiLCJwYXJzZUludCIsImRldmljZXMiLCJnZXREZXZpY2VzIiwiZGV2aWNlQXJyIiwidmFsdWVzIiwiZGV2aWNlIiwic3RhdGUiLCJFcnJvciIsImRlbGV0ZURldmljZSIsImVyYXNlRGV2aWNlIiwibG9vcEZuIiwiZ2V0RGV2aWNlc0J5UGFyc2luZyIsImRldmljZVNlY3Rpb25SZSIsImlzRW1wdHkiLCJSZWdFeHAiLCJlc2NhcGVSZWdFeHAiLCJtYXRjaGVzIiwibWF0Y2giLCJsaW5lUmUiLCJzZGsiLCJsaW5lIiwic3BsaXQiLCJzbGljZSIsImxpbmVNYXRjaCIsImZvclNkayIsInZlcnNpb25NYXRjaFJlIiwic2RrTmFtZSIsImVudHJpZXMiLCJ0b1BhaXJzIiwiSlNPTiIsInBhcnNlIiwidmVyc2lvbk1hdGNoIiwiZmlsdGVyIiwiZWwiLCJpc1VuZGVmaW5lZCIsImlzQXZhaWxhYmxlIiwibWFwIiwiYXZhaWxhYmlsaXR5Iiwic3RhY2siLCJlcnJNc2ciLCJhdmFpbGFibGVTREtzIiwia2V5cyIsImxlbmd0aCIsImpvaW4iLCJwbGF0Zm9ybVZlcnNpb24iLCJydW50aW1lUmUiLCJpZ24iLCJnZXRTY3JlZW5zaG90IiwicGF0aFRvU2NyZWVuc2hvdFBuZyIsInRlbXBEaXIiLCJwcmVmaXgiLCJzdWZmaXgiLCJzY3JlZW5zaG90SW1nIiwiZnMiLCJyZWFkRmlsZSIsInJpbXJhZiIsInRvU3RyaW5nIiwic2V0UGFzdGVib2FyZCIsImNvbnRlbnQiLCJlbmNvZGluZyIsInBiQ29weVN1YnByb2Nlc3MiLCJzdGFydCIsImV4aXRDb2RlVmVyaWZpZXIiLCJzdGRpbiIsInByb2MiLCJzZXRFbmNvZGluZyIsIndyaXRlIiwiZW5kIiwiZ2V0UGFzdGVib2FyZCIsImdldERldmljZVR5cGVzIiwiZGV2aWNlVHlwZXMiLCJkZXZpY2V0eXBlcyIsInR5cGUiLCJtc2ciLCJzdGFydEJvb3RNb25pdG9yIiwib25XYWl0aW5nRGF0YU1pZ3JhdGlvbiIsIm9uV2FpdGluZ1N5c3RlbUFwcCIsIm9uRmluaXNoZWQiLCJvbkVycm9yIiwic3RhdHVzIiwiaXNCb290aW5nRmluaXNoZWQiLCJlcnJvciIsInRpbWVvdXRIYW5kbGVyIiwiYm9vdE1vbml0b3IiLCJvbiIsImNvZGUiLCJzaWduYWwiLCJjbGVhclRpbWVvdXQiLCJzdG9wTW9uaXRvciIsImlzUnVubmluZyIsInN0b3AiLCJ0aW1lU3RhcnRlZCIsImhydGltZSIsInNldFRpbWVvdXQiLCJ3YWl0TXMiLCJpbnRlcnZhbE1zIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUdBLE1BQU1BLEdBQUcsR0FBR0Msc0JBQU9DLFNBQVAsQ0FBaUIsUUFBakIsQ0FBWjs7QUFHQSxNQUFNQywwQ0FBMEMsR0FBRyxXQUFuRDtBQUNBLE1BQU1DLDRCQUE0QixHQUFHLE1BQXJDO0FBRUEsTUFBTUMsZ0JBQWdCLEdBQUcscUNBQXpCO0FBQ0EsTUFBTUMsMkJBQTJCLEdBQUcsS0FBcEM7QUFDQSxNQUFNQyxnQ0FBZ0MsR0FBRyxLQUF6Qzs7QUF1QkEsZUFBZUMsVUFBZixDQUEyQkMsT0FBM0IsRUFBb0NDLE9BQXBDLEVBQTZDQyxJQUFJLEdBQUcsRUFBcEQsRUFBd0RDLEdBQUcsR0FBRyxFQUE5RCxFQUFrRUMsaUJBQWlCLEdBQUdDLGtCQUF0RixFQUE0RkMsU0FBUyxHQUFHLElBQXhHLEVBQThHO0FBRTVHSixFQUFBQSxJQUFJLEdBQUcsQ0FBQyxRQUFELEVBQVdGLE9BQVgsRUFBb0IsR0FBR0UsSUFBdkIsQ0FBUDtBQUdBQyxFQUFBQSxHQUFHLEdBQUdJLGdCQUFFQyxRQUFGLENBQVdELGdCQUFFRSxPQUFGLENBQVVOLEdBQVYsRUFBZSxDQUFDTyxLQUFELEVBQVFDLEdBQVIsS0FBZ0I7QUFDOUMsV0FBUSxnQkFBZUEsR0FBSSxFQUEzQjtBQUNELEdBRmdCLENBQVgsRUFFRkMsT0FB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QUNGLEdBaEJEO0FBaUJBLFFBQU1FLFdBQVcsQ0FBQ3RCLEtBQVosQ0FBa0IsQ0FBbEIsQ0FBTjs7QUFDQSxRQUFNMkIsV0FBVyxHQUFHLFlBQVk7QUFDOUIsUUFBSUwsV0FBVyxDQUFDTSxTQUFoQixFQUEyQjtBQUN6QixVQUFJO0FBQ0YsY0FBTU4sV0FBVyxDQUFDTyxJQUFaLEVBQU47QUFDRCxPQUZELENBRUUsT0FBT2hKLENBQVAsRUFBVTtBQUNWdEIsUUFBQUEsR0FBRyxDQUFDa0UsSUFBSixDQUFTNUMsQ0FBQyxDQUFDZSxPQUFYO0FBQ0Q7QUFDRjtBQUNGLEdBUkQ7O0FBU0EsUUFBTWtJLFdBQVcsR0FBR2xKLE9BQU8sQ0FBQ21KLE1BQVIsRUFBcEI7O0FBQ0EsTUFBSWYsVUFBSixFQUFnQjtBQUNkSyxJQUFBQSxjQUFjLEdBQUdXLFVBQVUsQ0FBQ0wsV0FBRCxFQUFjMUosT0FBZCxDQUEzQjtBQUNELEdBRkQsTUFFTztBQUNMLFFBQUk7QUFDRixZQUFNLGdDQUFpQixNQUFNO0FBQzNCLFlBQUltSixLQUFKLEVBQVc7QUFDVCxnQkFBTUEsS0FBTjtBQUNEOztBQUNELGVBQU9ELGlCQUFQO0FBQ0QsT0FMSyxFQUtIO0FBQUNjLFFBQUFBLE1BQU0sRUFBRWhLLE9BQVQ7QUFBa0JpSyxRQUFBQSxVQUFVLEVBQUU7QUFBOUIsT0FMRyxDQUFOO0FBTUQsS0FQRCxDQU9FLE9BQU92SSxHQUFQLEVBQVk7QUFDWixZQUFNZ0ksV0FBVyxFQUFqQjtBQUNBLFlBQU0sSUFBSWpGLEtBQUosQ0FBVyxpQkFBZ0JsRCxJQUFLLHVDQUFzQ1osT0FBTyxDQUFDbUosTUFBUixDQUFlRCxXQUFmLEVBQTRCLENBQTVCLENBQStCLEtBQTNGLEdBQ2Isb0JBQW1CWixNQUFPLEVBRHZCLENBQU47QUFFRDtBQUNGOztBQUNELFNBQU9JLFdBQVA7QUFDRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGV4ZWMsIFN1YlByb2Nlc3MgfSBmcm9tICd0ZWVuX3Byb2Nlc3MnO1xuaW1wb3J0IHsgcmV0cnlJbnRlcnZhbCwgd2FpdEZvckNvbmRpdGlvbiB9IGZyb20gJ2FzeW5jYm94JztcbmltcG9ydCB7IGxvZ2dlciwgZnMsIHRlbXBEaXIsIHV0aWwgfSBmcm9tICdhcHBpdW0tc3VwcG9ydCc7XG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHsgZ2V0Q2xhbmdWZXJzaW9uLCBnZXRWZXJzaW9uIH0gZnJvbSAnYXBwaXVtLXhjb2RlJztcblxuXG5jb25zdCBsb2cgPSBsb2dnZXIuZ2V0TG9nZ2VyKCdzaW1jdGwnKTtcblxuLy8gY29tbWFuZCBsaW5lIHRvb2xzIGFuZCB4Y29kZSB2ZXJzaW9uIGNhbiBiZSBkaWZmZXJlbnRcbmNvbnN0IENNRExJTkVfVE9PTFNfQ0xBTkdfRk9STUFUX0NIQU5HRURfVkVSU0lPTiA9ICcxMDAxLjAuNDYnO1xuY29uc3QgWENPREVfRk9STUFUX0NIQU5HRURfVkVSU0lPTiA9ICcxMC4yJztcblxuY29uc3QgU0lNX1JVTlRJTUVfTkFNRSA9ICdjb20uYXBwbGUuQ29yZVNpbXVsYXRvci5TaW1SdW50aW1lLic7XG5jb25zdCBTSU1fUlVOVElNRV9OQU1FX1NVRkZJWF9JT1MgPSAnaU9TJztcbmNvbnN0IERFRkFVTFRfQ1JFQVRFX1NJTVVMQVRPUl9USU1FT1VUID0gMTAwMDA7XG5cbi8qKlxuICogRXhlY3V0ZSB0aGUgcGFydGljdWxhciBzaW1jdGwgY29tbWFuZCBhbmQgcmV0dXJuIHRoZSBvdXRwdXQuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IGNvbW1hbmQgLSBPbmUgb2YgYXZhaWxhYmxlIHNpbWN0bCBzdWJjb21tYW5kcy5cbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgRXhlY3V0ZSBgeGNydW4gc2ltY3RsYCBpbiBUZXJtaW5hbCB0byBzZWUgdGhlIGZ1bGwgbGlzdFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICBvZiBhdmFpbGFibGUgc3ViY29tbWFuZHMuXG4gKiBAcGFyYW0ge251bWJlcn0gdGltZW91dCAtIENvbW1hbmQgZXhlY3V0aW9uIHRpbWVvdXQgaW4gbWlsbGlzZWNvbmRzLlxuICogICAgICAgICAgICAgICAgICAgICAgICAgICBTZXQgaXQgdG8gemVybyB0byBza2lwIHdhaXRpbmcgZm9yIGNvbW1hbmRcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhlY3V0aW9uLlxuICogQHBhcmFtIHtBcnJheS48c3RyaW5nPn0gYXJncyBbW11dIC0gVGhlIGxpc3Qgb2YgYWRkaXRpb25hbCBzdWJjb21tYW5kIGFyZ3VtZW50cy5cbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEl0J3MgZW1wdHkgYnkgZGVmYXVsdC5cbiAqIEBwYXJhbSB7T2JqZWN0fSBlbnYgW3t9XSAtIEVudmlyb25tZW50IHZhcmlhYmxlcyBtYXBwaW5nLiBBbGwgdGhlc2UgdmFyaWFibGVzXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aWxsIGJlIHBhc3NlZCBTaW11bGF0b3IgYW5kIHVzZWQgaW4gX2V4ZWN1dGluZ0Z1bmN0aW9uXy5cbiAqIEBwYXJhbSB7RnVuY3Rpb259IGV4ZWN1dGluZ0Z1bmN0aW9uIC0gRXhlY3V0aW5nIGZ1bmN0aW9uIG9iamVjdC4gRXF1YWxzIHRvIHRlZW5fcHJvY2VzcydzXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9leGVjXyBieSBkZWZhdWx0LlxuICogQHBhcmFtIHtib29sZWFufSBsb2dFcnJvcnMgW3RydWVdIC0gU2V0IGl0IHRvIF9mYWxzZV8gdG8gdGhyb3cgZXhlY3V0aW9uIGVycm9yc1xuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW1tZWRpYXRlbHkgd2l0aG91dCBsb2dnaW5nIGFueSBhZGRpdGlvbmFsIGluZm9ybWF0aW9uLlxuICogQHJldHVybiB7T2JqZWN0fSBUaGUgcmVzdWx0IG9mIF9leGVjdXRpbmdGdW5jdGlvbl8uXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlIHNpbWN0bCBzdWJjb21tYW5kIGNvbW1hbmQgZXhlY3V0ZWQgYnkgX2V4ZWN1dGluZ0Z1bmN0aW9uX1xuICogICAgICAgICAgICAgICAgIHJldHVybnMgbm9uLXplcm8gcmV0dXJuIGNvZGUuXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHNpbUNvbW1hbmQgKGNvbW1hbmQsIHRpbWVvdXQsIGFyZ3MgPSBbXSwgZW52ID0ge30sIGV4ZWN1dGluZ0Z1bmN0aW9uID0gZXhlYywgbG9nRXJyb3JzID0gdHJ1ZSkge1xuICAvLyBydW4gYSBwYXJ0aWN1bGFyIHNpbWN0bCBjb21tYW5kXG4gIGFyZ3MgPSBbJ3NpbWN0bCcsIGNvbW1hbmQsIC4uLmFyZ3NdO1xuICAvLyBQcmVmaXggYWxsIHBhc3NlZCBpbiBlbnZpcm9ubWVudCB2YXJpYWJsZXMgd2l0aCAnU0lNQ1RMX0NISUxEXycsIHNpbWN0bFxuICAvLyB3aWxsIHRoZW4gcGFzcyB0aGVzZSB0byB0aGUgY2hpbGQgKHNwYXduZWQpIHByb2Nlc3MuXG4gIGVudiA9IF8uZGVmYXVsdHMoXy5tYXBLZXlzKGVudiwgKHZhbHVlLCBrZXkpID0+IHtcbiAgICByZXR1cm4gYFNJTUNUTF9DSElMRF8ke2tleX1gO1xuICB9KSwgcHJvY2Vzcy5lbnYpO1xuXG4gIHRyeSB7XG4gICAgcmV0dXJuIGF3YWl0IGV4ZWN1dGluZ0Z1bmN0aW9uKCd4Y3J1bicsIGFyZ3MsIHt0aW1lb3V0LCBlbnZ9KTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIGlmICghbG9nRXJyb3JzKSB7XG4gICAgICAvLyBpZiB3ZSBkb24ndCB3YW50IHRvIHNlZSB0aGUgZXJyb3JzLCBqdXN0IHRocm93IGFuZCBhbGxvdyB0aGUgY2FsbGluZ1xuICAgICAgLy8gY29kZSBkbyB3aGF0IGl0IHdhbnRzXG4gICAgICB0aHJvdyBlO1xuICAgIH0gZWxzZSBpZiAoZS5zdGRlcnIpIHtcbiAgICAgIGxvZy5lcnJvckFuZFRocm93KGBzaW1jdGwgZXJyb3IgcnVubmluZyAnJHtjb21tYW5kfSc6ICR7ZS5zdGRlcnIudHJpbSgpfWApO1xuICAgIH0gZWxzZSB7XG4gICAgICBsb2cuZXJyb3JBbmRUaHJvdyhlKTtcbiAgICB9XG4gIH1cbn1cblxuLyoqXG4gKiBAdHlwZWRlZiB7T2JqZWN0fSBFeGVjUmVzdWx0XG4gKiBAcHJvcGVydHkgez9zdHJpbmd9IHN0ZG91dCAtIFByb2Nlc3Mgc3Rkb3V0LlxuICogQHByb3BlcnR5IHs/c3RyaW5nfSBzdGRlcnIgLSBQcm9jZXNzIHN0ZGVyci5cbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBjb2RlIC0gUHJvY2VzcyBleGl0IGNvZGUuXG4gKi9cblxuLyoqXG4gKiBFeGVjdXRlIHRoZSBwYXJ0aWN1bGFyIHNpbWN0bCBzdWJjb21tYW5kIHN5bmNocm9ub3VzbHkgYW5kXG4gKiB3YWl0IGZvciB0aGUgb3V0cHV0LlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBjb21tYW5kIC0gU2VlIHtAbGluayBzaW1Db21tYW5kfSBwYXJhbWV0ZXJzLlxuICogQHBhcmFtIHtudW1iZXJ9IHRpbWVvdXQgLSBTZWUge0BsaW5rIHNpbUNvbW1hbmR9IHBhcmFtZXRlcnMuXG4gKiBAcGFyYW0ge0FycmF5LjxzdHJpbmc+fSBhcmdzIFtbXV0gLSBTZWUge0BsaW5rIHNpbUNvbW1hbmR9IHBhcmFtZXRlcnMuXG4gKiBAcGFyYW0ge09iamVjdH0gZW52IFt7fV0gLSBTZWUge0BsaW5rIHNpbUNvbW1hbmR9IHBhcmFtZXRlcnMuXG4gKiBAcGFyYW0ge2Jvb2xlYW59IGxvZ0Vycm9ycyBbdHJ1ZV0gLSBTZWUge0BsaW5rIHNpbUNvbW1hbmR9IHBhcmFtZXRlcnMuXG4gKiBAcmV0dXJuIHtFeGVjUmVzdWx0fSBUaGUgcmVzdWx0IG9mIF9leGVjXyBmdW5jdGlvbi5cbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGUgc2ltY3RsIHN1YmNvbW1hbmQgY29tbWFuZCBleGVjdXRlZCBieSBleGVjXG4gKiAgICAgICAgICAgICAgICAgcmV0dXJucyBub24temVybyByZXR1cm4gY29kZS5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gc2ltRXhlYyAoY29tbWFuZCwgdGltZW91dCwgYXJncyA9IFtdLCBlbnYgPSB7fSwgbG9nRXJyb3JzID0gdHJ1ZSkge1xuICByZXR1cm4gYXdhaXQgc2ltQ29tbWFuZChjb21tYW5kLCB0aW1lb3V0LCBhcmdzLCBlbnYsIGFzeW5jIChjLCBhLCBvYikgPT4ge1xuICAgIHJldHVybiBhd2FpdCBleGVjKGMsIGEsIG9iKTtcbiAgfSwgbG9nRXJyb3JzKTtcbn1cblxuLyoqXG4gKiBDcmF0ZSBhIHRlZW5fcHJvY2VzcydzIFN1YlByb2Nlc3MgaW5zdGFuY2UgZm9yIHRoZSBwYXJ0aWN1bGFyXG4gKiBzaW1jdGwgc3ViY29tbWFuZCBleGVjdXRpb24uIFRoaXMgbWlnaHQgYmUgbmVlZGVkIHRvIGdhaW4gYmV0dGVyXG4gKiBjb250cm9sIG92ZXIgdGhlIGV4ZWN1dGlvbiBwcm9jZXNzLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBjb21tYW5kIC0gU2VlIHtAbGluayBzaW1Db21tYW5kfSBwYXJhbWV0ZXJzLlxuICogQHBhcmFtIHtudW1iZXJ9IHRpbWVvdXQgLSBTZWUge0BsaW5rIHNpbUNvbW1hbmR9IHBhcmFtZXRlcnMuXG4gKiBAcGFyYW0ge0FycmF5LjxzdHJpbmc+fSBhcmdzIFtbXV0gLSBTZWUge0BsaW5rIHNpbUNvbW1hbmR9IHBhcmFtZXRlcnMuXG4gKiBAcGFyYW0ge09iamVjdH0gZW52IFt7fV0gLSBTZWUge0BsaW5rIHNpbUNvbW1hbmR9IHBhcmFtZXRlcnMuXG4gKiBAcmV0dXJuIHtTdWJQcm9jZXNzfSBUaGUgaW5zdGFuY2Ugb2YgdGVlbl9wcm9jZXNzJ3MgU3ViUHJvY2VzcyBjbGFzcy5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gc2ltU3ViUHJvY2VzcyAoY29tbWFuZCwgdGltZW91dCwgYXJncyA9IFtdLCBlbnYgPSB7fSkge1xuICByZXR1cm4gYXdhaXQgc2ltQ29tbWFuZChjb21tYW5kLCB0aW1lb3V0LCBhcmdzLCBlbnYsIChjLCBhLCBvYikgPT4ge1xuICAgIHJldHVybiBuZXcgU3ViUHJvY2VzcyhjLCBhLCBvYik7XG4gIH0pO1xufVxuXG4vKipcbiAqIEluc3RhbGwgdGhlIHBhcnRpY3VsYXIgYXBwbGljYXRpb24gcGFja2FnZSBvbiBTaW11bGF0b3IuXG4gKiBJdCBpcyByZXF1aXJlZCB0aGF0IFNpbXVsYXRvciBpcyBpbiBfYm9vdGVkXyBzdGF0ZS5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gdWRpZCAtIFRoZSBVRElEIG9mIGFuIGV4aXN0aW5nIFNpbXVsYXRvci5cbiAqIEBwYXJhbSB7c3RyaW5nfSBhcHBQYXRoIC0gRnVsbCBwYXRoIHRvIC5hcHAgcGFja2FnZSwgd2hpY2ggaXNcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgZ29pbmcgdG8gYmUgaW5zdGFsbGVkLlxuICogQHRocm93cyB7RXJyb3J9IElmIHRoZSBjb3JyZXNwb25kaW5nIHNpbWN0bCBzdWJjb21tYW5kIGNvbW1hbmRcbiAqICAgICAgICAgICAgICAgICByZXR1cm5zIG5vbi16ZXJvIHJldHVybiBjb2RlLlxuICovXG5hc3luYyBmdW5jdGlvbiBpbnN0YWxsQXBwICh1ZGlkLCBhcHBQYXRoKSB7XG4gIGF3YWl0IHNpbUV4ZWMoJ2luc3RhbGwnLCAwLCBbdWRpZCwgYXBwUGF0aF0pO1xufVxuXG4vKipcbiAqIEJvb3QgdGhlIHBhcnRpY3VsYXIgU2ltdWxhdG9yIGlmIGl0IGlzIG5vdCBydW5uaW5nLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSB1ZGlkIC0gVGhlIFVESUQgb2YgYW4gZXhpc3RpbmcgU2ltdWxhdG9yLlxuICogQHRocm93cyB7RXJyb3J9IElmIHRoZSBjb3JyZXNwb25kaW5nIHNpbWN0bCBzdWJjb21tYW5kIGNvbW1hbmRcbiAqICAgICAgICAgICAgICAgICByZXR1cm5zIG5vbi16ZXJvIHJldHVybiBjb2RlLlxuICovXG5hc3luYyBmdW5jdGlvbiBib290RGV2aWNlICh1ZGlkKSB7XG4gIHRyeSB7XG4gICAgYXdhaXQgc2ltRXhlYygnYm9vdCcsIDAsIFt1ZGlkXSk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGlmICgoZXJyLm1lc3NhZ2UgfHwgJycpLmluZGV4T2YoJ1VuYWJsZSB0byBib290IGRldmljZSBpbiBjdXJyZW50IHN0YXRlOiBCb290ZWQnKSA9PT0gLTEpIHtcbiAgICAgIHRocm93IGVycjtcbiAgICB9XG4gICAgbG9nLmRlYnVnKGBTaW11bGF0b3IgYWxyZWFkeSBpbiAnQm9vdGVkJyBzdGF0ZS4gQ29udGludWluZ2ApO1xuICB9XG59XG5cbi8qKlxuICogUmVtb3ZlIHRoZSBwYXJ0aWN1bGFyIGFwcGxpY2F0aW9uIHBhY2thZ2UgZnJvbSBTaW11bGF0b3IuXG4gKiBJdCBpcyByZXF1aXJlZCB0aGF0IFNpbXVsYXRvciBpcyBpbiBfYm9vdGVkXyBzdGF0ZSBhbmRcbiAqIHRoZSBhcHBsaWNhdGlvbiB3aXRoIGdpdmVuIGJ1bmRsZSBpZGVudGlmaWVyIGlzIGFscmVhZHkgaW5zdGFsbGVkLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSB1ZGlkIC0gVGhlIFVESUQgb2YgYW4gZXhpc3RpbmcgU2ltdWxhdG9yLlxuICogQHBhcmFtIHtzdHJpbmd9IGJ1bmRsZUlkIC0gQnVuZGxlIGlkZW50aWZpZXIgb2YgdGhlIGFwcGxpY2F0aW9uLFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2hpY2ggaXMgZ29pbmcgdG8gYmUgcmVtb3ZlZC5cbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGUgY29ycmVzcG9uZGluZyBzaW1jdGwgc3ViY29tbWFuZCBjb21tYW5kXG4gKiAgICAgICAgICAgICAgICAgcmV0dXJucyBub24temVybyByZXR1cm4gY29kZS5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gcmVtb3ZlQXBwICh1ZGlkLCBidW5kbGVJZCkge1xuICBhd2FpdCBzaW1FeGVjKCd1bmluc3RhbGwnLCAwLCBbdWRpZCwgYnVuZGxlSWRdKTtcbn1cblxuLyoqXG4gKiBFeGVjdXRlIHRoZSBwYXJ0aWN1bGFyIGFwcGxpY2F0aW9uIHBhY2thZ2Ugb24gU2ltdWxhdG9yLlxuICogSXQgaXMgcmVxdWlyZWQgdGhhdCBTaW11bGF0b3IgaXMgaW4gX2Jvb3RlZF8gc3RhdGUgYW5kXG4gKiB0aGUgYXBwbGljYXRpb24gd2l0aCBnaXZlbiBidW5kbGUgaWRlbnRpZmllciBpcyBhbHJlYWR5IGluc3RhbGxlZC5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gdWRpZCAtIFRoZSBVRElEIG9mIGFuIGV4aXN0aW5nIFNpbXVsYXRvci5cbiAqIEBwYXJhbSB7c3RyaW5nfSBidW5kbGVJZCAtIEJ1bmRsZSBpZGVudGlmaWVyIG9mIHRoZSBhcHBsaWNhdGlvbixcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdoaWNoIGlzIGdvaW5nIHRvIGJlIHJlbW92ZWQuXG4gKiBAcGFyYW0ge251bWJlcn0gdHJpZXMgWzVdIC0gVGhlIG1heGltdW0gbnVtYmVyIG9mIHJldHJpZXMgYmVmb3JlXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3dpbmcgYW4gZXhjZXB0aW9uLlxuICogQHRocm93cyB7RXJyb3J9IElmIHRoZSBjb3JyZXNwb25kaW5nIHNpbWN0bCBzdWJjb21tYW5kIGNvbW1hbmRcbiAqICAgICAgICAgICAgICAgICByZXR1cm5zIG5vbi16ZXJvIHJldHVybiBjb2RlLlxuICovXG5hc3luYyBmdW5jdGlvbiBsYXVuY2ggKHVkaWQsIGJ1bmRsZUlkLCB0cmllcyA9IDUpIHtcbiAgYXdhaXQgcmV0cnlJbnRlcnZhbCh0cmllcywgMTAwMCwgYXN5bmMgKCkgPT4ge1xuICAgIGF3YWl0IHNpbUV4ZWMoJ2xhdW5jaCcsIDAsIFt1ZGlkLCBidW5kbGVJZF0pO1xuICB9KTtcbn1cblxuLyoqXG4gKiBTcGF3biB0aGUgcGFydGljdWxhciBwcm9jZXNzIG9uIFNpbXVsYXRvci5cbiAqIEl0IGlzIHJlcXVpcmVkIHRoYXQgU2ltdWxhdG9yIGlzIGluIF9ib290ZWRfIHN0YXRlLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSB1ZGlkIC0gVGhlIFVESUQgb2YgYW4gZXhpc3RpbmcgU2ltdWxhdG9yLlxuICogQHBhcmFtIHtzdHJpbmd8QXJyYXk8c3RyaW5nPn0gYXJncyAtIFNwYXduIGFyZ3VtZW50c1xuICogQHBhcmFtIHtvYmplY3R9IGVudiBbe31dIC0gQWRkaXRpb25hbCBlbnZpcm9ubWVudCB2YXJpYWJsZXMgbWFwcGluZy5cbiAqIEByZXR1cm4ge0V4ZWNSZXN1bHR9IENvbW1hbmQgZXhlY3V0aW9uIHJlc3VsdC5cbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGUgY29ycmVzcG9uZGluZyBzaW1jdGwgc3ViY29tbWFuZCBjb21tYW5kXG4gKiAgICAgICAgICAgICAgICAgcmV0dXJucyBub24temVybyByZXR1cm4gY29kZS5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gc3Bhd24gKHVkaWQsIGFyZ3MsIGVudiA9IHt9KSB7XG4gIHJldHVybiBhd2FpdCBzaW1FeGVjKCdzcGF3bicsIDAsIFt1ZGlkLCAuLi4oXy5pc0FycmF5KGFyZ3MpID8gYXJncyA6IFthcmdzXSldLCBlbnYpO1xufVxuXG4vKipcbiAqIFByZXBhcmUgU3ViUHJvY2VzcyBpbnN0YW5jZSBmb3IgYSBuZXcgcHJvY2Vzcywgd2hpY2ggaXMgZ29pbmcgdG8gYmUgc3Bhd25lZFxuICogb24gU2ltdWxhdG9yLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSB1ZGlkIC0gVGhlIFVESUQgb2YgYW4gZXhpc3RpbmcgU2ltdWxhdG9yLlxuICogQHBhcmFtIHtzdHJpbmd8QXJyYXk8c3RyaW5nPn0gYXJncyAtIFNwYXduIGFyZ3VtZW50c1xuICogQHBhcmFtIHtvYmplY3R9IGVudiBbe31dIC0gQWRkaXRpb25hbCBlbnZpcm9ubWVudCB2YXJpYWJsZXMgbWFwcGluZy5cbiAqIEByZXR1cm4ge1N1YlByb2Nlc3N9IFRoZSBpbnN0YW5jZSBvZiB0aGUgcHJvY2VzcyB0byBiZSBzcGF3bmVkLlxuICovXG5hc3luYyBmdW5jdGlvbiBzcGF3blN1YlByb2Nlc3MgKHVkaWQsIGFyZ3MsIGVudiA9IHt9KSB7XG4gIHJldHVybiBhd2FpdCBzaW1TdWJQcm9jZXNzKCdzcGF3bicsIDAsIFt1ZGlkLCAuLi4oXy5pc0FycmF5KGFyZ3MpID8gYXJncyA6IFthcmdzXSldLCBlbnYpO1xufVxuXG4vKipcbiAqIE9wZW4gVVJMIHNjaGVtZSBvbiBTaW11bGF0b3IuIGlPUyB3aWxsIGF1dG9tYXRpY2FsbHkgdHJ5XG4gKiB0byBmaW5kIGEgbWF0Y2hpbmcgYXBwbGljYXRpb24sIHdoaWNoIHN1cHBvcnRzIHRoZSBnaXZlbiBzY2hlbWUuXG4gKiBJdCBpcyByZXF1aXJlZCB0aGF0IFNpbXVsYXRvciBpcyBpbiBfYm9vdGVkXyBzdGF0ZS5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gdWRpZCAtIFRoZSBVRElEIG9mIGFuIGV4aXN0aW5nIFNpbXVsYXRvci5cbiAqIEBwYXJhbSB7c3RyaW5nfSB1cmwgLSBUaGUgVVJMIHNjaGVtZSB0byBvcGVuLCBmb3IgZXhhbXBsZSBodHRwOi8vYXBwaW9tLmlvXG4gKiAgICAgICAgICAgICAgICAgICAgICAgd2lsbCBiZSBvcGVuZWQgYnkgdGhlIGJ1aWx0LWluIG1vYmlsZSBicm93c2VyLlxuICogQHJldHVybiB7RXhlY1Jlc3VsdH0gQ29tbWFuZCBleGVjdXRpb24gcmVzdWx0LlxuICogQHRocm93cyB7RXJyb3J9IElmIHRoZSBjb3JyZXNwb25kaW5nIHNpbWN0bCBzdWJjb21tYW5kIGNvbW1hbmRcbiAqICAgICAgICAgICAgICAgICByZXR1cm5zIG5vbi16ZXJvIHJldHVybiBjb2RlLlxuICovXG5hc3luYyBmdW5jdGlvbiBvcGVuVXJsICh1ZGlkLCB1cmwpIHtcbiAgcmV0dXJuIGF3YWl0IHNpbUV4ZWMoJ29wZW51cmwnLCAwLCBbdWRpZCwgdXJsXSk7XG59XG5cbi8qKlxuICogSW52b2tlIGhpZGRlbiBhcHBpbmZvIHN1YmNvbW1hbmQgdG8gZ2V0IHRoZSBpbmZvcm1hdGlvblxuICogYWJvdXQgYXBwbGljYXRpb25zIGluc3RhbGxlZCBvbiBTaW11bGF0b3IsIGluY2x1ZGluZ1xuICogc3lzdGVtIGFwcGxpY2F0aW9ucyAoe0BsaW5rIGdldEFwcENvbnRhaW5lcn0gZG9lcyBub3QgXCJzZWVcIiBzdWNoIGFwcHMpLlxuICogU2ltdWxhdG9yIHNlcnZlciBzaG91bGQgYmUgaW4gJ2Jvb3RlZCcgc3RhdGUgZm9yIHRoaXMgY2FsbCB0byB3b3JrIHByb3Blcmx5LlxuICogVGhlIHRvb2wgaXMgb25seSBhdmFpbGFibGUgc2luY2UgWGNvZGUgU0RLIDguMVxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSB1ZGlkIC0gVURJRCBvZiB0aGUgdGFyZ2V0IFNpbXVsYXRvci5cbiAqIEBwYXJhbSB7c3RyaW5nfSBidW5kbGVJZCAtIFRoZSBidW5kbGUgaWRlbnRpZmllciBvZiB0aGUgdGFyZ2V0IGFwcGxpY2F0aW9uLlxuICogQHJldHVybiB7c3RyaW5nfSBUaGUgaW5mb3JtYXRpb24gYWJvdXQgaW5zdGFsbGVkIGFwcGxpY2F0aW9uLlxuICpcbiAqIEV4YW1wbGUgb3V0cHV0IGZvciBub24tZXhpc3RpbmcgYXBwbGljYXRpb24gY29udGFpbmVyOlxuICogPHByZT5cbiAqIHtcbiAqICAgQ0ZCdW5kbGVJZGVudGlmaWVyID0gXCJjb20uYXBwbGUuTW9iaWxlU2FmYXJpXCI7XG4gKiAgIEdyb3VwQ29udGFpbmVycyA9ICAgICB7XG4gKiAgIH07XG4gKiAgIFNCQXBwVGFncyA9ICAgICAoXG4gKiAgICk7XG4gKiB9XG4gKiA8L3ByZT5cbiAqXG4gKiBFeGFtcGxlIG91dHB1dCBmb3IgYW4gZXhpc3Rpbmcgc3lzdGVtIGFwcGxpY2F0aW9uIGNvbnRhaW5lcjpcbiAqIDxwcmU+XG4gKiB7XG4gKiAgIEFwcGxpY2F0aW9uVHlwZSA9IEhpZGRlbjtcbiAqICAgQnVuZGxlID0gXCJmaWxlOi8vL0FwcGxpY2F0aW9ucy9YY29kZS1iZXRhLmFwcC9Db250ZW50cy9EZXZlbG9wZXIvUGxhdGZvcm1zL2lQaG9uZU9TLnBsYXRmb3JtL0RldmVsb3Blci9MaWJyYXJ5L0NvcmVTaW11bGF0b3IvUHJvZmlsZXMvUnVudGltZXMvaU9TLnNpbXJ1bnRpbWUvQ29udGVudHMvUmVzb3VyY2VzL1J1bnRpbWVSb290L1N5c3RlbS9MaWJyYXJ5L0NvcmVTZXJ2aWNlcy9TcHJpbmdCb2FyZC5hcHBcIjtcbiAqICAgQ0ZCdW5kbGVEaXNwbGF5TmFtZSA9IFNwcmluZ0JvYXJkO1xuICogICBDRkJ1bmRsZUV4ZWN1dGFibGUgPSBTcHJpbmdCb2FyZDtcbiAqICAgQ0ZCdW5kbGVJZGVudGlmaWVyID0gXCJjb20uYXBwbGUuc3ByaW5nYm9hcmRcIjtcbiAqICAgQ0ZCdW5kbGVOYW1lID0gU3ByaW5nQm9hcmQ7XG4gKiAgIENGQnVuZGxlVmVyc2lvbiA9IDUwO1xuICogICBHcm91cENvbnRhaW5lcnMgPSAgICAge1xuICogICB9O1xuICogICBQYXRoID0gXCIvQXBwbGljYXRpb25zL1hjb2RlLWJldGEuYXBwL0NvbnRlbnRzL0RldmVsb3Blci9QbGF0Zm9ybXMvaVBob25lT1MucGxhdGZvcm0vRGV2ZWxvcGVyL0xpYnJhcnkvQ29yZVNpbXVsYXRvci9Qcm9maWxlcy9SdW50aW1lcy9pT1Muc2ltcnVudGltZS9Db250ZW50cy9SZXNvdXJjZXMvUnVudGltZVJvb3QvU3lzdGVtL0xpYnJhcnkvQ29yZVNlcnZpY2VzL1NwcmluZ0JvYXJkLmFwcFwiO1xuICogICBTQkFwcFRhZ3MgPSAgICAgKFxuICogICApO1xuICogfVxuICogPC9wcmU+XG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGFwcEluZm8gKHVkaWQsIGJ1bmRsZUlkKSB7XG4gIGNvbnN0IHtzdGRvdXR9ID0gYXdhaXQgc2ltRXhlYygnYXBwaW5mbycsIDAsIFt1ZGlkLCBidW5kbGVJZF0pO1xuICByZXR1cm4gKHN0ZG91dCB8fCAnJykudHJpbSgpO1xufVxuXG4vKipcbiAqIEFkZCB0aGUgcGFydGljdWxhciBtZWRpYSBmaWxlIHRvIFNpbXVsYXRvcidzIGxpYnJhcnkuXG4gKiBJdCBpcyByZXF1aXJlZCB0aGF0IFNpbXVsYXRvciBpcyBpbiBfYm9vdGVkXyBzdGF0ZS5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gdWRpZCAtIFRoZSBVRElEIG9mIGFuIGV4aXN0aW5nIFNpbXVsYXRvci5cbiAqIEBwYXJhbSB7c3RyaW5nfSBwYXRoIC0gRnVsbCBwYXRoIHRvIGEgbWVkaWEgZmlsZSBvbiB0aGUgbG9jYWxcbiAqICAgICAgICAgICAgICAgICAgICAgICAgZmlsZSBzeXN0ZW0uXG4gKiBAcmV0dXJuIHtFeGVjUmVzdWx0fSBDb21tYW5kIGV4ZWN1dGlvbiByZXN1bHQuXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlIGNvcnJlc3BvbmRpbmcgc2ltY3RsIHN1YmNvbW1hbmQgY29tbWFuZFxuICogICAgICAgICAgICAgICAgIHJldHVybnMgbm9uLXplcm8gcmV0dXJuIGNvZGUuXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGFkZE1lZGlhICh1ZGlkLCBwYXRoKSB7XG4gIHJldHVybiBhd2FpdCBzaW1FeGVjKCdhZGRtZWRpYScsIDAsIFt1ZGlkLCBwYXRoXSk7XG59XG5cbi8qKlxuICogVGVybWluYXRlIHRoZSBnaXZlbiBydW5uaW5nIGFwcGxpY2F0aW9uIG9uIFNpbXVsYXRvci5cbiAqIEl0IGlzIHJlcXVpcmVkIHRoYXQgU2ltdWxhdG9yIGlzIGluIF9ib290ZWRfIHN0YXRlLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSB1ZGlkIC0gVGhlIFVESUQgb2YgYW4gZXhpc3RpbmcgU2ltdWxhdG9yLlxuICogQHBhcmFtIHtzdHJpbmd9IGJ1bmRsZUlkIC0gQnVuZGxlIGlkZW50aWZpZXIgb2YgdGhlIGFwcGxpY2F0aW9uLFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2hpY2ggaXMgZ29pbmcgdG8gYmUgdGVybWluYXRlZC5cbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGUgY29ycmVzcG9uZGluZyBzaW1jdGwgc3ViY29tbWFuZCBjb21tYW5kXG4gKiAgICAgICAgICAgICAgICAgcmV0dXJucyBub24temVybyByZXR1cm4gY29kZS5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gdGVybWluYXRlICh1ZGlkLCBidW5kbGVJZCkge1xuICBhd2FpdCBzaW1FeGVjKCd0ZXJtaW5hdGUnLCAwLCBbdWRpZCwgYnVuZGxlSWRdKTtcbn1cblxuLyoqXG4gKiBHZXQgdGhlIGZ1bGwgcGF0aCB0byB0aGUgcGFydGljdWxhciBhcHBsaWNhdGlvbiBjb250YWluZXJcbiAqIG9uIHRoZSBsb2NhbCBmaWxlIHN5c3RlbS4gTm90ZSwgdGhhdCB0aGlzIHN1YmNvbW1hbmQgdGhyb3dzXG4gKiBhbiBlcnJvciBpZiBidW5kbGUgaWQgb2YgYSBzeXN0ZW0gYXBwbGljYXRpb24gaXMgcHJvdmlkZWQsXG4gKiBsaWtlICdjb20uYXBwbGUuc3ByaW5nYm9hcmQnLlxuICogSXQgaXMgcmVxdWlyZWQgdGhhdCBTaW11bGF0b3IgaXMgaW4gX2Jvb3RlZF8gc3RhdGUuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHVkaWQgLSBUaGUgVURJRCBvZiBhbiBleGlzdGluZyBTaW11bGF0b3IuXG4gKiBAcGFyYW0ge3N0cmluZ30gYnVuZGxlSWQgLSBCdW5kbGUgaWRlbnRpZmllciBvZiBhbiBhcHBsaWNhdGlvbi5cbiAqIEBwYXJhbSB7P2Jvb2xlYW59IGxvZ0Vycm9ycyBbdHJ1ZV0gLSBXaGV0aGVyIHRvIGluY2x1ZGUgZXhlYydzIGNvbW1hbmRcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGRlcnIgb3V0cHV0IGludG8gZXhjZXB0aW9uIG1lc3NhZ2UgaWYgdGhyb3duLlxuICogQHBhcmFtIHs/c3RyaW5nfSBjb250YWluZXJUeXBlIC0gV2hpY2ggY29udGFpbmVyIHR5cGUgdG8gcmV0dXJuLiBQb3NzaWJsZSB2YWx1ZXNcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZSAnYXBwJywgJ2RhdGEnLCAnZ3JvdXBzJywgJzxBIHNwZWNpZmljIEFwcCBHcm91cCBjb250YWluZXI+Jy5cbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRoZSBkZWZhdWx0IHZhbHVlIGlzICdhcHAnLlxuICogQHJldHVybiB7c3RyaW5nfSBGdWxsIHBhdGggdG8gdGhlIGdpdmVuIGFwcGxpY2F0aW9uIGNvbnRhaW5lciBvbiB0aGUgbG9jYWxcbiAqICAgICAgICAgICAgICAgICAgZmlsZSBzeXN0ZW0uXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlIGNvcnJlc3BvbmRpbmcgc2ltY3RsIHN1YmNvbW1hbmQgY29tbWFuZFxuICogICAgICAgICAgICAgICAgIHJldHVybnMgbm9uLXplcm8gcmV0dXJuIGNvZGUuXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGdldEFwcENvbnRhaW5lciAodWRpZCwgYnVuZGxlSWQsIGxvZ0Vycm9ycyA9IHRydWUsIGNvbnRhaW5lclR5cGUgPSBudWxsKSB7XG4gIGNvbnN0IGFyZ3MgPSBbdWRpZCwgYnVuZGxlSWRdO1xuICBpZiAoY29udGFpbmVyVHlwZSkge1xuICAgIGFyZ3MucHVzaChjb250YWluZXJUeXBlKTtcbiAgfVxuICBjb25zdCB7c3Rkb3V0fSA9IGF3YWl0IHNpbUV4ZWMoJ2dldF9hcHBfY29udGFpbmVyJywgMCwgYXJncywge30sIGxvZ0Vycm9ycyk7XG4gIHJldHVybiAoc3Rkb3V0IHx8ICcnKS50cmltKCk7XG59XG5cbi8qKlxuICogU2h1dGRvd24gdGhlIGdpdmVuIFNpbXVsYXRvciBpZiBpdCBpcyBydW5uaW5nLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSB1ZGlkIC0gVGhlIFVESUQgb2YgYW4gZXhpc3RpbmcgU2ltdWxhdG9yLlxuICogQHRocm93cyB7RXJyb3J9IElmIHRoZSBjb3JyZXNwb25kaW5nIHNpbWN0bCBzdWJjb21tYW5kIGNvbW1hbmRcbiAqICAgICAgICAgICAgICAgICByZXR1cm5zIG5vbi16ZXJvIHJldHVybiBjb2RlLlxuICovXG5hc3luYyBmdW5jdGlvbiBzaHV0ZG93biAodWRpZCkge1xuICB0cnkge1xuICAgIGF3YWl0IHNpbUV4ZWMoJ3NodXRkb3duJywgMCwgW3VkaWRdKTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgaWYgKCEoZXJyICsgJycpLmluY2x1ZGVzKCdjdXJyZW50IHN0YXRlOiBTaHV0ZG93bicpKSB7XG4gICAgICB0aHJvdyBlcnI7XG4gICAgfVxuICAgIGxvZy5kZWJ1ZyhgU2ltdWxhdG9yIGFscmVhZHkgaW4gJ1NodXRkb3duJyBzdGF0ZS4gQ29udGludWluZ2ApO1xuICB9XG59XG5cbi8qKlxuICogQHR5cGVkZWYge09iamVjdH0gU2ltQ3JlYXRpb25PcHRzXG4gKiBAcHJvcGVydHkge3N0cmluZ30gcGxhdGZvcm0gW2lPU10gLSBQbGF0Zm9ybSBuYW1lIGluIG9yZGVyIHRvIHNwZWNpZnkgcnVudGltZSBzdWNoIGFzICdpT1MnLCAndHZPUycsICd3YXRjaE9TJ1xuICogQHByb3BlcnR5IHtudW1iZXJ9IHRpbWVvdXQgWzEwMDAwXSAtIFRoZSBtYXhpbXVtIG51bWJlciBvZiBtaWxsaXNlY29uZHMgdG8gd2FpdFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuaXQgZGV2aWNlIGNyZWF0aW9uIGlzIGNvbXBsZXRlZC5cbiAqL1xuLyoqXG4gKiBDcmVhdGUgU2ltdWxhdG9yIGRldmljZSB3aXRoIGdpdmVuIG5hbWUgZm9yIHRoZSBwYXJ0aWN1bGFyXG4gKiBwbGF0Zm9ybSB0eXBlIGFuZCB2ZXJzaW9uLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIC0gVGhlIGRldmljZSBuYW1lIHRvIGJlIGNyZWF0ZWQuXG4gKiBAcGFyYW0ge3N0cmluZ30gZGV2aWNlVHlwZUlkIC0gRGV2aWNlIHR5cGUsIGZvciBleGFtcGxlICdpUGhvbmUgNicuXG4gKiBAcGFyYW0ge3N0cmluZ30gcnVudGltZUlkIC0gUGxhdGZvcm0gdmVyc2lvbiwgZm9yIGV4YW1wbGUgJzEwLjMnLlxuICogQHBhcmFtIHs/U2ltQ3JlYXRpb25PcHRzfSBvcHRzIC0gU2ltdWxhdG9yIG9wdGlvbnMgZm9yIGNyZWF0aW5nIGRldmljZXMuXG4gKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBVRElEIG9mIHRoZSBuZXdseSBjcmVhdGVkIGRldmljZS5cbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGUgY29ycmVzcG9uZGluZyBzaW1jdGwgc3ViY29tbWFuZCBjb21tYW5kXG4gKiAgICAgICAgICAgICAgICAgcmV0dXJucyBub24temVybyByZXR1cm4gY29kZS5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gY3JlYXRlRGV2aWNlIChuYW1lLCBkZXZpY2VUeXBlSWQsIHJ1bnRpbWVJZCwgb3B0cyA9IHt9KSB7XG4gIGNvbnN0IHtcbiAgICBwbGF0Zm9ybSA9IFNJTV9SVU5USU1FX05BTUVfU1VGRklYX0lPUyxcbiAgICB0aW1lb3V0ID0gREVGQVVMVF9DUkVBVEVfU0lNVUxBVE9SX1RJTUVPVVRcbiAgfSA9IG9wdHM7XG5cbiAgLy8gYXQgZmlyc3QgbWFrZSBzdXJlIHRoYXQgdGhlIHJ1bnRpbWUgaWQgaXMgdGhlIHJpZ2h0IG9uZVxuICAvLyBpbiBzb21lIHZlcnNpb25zIG9mIFhjb2RlIGl0IHdpbGwgYmUgYSBwYXRjaCB2ZXJzaW9uXG4gIHRyeSB7XG4gICAgcnVudGltZUlkID0gYXdhaXQgZ2V0UnVudGltZUZvclBsYXRmb3JtVmVyc2lvbihydW50aW1lSWQsIHBsYXRmb3JtKTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgbG9nLndhcm4oYFVuYWJsZSB0byBmaW5kIHJ1bnRpbWUgZm9yIGlPUyAnJHtydW50aW1lSWR9Jy4gQ29udGludWluZ2ApO1xuICB9XG5cbiAgY29uc3QgY2xhbmdWZXJzaW9uID0gYXdhaXQgZ2V0Q2xhbmdWZXJzaW9uKCk7XG4gIC8vIDFzdCBjb21wYXJpc29uOiBjbGFuZ1ZlcnNpb25cbiAgLy8gQ29tbWFuZCBsaW5lIHRvb2xzIHZlcnNpb24gaXMgMTAuMissIGJ1dCB4Y29kZSAxMC4xIGNhbiBoYXBwZW5cbiAgbGV0IGlzTmV3ZXJJZEZvcm1hdFJlcXVpcmVkID0gY2xhbmdWZXJzaW9uICYmIHV0aWwuY29tcGFyZVZlcnNpb25zKGNsYW5nVmVyc2lvbiwgJz49JyxcbiAgICBDTURMSU5FX1RPT0xTX0NMQU5HX0ZPUk1BVF9DSEFOR0VEX1ZFUlNJT04pO1xuICBpZiAoIWlzTmV3ZXJJZEZvcm1hdFJlcXVpcmVkKSB7XG4gICAgLy8gMm5kIGNvbXBhcmlzb246IGdldFZlcnNpb25cbiAgICAvLyBUaGUgb3Bwb3NpdGUgY2FuIGFsc28gaGFwcGVuLFxuICAgIC8vIGJ1dCB0aGUgY29tYmluYXRpb24gb2YgMTAuMiBjb21tYW5kIGxpbmUgdG9vbHMgYW5kIGxvd2VyIFhjb2RlIHZlcnNpb24gaGFwcGVucyBtb3JlIGZyZXF1ZW50bHlcbiAgICBjb25zdCB4Y29kZVZlcnNpb24gPSBhd2FpdCBnZXRWZXJzaW9uKGZhbHNlKTtcbiAgICBpc05ld2VySWRGb3JtYXRSZXF1aXJlZCA9IHhjb2RlVmVyc2lvbiAmJiB1dGlsLmNvbXBhcmVWZXJzaW9ucyh4Y29kZVZlcnNpb24sICc+PScsXG4gICAgICBYQ09ERV9GT1JNQVRfQ0hBTkdFRF9WRVJTSU9OKTtcbiAgfVxuICBpZiAoaXNOZXdlcklkRm9ybWF0UmVxdWlyZWQpIHtcbiAgICBydW50aW1lSWQgPSBgJHtTSU1fUlVOVElNRV9OQU1FfSR7cGxhdGZvcm19LSR7cnVudGltZUlkLnJlcGxhY2UoL1xcLi9nLCAnLScpfWA7XG4gIH1cblxuICBsb2cuZGVidWcoYENyZWF0aW5nIHNpbXVsYXRvciB3aXRoIG5hbWUgJyR7bmFtZX0nLCBkZXZpY2UgdHlwZSBpZCAnJHtkZXZpY2VUeXBlSWR9JyBhbmQgcnVudGltZSBpZCAnJHtydW50aW1lSWR9J2ApO1xuICBsZXQgdWRpZDtcbiAgdHJ5IHtcbiAgICBjb25zdCBvdXQgPSBhd2FpdCBzaW1FeGVjKCdjcmVhdGUnLCAwLCBbbmFtZSwgZGV2aWNlVHlwZUlkLCBydW50aW1lSWRdKTtcbiAgICB1ZGlkID0gb3V0LnN0ZG91dC50cmltKCk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGxldCByZWFzb24gPSBlcnIubWVzc2FnZTtcbiAgICBpZiAoZXJyLnN0ZGVycikge1xuICAgICAgcmVhc29uID0gZXJyLnN0ZGVyci50cmltKCk7XG4gICAgfVxuICAgIGxvZy5lcnJvckFuZFRocm93KGBDb3VsZCBub3QgY3JlYXRlIHNpbXVsYXRvciB3aXRoIG5hbWUgJyR7bmFtZX0nLCBkZXZpY2UgYCArXG4gICAgICAgICAgICAgICAgICAgICAgYHR5cGUgaWQgJyR7ZGV2aWNlVHlwZUlkfScgYW5kIHJ1bnRpbWUgaWQgJyR7cnVudGltZUlkfScuIFJlYXNvbjogJyR7cmVhc29ufSdgKTtcbiAgfVxuXG4gIC8vIG1ha2Ugc3VyZSB0aGF0IGl0IGdldHMgb3V0IG9mIHRoZSBcIkNyZWF0aW5nXCIgc3RhdGVcbiAgbGV0IHJldHJpZXMgPSBwYXJzZUludCh0aW1lb3V0IC8gMTAwMCwgMTApO1xuICBhd2FpdCByZXRyeUludGVydmFsKHJldHJpZXMsIDEwMDAsIGFzeW5jICgpID0+IHtcbiAgICBsZXQgZGV2aWNlcyA9IGF3YWl0IGdldERldmljZXMoKTtcbiAgICBmb3IgKGNvbnN0IGRldmljZUFyciBvZiBfLnZhbHVlcyhkZXZpY2VzKSkge1xuICAgICAgZm9yIChjb25zdCBkZXZpY2Ugb2YgZGV2aWNlQXJyKSB7XG4gICAgICAgIGlmIChkZXZpY2UudWRpZCA9PT0gdWRpZCkge1xuICAgICAgICAgIGlmIChkZXZpY2Uuc3RhdGUgPT09ICdDcmVhdGluZycpIHtcbiAgICAgICAgICAgIC8vIG5lZWQgdG8gcmV0cnlcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignRGV2aWNlIHN0aWxsIGJlaW5nIGNyZWF0ZWQnKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gc3RvcCBsb29raW5nLCB3ZSdyZSBkb25lXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9KTtcblxuICByZXR1cm4gdWRpZDtcbn1cblxuLyoqXG4gKiBEZWxldGUgdGhlIHBhcnRpY3VsYXIgU2ltdWxhdG9yIGZyb20gYXZhaWxhYmxlIGRldmljZXMgbGlzdC5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gdWRpZCAtIFRoZSBVRElEIG9mIGFuIGV4aXN0aW5nIFNpbXVsYXRvci5cbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGUgY29ycmVzcG9uZGluZyBzaW1jdGwgc3ViY29tbWFuZCBjb21tYW5kXG4gKiAgICAgICAgICAgICAgICAgcmV0dXJucyBub24temVybyByZXR1cm4gY29kZS5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gZGVsZXRlRGV2aWNlICh1ZGlkKSB7XG4gIGF3YWl0IHNpbUV4ZWMoJ2RlbGV0ZScsIDAsIFt1ZGlkXSk7XG59XG5cbi8qKlxuICogUmVzZXQgdGhlIGNvbnRlbnQgYW5kIHNldHRpbmdzIG9mIHRoZSBwYXJ0aWN1bGFyIFNpbXVsYXRvci5cbiAqIEl0IGlzIHJlcXVpcmVkIHRoYXQgU2ltdWxhdG9yIGlzIGluIF9zaHV0ZG93bl8gc3RhdGUuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHVkaWQgLSBUaGUgVURJRCBvZiBhbiBleGlzdGluZyBTaW11bGF0b3IuXG4gKiBAcGFyYW0ge251bWJlcn0gdGltZW91dCBbMTAwMDBdIC0gVGhlIG1heGltdW0gbnVtYmVyIG9mIG1pbGxpc2Vjb25kcyB0byB3YWl0XG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5pdCBkZXZpY2UgcmVzZXQgaXMgY29tcGxldGVkLlxuICogQHRocm93cyB7RXJyb3J9IElmIHRoZSBjb3JyZXNwb25kaW5nIHNpbWN0bCBzdWJjb21tYW5kIGNvbW1hbmRcbiAqICAgICAgICAgICAgICAgICByZXR1cm5zIG5vbi16ZXJvIHJldHVybiBjb2RlLlxuICovXG5hc3luYyBmdW5jdGlvbiBlcmFzZURldmljZSAodWRpZCwgdGltZW91dCA9IDEwMDApIHtcbiAgbGV0IGxvb3BGbiA9IGFzeW5jICgpID0+IHtcbiAgICBhd2FpdCBzaW1FeGVjKCdlcmFzZScsIDEwMDAwLCBbdWRpZF0pO1xuICB9O1xuICAvLyByZXRyeSBlcmFzZSB3aXRoIGEgc2xlZXAgaW4gYmV0d2VlbiBiZWNhdXNlIGl0J3MgZmxha2V5XG4gIGxldCByZXRyaWVzID0gcGFyc2VJbnQodGltZW91dCAvIDIwMCwgMTApO1xuICBhd2FpdCByZXRyeUludGVydmFsKHJldHJpZXMsIDIwMCwgbG9vcEZuKTtcbn1cblxuLyoqXG4gKiBAdHlwZWRlZiB7T2JqZWN0fSBEZXZpY2VJbmZvXG4gKiBAcHJvcGVydHkge3N0cmluZ30gbmFtZSAtIFRoZSBkZXZpY2UgbmFtZS5cbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSB1ZGlkIC0gVGhlIGRldmljZSBVRElELlxuICogQHByb3BlcnR5IHtzdHJpbmd9IHN0YXRlIC0gVGhlIGN1cnJlbnQgU2ltdWxhdG9yIHN0YXRlLCBmb3IgZXhhbXBsZSAnYm9vdGVkJyBvciAnc2h1dGRvd24nLlxuICogQHByb3BlcnR5IHtzdHJpbmd9IHNkayAtIFRoZSBTREsgdmVyc2lvbiwgZm9yIGV4YW1wbGUgJzEwLjMnLlxuICovXG5cbi8qKlxuICogUGFyc2UgdGhlIGxpc3Qgb2YgZXhpc3RpbmcgU2ltdWxhdG9yIGRldmljZXMgdG8gcmVwcmVzZW50XG4gKiBpdCBhcyBjb252ZW5pZW50IG1hcHBpbmcuXG4gKlxuICogQHBhcmFtIHs/c3RyaW5nfSBwbGF0Zm9ybSAtIFRoZSBwbGF0Zm9ybSBuYW1lLCBmb3IgZXhhbXBsZSAnd2F0Y2hPUycuXG4gKiBAcmV0dXJuIHtPYmplY3R9IFRoZSByZXN1bHRpbmcgbWFwcGluZy4gRWFjaCBrZXkgaXMgcGxhdGZvcm0gdmVyc2lvbixcbiAqICAgICAgICAgICAgICAgICAgZm9yIGV4YW1wbGUgJzEwLjMnIGFuZCB0aGUgY29ycmVzcG9uZGluZyB2YWx1ZSBpcyBhblxuICogICAgICAgICAgICAgICAgICBhcnJheSBvZiB0aGUgbWF0Y2hpbmcge0BsaW5rIERldmljZUluZm99IGluc3RhbmNlcy5cbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGUgY29ycmVzcG9uZGluZyBzaW1jdGwgc3ViY29tbWFuZCBjb21tYW5kXG4gKiAgICAgICAgICAgICAgICAgcmV0dXJucyBub24temVybyByZXR1cm4gY29kZS5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gZ2V0RGV2aWNlc0J5UGFyc2luZyAocGxhdGZvcm0pIHtcbiAgLy8gZ2V0IHRoZSBsaXN0IG9mIGRldmljZXNcbiAgY29uc3Qge3N0ZG91dH0gPSBhd2FpdCBzaW1FeGVjKCdsaXN0JywgMCwgWydkZXZpY2VzJ10pO1xuXG4gIC8vIGV4cGVjdCB0byBnZXQgYSBsaXN0aW5nIGxpa2VcbiAgLy8gLS0gaU9TIDguMSAtLVxuICAvLyAgICAgaVBob25lIDRzICgzQ0E2RTdERC0yMjBFLTQ1RTUtQjcxNi0xRTk5MkIzQTQyOUMpIChTaHV0ZG93bilcbiAgLy8gICAgIC4uLlxuICAvLyAtLSBpT1MgOC4yIC0tXG4gIC8vICAgICBpUGhvbmUgNHMgKEE5OUZGRkMzLThFMTktNERDRi1CNTg1LTdEOUQ0NkI0QzE2RSkgKFNodXRkb3duKVxuICAvLyAgICAgLi4uXG4gIC8vIHNvLCBnZXQgdGhlIGAtLSBpT1MgWC5YIC0tYCBsaW5lIHRvIGZpbmQgdGhlIHNkayAoWC5YKVxuICAvLyBhbmQgdGhlIHJlc3Qgb2YgdGhlIGxpc3RpbmcgaW4gb3JkZXIgdG8gbGF0ZXIgZmluZCB0aGUgZGV2aWNlc1xuICBjb25zdCBkZXZpY2VTZWN0aW9uUmUgPSBfLmlzRW1wdHkocGxhdGZvcm0pXG4gICAgPyBuZXcgUmVnRXhwKGBcXFxcLVxcXFwtXFxcXHMrKFxcXFxTKylcXFxccysoXFxcXFMrKVxcXFxzK1xcXFwtXFxcXC0oXFxcXG5cXFxcc3s0fS4rKSpgLCAnbWdpJylcbiAgICA6IG5ldyBSZWdFeHAoYFxcXFwtXFxcXC1cXFxccyske18uZXNjYXBlUmVnRXhwKHBsYXRmb3JtKX1cXFxccysoXFxcXFMrKVxcXFxzK1xcXFwtXFxcXC0oXFxcXG5cXFxcc3s0fS4rKSpgLCAnbWdpJyk7XG4gIGNvbnN0IG1hdGNoZXMgPSBbXTtcbiAgbGV0IG1hdGNoO1xuICAvLyBtYWtlIGFuIGVudHJ5IGZvciBlYWNoIHNkayB2ZXJzaW9uXG4gIHdoaWxlICgobWF0Y2ggPSBkZXZpY2VTZWN0aW9uUmUuZXhlYyhzdGRvdXQpKSkge1xuICAgIG1hdGNoZXMucHVzaChtYXRjaCk7XG4gIH1cbiAgaWYgKF8uaXNFbXB0eShtYXRjaGVzKSkge1xuICAgIHRocm93IG5ldyBFcnJvcignQ291bGQgbm90IGZpbmQgZGV2aWNlIHNlY3Rpb24nKTtcbiAgfVxuXG4gIGNvbnN0IGxpbmVSZSA9IC8oW15cXHNdLispIFxcKChcXHcrLS4rXFx3KylcXCkgXFwoKFxcdytcXHM/XFx3KylcXCkvOyAvLyBodHRwczovL3JlZ2V4MTAxLmNvbS9yL2xHN21LNi8zXG4gIC8vIGdldCBhbGwgdGhlIGRldmljZXMgZm9yIGVhY2ggc2RrXG4gIGNvbnN0IGRldmljZXMgPSB7fTtcbiAgZm9yIChtYXRjaCBvZiBtYXRjaGVzKSB7XG4gICAgY29uc3Qgc2RrID0gcGxhdGZvcm0gPyBtYXRjaFsxXSA6IG1hdGNoWzJdO1xuICAgIGRldmljZXNbc2RrXSA9IGRldmljZXNbc2RrXSB8fCBbXTtcbiAgICAvLyBzcGxpdCB0aGUgZnVsbCBtYXRjaCBpbnRvIGxpbmVzIGFuZCByZW1vdmUgdGhlIGZpcnN0XG4gICAgZm9yIChjb25zdCBsaW5lIG9mIG1hdGNoWzBdLnNwbGl0KCdcXG4nKS5zbGljZSgxKSkge1xuICAgICAgaWYgKGxpbmUuaW5jbHVkZXMoJyh1bmF2YWlsYWJsZSwgJykpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICAvLyBhIGxpbmUgaXMgc29tZXRoaW5nIGxpa2VcbiAgICAgIC8vICAgIGlQaG9uZSA0cyAoQTk5RkZGQzMtOEUxOS00RENGLUI1ODUtN0Q5RDQ2QjRDMTZFKSAoU2h1dGRvd24pXG4gICAgICAvLyByZXRyaWV2ZTpcbiAgICAgIC8vICAgaVBob25lIDRzXG4gICAgICAvLyAgIEE5OUZGRkMzLThFMTktNERDRi1CNTg1LTdEOUQ0NkI0QzE2RVxuICAgICAgLy8gICBTaHV0ZG93blxuICAgICAgY29uc3QgbGluZU1hdGNoID0gbGluZVJlLmV4ZWMobGluZSk7XG4gICAgICBpZiAoIWxpbmVNYXRjaCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYENvdWxkIG5vdCBtYXRjaCBsaW5lOiAke2xpbmV9YCk7XG4gICAgICB9XG4gICAgICAvLyBzYXZlIHRoZSB3aG9sZSB0aGluZyBhcyBhYiBvYmplY3QgaW4gdGhlIGxpc3QgZm9yIHRoaXMgc2RrXG4gICAgICBkZXZpY2VzW3Nka10ucHVzaCh7XG4gICAgICAgIG5hbWU6IGxpbmVNYXRjaFsxXSxcbiAgICAgICAgdWRpZDogbGluZU1hdGNoWzJdLFxuICAgICAgICBzdGF0ZTogbGluZU1hdGNoWzNdLFxuICAgICAgICBzZGssXG4gICAgICAgIHBsYXRmb3JtOiBwbGF0Zm9ybSB8fCBtYXRjaFsxXSxcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuICByZXR1cm4gZGV2aWNlcztcbn1cblxuLyoqXG4gKiBQYXJzZSB0aGUgbGlzdCBvZiBleGlzdGluZyBTaW11bGF0b3IgZGV2aWNlcyB0byByZXByZXNlbnRcbiAqIGl0IGFzIGNvbnZlbmllbnQgbWFwcGluZyBmb3IgdGhlIHBhcnRpY3VsYXIgcGxhdGZvcm0gdmVyc2lvbi5cbiAqXG4gKiBAcGFyYW0gez9zdHJpbmd9IGZvclNkayAtIFRoZSBzZGsgdmVyc2lvbixcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIHdoaWNoIHRoZSBkZXZpY2VzIGxpc3Qgc2hvdWxkIGJlIHBhcnNlZCxcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGV4YW1wbGUgJzEwLjMnLlxuICogQHBhcmFtIHs/c3RyaW5nfSBwbGF0Zm9ybSAtIFRoZSBwbGF0Zm9ybSBuYW1lLCBmb3IgZXhhbXBsZSAnd2F0Y2hPUycuXG4gKiBAcmV0dXJuIHtPYmplY3R8QXJyYXk8RGV2aWNlSW5mbz59IElmIF9mb3JTZGtfIGlzIHNldCB0aGVuIHRoZSBsaXN0XG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9mIGRldmljZXMgZm9yIHRoZSBwYXJ0aWN1bGFyIHBsYXRmb3JtIHZlcnNpb24uXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE90aGVyd2lzZSB0aGUgc2FtZSByZXN1bHQgYXMgZm9yIHtAbGluayBnZXREZXZpY2VzQnlQYXJzaW5nfVxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbi5cbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGUgY29ycmVzcG9uZGluZyBzaW1jdGwgc3ViY29tbWFuZCBjb21tYW5kXG4gKiAgICAgICAgICAgICAgICAgcmV0dXJucyBub24temVybyByZXR1cm4gY29kZSBvciBpZiBubyBtYXRjaGluZ1xuICogICAgICAgICAgICAgICAgIHBsYXRmb3JtIHZlcnNpb24gaXMgZm91bmQgaW4gdGhlIHN5c3RlbS5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gZ2V0RGV2aWNlcyAoZm9yU2RrLCBwbGF0Zm9ybSkge1xuICBsZXQgZGV2aWNlcyA9IHt9O1xuICB0cnkge1xuICAgIGNvbnN0IHtzdGRvdXR9ID0gYXdhaXQgc2ltRXhlYygnbGlzdCcsIDAsIFsnZGV2aWNlcycsICctaiddKTtcbiAgICAvKiBKU09OIHNob3VsZCBiZVxuICAgICAqIHtcbiAgICAgKiAgIFwiZGV2aWNlc1wiIDoge1xuICAgICAqICAgICBcImlPUyA8c2RrPlwiIDogWyAvLyBvclxuICAgICAqICAgICBcImNvbS5hcHBsZS5Db3JlU2ltdWxhdG9yLlNpbVJ1bnRpbWUuaU9TLTxzZGs+IDogW1xuICAgICAqICAgICAgIHtcbiAgICAgKiAgICAgICAgIFwic3RhdGVcIiA6IFwiQm9vdGVkXCIsXG4gICAgICogICAgICAgICBcImF2YWlsYWJpbGl0eVwiIDogXCIoYXZhaWxhYmxlKVwiLFxuICAgICAqICAgICAgICAgXCJpc0F2YWlsYWJsZVwiIDogdHJ1ZSxcbiAgICAgKiAgICAgICAgIFwibmFtZVwiIDogXCJpUGhvbmUgNlwiLFxuICAgICAqICAgICAgICAgXCJ1ZGlkXCIgOiBcIjc1RTM0MTQwLTE4RTgtNEQxQS05RjQ1LUFBQzczNURGNzVERlwiXG4gICAgICogICAgICAgfVxuICAgICAqICAgICBdXG4gICAgICogICB9XG4gICAgICogfVxuICAgICAqL1xuICAgIGNvbnN0IHZlcnNpb25NYXRjaFJlID0gXy5pc0VtcHR5KHBsYXRmb3JtKVxuICAgICAgPyBuZXcgUmVnRXhwKGBeKFteXFxcXHMtXSspW1xcXFxzLV0oXFxcXFMrKWAsICdpJylcbiAgICAgIDogbmV3IFJlZ0V4cChgXiR7Xy5lc2NhcGVSZWdFeHAocGxhdGZvcm0pfVtcXFxccy1dKFxcXFxTKylgLCAnaScpO1xuICAgIGZvciAobGV0IFtzZGtOYW1lLCBlbnRyaWVzXSBvZiBfLnRvUGFpcnMoSlNPTi5wYXJzZShzdGRvdXQpLmRldmljZXMpKSB7XG4gICAgICAvLyB0aGVyZSBjb3VsZCBiZSBhIGxvbmdlciBuYW1lLCBzbyByZW1vdmUgaXRcbiAgICAgIHNka05hbWUgPSBzZGtOYW1lLnJlcGxhY2UoU0lNX1JVTlRJTUVfTkFNRSwgJycpO1xuICAgICAgY29uc3QgdmVyc2lvbk1hdGNoID0gdmVyc2lvbk1hdGNoUmUuZXhlYyhzZGtOYW1lKTtcbiAgICAgIGlmICghdmVyc2lvbk1hdGNoKSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuXG4gICAgICAvLyB0aGUgc2RrIGNhbiBoYXZlIGRhc2hlcyAoYDEyLTJgKSBvciBkb3RzIChgMTIuMWApXG4gICAgICBjb25zdCBzZGsgPSAocGxhdGZvcm0gPyB2ZXJzaW9uTWF0Y2hbMV0gOiB2ZXJzaW9uTWF0Y2hbMl0pLnJlcGxhY2UoJy0nLCAnLicpO1xuICAgICAgZGV2aWNlc1tzZGtdID0gZGV2aWNlc1tzZGtdIHx8IFtdO1xuICAgICAgZGV2aWNlc1tzZGtdLnB1c2goLi4uZW50cmllcy5maWx0ZXIoKGVsKSA9PiBfLmlzVW5kZWZpbmVkKGVsLmlzQXZhaWxhYmxlKSB8fCBlbC5pc0F2YWlsYWJsZSlcbiAgICAgICAgLm1hcCgoZWwpID0+IHtcbiAgICAgICAgICBkZWxldGUgZWwuYXZhaWxhYmlsaXR5O1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBzZGssXG4gICAgICAgICAgICAuLi5lbCxcbiAgICAgICAgICAgIHBsYXRmb3JtOiBwbGF0Zm9ybSB8fCB2ZXJzaW9uTWF0Y2hbMV0sXG4gICAgICAgICAgfTtcbiAgICAgICAgfSlcbiAgICAgICk7XG4gICAgfVxuICB9IGNhdGNoIChlcnIpIHtcbiAgICBsb2cuZGVidWcoYFVuYWJsZSB0byBnZXQgSlNPTiBkZXZpY2UgbGlzdDogJHtlcnIuc3RhY2t9YCk7XG4gICAgbG9nLmRlYnVnKCdGYWxsaW5nIGJhY2sgdG8gbWFudWFsIHBhcnNpbmcnKTtcbiAgICBkZXZpY2VzID0gYXdhaXQgZ2V0RGV2aWNlc0J5UGFyc2luZyhwbGF0Zm9ybSk7XG4gIH1cblxuICBpZiAoIWZvclNkaykge1xuICAgIHJldHVybiBkZXZpY2VzO1xuICB9XG4gIC8vIGlmIGEgYGZvclNka2Agd2FzIHBhc3NlZCBpbiwgcmV0dXJuIG9ubHkgdGhlIGNvcnJlc3BvbmRpbmcgbGlzdFxuICBpZiAoZGV2aWNlc1tmb3JTZGtdKSB7XG4gICAgcmV0dXJuIGRldmljZXNbZm9yU2RrXTtcbiAgfVxuXG4gIGxldCBlcnJNc2cgPSBgJyR7Zm9yU2RrfScgZG9lcyBub3QgZXhpc3QgaW4gdGhlIGxpc3Qgb2Ygc2ltY3RsIFNES3MuYDtcbiAgY29uc3QgYXZhaWxhYmxlU0RLcyA9IF8ua2V5cyhkZXZpY2VzKTtcbiAgZXJyTXNnICs9IGF2YWlsYWJsZVNES3MubGVuZ3RoXG4gICAgPyBgIE9ubHkgdGhlIGZvbGxvd2luZyBTaW11bGF0b3IgU0RLIHZlcnNpb25zIGFyZSBhdmFpbGFibGUgb24geW91ciBzeXN0ZW06ICR7YXZhaWxhYmxlU0RLcy5qb2luKCcsICcpfWBcbiAgICA6IGAgTm8gU2ltdWxhdG9yIFNESyB2ZXJzaW9ucyBhcmUgYXZhaWxhYmxlIG9uIHlvdXIgc3lzdGVtLiBQbGVhc2UgaW5zdGFsbCBzb21lIHZpYSBYY29kZSBwcmVmZXJlbmNlcy5gO1xuICB0aHJvdyBuZXcgRXJyb3IoZXJyTXNnKTtcbn1cblxuXG4vKipcbiAqIEdldCB0aGUgcnVudGltZSBmb3IgdGhlIHBhcnRpY3VsYXIgcGxhdGZvcm0gdmVyc2lvbi5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gcGxhdGZvcm1WZXJzaW9uIC0gVGhlIHBsYXRmb3JtIHZlcnNpb24gbmFtZSxcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgZXhhbXBsZSAnMTAuMycuXG4gKiBAcGFyYW0gez9zdHJpbmd9IHBsYXRmb3JtIC0gVGhlIHBsYXRmb3JtIG5hbWUsIGZvciBleGFtcGxlICd3YXRjaE9TJy5cbiAqIEByZXR1cm4ge3N0cmluZ30gVGhlIGNvcnJlc3BvbmRpbmcgcnVudGltZSBuYW1lIGZvciB0aGUgZ2l2ZW5cbiAqICAgICAgICAgICAgICAgICAgcGxhdGZvcm0gdmVyc2lvbi5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gZ2V0UnVudGltZUZvclBsYXRmb3JtVmVyc2lvbiAocGxhdGZvcm1WZXJzaW9uLCBwbGF0Zm9ybSA9ICdpT1MnKSB7XG4gIHRyeSB7XG4gICAgY29uc3Qge3N0ZG91dH0gPSBhd2FpdCBzaW1FeGVjKCdsaXN0JywgMCwgWydydW50aW1lcyddKTtcbiAgICAvLyBodHRwczovL3JlZ2V4MTAxLmNvbS9yL1V5a2pRWi8xXG4gICAgY29uc3QgcnVudGltZVJlID0gbmV3IFJlZ0V4cChgJHtfLmVzY2FwZVJlZ0V4cChwbGF0Zm9ybSl9XFxcXHMrKFxcXFxkK1xcXFwuXFxcXGQrKVxcXFxzK1xcXFwoKFxcXFxkK1xcXFwuXFxcXGQrXFxcXC4qXFxcXGQqKWAsICdpJyk7XG4gICAgZm9yIChjb25zdCBsaW5lIG9mIHN0ZG91dC5zcGxpdCgnXFxuJykpIHtcbiAgICAgIGNvbnN0IG1hdGNoID0gcnVudGltZVJlLmV4ZWMobGluZSk7XG4gICAgICBpZiAobWF0Y2ggJiYgbWF0Y2hbMV0gPT09IHBsYXRmb3JtVmVyc2lvbikge1xuICAgICAgICByZXR1cm4gbWF0Y2hbMl07XG4gICAgICB9XG4gICAgfVxuICB9IGNhdGNoIChpZ24pIHt9XG5cbiAgLy8gaWYgbm90aGluZyB3YXMgZm91bmQsIHBhc3MgcGxhdGZvcm0gdmVyc2lvbiBiYWNrXG4gIHJldHVybiBwbGF0Zm9ybVZlcnNpb247XG59XG5cbi8qKlxuICogR2V0cyBiYXNlNjQgc2NyZWVuc2hvdCBmb3IgZGV2aWNlICh4Y29kZSA+PSA4LjEgb25seSkuXG4gKiBJdCBpcyByZXF1aXJlZCB0aGF0IFNpbXVsYXRvciBpcyBpbiBfYm9vdGVkXyBzdGF0ZS5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gdWRpZCAtIFRoZSBVRElEIG9mIGFuIGV4aXN0aW5nIFNpbXVsYXRvci5cbiAqIEByZXR1cm4ge3N0cmluZ30gQmFzZTY0LWVuY29kZWQgU2ltdWxhdG9yIHNjcmVlbnNob3QuXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlIGNvcnJlc3BvbmRpbmcgc2ltY3RsIHN1YmNvbW1hbmQgY29tbWFuZFxuICogICAgICAgICAgICAgICAgIHJldHVybnMgbm9uLXplcm8gcmV0dXJuIGNvZGUuXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGdldFNjcmVlbnNob3QgKHVkaWQpIHtcbiAgbGV0IHBhdGhUb1NjcmVlbnNob3RQbmcgPSBhd2FpdCB0ZW1wRGlyLnBhdGgoe3ByZWZpeDogYHNjcmVlbnNob3QtJHt1ZGlkfWAsIHN1ZmZpeDogJy5wbmcnfSk7XG4gIGF3YWl0IHNpbUV4ZWMoJ2lvJywgMCwgW3VkaWQsICdzY3JlZW5zaG90JywgcGF0aFRvU2NyZWVuc2hvdFBuZ10pO1xuICBsZXQgc2NyZWVuc2hvdEltZyA9IGF3YWl0IGZzLnJlYWRGaWxlKHBhdGhUb1NjcmVlbnNob3RQbmcpO1xuICBhd2FpdCBmcy5yaW1yYWYocGF0aFRvU2NyZWVuc2hvdFBuZyk7XG4gIHJldHVybiBzY3JlZW5zaG90SW1nLnRvU3RyaW5nKCdiYXNlNjQnKTtcbn1cblxuLyoqXG4gKiBTZXQgdGhlIGNvbnRlbnQgb2YgU2ltdWxhdG9yIHBhc3RlYm9hcmQgKHhjb2RlID49IDguMSBvbmx5KS5cbiAqIEl0IGlzIHJlcXVpcmVkIHRoYXQgU2ltdWxhdG9yIGlzIGluIF9ib290ZWRfIHN0YXRlLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSB1ZGlkIC0gRGV2aWNlIFVESUQuXG4gKiBAcGFyYW0ge3N0cmluZ30gY29udGVudCAtIFRoZSBhY3R1YWwgc3RyaW5nIGNvbnRlbnQgdG8gYmUgc2V0LlxuICogQHBhcmFtIHtzdHJpbmd9IGVuY29kaW5nIFsndXRmLTgnXSAtIFRoZSBlbmNvZGluZyBvZiB0aGUgZ2l2ZW4gcGFzdGVib2FyZCBjb250ZW50LlxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFVURi04IGJ5IGRlZmF1bHQuXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlIGNvcnJlc3BvbmRpbmcgc2ltY3RsIHN1YmNvbW1hbmQgY29tbWFuZFxuICogICAgICAgICAgICAgICAgIHJldHVybnMgbm9uLXplcm8gcmV0dXJuIGNvZGUuXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHNldFBhc3RlYm9hcmQgKHVkaWQsIGNvbnRlbnQsIGVuY29kaW5nID0gJ3V0Zi04Jykge1xuICBjb25zdCBwYkNvcHlTdWJwcm9jZXNzID0gbmV3IFN1YlByb2Nlc3MoJ3hjcnVuJywgWydzaW1jdGwnLCAncGJjb3B5JywgdWRpZF0pO1xuICBhd2FpdCBwYkNvcHlTdWJwcm9jZXNzLnN0YXJ0KDApO1xuICBjb25zdCBleGl0Q29kZVZlcmlmaWVyID0gcGJDb3B5U3VicHJvY2Vzcy5qb2luKCk7XG4gIGNvbnN0IHN0ZGluID0gcGJDb3B5U3VicHJvY2Vzcy5wcm9jLnN0ZGluO1xuICBzdGRpbi5zZXRFbmNvZGluZyhlbmNvZGluZyk7XG4gIHN0ZGluLndyaXRlKGNvbnRlbnQpO1xuICBzdGRpbi5lbmQoKTtcbiAgYXdhaXQgZXhpdENvZGVWZXJpZmllcjtcbn1cblxuLyoqXG4gKiBHZXQgdGhlIGNvbnRlbnQgb2YgU2ltdWxhdG9yIHBhc3RlYm9hcmQgKHhjb2RlID49IDguMSBvbmx5KS5cbiAqIEl0IGlzIHJlcXVpcmVkIHRoYXQgU2ltdWxhdG9yIGlzIGluIF9ib290ZWRfIHN0YXRlLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSB1ZGlkIC0gRGV2aWNlIFVESUQuXG4gKiBAcGFyYW0ge3N0cmluZ30gZW5jb2RpbmcgWyd1dGYtOCddIC0gVGhlIGVuY29kaW5nIG9mIHRoZSByZXR1cm5lZCBwYXN0ZWJvYXJkIGNvbnRlbnQuXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVVRGLTggYnkgZGVmYXVsdC5cbiAqIEByZXR1cm4ge3N0cmluZ30gQ3VycmVudCBjb250ZW50IG9mIFNpbXVsYXRvciBwYXN0ZWJvYXJkIG9yIGFuIGVtcHR5IHN0cmluZy5cbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGUgY29ycmVzcG9uZGluZyBzaW1jdGwgc3ViY29tbWFuZCBjb21tYW5kXG4gKiAgICAgICAgICAgICAgICAgcmV0dXJucyBub24temVybyByZXR1cm4gY29kZS5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gZ2V0UGFzdGVib2FyZCAodWRpZCwgZW5jb2RpbmcgPSAndXRmLTgnKSB7XG4gIGNvbnN0IGFyZ3MgPSBbJ3NpbWN0bCcsICdwYnBhc3RlJywgdWRpZF07XG4gIHRyeSB7XG4gICAgY29uc3Qge3N0ZG91dH0gPSBhd2FpdCBleGVjKCd4Y3J1bicsIGFyZ3MsIHt0aW1lb3V0OiAwLCBlbmNvZGluZ30pO1xuICAgIHJldHVybiBzdGRvdXQ7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBpZiAoZS5zdGRlcnIpIHtcbiAgICAgIGxvZy5lcnJvckFuZFRocm93KGBFcnJvciBydW5uaW5nICd4Y3J1biAke2FyZ3Muam9pbignICcpfSc6ICR7ZS5zdGRlcnIudHJpbSgpfWApO1xuICAgIH0gZWxzZSB7XG4gICAgICBsb2cuZXJyb3JBbmRUaHJvdyhlKTtcbiAgICB9XG4gIH1cbn1cblxuLyoqXG4gKiBHZXQgdGhlIGxpc3Qgb2YgZGV2aWNlIHR5cGVzIGF2YWlsYWJsZSBpbiB0aGUgY3VycmVudCBYY29kZSBpbnN0YWxsYXRpb25cbiAqXG4gKiBAcmV0dXJuIHtBcnJheTxzdHJpbmc+fSBMaXN0IG9mIHRoZSB0eXBlcyBvZiBkZXZpY2VzIGF2YWlsYWJsZVxuICogQHRocm93cyB7RXJyb3J9IElmIHRoZSBjb3JyZXNwb25kaW5nIHNpbWN0bCBjb21tYW5kIGZhaWxzXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGdldERldmljZVR5cGVzICgpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCB7c3Rkb3V0fSA9IGF3YWl0IHNpbUV4ZWMoJ2xpc3QnLCAwLCBbJ2RldmljZXR5cGVzJywgJy1qJ10pO1xuICAgIC8qXG4gICAgICogSlNPTiB3aWxsIGJlIGxpa2U6XG4gICAgICogICB7XG4gICAgICogICAgIFwiZGV2aWNldHlwZXNcIiA6IFtcbiAgICAgKiAgICAgICB7XG4gICAgICogICAgICAgICBcIm5hbWVcIiA6IFwiaVBob25lIDRzXCIsXG4gICAgICogICAgICAgICBcImlkZW50aWZpZXJcIiA6IFwiY29tLmFwcGxlLkNvcmVTaW11bGF0b3IuU2ltRGV2aWNlVHlwZS5pUGhvbmUtNHNcIlxuICAgICAqICAgICAgIH0sXG4gICAgICogICAgICAgLi4uXG4gICAgICogICB9XG4gICAgICovXG4gICAgY29uc3QgZGV2aWNlVHlwZXMgPSBKU09OLnBhcnNlKHN0ZG91dC50cmltKCkpO1xuICAgIHJldHVybiBkZXZpY2VUeXBlcy5kZXZpY2V0eXBlcy5tYXAoKHR5cGUpID0+IHR5cGUubmFtZSk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGxldCBtc2cgPSBgVW5hYmxlIHRvIGdldCBsaXN0IG9mIGRldmljZSB0eXBlczogJHtlcnIubWVzc2FnZX1gO1xuICAgIGlmIChlcnIuc3RkZXJyKSB7XG4gICAgICBtc2cgPSBgJHttc2d9LiBTdGRlcnI6ICR7ZXJyLnN0ZGVycn1gO1xuICAgIH1cbiAgICB0aHJvdyBuZXcgRXJyb3IobXNnKTtcbiAgfVxufVxuXG4vKipcbiAqIEB0eXBlZGVmIHtPYmplY3R9IEJvb3RNb25pdG9yT3B0aW9uc1xuICogQHByb3BlcnR5IHs/bnVtYmVyfSB0aW1lb3V0IFsyNDAwMDBdIC0gU2ltdWxhdG9yIGJvb3RpbmcgdGltZW91dCBpbiBtcy5cbiAqIEBwcm9wZXJ0eSB7P0Z1bmN0aW9ufSBvbldhaXRpbmdEYXRhTWlncmF0aW9uIC0gVGhpcyBldmVudCBpcyBmaXJlZCB3aGVuIGRhdGEgbWlncmF0aW9uIHN0YWdlIHN0YXJ0cy5cbiAqIEBwcm9wZXJ0eSB7P0Z1bmN0aW9ufSBvbldhaXRpbmdTeXN0ZW1BcHAgLSBUaGlzIGV2ZW50IGlzIGZpcmVkIHdoZW4gc3lzdGVtIGFwcCB3YWl0IHN0YWdlIHN0YXJ0cy5cbiAqIEBwcm9wZXJ0eSB7P0Z1bmN0aW9ufSBvbkZpbmlzaGVkIC0gVGhpcyBldmVudCBpcyBmaXJlZCB3aGVuIFNpbXVsYXRvciBpcyBmdWxseSBib290ZWQuXG4gKiBAcHJvcGVydHkgez9GdW5jdGlvbn0gb25FcnJvciAtIFRoaXMgZXZlbnQgaXMgZmlyZWQgd2hlbiB0aGVyZSB3YXMgYW4gZXJyb3Igd2hpbGUgbW9uaXRvcmluZyB0aGUgYm9vdGluZyBwcm9jZXNzXG4gKiBvciB3aGVuIHRoZSB0aW1lb3V0IGhhcyBleHBpcmVkLlxuICovXG5cbi8qKlxuICogU3RhcnQgbW9uaXRvcmluZyBmb3IgYm9vdCBzdGF0dXMgb2YgdGhlIHBhcnRpY3VsYXIgU2ltdWxhdG9yLlxuICogSWYgb25GaW5pc2hlZCBwcm9wZXJ0eSBpcyBub3Qgc2V0IHRoZW4gdGhlIG1ldGhvZCB3aWxsIGJsb2NrXG4gKiB1bnRpbCBTaW11bGF0b3IgYm9vdGluZyBpcyBjb21wbGV0ZWQuXG4gKiBUaGUgbWV0aG9kIGlzIG9ubHkgYXZhaWxhYmxlIHNpbmNlIFhjb2RlOC5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gdWRpZCAtIERldmljZSBVRElELlxuICogQHBhcmFtIHs/Qm9vdE1vbml0b3JPcHRpb25zfSBvcHRzIC0gTW9uaXRvcmluZyBvcHRpb25zLlxuICogQHJldHVybnMge1N1YlByb2Nlc3N9IFRoZSBpbnN0YW5jZSBvZiB0aGUgY29ycmVzcG9uZGluZyBtb25pdG9yaW5nIHByb2Nlc3MuXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlIFNpbXVsYXRvciBmYWlscyB0byBmaW5pc2ggYm9vdGluZyB3aXRoaW4gdGhlIGdpdmVuIHRpbWVvdXQgYW5kIG9uRmluaXNoZWRcbiAqIHByb3BlcnR5IGlzIG5vdCBzZXQuXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHN0YXJ0Qm9vdE1vbml0b3IgKHVkaWQsIG9wdHMgPSB7fSkge1xuICBjb25zdCB7XG4gICAgdGltZW91dCA9IDI0MDAwMCxcbiAgICBvbldhaXRpbmdEYXRhTWlncmF0aW9uLFxuICAgIG9uV2FpdGluZ1N5c3RlbUFwcCxcbiAgICBvbkZpbmlzaGVkLFxuICAgIG9uRXJyb3IsXG4gIH0gPSBvcHRzO1xuXG4gIGxldCBzdGF0dXMgPSAnJztcbiAgbGV0IGlzQm9vdGluZ0ZpbmlzaGVkID0gZmFsc2U7XG4gIGxldCBlcnJvciA9IG51bGw7XG4gIGxldCB0aW1lb3V0SGFuZGxlciA9IG51bGw7XG4gIGNvbnN0IGJvb3RNb25pdG9yID0gYXdhaXQgc2ltU3ViUHJvY2VzcygnYm9vdHN0YXR1cycsIDAsIFt1ZGlkXSk7XG4gIGJvb3RNb25pdG9yLm9uKCdvdXRwdXQnLCAoc3Rkb3V0LCBzdGRlcnIpID0+IHtcbiAgICBzdGF0dXMgKz0gc3Rkb3V0IHx8IHN0ZGVycjtcbiAgICBpZiAoc3Rkb3V0KSB7XG4gICAgICBpZiAoc3Rkb3V0LmluY2x1ZGVzKCdXYWl0aW5nIG9uIERhdGEgTWlncmF0aW9uJykgJiYgb25XYWl0aW5nRGF0YU1pZ3JhdGlvbikge1xuICAgICAgICBvbldhaXRpbmdEYXRhTWlncmF0aW9uKCk7XG4gICAgICB9IGVsc2UgaWYgKHN0ZG91dC5pbmNsdWRlcygnV2FpdGluZyBvbiBTeXN0ZW0gQXBwJykgJiYgb25XYWl0aW5nU3lzdGVtQXBwKSB7XG4gICAgICAgIG9uV2FpdGluZ1N5c3RlbUFwcCgpO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG4gIGJvb3RNb25pdG9yLm9uKCdleGl0JywgKGNvZGUsIHNpZ25hbCkgPT4ge1xuICAgIGlmICh0aW1lb3V0SGFuZGxlcikge1xuICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXRIYW5kbGVyKTtcbiAgICB9XG4gICAgaWYgKGNvZGUgPT09IDApIHtcbiAgICAgIGlmIChvbkZpbmlzaGVkKSB7XG4gICAgICAgIG9uRmluaXNoZWQoKTtcbiAgICAgIH1cbiAgICAgIGlzQm9vdGluZ0ZpbmlzaGVkID0gdHJ1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgc3RhdHVzID0gc3RhdHVzIHx8IHNpZ25hbDtcbiAgICAgIGVycm9yID0gbmV3IEVycm9yKHN0YXR1cyk7XG4gICAgICBpZiAob25FcnJvcikge1xuICAgICAgICBvbkVycm9yKGVycm9yKTtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xuICBhd2FpdCBib290TW9uaXRvci5zdGFydCgwKTtcbiAgY29uc3Qgc3RvcE1vbml0b3IgPSBhc3luYyAoKSA9PiB7XG4gICAgaWYgKGJvb3RNb25pdG9yLmlzUnVubmluZykge1xuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgYm9vdE1vbml0b3Iuc3RvcCgpO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICBsb2cud2FybihlLm1lc3NhZ2UpO1xuICAgICAgfVxuICAgIH1cbiAgfTtcbiAgY29uc3QgdGltZVN0YXJ0ZWQgPSBwcm9jZXNzLmhydGltZSgpO1xuICBpZiAob25GaW5pc2hlZCkge1xuICAgIHRpbWVvdXRIYW5kbGVyID0gc2V0VGltZW91dChzdG9wTW9uaXRvciwgdGltZW91dCk7XG4gIH0gZWxzZSB7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHdhaXRGb3JDb25kaXRpb24oKCkgPT4ge1xuICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gaXNCb290aW5nRmluaXNoZWQ7XG4gICAgICB9LCB7d2FpdE1zOiB0aW1lb3V0LCBpbnRlcnZhbE1zOiA1MDB9KTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGF3YWl0IHN0b3BNb25pdG9yKCk7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFRoZSBzaW11bGF0b3IgJHt1ZGlkfSBoYXMgZmFpbGVkIHRvIGZpbmlzaCBib290aW5nIGFmdGVyICR7cHJvY2Vzcy5ocnRpbWUodGltZVN0YXJ0ZWQpWzBdfXMuIGAgK1xuICAgICAgICBgT3JpZ2luYWwgc3RhdHVzOiAke3N0YXR1c31gKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGJvb3RNb25pdG9yO1xufVxuXG5cbmV4cG9ydCB7XG4gIGluc3RhbGxBcHAsIHJlbW92ZUFwcCwgbGF1bmNoLCBzcGF3biwgc3Bhd25TdWJQcm9jZXNzLCBvcGVuVXJsLCB0ZXJtaW5hdGUsXG4gIHNodXRkb3duLCBjcmVhdGVEZXZpY2UsIGdldEFwcENvbnRhaW5lciwgZ2V0U2NyZWVuc2hvdCwgZGVsZXRlRGV2aWNlLFxuICBlcmFzZURldmljZSwgZ2V0RGV2aWNlcywgZ2V0UnVudGltZUZvclBsYXRmb3JtVmVyc2lvbiwgYm9vdERldmljZSxcbiAgc2V0UGFzdGVib2FyZCwgZ2V0UGFzdGVib2FyZCwgYWRkTWVkaWEsIGFwcEluZm8sIGdldERldmljZVR5cGVzLFxuICBzdGFydEJvb3RNb25pdG9yLFxufTtcbiJdLCJmaWxlIjoibGliL3NpbWN0bC5qcyIsInNvdXJjZVJvb3QiOiIuLi8uLiJ9
