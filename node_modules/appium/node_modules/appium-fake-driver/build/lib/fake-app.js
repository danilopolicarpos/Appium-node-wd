"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.FakeApp = void 0;

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _bluebird = _interopRequireDefault(require("bluebird"));

var _fs = _interopRequireDefault(require("fs"));

var _xmldom = _interopRequireDefault(require("xmldom"));

var _xpath = _interopRequireDefault(require("xpath"));

var _logger = _interopRequireDefault(require("./logger"));

var _fakeElement = require("./fake-element");

const readFile = _bluebird.default.promisify(_fs.default.readFile);

class FakeApp {
  constructor() {
    this.dom = null;
    this.activeDom = null;
    this.activeWebview = null;
    this.activeFrame = null;
    this.activeAlert = null;
    this.lat = 0;
    this.long = 0;
    this.rawXml = '';
    this.currentOrientation = "PORTRAIT";
  }

  get title() {
    let nodes = this.xpathQuery('//title');

    if (nodes.length < 1) {
      throw new Error("No title!");
    }

    return nodes[0].firstChild.data;
  }

  get currentGeoLocation() {
    return {
      latitude: this.lat,
      longitude: this.long
    };
  }

  get orientation() {
    return this.currentOrientation;
  }

  set orientation(o) {
    this.currentOrientation = o;
  }

  loadApp(appPath) {
    var _this = this;

    return (0, _asyncToGenerator2.default)(function* () {
      _logger.default.info("Loading Mock app model");

      let data = yield readFile(appPath);

      _logger.default.info("Parsing Mock app XML");

      _this.rawXml = data.toString();
      _this.dom = new _xmldom.default.DOMParser().parseFromString(_this.rawXml);
      _this.activeDom = _this.dom;
    })();
  }

  getWebviews() {
    return this.xpathQuery('//MockWebView/*[1]').map(n => {
      return new FakeWebView(n);
    });
  }

  activateWebview(wv) {
    this.activeWebview = wv;
    let fragment = new _xmldom.default.XMLSerializer().serializeToString(wv.node);
    this.activeDom = new _xmldom.default.DOMParser().parseFromString(fragment, "application/xml");
  }

  deactivateWebview() {
    this.activeWebview = null;
    this.activeDom = this.dom;
  }

  activateFrame(frame) {
    this.activeFrame = frame;
    let fragment = new _xmldom.default.XMLSerializer().serializeToString(frame);
    this.activeDom = new _xmldom.default.DOMParser().parseFromString(fragment, "application/xml");
  }

  deactivateFrame() {
    this.activeFrame = null;
    this.activateWebview(this.activeWebview);
  }

  xpathQuery(sel, ctx) {
    return _xpath.default.select(sel, ctx || this.activeDom);
  }

  idQuery(id, ctx) {
    return this.xpathQuery(`//*[@id="${id}"]`, ctx);
  }

  classQuery(className, ctx) {
    return this.xpathQuery(`//${className}`, ctx);
  }

  hasAlert() {
    return this.activeAlert !== null;
  }

  setAlertText(text) {
    if (!this.activeAlert.hasPrompt()) {
      throw new Error("No prompt to set text of");
    }

    this.activeAlert.setAttr('prompt', text);
  }

  showAlert(alertId) {
    let nodes = this.xpathQuery(`//alert[@id="${alertId}"]`);

    if (nodes.length < 1) {
      throw new Error(`Alert ${alertId} doesn't exist!`);
    }

    this.activeAlert = new _fakeElement.FakeElement(nodes[0], this);
  }

  alertText() {
    return this.activeAlert.getAttr('prompt') || this.activeAlert.nodeAttrs.text;
  }

  handleAlert() {
    this.activeAlert = null;
  }

  getScreenshot() {
    return "hahahanotreallyascreenshot";
  }

}

exports.FakeApp = FakeApp;

class FakeWebView {
  constructor(node) {
    this.node = node;
  }

}require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9mYWtlLWFwcC5qcyJdLCJuYW1lcyI6WyJyZWFkRmlsZSIsIkIiLCJwcm9taXNpZnkiLCJmcyIsIkZha2VBcHAiLCJjb25zdHJ1Y3RvciIsImRvbSIsImFjdGl2ZURvbSIsImFjdGl2ZVdlYnZpZXciLCJhY3RpdmVGcmFtZSIsImFjdGl2ZUFsZXJ0IiwibGF0IiwibG9uZyIsInJhd1htbCIsImN1cnJlbnRPcmllbnRhdGlvbiIsInRpdGxlIiwibm9kZXMiLCJ4cGF0aFF1ZXJ5IiwibGVuZ3RoIiwiRXJyb3IiLCJmaXJzdENoaWxkIiwiZGF0YSIsImN1cnJlbnRHZW9Mb2NhdGlvbiIsImxhdGl0dWRlIiwibG9uZ2l0dWRlIiwib3JpZW50YXRpb24iLCJvIiwibG9hZEFwcCIsImFwcFBhdGgiLCJsb2ciLCJpbmZvIiwidG9TdHJpbmciLCJYTUxEb20iLCJET01QYXJzZXIiLCJwYXJzZUZyb21TdHJpbmciLCJnZXRXZWJ2aWV3cyIsIm1hcCIsIm4iLCJGYWtlV2ViVmlldyIsImFjdGl2YXRlV2VidmlldyIsInd2IiwiZnJhZ21lbnQiLCJYTUxTZXJpYWxpemVyIiwic2VyaWFsaXplVG9TdHJpbmciLCJub2RlIiwiZGVhY3RpdmF0ZVdlYnZpZXciLCJhY3RpdmF0ZUZyYW1lIiwiZnJhbWUiLCJkZWFjdGl2YXRlRnJhbWUiLCJzZWwiLCJjdHgiLCJ4cGF0aCIsInNlbGVjdCIsImlkUXVlcnkiLCJpZCIsImNsYXNzUXVlcnkiLCJjbGFzc05hbWUiLCJoYXNBbGVydCIsInNldEFsZXJ0VGV4dCIsInRleHQiLCJoYXNQcm9tcHQiLCJzZXRBdHRyIiwic2hvd0FsZXJ0IiwiYWxlcnRJZCIsIkZha2VFbGVtZW50IiwiYWxlcnRUZXh0IiwiZ2V0QXR0ciIsIm5vZGVBdHRycyIsImhhbmRsZUFsZXJ0IiwiZ2V0U2NyZWVuc2hvdCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQSxNQUFNQSxRQUFRLEdBQUdDLGtCQUFFQyxTQUFGLENBQVlDLFlBQUdILFFBQWYsQ0FBakI7O0FBRUEsTUFBTUksT0FBTixDQUFjO0FBQ1pDLEVBQUFBLFdBQVcsR0FBSTtBQUNiLFNBQUtDLEdBQUwsR0FBVyxJQUFYO0FBQ0EsU0FBS0MsU0FBTCxHQUFpQixJQUFqQjtBQUNBLFNBQUtDLGFBQUwsR0FBcUIsSUFBckI7QUFDQSxTQUFLQyxXQUFMLEdBQW1CLElBQW5CO0FBQ0EsU0FBS0MsV0FBTCxHQUFtQixJQUFuQjtBQUNBLFNBQUtDLEdBQUwsR0FBVyxDQUFYO0FBQ0EsU0FBS0MsSUFBTCxHQUFZLENBQVo7QUFDQSxTQUFLQyxNQUFMLEdBQWMsRUFBZDtBQUNBLFNBQUtDLGtCQUFMLEdBQTBCLFVBQTFCO0FBQ0Q7O0FBRUQsTUFBSUMsS0FBSixHQUFhO0FBQ1gsUUFBSUMsS0FBSyxHQUFHLEtBQUtDLFVBQUwsQ0FBZ0IsU0FBaEIsQ0FBWjs7QUFDQSxRQUFJRCxLQUFLLENBQUNFLE1BQU4sR0FBZSxDQUFuQixFQUFzQjtBQUNwQixZQUFNLElBQUlDLEtBQUosQ0FBVSxXQUFWLENBQU47QUFDRDs7QUFDRCxXQUFPSCxLQUFLLENBQUMsQ0FBRCxDQUFMLENBQVNJLFVBQVQsQ0FBb0JDLElBQTNCO0FBQ0Q7O0FBRUQsTUFBSUMsa0JBQUosR0FBMEI7QUFDeEIsV0FBTztBQUNMQyxNQUFBQSxRQUFRLEVBQUUsS0FBS1osR0FEVjtBQUVMYSxNQUFBQSxTQUFTLEVBQUUsS0FBS1o7QUFGWCxLQUFQO0FBSUQ7O0FBRUQsTUFBSWEsV0FBSixHQUFtQjtBQUNqQixXQUFPLEtBQUtYLGtCQUFaO0FBQ0Q7O0FBRUQsTUFBSVcsV0FBSixDQUFpQkMsQ0FBakIsRUFBb0I7QUFDbEIsU0FBS1osa0JBQUwsR0FBMEJZLENBQTFCO0FBQ0Q7O0FBRUtDLEVBQUFBLE9BQU4sQ0FBZUMsT0FBZixFQUF3QjtBQUFBOztBQUFBO0FBQ3RCQyxzQkFBSUMsSUFBSixDQUFTLHdCQUFUOztBQUNBLFVBQUlULElBQUksU0FBU3JCLFFBQVEsQ0FBQzRCLE9BQUQsQ0FBekI7O0FBQ0FDLHNCQUFJQyxJQUFKLENBQVMsc0JBQVQ7O0FBQ0EsTUFBQSxLQUFJLENBQUNqQixNQUFMLEdBQWNRLElBQUksQ0FBQ1UsUUFBTCxFQUFkO0FBQ0EsTUFBQSxLQUFJLENBQUN6QixHQUFMLEdBQVcsSUFBSTBCLGdCQUFPQyxTQUFYLEdBQXVCQyxlQUF2QixDQUF1QyxLQUFJLENBQUNyQixNQUE1QyxDQUFYO0FBQ0EsTUFBQSxLQUFJLENBQUNOLFNBQUwsR0FBaUIsS0FBSSxDQUFDRCxHQUF0QjtBQU5zQjtBQU92Qjs7QUFFRDZCLEVBQUFBLFdBQVcsR0FBSTtBQUNiLFdBQU8sS0FBS2xCLFVBQUwsQ0FBZ0Isb0JBQWhCLEVBQXNDbUIsR0FBdEMsQ0FBMkNDLENBQUQsSUFBTztBQUN0RCxhQUFPLElBQUlDLFdBQUosQ0FBZ0JELENBQWhCLENBQVA7QUFDRCxLQUZNLENBQVA7QUFHRDs7QUFFREUsRUFBQUEsZUFBZSxDQUFFQyxFQUFGLEVBQU07QUFDbkIsU0FBS2hDLGFBQUwsR0FBcUJnQyxFQUFyQjtBQUNBLFFBQUlDLFFBQVEsR0FBRyxJQUFJVCxnQkFBT1UsYUFBWCxHQUEyQkMsaUJBQTNCLENBQTZDSCxFQUFFLENBQUNJLElBQWhELENBQWY7QUFDQSxTQUFLckMsU0FBTCxHQUFpQixJQUFJeUIsZ0JBQU9DLFNBQVgsR0FBdUJDLGVBQXZCLENBQXVDTyxRQUF2QyxFQUNiLGlCQURhLENBQWpCO0FBRUQ7O0FBRURJLEVBQUFBLGlCQUFpQixHQUFJO0FBQ25CLFNBQUtyQyxhQUFMLEdBQXFCLElBQXJCO0FBQ0EsU0FBS0QsU0FBTCxHQUFpQixLQUFLRCxHQUF0QjtBQUNEOztBQUVEd0MsRUFBQUEsYUFBYSxDQUFFQyxLQUFGLEVBQVM7QUFDcEIsU0FBS3RDLFdBQUwsR0FBbUJzQyxLQUFuQjtBQUNBLFFBQUlOLFFBQVEsR0FBRyxJQUFJVCxnQkFBT1UsYUFBWCxHQUEyQkMsaUJBQTNCLENBQTZDSSxLQUE3QyxDQUFmO0FBQ0EsU0FBS3hDLFNBQUwsR0FBaUIsSUFBSXlCLGdCQUFPQyxTQUFYLEdBQXVCQyxlQUF2QixDQUF1Q08sUUFBdkMsRUFDYixpQkFEYSxDQUFqQjtBQUVEOztBQUVETyxFQUFBQSxlQUFlLEdBQUk7QUFDakIsU0FBS3ZDLFdBQUwsR0FBbUIsSUFBbkI7QUFDQSxTQUFLOEIsZUFBTCxDQUFxQixLQUFLL0IsYUFBMUI7QUFDRDs7QUFFRFMsRUFBQUEsVUFBVSxDQUFFZ0MsR0FBRixFQUFPQyxHQUFQLEVBQVk7QUFDcEIsV0FBT0MsZUFBTUMsTUFBTixDQUFhSCxHQUFiLEVBQWtCQyxHQUFHLElBQUksS0FBSzNDLFNBQTlCLENBQVA7QUFDRDs7QUFFRDhDLEVBQUFBLE9BQU8sQ0FBRUMsRUFBRixFQUFNSixHQUFOLEVBQVc7QUFDaEIsV0FBTyxLQUFLakMsVUFBTCxDQUFpQixZQUFXcUMsRUFBRyxJQUEvQixFQUFvQ0osR0FBcEMsQ0FBUDtBQUNEOztBQUVESyxFQUFBQSxVQUFVLENBQUVDLFNBQUYsRUFBYU4sR0FBYixFQUFrQjtBQUMxQixXQUFPLEtBQUtqQyxVQUFMLENBQWlCLEtBQUl1QyxTQUFVLEVBQS9CLEVBQWtDTixHQUFsQyxDQUFQO0FBQ0Q7O0FBRURPLEVBQUFBLFFBQVEsR0FBSTtBQUNWLFdBQU8sS0FBSy9DLFdBQUwsS0FBcUIsSUFBNUI7QUFDRDs7QUFFRGdELEVBQUFBLFlBQVksQ0FBRUMsSUFBRixFQUFRO0FBQ2xCLFFBQUksQ0FBQyxLQUFLakQsV0FBTCxDQUFpQmtELFNBQWpCLEVBQUwsRUFBbUM7QUFDakMsWUFBTSxJQUFJekMsS0FBSixDQUFVLDBCQUFWLENBQU47QUFDRDs7QUFDRCxTQUFLVCxXQUFMLENBQWlCbUQsT0FBakIsQ0FBeUIsUUFBekIsRUFBbUNGLElBQW5DO0FBQ0Q7O0FBRURHLEVBQUFBLFNBQVMsQ0FBRUMsT0FBRixFQUFXO0FBQ2xCLFFBQUkvQyxLQUFLLEdBQUcsS0FBS0MsVUFBTCxDQUFpQixnQkFBZThDLE9BQVEsSUFBeEMsQ0FBWjs7QUFDQSxRQUFJL0MsS0FBSyxDQUFDRSxNQUFOLEdBQWUsQ0FBbkIsRUFBc0I7QUFDcEIsWUFBTSxJQUFJQyxLQUFKLENBQVcsU0FBUTRDLE9BQVEsaUJBQTNCLENBQU47QUFDRDs7QUFDRCxTQUFLckQsV0FBTCxHQUFtQixJQUFJc0Qsd0JBQUosQ0FBZ0JoRCxLQUFLLENBQUMsQ0FBRCxDQUFyQixFQUEwQixJQUExQixDQUFuQjtBQUNEOztBQUVEaUQsRUFBQUEsU0FBUyxHQUFJO0FBQ1gsV0FBTyxLQUFLdkQsV0FBTCxDQUFpQndELE9BQWpCLENBQXlCLFFBQXpCLEtBQ0EsS0FBS3hELFdBQUwsQ0FBaUJ5RCxTQUFqQixDQUEyQlIsSUFEbEM7QUFFRDs7QUFFRFMsRUFBQUEsV0FBVyxHQUFJO0FBQ2IsU0FBSzFELFdBQUwsR0FBbUIsSUFBbkI7QUFDRDs7QUFFRDJELEVBQUFBLGFBQWEsR0FBSTtBQUNmLFdBQU8sNEJBQVA7QUFDRDs7QUFySFc7Ozs7QUF5SGQsTUFBTS9CLFdBQU4sQ0FBa0I7QUFDaEJqQyxFQUFBQSxXQUFXLENBQUV1QyxJQUFGLEVBQVE7QUFDakIsU0FBS0EsSUFBTCxHQUFZQSxJQUFaO0FBQ0Q7O0FBSGUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgQiBmcm9tICdibHVlYmlyZCc7XG5pbXBvcnQgZnMgZnJvbSAnZnMnO1xuaW1wb3J0IFhNTERvbSBmcm9tICd4bWxkb20nO1xuaW1wb3J0IHhwYXRoIGZyb20gJ3hwYXRoJztcbmltcG9ydCBsb2cgZnJvbSAnLi9sb2dnZXInO1xuaW1wb3J0IHsgRmFrZUVsZW1lbnQgfSBmcm9tICcuL2Zha2UtZWxlbWVudCc7XG5cbmNvbnN0IHJlYWRGaWxlID0gQi5wcm9taXNpZnkoZnMucmVhZEZpbGUpO1xuXG5jbGFzcyBGYWtlQXBwIHtcbiAgY29uc3RydWN0b3IgKCkge1xuICAgIHRoaXMuZG9tID0gbnVsbDtcbiAgICB0aGlzLmFjdGl2ZURvbSA9IG51bGw7XG4gICAgdGhpcy5hY3RpdmVXZWJ2aWV3ID0gbnVsbDtcbiAgICB0aGlzLmFjdGl2ZUZyYW1lID0gbnVsbDtcbiAgICB0aGlzLmFjdGl2ZUFsZXJ0ID0gbnVsbDtcbiAgICB0aGlzLmxhdCA9IDA7XG4gICAgdGhpcy5sb25nID0gMDtcbiAgICB0aGlzLnJhd1htbCA9ICcnO1xuICAgIHRoaXMuY3VycmVudE9yaWVudGF0aW9uID0gXCJQT1JUUkFJVFwiO1xuICB9XG5cbiAgZ2V0IHRpdGxlICgpIHtcbiAgICBsZXQgbm9kZXMgPSB0aGlzLnhwYXRoUXVlcnkoJy8vdGl0bGUnKTtcbiAgICBpZiAobm9kZXMubGVuZ3RoIDwgMSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTm8gdGl0bGUhXCIpO1xuICAgIH1cbiAgICByZXR1cm4gbm9kZXNbMF0uZmlyc3RDaGlsZC5kYXRhO1xuICB9XG5cbiAgZ2V0IGN1cnJlbnRHZW9Mb2NhdGlvbiAoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGxhdGl0dWRlOiB0aGlzLmxhdCxcbiAgICAgIGxvbmdpdHVkZTogdGhpcy5sb25nXG4gICAgfTtcbiAgfVxuXG4gIGdldCBvcmllbnRhdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRoaXMuY3VycmVudE9yaWVudGF0aW9uO1xuICB9XG5cbiAgc2V0IG9yaWVudGF0aW9uIChvKSB7XG4gICAgdGhpcy5jdXJyZW50T3JpZW50YXRpb24gPSBvO1xuICB9XG5cbiAgYXN5bmMgbG9hZEFwcCAoYXBwUGF0aCkge1xuICAgIGxvZy5pbmZvKFwiTG9hZGluZyBNb2NrIGFwcCBtb2RlbFwiKTtcbiAgICBsZXQgZGF0YSA9IGF3YWl0IHJlYWRGaWxlKGFwcFBhdGgpO1xuICAgIGxvZy5pbmZvKFwiUGFyc2luZyBNb2NrIGFwcCBYTUxcIik7XG4gICAgdGhpcy5yYXdYbWwgPSBkYXRhLnRvU3RyaW5nKCk7XG4gICAgdGhpcy5kb20gPSBuZXcgWE1MRG9tLkRPTVBhcnNlcigpLnBhcnNlRnJvbVN0cmluZyh0aGlzLnJhd1htbCk7XG4gICAgdGhpcy5hY3RpdmVEb20gPSB0aGlzLmRvbTtcbiAgfVxuXG4gIGdldFdlYnZpZXdzICgpIHtcbiAgICByZXR1cm4gdGhpcy54cGF0aFF1ZXJ5KCcvL01vY2tXZWJWaWV3LypbMV0nKS5tYXAoKG4pID0+IHtcbiAgICAgIHJldHVybiBuZXcgRmFrZVdlYlZpZXcobik7XG4gICAgfSk7XG4gIH1cblxuICBhY3RpdmF0ZVdlYnZpZXcgKHd2KSB7XG4gICAgdGhpcy5hY3RpdmVXZWJ2aWV3ID0gd3Y7XG4gICAgbGV0IGZyYWdtZW50ID0gbmV3IFhNTERvbS5YTUxTZXJpYWxpemVyKCkuc2VyaWFsaXplVG9TdHJpbmcod3Yubm9kZSk7XG4gICAgdGhpcy5hY3RpdmVEb20gPSBuZXcgWE1MRG9tLkRPTVBhcnNlcigpLnBhcnNlRnJvbVN0cmluZyhmcmFnbWVudCxcbiAgICAgICAgXCJhcHBsaWNhdGlvbi94bWxcIik7XG4gIH1cblxuICBkZWFjdGl2YXRlV2VidmlldyAoKSB7XG4gICAgdGhpcy5hY3RpdmVXZWJ2aWV3ID0gbnVsbDtcbiAgICB0aGlzLmFjdGl2ZURvbSA9IHRoaXMuZG9tO1xuICB9XG5cbiAgYWN0aXZhdGVGcmFtZSAoZnJhbWUpIHtcbiAgICB0aGlzLmFjdGl2ZUZyYW1lID0gZnJhbWU7XG4gICAgbGV0IGZyYWdtZW50ID0gbmV3IFhNTERvbS5YTUxTZXJpYWxpemVyKCkuc2VyaWFsaXplVG9TdHJpbmcoZnJhbWUpO1xuICAgIHRoaXMuYWN0aXZlRG9tID0gbmV3IFhNTERvbS5ET01QYXJzZXIoKS5wYXJzZUZyb21TdHJpbmcoZnJhZ21lbnQsXG4gICAgICAgIFwiYXBwbGljYXRpb24veG1sXCIpO1xuICB9XG5cbiAgZGVhY3RpdmF0ZUZyYW1lICgpIHtcbiAgICB0aGlzLmFjdGl2ZUZyYW1lID0gbnVsbDtcbiAgICB0aGlzLmFjdGl2YXRlV2Vidmlldyh0aGlzLmFjdGl2ZVdlYnZpZXcpO1xuICB9XG5cbiAgeHBhdGhRdWVyeSAoc2VsLCBjdHgpIHtcbiAgICByZXR1cm4geHBhdGguc2VsZWN0KHNlbCwgY3R4IHx8IHRoaXMuYWN0aXZlRG9tKTtcbiAgfVxuXG4gIGlkUXVlcnkgKGlkLCBjdHgpIHtcbiAgICByZXR1cm4gdGhpcy54cGF0aFF1ZXJ5KGAvLypbQGlkPVwiJHtpZH1cIl1gLCBjdHgpO1xuICB9XG5cbiAgY2xhc3NRdWVyeSAoY2xhc3NOYW1lLCBjdHgpIHtcbiAgICByZXR1cm4gdGhpcy54cGF0aFF1ZXJ5KGAvLyR7Y2xhc3NOYW1lfWAsIGN0eCk7XG4gIH1cblxuICBoYXNBbGVydCAoKSB7XG4gICAgcmV0dXJuIHRoaXMuYWN0aXZlQWxlcnQgIT09IG51bGw7XG4gIH1cblxuICBzZXRBbGVydFRleHQgKHRleHQpIHtcbiAgICBpZiAoIXRoaXMuYWN0aXZlQWxlcnQuaGFzUHJvbXB0KCkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIk5vIHByb21wdCB0byBzZXQgdGV4dCBvZlwiKTtcbiAgICB9XG4gICAgdGhpcy5hY3RpdmVBbGVydC5zZXRBdHRyKCdwcm9tcHQnLCB0ZXh0KTtcbiAgfVxuXG4gIHNob3dBbGVydCAoYWxlcnRJZCkge1xuICAgIGxldCBub2RlcyA9IHRoaXMueHBhdGhRdWVyeShgLy9hbGVydFtAaWQ9XCIke2FsZXJ0SWR9XCJdYCk7XG4gICAgaWYgKG5vZGVzLmxlbmd0aCA8IDEpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgQWxlcnQgJHthbGVydElkfSBkb2Vzbid0IGV4aXN0IWApO1xuICAgIH1cbiAgICB0aGlzLmFjdGl2ZUFsZXJ0ID0gbmV3IEZha2VFbGVtZW50KG5vZGVzWzBdLCB0aGlzKTtcbiAgfVxuXG4gIGFsZXJ0VGV4dCAoKSB7XG4gICAgcmV0dXJuIHRoaXMuYWN0aXZlQWxlcnQuZ2V0QXR0cigncHJvbXB0JykgfHxcbiAgICAgICAgICAgdGhpcy5hY3RpdmVBbGVydC5ub2RlQXR0cnMudGV4dDtcbiAgfVxuXG4gIGhhbmRsZUFsZXJ0ICgpIHtcbiAgICB0aGlzLmFjdGl2ZUFsZXJ0ID0gbnVsbDtcbiAgfVxuXG4gIGdldFNjcmVlbnNob3QgKCkge1xuICAgIHJldHVybiBcImhhaGFoYW5vdHJlYWxseWFzY3JlZW5zaG90XCI7XG4gIH1cblxufVxuXG5jbGFzcyBGYWtlV2ViVmlldyB7XG4gIGNvbnN0cnVjdG9yIChub2RlKSB7XG4gICAgdGhpcy5ub2RlID0gbm9kZTtcbiAgfVxufVxuXG5leHBvcnQgeyBGYWtlQXBwIH07XG4iXSwiZmlsZSI6ImxpYi9mYWtlLWFwcC5qcyIsInNvdXJjZVJvb3QiOiIuLi8uLiJ9
