"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.SETTINGS_HELPER_PKG_ID = exports.helpers = void 0;

require("source-map-support/register");

var _lodash = _interopRequireDefault(require("lodash"));

var _path = _interopRequireDefault(require("path"));

var _teen_process = require("teen_process");

var _asyncbox = require("asyncbox");

var _logger = _interopRequireDefault(require("./logger"));

var _appiumSupport = require("appium-support");

var _ioAppium = require("io.appium.settings");

var _bootstrap = _interopRequireDefault(require("./bootstrap"));

var _bluebird = _interopRequireDefault(require("bluebird"));

var _appiumAdb = _interopRequireDefault(require("appium-adb"));

var _unlockHelpers = _interopRequireWildcard(require("./unlock-helpers"));

var _os = require("os");

const PACKAGE_INSTALL_TIMEOUT = 90000;
const CHROME_BROWSER_PACKAGE_ACTIVITY = {
  chrome: {
    pkg: 'com.android.chrome',
    activity: 'com.google.android.apps.chrome.Main'
  },
  chromium: {
    pkg: 'org.chromium.chrome.shell',
    activity: '.ChromeShellActivity'
  },
  chromebeta: {
    pkg: 'com.chrome.beta',
    activity: 'com.google.android.apps.chrome.Main'
  },
  browser: {
    pkg: 'com.android.browser',
    activity: 'com.android.browser.BrowserActivity'
  },
  'chromium-browser': {
    pkg: 'org.chromium.chrome',
    activity: 'com.google.android.apps.chrome.Main'
  },
  'chromium-webview': {
    pkg: 'org.chromium.webview_shell',
    activity: 'org.chromium.webview_shell.WebViewBrowserActivity'
  },
  default: {
    pkg: 'com.android.chrome',
    activity: 'com.google.android.apps.chrome.Main'
  }
};
const SETTINGS_HELPER_PKG_ID = 'io.appium.settings';
exports.SETTINGS_HELPER_PKG_ID = SETTINGS_HELPER_PKG_ID;
const SETTINGS_HELPER_MAIN_ACTIVITY = '.Settings';
const SETTINGS_HELPER_UNLOCK_ACTIVITY = '.Unlock';
let helpers = {};
exports.helpers = helpers;

helpers.createBaseADB = async function createBaseADB(opts = {}) {
  const {
    adbPort,
    suppressKillServer,
    remoteAdbHost,
    clearDeviceLogsOnStart,
    adbExecTimeout,
    useKeystore,
    keystorePath,
    keystorePassword,
    keyAlias,
    keyPassword,
    remoteAppsCacheLimit,
    buildToolsVersion
  } = opts;
  return await _appiumAdb.default.createADB({
    adbPort,
    suppressKillServer,
    remoteAdbHost,
    clearDeviceLogsOnStart,
    adbExecTimeout,
    useKeystore,
    keystorePath,
    keystorePassword,
    keyAlias,
    keyPassword,
    remoteAppsCacheLimit,
    buildToolsVersion
  });
};

helpers.getJavaVersion = async function getJavaVersion(logVersion = true) {
  let stderr;

  try {
    ({
      stderr
    } = await (0, _teen_process.exec)('java', ['-version']));
  } catch (e) {
    throw new Error(`Could not get the Java version. Is Java installed? Original error: ${e.stderr}`);
  }

  const versionMatch = /(java|openjdk)\s+version.+?([0-9._]+)/i.exec(stderr);

  if (!versionMatch) {
    throw new Error(`Could not parse Java version. Is Java installed? Original output: ${stderr}`);
  }

  if (logVersion) {
    _logger.default.info(`Java version is: ${versionMatch[2]}`);
  }

  return versionMatch[2];
};

helpers.prepareEmulator = async function prepareEmulator(adb, opts) {
  let {
    avd,
    avdArgs,
    language,
    locale,
    avdLaunchTimeout,
    avdReadyTimeout
  } = opts;

  if (!avd) {
    throw new Error('Cannot launch AVD without AVD name');
  }

  let avdName = avd.replace('@', '');
  let runningAVD = await adb.getRunningAVD(avdName);

  if (runningAVD !== null) {
    if (avdArgs && avdArgs.toLowerCase().indexOf('-wipe-data') > -1) {
      _logger.default.debug(`Killing '${avdName}' because it needs to be wiped at start.`);

      await adb.killEmulator(avdName);
    } else {
      _logger.default.debug('Not launching AVD because it is already running.');

      return;
    }
  }

  avdArgs = this.prepareAVDArgs(opts, adb, avdArgs);
  await adb.launchAVD(avd, avdArgs, language, locale, avdLaunchTimeout, avdReadyTimeout);
};

helpers.prepareAVDArgs = function prepareAVDArgs(opts, adb, avdArgs) {
  let args = avdArgs ? [avdArgs] : [];

  if (!_lodash.default.isUndefined(opts.networkSpeed)) {
    let networkSpeed = this.ensureNetworkSpeed(adb, opts.networkSpeed);
    args.push('-netspeed', networkSpeed);
  }

  if (opts.isHeadless) {
    args.push('-no-window');
  }

  return args.join(' ');
};

helpers.ensureNetworkSpeed = function ensureNetworkSpeed(adb, networkSpeed) {
  if (_lodash.default.values(adb.NETWORK_SPEED).indexOf(networkSpeed) !== -1) {
    return networkSpeed;
  }

  _logger.default.warn(`Wrong network speed param ${networkSpeed}, using default: full. Supported values: ${_lodash.default.values(adb.NETWORK_SPEED)}`);

  return adb.NETWORK_SPEED.FULL;
};

helpers.ensureDeviceLocale = async function ensureDeviceLocale(adb, language, country, script = null) {
  if (!_lodash.default.isString(language) && !_lodash.default.isString(country)) {
    _logger.default.warn(`setDeviceLanguageCountry requires language or country.`);

    _logger.default.warn(`Got language: '${language}' and country: '${country}'`);

    return;
  }

  await adb.setDeviceLanguageCountry(language, country, script);

  if (!(await adb.ensureCurrentLocale(language, country, script))) {
    const message = script ? `language: ${language}, country: ${country} and script: ${script}` : `language: ${language} and country: ${country}`;
    throw new Error(`Failed to set ${message}`);
  }
};

helpers.getDeviceInfoFromCaps = async function getDeviceInfoFromCaps(opts = {}) {
  const adb = await helpers.createBaseADB(opts);
  let udid = opts.udid;
  let emPort = null;

  if (opts.avd) {
    await helpers.prepareEmulator(adb, opts);
    udid = adb.curDeviceId;
    emPort = adb.emulatorPort;
  } else {
    _logger.default.info('Retrieving device list');

    let devices = await adb.getDevicesWithRetry();

    if (udid) {
      if (!_lodash.default.includes(_lodash.default.map(devices, 'udid'), udid)) {
        _logger.default.errorAndThrow(`Device ${udid} was not in the list of connected devices`);
      }

      emPort = adb.getPortFromEmulatorString(udid);
    } else if (opts.platformVersion) {
      opts.platformVersion = `${opts.platformVersion}`.trim();

      _logger.default.info(`Looking for a device with Android '${opts.platformVersion}'`);

      let availDevicesStr = [];

      for (let device of devices) {
        await adb.setDeviceId(device.udid);
        let deviceOS = await adb.getPlatformVersion();
        availDevicesStr.push(`${device.udid} (${deviceOS})`);

        if (deviceOS.indexOf(opts.platformVersion) === 0) {
          udid = device.udid;
          break;
        }
      }

      if (!udid) {
        _logger.default.errorAndThrow(`Unable to find an active device or emulator ` + `with OS ${opts.platformVersion}. The following are available: ` + availDevicesStr.join(', '));
      }

      emPort = adb.getPortFromEmulatorString(udid);
    } else {
      udid = devices[0].udid;
      emPort = adb.getPortFromEmulatorString(udid);
    }
  }

  _logger.default.info(`Using device: ${udid}`);

  return {
    udid,
    emPort
  };
};

helpers.createADB = async function createADB(opts = {}) {
  const {
    udid,
    emPort
  } = opts;
  const adb = await helpers.createBaseADB(opts);
  adb.setDeviceId(udid);

  if (emPort) {
    adb.setEmulatorPort(emPort);
  }

  return adb;
};

helpers.validatePackageActivityNames = function validatePackageActivityNames(opts) {
  for (const key of ['appPackage', 'appActivity', 'appWaitPackage', 'appWaitActivity']) {
    const name = opts[key];

    if (!name) {
      continue;
    }

    const match = /([^\w.*,])+/.exec(name);

    if (!match) {
      continue;
    }

    _logger.default.warn(`Capability '${key}' is expected to only include latin letters, digits, underscore, dot, comma and asterisk characters.`);

    _logger.default.warn(`Current value '${name}' has non-matching character at index ${match.index}: '${name.substring(0, match.index + 1)}'`);
  }
};

helpers.getLaunchInfo = async function getLaunchInfo(adb, opts) {
  let {
    app,
    appPackage,
    appActivity,
    appWaitPackage,
    appWaitActivity
  } = opts;

  if (!app) {
    _logger.default.warn('No app sent in, not parsing package/activity');

    return;
  }

  this.validatePackageActivityNames(opts);

  if (appPackage && appActivity) {
    return;
  }

  _logger.default.debug('Parsing package and activity from app manifest');

  let {
    apkPackage,
    apkActivity
  } = await adb.packageAndLaunchActivityFromManifest(app);

  if (apkPackage && !appPackage) {
    appPackage = apkPackage;
  }

  if (!appWaitPackage) {
    appWaitPackage = appPackage;
  }

  if (apkActivity && !appActivity) {
    appActivity = apkActivity;
  }

  if (!appWaitActivity) {
    appWaitActivity = appActivity;
  }

  _logger.default.debug(`Parsed package and activity are: ${apkPackage}/${apkActivity}`);

  return {
    appPackage,
    appWaitPackage,
    appActivity,
    appWaitActivity
  };
};

helpers.resetApp = async function resetApp(adb, opts = {}) {
  const {
    app,
    appPackage,
    fastReset,
    fullReset,
    androidInstallTimeout = PACKAGE_INSTALL_TIMEOUT,
    autoGrantPermissions,
    allowTestPackages
  } = opts;

  if (!appPackage) {
    throw new Error("'appPackage' option is required");
  }

  const isInstalled = await adb.isAppInstalled(appPackage);

  if (isInstalled) {
    try {
      await adb.forceStop(appPackage);
    } catch (ign) {}

    if (!fullReset && fastReset) {
      const output = await adb.clear(appPackage);

      if (_lodash.default.isString(output) && output.toLowerCase().includes('failed')) {
        throw new Error(`Cannot clear the application data of '${appPackage}'. Original error: ${output}`);
      }

      if (autoGrantPermissions) {
        try {
          await adb.grantAllPermissions(appPackage);
        } catch (error) {
          _logger.default.error(`Unable to grant permissions requested. Original error: ${error.message}`);
        }
      }

      _logger.default.debug(`Performed fast reset on the installed '${appPackage}' application (stop and clear)`);

      return;
    }
  }

  if (!app) {
    throw new Error("'app' option is required for reinstall");
  }

  _logger.default.debug(`Running full reset on '${appPackage}' (reinstall)`);

  if (isInstalled) {
    await adb.uninstallApk(appPackage);
  }

  await adb.install(app, {
    grantPermissions: autoGrantPermissions,
    timeout: androidInstallTimeout,
    allowTestPackages
  });
};

helpers.installApk = async function installApk(adb, opts = {}) {
  const {
    app,
    appPackage,
    fastReset,
    fullReset,
    androidInstallTimeout = PACKAGE_INSTALL_TIMEOUT,
    autoGrantPermissions,
    allowTestPackages
  } = opts;

  if (!app || !appPackage) {
    throw new Error("'app' and 'appPackage' options are required");
  }

  if (fullReset) {
    await this.resetApp(adb, opts);
    return;
  }

  const shouldPerformFastReset = fastReset && (await adb.isAppInstalled(appPackage));
  await adb.installOrUpgrade(app, appPackage, {
    grantPermissions: autoGrantPermissions,
    timeout: androidInstallTimeout,
    allowTestPackages
  });

  if (shouldPerformFastReset) {
    _logger.default.info(`Performing fast reset on '${appPackage}'`);

    await this.resetApp(adb, opts);
  }
};

helpers.installOtherApks = async function installOtherApks(otherApps, adb, opts) {
  let {
    androidInstallTimeout = PACKAGE_INSTALL_TIMEOUT,
    autoGrantPermissions,
    allowTestPackages
  } = opts;
  await _bluebird.default.all(otherApps.map(otherApp => {
    _logger.default.debug(`Installing app: ${otherApp}`);

    return adb.installOrUpgrade(otherApp, null, {
      grantPermissions: autoGrantPermissions,
      timeout: androidInstallTimeout,
      allowTestPackages
    });
  }));
};

helpers.uninstallOtherPackages = async function uninstallOtherPackages(adb, appPackages, filterPackages = []) {
  if (appPackages.includes('*')) {
    _logger.default.debug('Uninstall third party packages');

    appPackages = await this.getThirdPartyPackages(adb, filterPackages);
  }

  _logger.default.debug(`Uninstalling packages: ${appPackages}`);

  await _bluebird.default.all(appPackages.map(appPackage => adb.uninstallApk(appPackage)));
};

helpers.getThirdPartyPackages = async function getThirdPartyPackages(adb, filterPackages = []) {
  try {
    const packagesString = await adb.shell(['pm', 'list', 'packages', '-3']);
    const appPackagesArray = packagesString.trim().replace(/package:/g, '').split(_os.EOL);

    _logger.default.debug(`'${appPackagesArray}' filtered with '${filterPackages}'`);

    return _lodash.default.difference(appPackagesArray, filterPackages);
  } catch (err) {
    _logger.default.warn(`Unable to get packages with 'adb shell pm list packages -3': ${err.message}`);

    return [];
  }
};

helpers.initUnicodeKeyboard = async function initUnicodeKeyboard(adb) {
  _logger.default.debug('Enabling Unicode keyboard support');

  let defaultIME = await adb.defaultIME();

  _logger.default.debug(`Unsetting previous IME ${defaultIME}`);

  const appiumIME = `${SETTINGS_HELPER_PKG_ID}/.UnicodeIME`;

  _logger.default.debug(`Setting IME to '${appiumIME}'`);

  await adb.enableIME(appiumIME);
  await adb.setIME(appiumIME);
  return defaultIME;
};

helpers.setMockLocationApp = async function setMockLocationApp(adb, app) {
  try {
    if ((await adb.getApiLevel()) < 23) {
      await adb.shell(['settings', 'put', 'secure', 'mock_location', '1']);
    } else {
      await adb.shell(['appops', 'set', app, 'android:mock_location', 'allow']);
    }
  } catch (err) {
    _logger.default.warn(`Unable to set mock location for app '${app}': ${err.message}`);
  }
};

helpers.installHelperApp = async function installHelperApp(adb, apkPath, packageId) {
  await (0, _asyncbox.retry)(2, async function retryInstallHelperApp() {
    await adb.installOrUpgrade(apkPath, packageId, {
      grantPermissions: true
    });
  });
};

helpers.pushSettingsApp = async function pushSettingsApp(adb, throwError = false) {
  _logger.default.debug('Pushing settings apk to device...');

  try {
    await helpers.installHelperApp(adb, _ioAppium.path, SETTINGS_HELPER_PKG_ID, throwError);
  } catch (err) {
    if (throwError) {
      throw err;
    }

    _logger.default.warn(`Ignored error while installing '${_ioAppium.path}': ` + `'${err.message}'. Features that rely on this helper ` + 'require the apk such as toggle WiFi and getting location ' + 'will raise an error if you try to use them.');
  }

  if (await adb.processExists(SETTINGS_HELPER_PKG_ID)) {
    _logger.default.debug(`${SETTINGS_HELPER_PKG_ID} is already running. ` + `There is no need to reset its permissions.`);

    return;
  }

  if ((await adb.getApiLevel()) <= 23) {
    _logger.default.info('Granting android.permission.SET_ANIMATION_SCALE, CHANGE_CONFIGURATION, ACCESS_FINE_LOCATION by pm grant');

    await adb.grantPermissions(SETTINGS_HELPER_PKG_ID, ['android.permission.SET_ANIMATION_SCALE', 'android.permission.CHANGE_CONFIGURATION', 'android.permission.ACCESS_FINE_LOCATION']);
  }

  try {
    await adb.startApp({
      pkg: SETTINGS_HELPER_PKG_ID,
      activity: SETTINGS_HELPER_MAIN_ACTIVITY,
      action: 'android.intent.action.MAIN',
      category: 'android.intent.category.LAUNCHER',
      stopApp: false,
      waitForLaunch: false
    });
    await (0, _asyncbox.waitForCondition)(async () => await adb.processExists(SETTINGS_HELPER_PKG_ID), {
      waitMs: 5000,
      intervalMs: 300
    });
  } catch (err) {
    const message = `Failed to launch Appium Settings app: ${err.message}`;
    err.message = message;

    _logger.default.warn(message);

    if (throwError) {
      throw err;
    }
  }
};

helpers.pushStrings = async function pushStrings(language, adb, opts) {
  const remoteDir = '/data/local/tmp';
  const stringsJson = 'strings.json';

  const remoteFile = _path.default.posix.resolve(remoteDir, stringsJson);

  await adb.rimraf(remoteFile);
  let app;

  try {
    app = opts.app || (await adb.pullApk(opts.appPackage, opts.tmpDir));
  } catch (err) {
    _logger.default.info(`Failed to pull an apk from '${opts.appPackage}' to '${opts.tmpDir}'. Original error: ${err.message}`);
  }

  if (_lodash.default.isEmpty(opts.appPackage) || !(await _appiumSupport.fs.exists(app))) {
    _logger.default.debug(`No app or package specified. Returning empty strings`);

    return {};
  }

  const stringsTmpDir = _path.default.resolve(opts.tmpDir, opts.appPackage);

  try {
    _logger.default.debug('Extracting strings from apk', app, language, stringsTmpDir);

    const {
      apkStrings,
      localPath
    } = await adb.extractStringsFromApk(app, language, stringsTmpDir);
    await adb.push(localPath, remoteDir);
    return apkStrings;
  } catch (err) {
    _logger.default.warn(`Could not get strings, continuing anyway. Original error: ${err.message}`);

    await adb.shell('echo', [`'{}' > ${remoteFile}`]);
  } finally {
    await _appiumSupport.fs.rimraf(stringsTmpDir);
  }

  return {};
};

helpers.unlockWithUIAutomation = async function unlockWithUIAutomation(driver, adb, unlockCapabilities) {
  let unlockType = unlockCapabilities.unlockType;

  if (!_unlockHelpers.default.isValidUnlockType(unlockType)) {
    throw new Error(`Invalid unlock type ${unlockType}`);
  }

  let unlockKey = unlockCapabilities.unlockKey;

  if (!_unlockHelpers.default.isValidKey(unlockType, unlockKey)) {
    throw new Error(`Missing unlockKey ${unlockKey} capability for unlockType ${unlockType}`);
  }

  const unlockMethod = {
    [_unlockHelpers.PIN_UNLOCK]: _unlockHelpers.default.pinUnlock,
    [_unlockHelpers.PASSWORD_UNLOCK]: _unlockHelpers.default.passwordUnlock,
    [_unlockHelpers.PATTERN_UNLOCK]: _unlockHelpers.default.patternUnlock,
    [_unlockHelpers.FINGERPRINT_UNLOCK]: _unlockHelpers.default.fingerprintUnlock
  }[unlockType];
  await unlockMethod(adb, driver, unlockCapabilities);
};

helpers.unlockWithHelperApp = async function unlockWithHelperApp(adb) {
  _logger.default.info('Unlocking screen');

  let firstRun = true;
  await (0, _asyncbox.retry)(3, async function launchHelper() {
    if (firstRun) {
      firstRun = false;
    } else {
      try {
        if (!(await adb.isScreenLocked())) {
          return;
        }
      } catch (e) {
        _logger.default.warn(`Error in isScreenLocked: ${e.message}`);

        _logger.default.warn('"adb shell dumpsys window" command has timed out.');

        _logger.default.warn('The reason of this timeout is the delayed adb response. Resetting adb server can improve it.');
      }
    }

    _logger.default.info(`Launching ${SETTINGS_HELPER_UNLOCK_ACTIVITY}`);

    await adb.shell(['am', 'start', '-n', `${SETTINGS_HELPER_PKG_ID}/${SETTINGS_HELPER_UNLOCK_ACTIVITY}`, '-c', 'android.intent.category.LAUNCHER', '-a', 'android.intent.action.MAIN', '-f', '0x10200000']);
    await _bluebird.default.delay(1000);
  });
};

helpers.unlock = async function unlock(driver, adb, capabilities) {
  if (!(await adb.isScreenLocked())) {
    _logger.default.info('Screen already unlocked, doing nothing');

    return;
  }

  _logger.default.debug('Screen is locked, trying to unlock');

  if (_lodash.default.isUndefined(capabilities.unlockType)) {
    _logger.default.warn('Using app unlock, this is going to be deprecated!');

    await helpers.unlockWithHelperApp(adb);
  } else {
    await helpers.unlockWithUIAutomation(driver, adb, {
      unlockType: capabilities.unlockType,
      unlockKey: capabilities.unlockKey
    });
    await helpers.verifyUnlock(adb);
  }
};

helpers.verifyUnlock = async function verifyUnlock(adb) {
  await (0, _asyncbox.retryInterval)(2, 1000, async () => {
    if (await adb.isScreenLocked()) {
      throw new Error('Screen did not unlock successfully, retrying');
    }

    _logger.default.debug('Screen unlocked successfully');
  });
};

helpers.initDevice = async function initDevice(adb, opts) {
  if (opts.skipDeviceInitialization) {
    _logger.default.info(`'skipDeviceInitialization' is set. Skipping device initialization.`);
  } else {
    await adb.waitForDevice();
    const shouldThrowError = opts.language || opts.locale || opts.localeScript || opts.unicodeKeyboard || opts.disableWindowAnimation || !opts.skipUnlock;
    await helpers.pushSettingsApp(adb, shouldThrowError);
  }

  if (!opts.avd) {
    await helpers.setMockLocationApp(adb, SETTINGS_HELPER_PKG_ID);
  }

  if (opts.language || opts.locale) {
    await helpers.ensureDeviceLocale(adb, opts.language, opts.locale, opts.localeScript);
  }

  if (opts.skipLogcatCapture) {
    _logger.default.info(`'skipLogcatCapture' is set. Skipping starting logcat capture.`);
  } else {
    await adb.startLogcat();
  }

  if (opts.unicodeKeyboard) {
    return await helpers.initUnicodeKeyboard(adb);
  }
};

helpers.removeNullProperties = function removeNullProperties(obj) {
  for (let key of _lodash.default.keys(obj)) {
    if (_lodash.default.isNull(obj[key]) || _lodash.default.isUndefined(obj[key])) {
      delete obj[key];
    }
  }
};

helpers.truncateDecimals = function truncateDecimals(number, digits) {
  let multiplier = Math.pow(10, digits),
      adjustedNum = number * multiplier,
      truncatedNum = Math[adjustedNum < 0 ? 'ceil' : 'floor'](adjustedNum);
  return truncatedNum / multiplier;
};

helpers.isChromeBrowser = function isChromeBrowser(browser) {
  return _lodash.default.includes(Object.keys(CHROME_BROWSER_PACKAGE_ACTIVITY), (browser || '').toLowerCase());
};

helpers.getChromePkg = function getChromePkg(browser) {
  return CHROME_BROWSER_PACKAGE_ACTIVITY[browser.toLowerCase()] || CHROME_BROWSER_PACKAGE_ACTIVITY.default;
};

helpers.removeAllSessionWebSocketHandlers = async function removeAllSessionWebSocketHandlers(server, sessionId) {
  if (!server || !_lodash.default.isFunction(server.getWebSocketHandlers)) {
    return;
  }

  const activeHandlers = await server.getWebSocketHandlers(sessionId);

  for (const pathname of _lodash.default.keys(activeHandlers)) {
    await server.removeWebSocketHandler(pathname);
  }
};

helpers.parseArray = function parseArray(cap) {
  let parsedCaps;

  try {
    parsedCaps = JSON.parse(cap);
  } catch (ign) {}

  if (_lodash.default.isArray(parsedCaps)) {
    return parsedCaps;
  } else if (_lodash.default.isString(cap)) {
    return [cap];
  }

  throw new Error(`must provide a string or JSON Array; received ${cap}`);
};

helpers.validateDesiredCaps = function validateDesiredCaps(caps) {
  if ((!caps.browserName || !this.isChromeBrowser(caps.browserName)) && !caps.app && !caps.appPackage) {
    _logger.default.errorAndThrow('The desired capabilities must include either an app, appPackage or browserName');
  }

  if (caps.browserName) {
    if (caps.app) {
      _logger.default.warn(`The desired capabilities should generally not include both an 'app' and a 'browserName'`);
    }

    if (caps.appPackage) {
      _logger.default.errorAndThrow(`The desired should not include both of an 'appPackage' and a 'browserName'`);
    }
  }

  if (caps.uninstallOtherPackages) {
    try {
      this.parseArray(caps.uninstallOtherPackages);
    } catch (e) {
      _logger.default.errorAndThrow(`Could not parse "uninstallOtherPackages" capability: ${e.message}`);
    }
  }

  return true;
};

helpers.bootstrap = _bootstrap.default;
helpers.unlocker = _unlockHelpers.default;
var _default = helpers;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9hbmRyb2lkLWhlbHBlcnMuanMiXSwibmFtZXMiOlsiUEFDS0FHRV9JTlNUQUxMX1RJTUVPVVQiLCJDSFJPTUVfQlJPV1NFUl9QQUNLQUdFX0FDVElWSVRZIiwiY2hyb21lIiwicGtnIiwiYWN0aXZpdHkiLCJjaHJvbWl1bSIsImNocm9tZWJldGEiLCJicm93c2VyIiwiZGVmYXVsdCIsIlNFVFRJTkdTX0hFTFBFUl9QS0dfSUQiLCJTRVRUSU5HU19IRUxQRVJfTUFJTl9BQ1RJVklUWSIsIlNFVFRJTkdTX0hFTFBFUl9VTkxPQ0tfQUNUSVZJVFkiLCJoZWxwZXJzIiwiY3JlYXRlQmFzZUFEQiIsIm9wdHMiLCJhZGJQb3J0Iiwic3VwcHJlc3NLaWxsU2VydmVyIiwicmVtb3RlQWRiSG9zdCIsImNsZWFyRGV2aWNlTG9nc09uU3RhcnQiLCJhZGJFeGVjVGltZW91dCIsInVzZUtleXN0b3JlIiwia2V5c3RvcmVQYXRoIiwia2V5c3RvcmVQYXNzd29yZCIsImtleUFsaWFzIiwia2V5UGFzc3dvcmQiLCJyZW1vdGVBcHBzQ2FjaGVMaW1pdCIsImJ1aWxkVG9vbHNWZXJzaW9uIiwiQURCIiwiY3JlYXRlQURCIiwiZ2V0SmF2YVZlcnNpb24iLCJsb2dWZXJzaW9uIiwic3RkZXJyIiwiZSIsIkVycm9yIiwidmVyc2lvbk1hdGNoIiwiZXhlYyIsImxvZ2dlciIsImluZm8iLCJwcmVwYXJlRW11bGF0b3IiLCJhZGIiLCJhdmQiLCJhdmRBcmdzIiwibGFuZ3VhZ2UiLCJsb2NhbGUiLCJhdmRMYXVuY2hUaW1lb3V0IiwiYXZkUmVhZHlUaW1lb3V0IiwiYXZkTmFtZSIsInJlcGxhY2UiLCJydW5uaW5nQVZEIiwiZ2V0UnVubmluZ0FWRCIsInRvTG93ZXJDYXNlIiwiaW5kZXhPZiIsImRlYnVnIiwia2lsbEVtdWxhdG9yIiwicHJlcGFyZUFWREFyZ3MiLCJsYXVuY2hBVkQiLCJhcmdzIiwiXyIsImlzVW5kZWZpbmVkIiwibmV0d29ya1NwZWVkIiwiZW5zdXJlTmV0d29ya1NwZWVkIiwicHVzaCIsImlzSGVhZGxlc3MiLCJqb2luIiwidmFsdWVzIiwiTkVUV09SS19TUEVFRCIsIndhcm4iLCJGVUxMIiwiZW5zdXJlRGV2aWNlTG9jYWxlIiwiY291bnRyeSIsInNjcmlwdCIsImlzU3RyaW5nIiwic2V0RGV2aWNlTGFuZ3VhZ2VDb3VudHJ5IiwiZW5zdXJlQ3VycmVudExvY2FsZSIsIm1lc3NhZ2UiLCJnZXREZXZpY2VJbmZvRnJvbUNhcHMiLCJ1ZGlkIiwiZW1Qb3J0IiwiY3VyRGV2aWNlSWQiLCJlbXVsYXRvclBvcnQiLCJkZXZpY2VzIiwiZ2V0RGV2aWNlc1dpdGhSZXRyeSIsImluY2x1ZGVzIiwibWFwIiwiZXJyb3JBbmRUaHJvdyIsImdldFBvcnRGcm9tRW11bGF0b3JTdHJpbmciLCJwbGF0Zm9ybVZlcnNpb24iLCJ0cmltIiwiYXZhaWxEZXZpY2VzU3RyIiwiZGV2aWNlIiwic2V0RGV2aWNlSWQiLCJkZXZpY2VPUyIsImdldFBsYXRmb3JtVmVyc2lvbiIsInNldEVtdWxhdG9yUG9ydCIsInZhbGlkYXRlUGFja2FnZUFjdGl2aXR5TmFtZXMiLCJrZXkiLCJuYW1lIiwibWF0Y2giLCJpbmRleCIsInN1YnN0cmluZyIsImdldExhdW5jaEluZm8iLCJhcHAiLCJhcHBQYWNrYWdlIiwiYXBwQWN0aXZpdHkiLCJhcHBXYWl0UGFja2FnZSIsImFwcFdhaXRBY3Rpdml0eSIsImFwa1BhY2thZ2UiLCJhcGtBY3Rpdml0eSIsInBhY2thZ2VBbmRMYXVuY2hBY3Rpdml0eUZyb21NYW5pZmVzdCIsInJlc2V0QXBwIiwiZmFzdFJlc2V0IiwiZnVsbFJlc2V0IiwiYW5kcm9pZEluc3RhbGxUaW1lb3V0IiwiYXV0b0dyYW50UGVybWlzc2lvbnMiLCJhbGxvd1Rlc3RQYWNrYWdlcyIsImlzSW5zdGFsbGVkIiwiaXNBcHBJbnN0YWxsZWQiLCJmb3JjZVN0b3AiLCJpZ24iLCJvdXRwdXQiLCJjbGVhciIsImdyYW50QWxsUGVybWlzc2lvbnMiLCJlcnJvciIsInVuaW5zdGFsbEFwayIsImluc3RhbGwiLCJncmFudFBlcm1pc3Npb25zIiwidGltZW91dCIsImluc3RhbGxBcGsiLCJzaG91bGRQZXJmb3JtRmFzdFJlc2V0IiwiaW5zdGFsbE9yVXBncmFkZSIsImluc3RhbGxPdGhlckFwa3MiLCJvdGhlckFwcHMiLCJCIiwiYWxsIiwib3RoZXJBcHAiLCJ1bmluc3RhbGxPdGhlclBhY2thZ2VzIiwiYXBwUGFja2FnZXMiLCJmaWx0ZXJQYWNrYWdlcyIsImdldFRoaXJkUGFydHlQYWNrYWdlcyIsInBhY2thZ2VzU3RyaW5nIiwic2hlbGwiLCJhcHBQYWNrYWdlc0FycmF5Iiwic3BsaXQiLCJFT0wiLCJkaWZmZXJlbmNlIiwiZXJyIiwiaW5pdFVuaWNvZGVLZXlib2FyZCIsImRlZmF1bHRJTUUiLCJhcHBpdW1JTUUiLCJlbmFibGVJTUUiLCJzZXRJTUUiLCJzZXRNb2NrTG9jYXRpb25BcHAiLCJnZXRBcGlMZXZlbCIsImluc3RhbGxIZWxwZXJBcHAiLCJhcGtQYXRoIiwicGFja2FnZUlkIiwicmV0cnlJbnN0YWxsSGVscGVyQXBwIiwicHVzaFNldHRpbmdzQXBwIiwidGhyb3dFcnJvciIsInNldHRpbmdzQXBrUGF0aCIsInByb2Nlc3NFeGlzdHMiLCJzdGFydEFwcCIsImFjdGlvbiIsImNhdGVnb3J5Iiwic3RvcEFwcCIsIndhaXRGb3JMYXVuY2giLCJ3YWl0TXMiLCJpbnRlcnZhbE1zIiwicHVzaFN0cmluZ3MiLCJyZW1vdGVEaXIiLCJzdHJpbmdzSnNvbiIsInJlbW90ZUZpbGUiLCJwYXRoIiwicG9zaXgiLCJyZXNvbHZlIiwicmltcmFmIiwicHVsbEFwayIsInRtcERpciIsImlzRW1wdHkiLCJmcyIsImV4aXN0cyIsInN0cmluZ3NUbXBEaXIiLCJhcGtTdHJpbmdzIiwibG9jYWxQYXRoIiwiZXh0cmFjdFN0cmluZ3NGcm9tQXBrIiwidW5sb2NrV2l0aFVJQXV0b21hdGlvbiIsImRyaXZlciIsInVubG9ja0NhcGFiaWxpdGllcyIsInVubG9ja1R5cGUiLCJ1bmxvY2tlciIsImlzVmFsaWRVbmxvY2tUeXBlIiwidW5sb2NrS2V5IiwiaXNWYWxpZEtleSIsInVubG9ja01ldGhvZCIsIlBJTl9VTkxPQ0siLCJwaW5VbmxvY2siLCJQQVNTV09SRF9VTkxPQ0siLCJwYXNzd29yZFVubG9jayIsIlBBVFRFUk5fVU5MT0NLIiwicGF0dGVyblVubG9jayIsIkZJTkdFUlBSSU5UX1VOTE9DSyIsImZpbmdlcnByaW50VW5sb2NrIiwidW5sb2NrV2l0aEhlbHBlckFwcCIsImZpcnN0UnVuIiwibGF1bmNoSGVscGVyIiwiaXNTY3JlZW5Mb2NrZWQiLCJkZWxheSIsInVubG9jayIsImNhcGFiaWxpdGllcyIsInZlcmlmeVVubG9jayIsImluaXREZXZpY2UiLCJza2lwRGV2aWNlSW5pdGlhbGl6YXRpb24iLCJ3YWl0Rm9yRGV2aWNlIiwic2hvdWxkVGhyb3dFcnJvciIsImxvY2FsZVNjcmlwdCIsInVuaWNvZGVLZXlib2FyZCIsImRpc2FibGVXaW5kb3dBbmltYXRpb24iLCJza2lwVW5sb2NrIiwic2tpcExvZ2NhdENhcHR1cmUiLCJzdGFydExvZ2NhdCIsInJlbW92ZU51bGxQcm9wZXJ0aWVzIiwib2JqIiwia2V5cyIsImlzTnVsbCIsInRydW5jYXRlRGVjaW1hbHMiLCJudW1iZXIiLCJkaWdpdHMiLCJtdWx0aXBsaWVyIiwiTWF0aCIsInBvdyIsImFkanVzdGVkTnVtIiwidHJ1bmNhdGVkTnVtIiwiaXNDaHJvbWVCcm93c2VyIiwiT2JqZWN0IiwiZ2V0Q2hyb21lUGtnIiwicmVtb3ZlQWxsU2Vzc2lvbldlYlNvY2tldEhhbmRsZXJzIiwic2VydmVyIiwic2Vzc2lvbklkIiwiaXNGdW5jdGlvbiIsImdldFdlYlNvY2tldEhhbmRsZXJzIiwiYWN0aXZlSGFuZGxlcnMiLCJwYXRobmFtZSIsInJlbW92ZVdlYlNvY2tldEhhbmRsZXIiLCJwYXJzZUFycmF5IiwiY2FwIiwicGFyc2VkQ2FwcyIsIkpTT04iLCJwYXJzZSIsImlzQXJyYXkiLCJ2YWxpZGF0ZURlc2lyZWRDYXBzIiwiY2FwcyIsImJyb3dzZXJOYW1lIiwi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d0wsSUFBSSxDQUFDcEosVUFBVCxFQUFxQjtBQUNuQmxFLHNCQUFPZ0QsYUFBUCxDQUFzQiw0RUFBdEI7QUFDRDtBQUNGOztBQUVELE1BQUlzSyxJQUFJLENBQUNuSCxzQkFBVCxFQUFpQztBQUMvQixRQUFJO0FBQ0YsV0FBSzRHLFVBQUwsQ0FBZ0JPLElBQUksQ0FBQ25ILHNCQUFyQjtBQUNELEtBRkQsQ0FFRSxPQUFPdkcsQ0FBUCxFQUFVO0FBQ1ZJLHNCQUFPZ0QsYUFBUCxDQUFzQix3REFBdURwRCxDQUFDLENBQUMwQyxPQUFRLEVBQXZGO0FBQ0Q7QUFDRjs7QUFFRCxTQUFPLElBQVA7QUFDRCxDQXhCRDs7QUEwQkE5RCxPQUFPLENBQUNnUCxTQUFSLEdBQW9CQyxrQkFBcEI7QUFDQWpQLE9BQU8sQ0FBQ2lMLFFBQVIsR0FBbUJBLHNCQUFuQjtlQUdlakwsTyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCB7IGV4ZWMgfSBmcm9tICd0ZWVuX3Byb2Nlc3MnO1xuaW1wb3J0IHsgcmV0cnksIHJldHJ5SW50ZXJ2YWwsIHdhaXRGb3JDb25kaXRpb24gfSBmcm9tICdhc3luY2JveCc7XG5pbXBvcnQgbG9nZ2VyIGZyb20gJy4vbG9nZ2VyJztcbmltcG9ydCB7IGZzIH0gZnJvbSAnYXBwaXVtLXN1cHBvcnQnO1xuaW1wb3J0IHsgcGF0aCBhcyBzZXR0aW5nc0Fwa1BhdGggfSBmcm9tICdpby5hcHBpdW0uc2V0dGluZ3MnO1xuaW1wb3J0IEJvb3RzdHJhcCBmcm9tICcuL2Jvb3RzdHJhcCc7XG5pbXBvcnQgQiBmcm9tICdibHVlYmlyZCc7XG5pbXBvcnQgQURCIGZyb20gJ2FwcGl1bS1hZGInO1xuaW1wb3J0IHtcbiAgZGVmYXVsdCBhcyB1bmxvY2tlciwgUElOX1VOTE9DSywgUEFTU1dPUkRfVU5MT0NLLFxuICBQQVRURVJOX1VOTE9DSywgRklOR0VSUFJJTlRfVU5MT0NLIH0gZnJvbSAnLi91bmxvY2staGVscGVycyc7XG5pbXBvcnQgeyBFT0wgfSBmcm9tICdvcyc7XG5cbmNvbnN0IFBBQ0tBR0VfSU5TVEFMTF9USU1FT1VUID0gOTAwMDA7IC8vIG1pbGxpc2Vjb25kc1xuY29uc3QgQ0hST01FX0JST1dTRVJfUEFDS0FHRV9BQ1RJVklUWSA9IHtcbiAgY2hyb21lOiB7XG4gICAgcGtnOiAnY29tLmFuZHJvaWQuY2hyb21lJyxcbiAgICBhY3Rpdml0eTogJ2NvbS5nb29nbGUuYW5kcm9pZC5hcHBzLmNocm9tZS5NYWluJyxcbiAgfSxcbiAgY2hyb21pdW06IHtcbiAgICBwa2c6ICdvcmcuY2hyb21pdW0uY2hyb21lLnNoZWxsJyxcbiAgICBhY3Rpdml0eTogJy5DaHJvbWVTaGVsbEFjdGl2aXR5JyxcbiAgfSxcbiAgY2hyb21lYmV0YToge1xuICAgIHBrZzogJ2NvbS5jaHJvbWUuYmV0YScsXG4gICAgYWN0aXZpdHk6ICdjb20uZ29vZ2xlLmFuZHJvaWQuYXBwcy5jaHJvbWUuTWFpbicsXG4gIH0sXG4gIGJyb3dzZXI6IHtcbiAgICBwa2c6ICdjb20uYW5kcm9pZC5icm93c2VyJyxcbiAgICBhY3Rpdml0eTogJ2NvbS5hbmRyb2lkLmJyb3dzZXIuQnJvd3NlckFjdGl2aXR5JyxcbiAgfSxcbiAgJ2Nocm9taXVtLWJyb3dzZXInOiB7XG4gICAgcGtnOiAnb3JnLmNocm9taXVtLmNocm9tZScsXG4gICAgYWN0aXZpdHk6ICdjb20uZ29vZ2xlLmFuZHJvaWQuYXBwcy5jaHJvbWUuTWFpbicsXG4gIH0sXG4gICdjaHJvbWl1bS13ZWJ2aWV3Jzoge1xuICAgIHBrZzogJ29yZy5jaHJvbWl1bS53ZWJ2aWV3X3NoZWxsJyxcbiAgICBhY3Rpdml0eTogJ29yZy5jaHJvbWl1bS53ZWJ2aWV3X3NoZWxsLldlYlZpZXdCcm93c2VyQWN0aXZpdHknLFxuICB9LFxuICBkZWZhdWx0OiB7XG4gICAgcGtnOiAnY29tLmFuZHJvaWQuY2hyb21lJyxcbiAgICBhY3Rpdml0eTogJ2NvbS5nb29nbGUuYW5kcm9pZC5hcHBzLmNocm9tZS5NYWluJyxcbiAgfSxcbn07XG5jb25zdCBTRVRUSU5HU19IRUxQRVJfUEtHX0lEID0gJ2lvLmFwcGl1bS5zZXR0aW5ncyc7XG5jb25zdCBTRVRUSU5HU19IRUxQRVJfTUFJTl9BQ1RJVklUWSA9ICcuU2V0dGluZ3MnO1xuY29uc3QgU0VUVElOR1NfSEVMUEVSX1VOTE9DS19BQ1RJVklUWSA9ICcuVW5sb2NrJztcblxubGV0IGhlbHBlcnMgPSB7fTtcblxuaGVscGVycy5jcmVhdGVCYXNlQURCID0gYXN5bmMgZnVuY3Rpb24gY3JlYXRlQmFzZUFEQiAob3B0cyA9IHt9KSB7XG4gIC8vIGZpbHRlciBvdXQgYW55IHVud2FudGVkIG9wdGlvbnMgc2VudCBpblxuICAvLyB0aGlzIGxpc3Qgc2hvdWxkIGJlIHVwZGF0ZWQgYXMgQURCIHRha2VzIG1vcmUgYXJndW1lbnRzXG4gIGNvbnN0IHtcbiAgICBhZGJQb3J0LFxuICAgIHN1cHByZXNzS2lsbFNlcnZlcixcbiAgICByZW1vdGVBZGJIb3N0LFxuICAgIGNsZWFyRGV2aWNlTG9nc09uU3RhcnQsXG4gICAgYWRiRXhlY1RpbWVvdXQsXG4gICAgdXNlS2V5c3RvcmUsXG4gICAga2V5c3RvcmVQYXRoLFxuICAgIGtleXN0b3JlUGFzc3dvcmQsXG4gICAga2V5QWxpYXMsXG4gICAga2V5UGFzc3dvcmQsXG4gICAgcmVtb3RlQXBwc0NhY2hlTGltaXQsXG4gICAgYnVpbGRUb29sc1ZlcnNpb24sXG4gIH0gPSBvcHRzO1xuICByZXR1cm4gYXdhaXQgQURCLmNyZWF0ZUFEQih7XG4gICAgYWRiUG9ydCxcbiAgICBzdXBwcmVzc0tpbGxTZXJ2ZXIsXG4gICAgcmVtb3RlQWRiSG9zdCxcbiAgICBjbGVhckRldmljZUxvZ3NPblN0YXJ0LFxuICAgIGFkYkV4ZWNUaW1lb3V0LFxuICAgIHVzZUtleXN0b3JlLFxuICAgIGtleXN0b3JlUGF0aCxcbiAgICBrZXlzdG9yZVBhc3N3b3JkLFxuICAgIGtleUFsaWFzLFxuICAgIGtleVBhc3N3b3JkLFxuICAgIHJlbW90ZUFwcHNDYWNoZUxpbWl0LFxuICAgIGJ1aWxkVG9vbHNWZXJzaW9uLFxuICB9KTtcbn07XG5cbmhlbHBlcnMuZ2V0SmF2YVZlcnNpb24gPSBhc3luYyBmdW5jdGlvbiBnZXRKYXZhVmVyc2lvbiAobG9nVmVyc2lvbiA9IHRydWUpIHtcbiAgbGV0IHN0ZGVycjtcbiAgdHJ5IHtcbiAgICAoe3N0ZGVycn0gPSBhd2FpdCBleGVjKCdqYXZhJywgWyctdmVyc2lvbiddKSk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYENvdWxkIG5vdCBnZXQgdGhlIEphdmEgdmVyc2lvbi4gSXMgSmF2YSBpbnN0YWxsZWQ/IE9yaWdpbmFsIGVycm9yOiAke2Uuc3RkZXJyfWApO1xuICB9XG4gIGNvbnN0IHZlcnNpb25NYXRjaCA9IC8oamF2YXxvcGVuamRrKVxccyt2ZXJzaW9uLis/KFswLTkuX10rKS9pLmV4ZWMoc3RkZXJyKTtcbiAgaWYgKCF2ZXJzaW9uTWF0Y2gpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYENvdWxkIG5vdCBwYXJzZSBKYXZhIHZlcnNpb24uIElzIEphdmEgaW5zdGFsbGVkPyBPcmlnaW5hbCBvdXRwdXQ6ICR7c3RkZXJyfWApO1xuICB9XG4gIGlmIChsb2dWZXJzaW9uKSB7XG4gICAgbG9nZ2VyLmluZm8oYEphdmEgdmVyc2lvbiBpczogJHt2ZXJzaW9uTWF0Y2hbMl19YCk7XG4gIH1cbiAgcmV0dXJuIHZlcnNpb25NYXRjaFsyXTtcbn07XG5cbmhlbHBlcnMucHJlcGFyZUVtdWxhdG9yID0gYXN5bmMgZnVuY3Rpb24gcHJlcGFyZUVtdWxhdG9yIChhZGIsIG9wdHMpIHtcbiAgbGV0IHtcbiAgICBhdmQsXG4gICAgYXZkQXJncyxcbiAgICBsYW5ndWFnZSxcbiAgICBsb2NhbGUsXG4gICAgYXZkTGF1bmNoVGltZW91dCxcbiAgICBhdmRSZWFkeVRpbWVvdXQsXG4gIH0gPSBvcHRzO1xuICBpZiAoIWF2ZCkge1xuICAgIHRocm93IG5ldyBFcnJvcignQ2Fubm90IGxhdW5jaCBBVkQgd2l0aG91dCBBVkQgbmFtZScpO1xuICB9XG4gIGxldCBhdmROYW1lID0gYXZkLnJlcGxhY2UoJ0AnLCAnJyk7XG4gIGxldCBydW5uaW5nQVZEID0gYXdhaXQgYWRiLmdldFJ1bm5pbmdBVkQoYXZkTmFtZSk7XG4gIGlmIChydW5uaW5nQVZEICE9PSBudWxsKSB7XG4gICAgaWYgKGF2ZEFyZ3MgJiYgYXZkQXJncy50b0xvd2VyQ2FzZSgpLmluZGV4T2YoJy13aXBlLWRhdGEnKSA+IC0xKSB7XG4gICAgICBsb2dnZXIuZGVidWcoYEtpbGxpbmcgJyR7YXZkTmFtZX0nIGJlY2F1c2UgaXQgbmVlZHMgdG8gYmUgd2lwZWQgYXQgc3RhcnQuYCk7XG4gICAgICBhd2FpdCBhZGIua2lsbEVtdWxhdG9yKGF2ZE5hbWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICBsb2dnZXIuZGVidWcoJ05vdCBsYXVuY2hpbmcgQVZEIGJlY2F1c2UgaXQgaXMgYWxyZWFkeSBydW5uaW5nLicpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgfVxuICBhdmRBcmdzID0gdGhpcy5wcmVwYXJlQVZEQXJncyhvcHRzLCBhZGIsIGF2ZEFyZ3MpO1xuICBhd2FpdCBhZGIubGF1bmNoQVZEKGF2ZCwgYXZkQXJncywgbGFuZ3VhZ2UsIGxvY2FsZSwgYXZkTGF1bmNoVGltZW91dCxcbiAgICAgICAgICAgICAgICAgICAgICBhdmRSZWFkeVRpbWVvdXQpO1xufTtcblxuaGVscGVycy5wcmVwYXJlQVZEQXJncyA9IGZ1bmN0aW9uIHByZXBhcmVBVkRBcmdzIChvcHRzLCBhZGIsIGF2ZEFyZ3MpIHtcbiAgbGV0IGFyZ3MgPSBhdmRBcmdzID8gW2F2ZEFyZ3NdIDogW107XG4gIGlmICghXy5pc1VuZGVmaW5lZChvcHRzLm5ldHdvcmtTcGVlZCkpIHtcbiAgICBsZXQgbmV0d29ya1NwZWVkID0gdGhpcy5lbnN1cmVOZXR3b3JrU3BlZWQoYWRiLCBvcHRzLm5ldHdvcmtTcGVlZCk7XG4gICAgYXJncy5wdXNoKCctbmV0c3BlZWQnLCBuZXR3b3JrU3BlZWQpO1xuICB9XG4gIGlmIChvcHRzLmlzSGVhZGxlc3MpIHtcbiAgICBhcmdzLnB1c2goJy1uby13aW5kb3cnKTtcbiAgfVxuICByZXR1cm4gYXJncy5qb2luKCcgJyk7XG59O1xuXG5oZWxwZXJzLmVuc3VyZU5ldHdvcmtTcGVlZCA9IGZ1bmN0aW9uIGVuc3VyZU5ldHdvcmtTcGVlZCAoYWRiLCBuZXR3b3JrU3BlZWQpIHtcbiAgaWYgKF8udmFsdWVzKGFkYi5ORVRXT1JLX1NQRUVEKS5pbmRleE9mKG5ldHdvcmtTcGVlZCkgIT09IC0xKSB7XG4gICAgcmV0dXJuIG5ldHdvcmtTcGVlZDtcbiAgfVxuICBsb2dnZXIud2FybihgV3JvbmcgbmV0d29yayBzcGVlZCBwYXJhbSAke25ldHdvcmtTcGVlZH0sIHVzaW5nIGRlZmF1bHQ6IGZ1bGwuIFN1cHBvcnRlZCB2YWx1ZXM6ICR7Xy52YWx1ZXMoYWRiLk5FVFdPUktfU1BFRUQpfWApO1xuICByZXR1cm4gYWRiLk5FVFdPUktfU1BFRUQuRlVMTDtcbn07XG5cbi8qKlxuICogU2V0IGFuZCBlbnN1cmUgdGhlIGxvY2FsZSBuYW1lIG9mIHRoZSBkZXZpY2UgdW5kZXIgdGVzdC5cbiAqXG4gKiBAcGFyYW0ge09iamVjdH0gYWRiIC0gVGhlIGFkYiBtb2R1bGUgaW5zdGFuY2UuXG4gKiBAcGFyYW0ge3N0cmluZ30gbGFuZ3VhZ2UgLSBMYW5ndWFnZS4gVGhlIGxhbmd1YWdlIGZpZWxkIGlzIGNhc2UgaW5zZW5zaXRpdmUsIGJ1dCBMb2NhbGUgYWx3YXlzIGNhbm9uaWNhbGl6ZXMgdG8gbG93ZXIgY2FzZS5cbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1hdDogW2EtekEtWl17Miw4fS4gZS5nLiBlbiwgamEgOiBodHRwczovL2RldmVsb3Blci5hbmRyb2lkLmNvbS9yZWZlcmVuY2UvamF2YS91dGlsL0xvY2FsZS5odG1sXG4gKiBAcGFyYW0ge3N0cmluZ30gY291bnRyeSAtIENvdW50cnkuIFRoZSBjb3VudHJ5IChyZWdpb24pIGZpZWxkIGlzIGNhc2UgaW5zZW5zaXRpdmUsIGJ1dCBMb2NhbGUgYWx3YXlzIGNhbm9uaWNhbGl6ZXMgdG8gdXBwZXIgY2FzZS5cbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1hdDogW2EtekEtWl17Mn0gfCBbMC05XXszfS4gZS5nLiBVUywgSlAgOiBodHRwczovL2RldmVsb3Blci5hbmRyb2lkLmNvbS9yZWZlcmVuY2UvamF2YS91dGlsL0xvY2FsZS5odG1sXG4gKiBAcGFyYW0gez9zdHJpbmd9IHNjcmlwdCAtIFNjcmlwdC4gVGhlIHNjcmlwdCBmaWVsZCBpcyBjYXNlIGluc2Vuc2l0aXZlIGJ1dCBMb2NhbGUgYWx3YXlzIGNhbm9uaWNhbGl6ZXMgdG8gdGl0bGUgY2FzZS5cbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1hdDogW2EtekEtWl17NH0uIGUuZy4gSGFucyBpbiB6aC1IYW5zLUNOIDogaHR0cHM6Ly9kZXZlbG9wZXIuYW5kcm9pZC5jb20vcmVmZXJlbmNlL2phdmEvdXRpbC9Mb2NhbGUuaHRtbFxuICogQHRocm93cyB7RXJyb3J9IElmIGl0IGZhaWxlZCB0byBzZXQgbG9jYWxlIHByb3Blcmx5XG4gKi9cbmhlbHBlcnMuZW5zdXJlRGV2aWNlTG9jYWxlID0gYXN5bmMgZnVuY3Rpb24gZW5zdXJlRGV2aWNlTG9jYWxlIChhZGIsIGxhbmd1YWdlLCBjb3VudHJ5LCBzY3JpcHQgPSBudWxsKSB7XG4gIGlmICghXy5pc1N0cmluZyhsYW5ndWFnZSkgJiYgIV8uaXNTdHJpbmcoY291bnRyeSkpIHtcbiAgICBsb2dnZXIud2Fybihgc2V0RGV2aWNlTGFuZ3VhZ2VDb3VudHJ5IHJlcXVpcmVzIGxhbmd1YWdlIG9yIGNvdW50cnkuYCk7XG4gICAgbG9nZ2VyLndhcm4oYEdvdCBsYW5ndWFnZTogJyR7bGFuZ3VhZ2V9JyBhbmQgY291bnRyeTogJyR7Y291bnRyeX0nYCk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgYXdhaXQgYWRiLnNldERldmljZUxhbmd1YWdlQ291bnRyeShsYW5ndWFnZSwgY291bnRyeSwgc2NyaXB0KTtcblxuICBpZiAoIWF3YWl0IGFkYi5lbnN1cmVDdXJyZW50TG9jYWxlKGxhbmd1YWdlLCBjb3VudHJ5LCBzY3JpcHQpKSB7XG4gICAgY29uc3QgbWVzc2FnZSA9IHNjcmlwdCA/IGBsYW5ndWFnZTogJHtsYW5ndWFnZX0sIGNvdW50cnk6ICR7Y291bnRyeX0gYW5kIHNjcmlwdDogJHtzY3JpcHR9YCA6IGBsYW5ndWFnZTogJHtsYW5ndWFnZX0gYW5kIGNvdW50cnk6ICR7Y291bnRyeX1gO1xuICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIHNldCAke21lc3NhZ2V9YCk7XG4gIH1cbn07XG5cbmhlbHBlcnMuZ2V0RGV2aWNlSW5mb0Zyb21DYXBzID0gYXN5bmMgZnVuY3Rpb24gZ2V0RGV2aWNlSW5mb0Zyb21DYXBzIChvcHRzID0ge30pIHtcbiAgLy8gd2UgY2FuIGNyZWF0ZSBhIHRocm93YXdheSBBREIgaW5zdGFuY2UgaGVyZSwgc28gdGhlcmUgaXMgbm8gZGVwZW5kZW5jeVxuICAvLyBvbiBpbnN0YW50aWF0aW5nIG9uIGVhcmxpZXIgKGF0IHRoaXMgcG9pbnQsIHdlIGhhdmUgbm8gdWRpZClcbiAgLy8gd2UgY2FuIG9ubHkgdXNlIHRoaXMgQURCIG9iamVjdCBmb3IgY29tbWFuZHMgdGhhdCB3b3VsZCBub3QgYmUgY29uZnVzZWRcbiAgLy8gaWYgbXVsdGlwbGUgZGV2aWNlcyBhcmUgY29ubmVjdGVkXG4gIGNvbnN0IGFkYiA9IGF3YWl0IGhlbHBlcnMuY3JlYXRlQmFzZUFEQihvcHRzKTtcbiAgbGV0IHVkaWQgPSBvcHRzLnVkaWQ7XG4gIGxldCBlbVBvcnQgPSBudWxsO1xuXG4gIC8vIGEgc3BlY2lmaWMgYXZkIG5hbWUgd2FzIGdpdmVuLiB0cnkgdG8gaW5pdGlhbGl6ZSB3aXRoIHRoYXRcbiAgaWYgKG9wdHMuYXZkKSB7XG4gICAgYXdhaXQgaGVscGVycy5wcmVwYXJlRW11bGF0b3IoYWRiLCBvcHRzKTtcbiAgICB1ZGlkID0gYWRiLmN1ckRldmljZUlkO1xuICAgIGVtUG9ydCA9IGFkYi5lbXVsYXRvclBvcnQ7XG4gIH0gZWxzZSB7XG4gICAgLy8gbm8gYXZkIGdpdmVuLiBsZXRzIHRyeSB3aGF0ZXZlcidzIHBsdWdnZWQgaW4gZGV2aWNlcy9lbXVsYXRvcnNcbiAgICBsb2dnZXIuaW5mbygnUmV0cmlldmluZyBkZXZpY2UgbGlzdCcpO1xuICAgIGxldCBkZXZpY2VzID0gYXdhaXQgYWRiLmdldERldmljZXNXaXRoUmV0cnkoKTtcblxuICAgIC8vIHVkaWQgd2FzIGdpdmVuLCBsZXRzIHRyeSB0byBpbml0IHdpdGggdGhhdCBkZXZpY2VcbiAgICBpZiAodWRpZCkge1xuICAgICAgaWYgKCFfLmluY2x1ZGVzKF8ubWFwKGRldmljZXMsICd1ZGlkJyksIHVkaWQpKSB7XG4gICAgICAgIGxvZ2dlci5lcnJvckFuZFRocm93KGBEZXZpY2UgJHt1ZGlkfSB3YXMgbm90IGluIHRoZSBsaXN0IG9mIGNvbm5lY3RlZCBkZXZpY2VzYCk7XG4gICAgICB9XG4gICAgICBlbVBvcnQgPSBhZGIuZ2V0UG9ydEZyb21FbXVsYXRvclN0cmluZyh1ZGlkKTtcbiAgICB9IGVsc2UgaWYgKG9wdHMucGxhdGZvcm1WZXJzaW9uKSB7XG4gICAgICBvcHRzLnBsYXRmb3JtVmVyc2lvbiA9IGAke29wdHMucGxhdGZvcm1WZXJzaW9ufWAudHJpbSgpO1xuXG4gICAgICAvLyBhIHBsYXRmb3JtIHZlcnNpb24gd2FzIGdpdmVuLiBsZXRzIHRyeSB0byBmaW5kIGEgZGV2aWNlIHdpdGggdGhlIHNhbWUgb3NcbiAgICAgIGxvZ2dlci5pbmZvKGBMb29raW5nIGZvciBhIGRldmljZSB3aXRoIEFuZHJvaWQgJyR7b3B0cy5wbGF0Zm9ybVZlcnNpb259J2ApO1xuXG4gICAgICAvLyBpbiBjYXNlIHdlIGZhaWwgdG8gZmluZCBzb21ldGhpbmcsIGdpdmUgdGhlIHVzZXIgYSB1c2VmdWwgbG9nIHRoYXQgaGFzXG4gICAgICAvLyB0aGUgZGV2aWNlIHVkaWRzIGFuZCBvcyB2ZXJzaW9ucyBzbyB0aGV5IGtub3cgd2hhdCdzIGF2YWlsYWJsZVxuICAgICAgbGV0IGF2YWlsRGV2aWNlc1N0ciA9IFtdO1xuXG4gICAgICAvLyBmaXJzdCB0cnkgc3RhcnRlZCBkZXZpY2VzL2VtdWxhdG9yc1xuICAgICAgZm9yIChsZXQgZGV2aWNlIG9mIGRldmljZXMpIHtcbiAgICAgICAgLy8gZGlyZWN0IGFkYiBjYWxscyB0byB0aGUgc3BlY2lmaWMgZGV2aWNlXG4gICAgICAgIGF3YWl0IGFkYi5zZXREZXZpY2VJZChkZXZpY2UudWRpZCk7XG4gICAgICAgIGxldCBkZXZpY2VPUyA9IGF3YWl0IGFkYi5nZXRQbGF0Zm9ybVZlcnNpb24oKTtcblxuICAgICAgICAvLyBidWlsZCB1cCBvdXIgaW5mbyBzdHJpbmcgb2YgYXZhaWxhYmxlIGRldmljZXMgYXMgd2UgaXRlcmF0ZVxuICAgICAgICBhdmFpbERldmljZXNTdHIucHVzaChgJHtkZXZpY2UudWRpZH0gKCR7ZGV2aWNlT1N9KWApO1xuXG4gICAgICAgIC8vIHdlIGRvIGEgYmVnaW5zIHdpdGggY2hlY2sgZm9yIGltcGxpZWQgd2lsZGNhcmQgbWF0Y2hpbmdcbiAgICAgICAgLy8gZWc6IDQgbWF0Y2hlcyA0LjEsIDQuMCwgNC4xLjMtc2Ftc3VuZywgZXRjXG4gICAgICAgIGlmIChkZXZpY2VPUy5pbmRleE9mKG9wdHMucGxhdGZvcm1WZXJzaW9uKSA9PT0gMCkge1xuICAgICAgICAgIHVkaWQgPSBkZXZpY2UudWRpZDtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyB3ZSBjb3VsZG4ndCBmaW5kIGFueXRoaW5nISBxdWl0XG4gICAgICBpZiAoIXVkaWQpIHtcbiAgICAgICAgbG9nZ2VyLmVycm9yQW5kVGhyb3coYFVuYWJsZSB0byBmaW5kIGFuIGFjdGl2ZSBkZXZpY2Ugb3IgZW11bGF0b3IgYCArXG4gICAgICAgICAgYHdpdGggT1MgJHtvcHRzLnBsYXRmb3JtVmVyc2lvbn0uIFRoZSBmb2xsb3dpbmcgYXJlIGF2YWlsYWJsZTogYCArIGF2YWlsRGV2aWNlc1N0ci5qb2luKCcsICcpKTtcbiAgICAgIH1cblxuICAgICAgZW1Qb3J0ID0gYWRiLmdldFBvcnRGcm9tRW11bGF0b3JTdHJpbmcodWRpZCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIGEgdWRpZCB3YXMgbm90IGdpdmVuLCBncmFiIHRoZSBmaXJzdCBkZXZpY2Ugd2Ugc2VlXG4gICAgICB1ZGlkID0gZGV2aWNlc1swXS51ZGlkO1xuICAgICAgZW1Qb3J0ID0gYWRiLmdldFBvcnRGcm9tRW11bGF0b3JTdHJpbmcodWRpZCk7XG4gICAgfVxuICB9XG5cbiAgbG9nZ2VyLmluZm8oYFVzaW5nIGRldmljZTogJHt1ZGlkfWApO1xuICByZXR1cm4ge3VkaWQsIGVtUG9ydH07XG59O1xuXG4vLyByZXR1cm5zIGEgbmV3IGFkYiBpbnN0YW5jZSB3aXRoIGRldmljZUlkIHNldFxuaGVscGVycy5jcmVhdGVBREIgPSBhc3luYyBmdW5jdGlvbiBjcmVhdGVBREIgKG9wdHMgPSB7fSkge1xuICBjb25zdCB7dWRpZCwgZW1Qb3J0fSA9IG9wdHM7XG4gIGNvbnN0IGFkYiA9IGF3YWl0IGhlbHBlcnMuY3JlYXRlQmFzZUFEQihvcHRzKTtcbiAgYWRiLnNldERldmljZUlkKHVkaWQpO1xuICBpZiAoZW1Qb3J0KSB7XG4gICAgYWRiLnNldEVtdWxhdG9yUG9ydChlbVBvcnQpO1xuICB9XG5cbiAgcmV0dXJuIGFkYjtcbn07XG5cbmhlbHBlcnMudmFsaWRhdGVQYWNrYWdlQWN0aXZpdHlOYW1lcyA9IGZ1bmN0aW9uIHZhbGlkYXRlUGFja2FnZUFjdGl2aXR5TmFtZXMgKG9wdHMpIHtcbiAgZm9yIChjb25zdCBrZXkgb2YgWydhcHBQYWNrYWdlJywgJ2FwcEFjdGl2aXR5JywgJ2FwcFdhaXRQYWNrYWdlJywgJ2FwcFdhaXRBY3Rpdml0eSddKSB7XG4gICAgY29uc3QgbmFtZSA9IG9wdHNba2V5XTtcbiAgICBpZiAoIW5hbWUpIHtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIGNvbnN0IG1hdGNoID0gLyhbXlxcdy4qLF0pKy8uZXhlYyhuYW1lKTtcbiAgICBpZiAoIW1hdGNoKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICBsb2dnZXIud2FybihgQ2FwYWJpbGl0eSAnJHtrZXl9JyBpcyBleHBlY3RlZCB0byBvbmx5IGluY2x1ZGUgbGF0aW4gbGV0dGVycywgZGlnaXRzLCB1bmRlcnNjb3JlLCBkb3QsIGNvbW1hIGFuZCBhc3RlcmlzayBjaGFyYWN0ZXJzLmApO1xuICAgIGxvZ2dlci53YXJuKGBDdXJyZW50IHZhbHVlICcke25hbWV9JyBoYXMgbm9uLW1hdGNoaW5nIGNoYXJhY3RlciBhdCBpbmRleCAke21hdGNoLmluZGV4fTogJyR7bmFtZS5zdWJzdHJpbmcoMCwgbWF0Y2guaW5kZXggKyAxKX0nYCk7XG4gIH1cbn07XG5cbmhlbHBlcnMuZ2V0TGF1bmNoSW5mbyA9IGFzeW5jIGZ1bmN0aW9uIGdldExhdW5jaEluZm8gKGFkYiwgb3B0cykge1xuICBsZXQge2FwcCwgYXBwUGFja2FnZSwgYXBwQWN0aXZpdHksIGFwcFdhaXRQYWNrYWdlLCBhcHBXYWl0QWN0aXZpdHl9ID0gb3B0cztcbiAgaWYgKCFhcHApIHtcbiAgICBsb2dnZXIud2FybignTm8gYXBwIHNlbnQgaW4sIG5vdCBwYXJzaW5nIHBhY2thZ2UvYWN0aXZpdHknKTtcbiAgICByZXR1cm47XG4gIH1cblxuICB0aGlzLnZhbGlkYXRlUGFja2FnZUFjdGl2aXR5TmFtZXMob3B0cyk7XG5cbiAgaWYgKGFwcFBhY2thZ2UgJiYgYXBwQWN0aXZpdHkpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBsb2dnZXIuZGVidWcoJ1BhcnNpbmcgcGFja2FnZSBhbmQgYWN0aXZpdHkgZnJvbSBhcHAgbWFuaWZlc3QnKTtcbiAgbGV0IHthcGtQYWNrYWdlLCBhcGtBY3Rpdml0eX0gPVxuICAgIGF3YWl0IGFkYi5wYWNrYWdlQW5kTGF1bmNoQWN0aXZpdHlGcm9tTWFuaWZlc3QoYXBwKTtcbiAgaWYgKGFwa1BhY2thZ2UgJiYgIWFwcFBhY2thZ2UpIHtcbiAgICBhcHBQYWNrYWdlID0gYXBrUGFja2FnZTtcbiAgfVxuICBpZiAoIWFwcFdhaXRQYWNrYWdlKSB7XG4gICAgYXBwV2FpdFBhY2thZ2UgPSBhcHBQYWNrYWdlO1xuICB9XG4gIGlmIChhcGtBY3Rpdml0eSAmJiAhYXBwQWN0aXZpdHkpIHtcbiAgICBhcHBBY3Rpdml0eSA9IGFwa0FjdGl2aXR5O1xuICB9XG4gIGlmICghYXBwV2FpdEFjdGl2aXR5KSB7XG4gICAgYXBwV2FpdEFjdGl2aXR5ID0gYXBwQWN0aXZpdHk7XG4gIH1cbiAgbG9nZ2VyLmRlYnVnKGBQYXJzZWQgcGFja2FnZSBhbmQgYWN0aXZpdHkgYXJlOiAke2Fwa1BhY2thZ2V9LyR7YXBrQWN0aXZpdHl9YCk7XG4gIHJldHVybiB7YXBwUGFja2FnZSwgYXBwV2FpdFBhY2thZ2UsIGFwcEFjdGl2aXR5LCBhcHBXYWl0QWN0aXZpdHl9O1xufTtcblxuaGVscGVycy5yZXNldEFwcCA9IGFzeW5jIGZ1bmN0aW9uIHJlc2V0QXBwIChhZGIsIG9wdHMgPSB7fSkge1xuICBjb25zdCB7XG4gICAgYXBwLFxuICAgIGFwcFBhY2thZ2UsXG4gICAgZmFzdFJlc2V0LFxuICAgIGZ1bGxSZXNldCxcbiAgICBhbmRyb2lkSW5zdGFsbFRpbWVvdXQgPSBQQUNLQUdFX0lOU1RBTExfVElNRU9VVCxcbiAgICBhdXRvR3JhbnRQZXJtaXNzaW9ucyxcbiAgICBhbGxvd1Rlc3RQYWNrYWdlc1xuICB9ID0gb3B0cztcblxuICBpZiAoIWFwcFBhY2thZ2UpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCInYXBwUGFja2FnZScgb3B0aW9uIGlzIHJlcXVpcmVkXCIpO1xuICB9XG5cbiAgY29uc3QgaXNJbnN0YWxsZWQgPSBhd2FpdCBhZGIuaXNBcHBJbnN0YWxsZWQoYXBwUGFja2FnZSk7XG5cbiAgaWYgKGlzSW5zdGFsbGVkKSB7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IGFkYi5mb3JjZVN0b3AoYXBwUGFja2FnZSk7XG4gICAgfSBjYXRjaCAoaWduKSB7fVxuICAgIC8vIGZ1bGxSZXNldCBoYXMgcHJpb3JpdHkgb3ZlciBmYXN0UmVzZXRcbiAgICBpZiAoIWZ1bGxSZXNldCAmJiBmYXN0UmVzZXQpIHtcbiAgICAgIGNvbnN0IG91dHB1dCA9IGF3YWl0IGFkYi5jbGVhcihhcHBQYWNrYWdlKTtcbiAgICAgIGlmIChfLmlzU3RyaW5nKG91dHB1dCkgJiYgb3V0cHV0LnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoJ2ZhaWxlZCcpKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgQ2Fubm90IGNsZWFyIHRoZSBhcHBsaWNhdGlvbiBkYXRhIG9mICcke2FwcFBhY2thZ2V9Jy4gT3JpZ2luYWwgZXJyb3I6ICR7b3V0cHV0fWApO1xuICAgICAgfVxuICAgICAgLy8gZXhlY3V0aW5nIGBzaGVsbCBwbSBjbGVhcmAgcmVzZXRzIHByZXZpb3VzbHkgYXNzaWduZWQgYXBwbGljYXRpb24gcGVybWlzc2lvbnMgYXMgd2VsbFxuICAgICAgaWYgKGF1dG9HcmFudFBlcm1pc3Npb25zKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgYXdhaXQgYWRiLmdyYW50QWxsUGVybWlzc2lvbnMoYXBwUGFja2FnZSk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgbG9nZ2VyLmVycm9yKGBVbmFibGUgdG8gZ3JhbnQgcGVybWlzc2lvbnMgcmVxdWVzdGVkLiBPcmlnaW5hbCBlcnJvcjogJHtlcnJvci5tZXNzYWdlfWApO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBsb2dnZXIuZGVidWcoYFBlcmZvcm1lZCBmYXN0IHJlc2V0IG9uIHRoZSBpbnN0YWxsZWQgJyR7YXBwUGFja2FnZX0nIGFwcGxpY2F0aW9uIChzdG9wIGFuZCBjbGVhcilgKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gIH1cblxuICBpZiAoIWFwcCkge1xuICAgIHRocm93IG5ldyBFcnJvcihcIidhcHAnIG9wdGlvbiBpcyByZXF1aXJlZCBmb3IgcmVpbnN0YWxsXCIpO1xuICB9XG5cbiAgbG9nZ2VyLmRlYnVnKGBSdW5uaW5nIGZ1bGwgcmVzZXQgb24gJyR7YXBwUGFja2FnZX0nIChyZWluc3RhbGwpYCk7XG4gIGlmIChpc0luc3RhbGxlZCkge1xuICAgIGF3YWl0IGFkYi51bmluc3RhbGxBcGsoYXBwUGFja2FnZSk7XG4gIH1cbiAgYXdhaXQgYWRiLmluc3RhbGwoYXBwLCB7XG4gICAgZ3JhbnRQZXJtaXNzaW9uczogYXV0b0dyYW50UGVybWlzc2lvbnMsXG4gICAgdGltZW91dDogYW5kcm9pZEluc3RhbGxUaW1lb3V0LFxuICAgIGFsbG93VGVzdFBhY2thZ2VzLFxuICB9KTtcbn07XG5cbmhlbHBlcnMuaW5zdGFsbEFwayA9IGFzeW5jIGZ1bmN0aW9uIGluc3RhbGxBcGsgKGFkYiwgb3B0cyA9IHt9KSB7XG4gIGNvbnN0IHtcbiAgICBhcHAsXG4gICAgYXBwUGFja2FnZSxcbiAgICBmYXN0UmVzZXQsXG4gICAgZnVsbFJlc2V0LFxuICAgIGFuZHJvaWRJbnN0YWxsVGltZW91dCA9IFBBQ0tBR0VfSU5TVEFMTF9USU1FT1VULFxuICAgIGF1dG9HcmFudFBlcm1pc3Npb25zLFxuICAgIGFsbG93VGVzdFBhY2thZ2VzXG4gIH0gPSBvcHRzO1xuXG4gIGlmICghYXBwIHx8ICFhcHBQYWNrYWdlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiJ2FwcCcgYW5kICdhcHBQYWNrYWdlJyBvcHRpb25zIGFyZSByZXF1aXJlZFwiKTtcbiAgfVxuXG4gIGlmIChmdWxsUmVzZXQpIHtcbiAgICBhd2FpdCB0aGlzLnJlc2V0QXBwKGFkYiwgb3B0cyk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gVGhlcmUgaXMgbm8gbmVlZCB0byByZXNldCB0aGUgbmV3bHkgaW5zdGFsbGVkIGFwcFxuICBjb25zdCBzaG91bGRQZXJmb3JtRmFzdFJlc2V0ID0gZmFzdFJlc2V0ICYmIGF3YWl0IGFkYi5pc0FwcEluc3RhbGxlZChhcHBQYWNrYWdlKTtcblxuICBhd2FpdCBhZGIuaW5zdGFsbE9yVXBncmFkZShhcHAsIGFwcFBhY2thZ2UsIHtcbiAgICBncmFudFBlcm1pc3Npb25zOiBhdXRvR3JhbnRQZXJtaXNzaW9ucyxcbiAgICB0aW1lb3V0OiBhbmRyb2lkSW5zdGFsbFRpbWVvdXQsXG4gICAgYWxsb3dUZXN0UGFja2FnZXMsXG4gIH0pO1xuXG4gIGlmIChzaG91bGRQZXJmb3JtRmFzdFJlc2V0KSB7XG4gICAgbG9nZ2VyLmluZm8oYFBlcmZvcm1pbmcgZmFzdCByZXNldCBvbiAnJHthcHBQYWNrYWdlfSdgKTtcbiAgICBhd2FpdCB0aGlzLnJlc2V0QXBwKGFkYiwgb3B0cyk7XG4gIH1cbn07XG5cbi8qKlxuICogSW5zdGFsbHMgYW4gYXJyYXkgb2YgYXBrc1xuICogQHBhcmFtIHtBREJ9IGFkYiBJbnN0YW5jZSBvZiBBcHBpdW0gQURCIG9iamVjdFxuICogQHBhcmFtIHtPYmplY3R9IG9wdHMgT3B0cyBkZWZpbmVkIGluIGRyaXZlci5qc1xuICovXG5oZWxwZXJzLmluc3RhbGxPdGhlckFwa3MgPSBhc3luYyBmdW5jdGlvbiBpbnN0YWxsT3RoZXJBcGtzIChvdGhlckFwcHMsIGFkYiwgb3B0cykge1xuICBsZXQge1xuICAgIGFuZHJvaWRJbnN0YWxsVGltZW91dCA9IFBBQ0tBR0VfSU5TVEFMTF9USU1FT1VULFxuICAgIGF1dG9HcmFudFBlcm1pc3Npb25zLFxuICAgIGFsbG93VGVzdFBhY2thZ2VzXG4gIH0gPSBvcHRzO1xuXG4gIC8vIEluc3RhbGwgYWxsIG9mIHRoZSBBUEsncyBhc3luY2hyb25vdXNseVxuICBhd2FpdCBCLmFsbChvdGhlckFwcHMubWFwKChvdGhlckFwcCkgPT4ge1xuICAgIGxvZ2dlci5kZWJ1ZyhgSW5zdGFsbGluZyBhcHA6ICR7b3RoZXJBcHB9YCk7XG4gICAgcmV0dXJuIGFkYi5pbnN0YWxsT3JVcGdyYWRlKG90aGVyQXBwLCBudWxsLCB7XG4gICAgICBncmFudFBlcm1pc3Npb25zOiBhdXRvR3JhbnRQZXJtaXNzaW9ucyxcbiAgICAgIHRpbWVvdXQ6IGFuZHJvaWRJbnN0YWxsVGltZW91dCxcbiAgICAgIGFsbG93VGVzdFBhY2thZ2VzLFxuICAgIH0pO1xuICB9KSk7XG59O1xuXG4vKipcbiAqIFVuaW5zdGFsbCBhbiBhcnJheSBvZiBwYWNrYWdlc1xuICogQHBhcmFtIHtBREJ9IGFkYiBJbnN0YW5jZSBvZiBBcHBpdW0gQURCIG9iamVjdFxuICogQHBhcmFtIHtBcnJheTxzdHJpbmc+fSBhcHBQYWNrYWdlcyBBbiBhcnJheSBvZiBwYWNrYWdlIG5hbWVzIHRvIHVuaW5zdGFsbC4gSWYgdGhpcyBpbmNsdWRlcyBgJyonYCwgdW5pbnN0YWxsIGFsbCBvZiAzcmQgcGFydHkgYXBwc1xuICogQHBhcmFtIHtBcnJheTxzdHJpbmc+fSBmaWx0ZXJQYWNrYWdlcyBBbiBhcnJheSBvZiBwYWNrYWdlcyBkb2VzIG5vdCB1bmluc3RhbGwgd2hlbiBgKmAgaXMgcHJvdmlkZWQgYXMgYGFwcFBhY2thZ2VzYFxuICovXG5oZWxwZXJzLnVuaW5zdGFsbE90aGVyUGFja2FnZXMgPSBhc3luYyBmdW5jdGlvbiB1bmluc3RhbGxPdGhlclBhY2thZ2VzIChhZGIsIGFwcFBhY2thZ2VzLCBmaWx0ZXJQYWNrYWdlcyA9IFtdKSB7XG4gIGlmIChhcHBQYWNrYWdlcy5pbmNsdWRlcygnKicpKSB7XG4gICAgbG9nZ2VyLmRlYnVnKCdVbmluc3RhbGwgdGhpcmQgcGFydHkgcGFja2FnZXMnKTtcbiAgICBhcHBQYWNrYWdlcyA9IGF3YWl0IHRoaXMuZ2V0VGhpcmRQYXJ0eVBhY2thZ2VzKGFkYiwgZmlsdGVyUGFja2FnZXMpO1xuICB9XG5cbiAgbG9nZ2VyLmRlYnVnKGBVbmluc3RhbGxpbmcgcGFja2FnZXM6ICR7YXBwUGFja2FnZXN9YCk7XG4gIGF3YWl0IEIuYWxsKGFwcFBhY2thZ2VzLm1hcCgoYXBwUGFja2FnZSkgPT4gYWRiLnVuaW5zdGFsbEFwayhhcHBQYWNrYWdlKSkpO1xufTtcblxuLyoqXG4gKiBHZXQgdGhpcmQgcGFydHkgcGFja2FnZXMgZmlsdGVyZWQgd2l0aCBgZmlsdGVyUGFja2FnZXNgXG4gKiBAcGFyYW0ge0FEQn0gYWRiIEluc3RhbmNlIG9mIEFwcGl1bSBBREIgb2JqZWN0XG4gKiBAcGFyYW0ge0FycmF5PHN0cmluZz59IGZpbHRlclBhY2thZ2VzIEFuIGFycmF5IG9mIHBhY2thZ2VzIGRvZXMgbm90IHVuaW5zdGFsbCB3aGVuIGAqYCBpcyBwcm92aWRlZCBhcyBgYXBwUGFja2FnZXNgXG4gKiBAcmV0dXJucyB7QXJyYXk8c3RyaW5nPn0gQW4gYXJyYXkgb2YgaW5zdGFsbGVkIHRoaXJkIHBhcnkgcGFja2FnZXNcbiAqL1xuaGVscGVycy5nZXRUaGlyZFBhcnR5UGFja2FnZXMgPSBhc3luYyBmdW5jdGlvbiBnZXRUaGlyZFBhcnR5UGFja2FnZXMgKGFkYiwgZmlsdGVyUGFja2FnZXMgPSBbXSkge1xuICB0cnkge1xuICAgIGNvbnN0IHBhY2thZ2VzU3RyaW5nID0gYXdhaXQgYWRiLnNoZWxsKFsncG0nLCAnbGlzdCcsICdwYWNrYWdlcycsICctMyddKTtcbiAgICBjb25zdCBhcHBQYWNrYWdlc0FycmF5ID0gcGFja2FnZXNTdHJpbmcudHJpbSgpLnJlcGxhY2UoL3BhY2thZ2U6L2csICcnKS5zcGxpdChFT0wpO1xuICAgIGxvZ2dlci5kZWJ1ZyhgJyR7YXBwUGFja2FnZXNBcnJheX0nIGZpbHRlcmVkIHdpdGggJyR7ZmlsdGVyUGFja2FnZXN9J2ApO1xuICAgIHJldHVybiBfLmRpZmZlcmVuY2UoYXBwUGFja2FnZXNBcnJheSwgZmlsdGVyUGFja2FnZXMpO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBsb2dnZXIud2FybihgVW5hYmxlIHRvIGdldCBwYWNrYWdlcyB3aXRoICdhZGIgc2hlbGwgcG0gbGlzdCBwYWNrYWdlcyAtMyc6ICR7ZXJyLm1lc3NhZ2V9YCk7XG4gICAgcmV0dXJuIFtdO1xuICB9XG59O1xuXG5oZWxwZXJzLmluaXRVbmljb2RlS2V5Ym9hcmQgPSBhc3luYyBmdW5jdGlvbiBpbml0VW5pY29kZUtleWJvYXJkIChhZGIpIHtcbiAgbG9nZ2VyLmRlYnVnKCdFbmFibGluZyBVbmljb2RlIGtleWJvYXJkIHN1cHBvcnQnKTtcblxuICAvLyBnZXQgdGhlIGRlZmF1bHQgSU1FIHNvIHdlIGNhbiByZXR1cm4gYmFjayB0byBpdCBsYXRlciBpZiB3ZSB3YW50XG4gIGxldCBkZWZhdWx0SU1FID0gYXdhaXQgYWRiLmRlZmF1bHRJTUUoKTtcblxuICBsb2dnZXIuZGVidWcoYFVuc2V0dGluZyBwcmV2aW91cyBJTUUgJHtkZWZhdWx0SU1FfWApO1xuICBjb25zdCBhcHBpdW1JTUUgPSBgJHtTRVRUSU5HU19IRUxQRVJfUEtHX0lEfS8uVW5pY29kZUlNRWA7XG4gIGxvZ2dlci5kZWJ1ZyhgU2V0dGluZyBJTUUgdG8gJyR7YXBwaXVtSU1FfSdgKTtcbiAgYXdhaXQgYWRiLmVuYWJsZUlNRShhcHBpdW1JTUUpO1xuICBhd2FpdCBhZGIuc2V0SU1FKGFwcGl1bUlNRSk7XG4gIHJldHVybiBkZWZhdWx0SU1FO1xufTtcblxuaGVscGVycy5zZXRNb2NrTG9jYXRpb25BcHAgPSBhc3luYyBmdW5jdGlvbiBzZXRNb2NrTG9jYXRpb25BcHAgKGFkYiwgYXBwKSB7XG4gIHRyeSB7XG4gICAgaWYgKGF3YWl0IGFkYi5nZXRBcGlMZXZlbCgpIDwgMjMpIHtcbiAgICAgIGF3YWl0IGFkYi5zaGVsbChbJ3NldHRpbmdzJywgJ3B1dCcsICdzZWN1cmUnLCAnbW9ja19sb2NhdGlvbicsICcxJ10pO1xuICAgIH0gZWxzZSB7XG4gICAgICBhd2FpdCBhZGIuc2hlbGwoWydhcHBvcHMnLCAnc2V0JywgYXBwLCAnYW5kcm9pZDptb2NrX2xvY2F0aW9uJywgJ2FsbG93J10pO1xuICAgIH1cbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgbG9nZ2VyLndhcm4oYFVuYWJsZSB0byBzZXQgbW9jayBsb2NhdGlvbiBmb3IgYXBwICcke2FwcH0nOiAke2Vyci5tZXNzYWdlfWApO1xuICB9XG59O1xuXG5oZWxwZXJzLmluc3RhbGxIZWxwZXJBcHAgPSBhc3luYyBmdW5jdGlvbiBpbnN0YWxsSGVscGVyQXBwIChhZGIsIGFwa1BhdGgsIHBhY2thZ2VJZCkge1xuICAvLyBTb21ldGltZXMgYWRiIHB1c2ggb3IgYWRiIGluc3RhbCB0YWtlIG1vcmUgdGltZSB0aGFuIGV4cGVjdGVkIHRvIGluc3RhbGwgYW4gYXBwXG4gIC8vIGUuZy4gaHR0cHM6Ly9naXRodWIuY29tL2FwcGl1bS9pby5hcHBpdW0uc2V0dGluZ3MvaXNzdWVzLzQwI2lzc3VlY29tbWVudC00NzY1OTMxNzRcbiAgYXdhaXQgcmV0cnkoMiwgYXN5bmMgZnVuY3Rpb24gcmV0cnlJbnN0YWxsSGVscGVyQXBwICgpIHtcbiAgICBhd2FpdCBhZGIuaW5zdGFsbE9yVXBncmFkZShhcGtQYXRoLCBwYWNrYWdlSWQsIHtncmFudFBlcm1pc3Npb25zOiB0cnVlfSk7XG4gIH0pO1xufTtcblxuLyoqXG4gKiBQdXNoZXMgYW5kIGluc3RhbGxzIGlvLmFwcGl1bS5zZXR0aW5ncyBhcHAuXG4gKiBUaHJvd3MgYW4gZXJyb3IgaWYgdGhlIHNldHRpbmcgYXBwIGlzIHJlcXVpcmVkXG4gKlxuICogQHBhcmFtIHtBZGJ9IGFkYiAtIFRoZSBhZGIgbW9kdWxlIGluc3RhbmNlLlxuICogQHBhcmFtIHtib29sZWFufSB0aHJvd0Vycm9yW2ZhbHNlXSAtIFdoZXRoZXIgdGhyb3cgZXJyb3Igb3Igbm90XG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhyb3dFcnJvciBpcyB0cnVlIGFuZCBzb21ldGhpbmcgaGFwcGVucyBpbiBpbnN0YWxsYXRpb24gc3RlcFxuICovXG5oZWxwZXJzLnB1c2hTZXR0aW5nc0FwcCA9IGFzeW5jIGZ1bmN0aW9uIHB1c2hTZXR0aW5nc0FwcCAoYWRiLCB0aHJvd0Vycm9yID0gZmFsc2UpIHtcbiAgbG9nZ2VyLmRlYnVnKCdQdXNoaW5nIHNldHRpbmdzIGFwayB0byBkZXZpY2UuLi4nKTtcblxuICB0cnkge1xuICAgIGF3YWl0IGhlbHBlcnMuaW5zdGFsbEhlbHBlckFwcChhZGIsIHNldHRpbmdzQXBrUGF0aCwgU0VUVElOR1NfSEVMUEVSX1BLR19JRCwgdGhyb3dFcnJvcik7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGlmICh0aHJvd0Vycm9yKSB7XG4gICAgICB0aHJvdyBlcnI7XG4gICAgfVxuXG4gICAgbG9nZ2VyLndhcm4oYElnbm9yZWQgZXJyb3Igd2hpbGUgaW5zdGFsbGluZyAnJHtzZXR0aW5nc0Fwa1BhdGh9JzogYCArXG4gICAgICAgICAgICAgICAgYCcke2Vyci5tZXNzYWdlfScuIEZlYXR1cmVzIHRoYXQgcmVseSBvbiB0aGlzIGhlbHBlciBgICtcbiAgICAgICAgICAgICAgICAncmVxdWlyZSB0aGUgYXBrIHN1Y2ggYXMgdG9nZ2xlIFdpRmkgYW5kIGdldHRpbmcgbG9jYXRpb24gJyArXG4gICAgICAgICAgICAgICAgJ3dpbGwgcmFpc2UgYW4gZXJyb3IgaWYgeW91IHRyeSB0byB1c2UgdGhlbS4nKTtcbiAgfVxuXG4gIC8vIFJlaW5zdGFsbCB3aWxsIHN0b3AgdGhlIHNldHRpbmdzIGhlbHBlciBwcm9jZXNzIGFueXdheSwgc29cbiAgLy8gdGhlcmUgaXMgbm8gbmVlZCB0byBjb250aW51ZSBpZiB0aGUgYXBwbGljYXRpb24gaXMgc3RpbGwgcnVubmluZ1xuICBpZiAoYXdhaXQgYWRiLnByb2Nlc3NFeGlzdHMoU0VUVElOR1NfSEVMUEVSX1BLR19JRCkpIHtcbiAgICBsb2dnZXIuZGVidWcoYCR7U0VUVElOR1NfSEVMUEVSX1BLR19JRH0gaXMgYWxyZWFkeSBydW5uaW5nLiBgICtcbiAgICAgIGBUaGVyZSBpcyBubyBuZWVkIHRvIHJlc2V0IGl0cyBwZXJtaXNzaW9ucy5gKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBpZiAoYXdhaXQgYWRiLmdldEFwaUxldmVsKCkgPD0gMjMpIHsgLy8gQW5kcm9pZCA2LSBkZXZpY2VzIHNob3VsZCBoYXZlIGdyYW50ZWQgcGVybWlzc2lvbnNcbiAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vYXBwaXVtL2FwcGl1bS9wdWxsLzExNjQwI2lzc3VlY29tbWVudC00MzgyNjA0NzdcbiAgICBsb2dnZXIuaW5mbygnR3JhbnRpbmcgYW5kcm9pZC5wZXJtaXNzaW9uLlNFVF9BTklNQVRJT05fU0NBTEUsIENIQU5HRV9DT05GSUdVUkFUSU9OLCBBQ0NFU1NfRklORV9MT0NBVElPTiBieSBwbSBncmFudCcpO1xuICAgIGF3YWl0IGFkYi5ncmFudFBlcm1pc3Npb25zKFNFVFRJTkdTX0hFTFBFUl9QS0dfSUQsIFtcbiAgICAgICdhbmRyb2lkLnBlcm1pc3Npb24uU0VUX0FOSU1BVElPTl9TQ0FMRScsXG4gICAgICAnYW5kcm9pZC5wZXJtaXNzaW9uLkNIQU5HRV9DT05GSUdVUkFUSU9OJyxcbiAgICAgICdhbmRyb2lkLnBlcm1pc3Npb24uQUNDRVNTX0ZJTkVfTE9DQVRJT04nXG4gICAgXSk7XG4gIH1cblxuICAvLyBsYXVuY2ggaW8uYXBwaXVtLnNldHRpbmdzIGFwcCBkdWUgdG8gc2V0dGluZ3MgZmFpbGluZyB0byBiZSBzZXRcbiAgLy8gaWYgdGhlIGFwcCBpcyBub3QgbGF1bmNoZWQgcHJpb3IgdG8gc3RhcnQgdGhlIHNlc3Npb24gb24gYW5kcm9pZCA3K1xuICAvLyBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2FwcGl1bS9hcHBpdW0vaXNzdWVzLzg5NTdcbiAgdHJ5IHtcbiAgICBhd2FpdCBhZGIuc3RhcnRBcHAoe1xuICAgICAgcGtnOiBTRVRUSU5HU19IRUxQRVJfUEtHX0lELFxuICAgICAgYWN0aXZpdHk6IFNFVFRJTkdTX0hFTFBFUl9NQUlOX0FDVElWSVRZLFxuICAgICAgYWN0aW9uOiAnYW5kcm9pZC5pbnRlbnQuYWN0aW9uLk1BSU4nLFxuICAgICAgY2F0ZWdvcnk6ICdhbmRyb2lkLmludGVudC5jYXRlZ29yeS5MQVVOQ0hFUicsXG4gICAgICBzdG9wQXBwOiBmYWxzZSxcbiAgICAgIHdhaXRGb3JMYXVuY2g6IGZhbHNlLFxuICAgIH0pO1xuXG4gICAgYXdhaXQgd2FpdEZvckNvbmRpdGlvbihhc3luYyAoKSA9PiBhd2FpdCBhZGIucHJvY2Vzc0V4aXN0cyhTRVRUSU5HU19IRUxQRVJfUEtHX0lEKSwge1xuICAgICAgd2FpdE1zOiA1MDAwLFxuICAgICAgaW50ZXJ2YWxNczogMzAwLFxuICAgIH0pO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBjb25zdCBtZXNzYWdlID0gYEZhaWxlZCB0byBsYXVuY2ggQXBwaXVtIFNldHRpbmdzIGFwcDogJHtlcnIubWVzc2FnZX1gO1xuICAgIGVyci5tZXNzYWdlID0gbWVzc2FnZTtcbiAgICBsb2dnZXIud2FybihtZXNzYWdlKTtcbiAgICBpZiAodGhyb3dFcnJvcikge1xuICAgICAgdGhyb3cgZXJyO1xuICAgIH1cbiAgfVxufTtcblxuLyoqXG4gKiBFeHRyYWN0cyBzdHJpbmcueG1sIGFuZCBjb252ZXJ0cyBpdCB0byBzdHJpbmcuanNvbiBhbmQgcHVzaGVzXG4gKiBpdCB0byAvZGF0YS9sb2NhbC90bXAvc3RyaW5nLmpzb24gb24gZm9yIHVzZSBvZiBib290c3RyYXBcbiAqIElmIGFwcCBpcyBub3QgcHJlc2VudCB0byBleHRyYWN0IHN0cmluZy54bWwgaXQgZGVsZXRlcyByZW1vdGUgc3RyaW5ncy5qc29uXG4gKiBJZiBhcHAgZG9lcyBub3QgaGF2ZSBzdHJpbmdzLnhtbCB3ZSBwdXNoIGFuIGVtcHR5IGpzb24gb2JqZWN0IHRvIHJlbW90ZVxuICpcbiAqIEBwYXJhbSB7P3N0cmluZ30gbGFuZ3VhZ2UgLSBMYW5ndWFnZSBhYmJyZXZpYXRpb24sIGZvciBleGFtcGxlICdmcicuIFRoZSBkZWZhdWx0IGxhbmd1YWdlXG4gKiBpcyB1c2VkIGlmIHRoaXMgYXJndW1lbnQgaXMgbm90IGRlZmluZWQuXG4gKiBAcGFyYW0ge09iamVjdH0gYWRiIC0gVGhlIGFkYiBtb2R1bGUgaW5zdGFuY2UuXG4gKiBAcGFyYW0ge09iamVjdH0gb3B0cyAtIERyaXZlciBvcHRpb25zIGRpY3Rpb25hcnkuXG4gKiBAcmV0dXJucyB7T2JqZWN0fSBUaGUgZGljdGlvbmFyeSwgd2hlcmUgc3RyaW5nIHJlc291cmNlIGlkZW50aWZpZXJzIGFyZSBrZXlzXG4gKiBhbG9uZyB3aXRoIHRoZWlyIGNvcnJlc3BvbmRpbmcgdmFsdWVzIGZvciB0aGUgZ2l2ZW4gbGFuZ3VhZ2Ugb3IgYW4gZW1wdHkgb2JqZWN0XG4gKiBpZiBubyBtYXRjaGluZyByZXNvdXJjZXMgd2VyZSBleHRyYWN0ZWQuXG4gKi9cbmhlbHBlcnMucHVzaFN0cmluZ3MgPSBhc3luYyBmdW5jdGlvbiBwdXNoU3RyaW5ncyAobGFuZ3VhZ2UsIGFkYiwgb3B0cykge1xuICBjb25zdCByZW1vdGVEaXIgPSAnL2RhdGEvbG9jYWwvdG1wJztcbiAgY29uc3Qgc3RyaW5nc0pzb24gPSAnc3RyaW5ncy5qc29uJztcbiAgY29uc3QgcmVtb3RlRmlsZSA9IHBhdGgucG9zaXgucmVzb2x2ZShyZW1vdGVEaXIsIHN0cmluZ3NKc29uKTtcblxuICAvLyBjbGVhbiB1cCByZW1vdGUgc3RyaW5nLmpzb24gaWYgcHJlc2VudFxuICBhd2FpdCBhZGIucmltcmFmKHJlbW90ZUZpbGUpO1xuXG4gIGxldCBhcHA7XG4gIHRyeSB7XG4gICAgYXBwID0gb3B0cy5hcHAgfHwgYXdhaXQgYWRiLnB1bGxBcGsob3B0cy5hcHBQYWNrYWdlLCBvcHRzLnRtcERpcik7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGxvZ2dlci5pbmZvKGBGYWlsZWQgdG8gcHVsbCBhbiBhcGsgZnJvbSAnJHtvcHRzLmFwcFBhY2thZ2V9JyB0byAnJHtvcHRzLnRtcERpcn0nLiBPcmlnaW5hbCBlcnJvcjogJHtlcnIubWVzc2FnZX1gKTtcbiAgfVxuXG4gIGlmIChfLmlzRW1wdHkob3B0cy5hcHBQYWNrYWdlKSB8fCAhKGF3YWl0IGZzLmV4aXN0cyhhcHApKSkge1xuICAgIGxvZ2dlci5kZWJ1ZyhgTm8gYXBwIG9yIHBhY2thZ2Ugc3BlY2lmaWVkLiBSZXR1cm5pbmcgZW1wdHkgc3RyaW5nc2ApO1xuICAgIHJldHVybiB7fTtcbiAgfVxuXG4gIGNvbnN0IHN0cmluZ3NUbXBEaXIgPSBwYXRoLnJlc29sdmUob3B0cy50bXBEaXIsIG9wdHMuYXBwUGFja2FnZSk7XG4gIHRyeSB7XG4gICAgbG9nZ2VyLmRlYnVnKCdFeHRyYWN0aW5nIHN0cmluZ3MgZnJvbSBhcGsnLCBhcHAsIGxhbmd1YWdlLCBzdHJpbmdzVG1wRGlyKTtcbiAgICBjb25zdCB7YXBrU3RyaW5ncywgbG9jYWxQYXRofSA9IGF3YWl0IGFkYi5leHRyYWN0U3RyaW5nc0Zyb21BcGsoYXBwLCBsYW5ndWFnZSwgc3RyaW5nc1RtcERpcik7XG4gICAgYXdhaXQgYWRiLnB1c2gobG9jYWxQYXRoLCByZW1vdGVEaXIpO1xuICAgIHJldHVybiBhcGtTdHJpbmdzO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBsb2dnZXIud2FybihgQ291bGQgbm90IGdldCBzdHJpbmdzLCBjb250aW51aW5nIGFueXdheS4gT3JpZ2luYWwgZXJyb3I6ICR7ZXJyLm1lc3NhZ2V9YCk7XG4gICAgYXdhaXQgYWRiLnNoZWxsKCdlY2hvJywgW2Ane30nID4gJHtyZW1vdGVGaWxlfWBdKTtcbiAgfSBmaW5hbGx5IHtcbiAgICBhd2FpdCBmcy5yaW1yYWYoc3RyaW5nc1RtcERpcik7XG4gIH1cbiAgcmV0dXJuIHt9O1xufTtcblxuaGVscGVycy51bmxvY2tXaXRoVUlBdXRvbWF0aW9uID0gYXN5bmMgZnVuY3Rpb24gdW5sb2NrV2l0aFVJQXV0b21hdGlvbiAoZHJpdmVyLCBhZGIsIHVubG9ja0NhcGFiaWxpdGllcykge1xuICBsZXQgdW5sb2NrVHlwZSA9IHVubG9ja0NhcGFiaWxpdGllcy51bmxvY2tUeXBlO1xuICBpZiAoIXVubG9ja2VyLmlzVmFsaWRVbmxvY2tUeXBlKHVubG9ja1R5cGUpKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIHVubG9jayB0eXBlICR7dW5sb2NrVHlwZX1gKTtcbiAgfVxuICBsZXQgdW5sb2NrS2V5ID0gdW5sb2NrQ2FwYWJpbGl0aWVzLnVubG9ja0tleTtcbiAgaWYgKCF1bmxvY2tlci5pc1ZhbGlkS2V5KHVubG9ja1R5cGUsIHVubG9ja0tleSkpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYE1pc3NpbmcgdW5sb2NrS2V5ICR7dW5sb2NrS2V5fSBjYXBhYmlsaXR5IGZvciB1bmxvY2tUeXBlICR7dW5sb2NrVHlwZX1gKTtcbiAgfVxuICBjb25zdCB1bmxvY2tNZXRob2QgPSB7XG4gICAgW1BJTl9VTkxPQ0tdOiB1bmxvY2tlci5waW5VbmxvY2ssXG4gICAgW1BBU1NXT1JEX1VOTE9DS106IHVubG9ja2VyLnBhc3N3b3JkVW5sb2NrLFxuICAgIFtQQVRURVJOX1VOTE9DS106IHVubG9ja2VyLnBhdHRlcm5VbmxvY2ssXG4gICAgW0ZJTkdFUlBSSU5UX1VOTE9DS106IHVubG9ja2VyLmZpbmdlcnByaW50VW5sb2NrXG4gIH1bdW5sb2NrVHlwZV07XG4gIGF3YWl0IHVubG9ja01ldGhvZChhZGIsIGRyaXZlciwgdW5sb2NrQ2FwYWJpbGl0aWVzKTtcbn07XG5cbmhlbHBlcnMudW5sb2NrV2l0aEhlbHBlckFwcCA9IGFzeW5jIGZ1bmN0aW9uIHVubG9ja1dpdGhIZWxwZXJBcHAgKGFkYikge1xuICBsb2dnZXIuaW5mbygnVW5sb2NraW5nIHNjcmVlbicpO1xuXG4gIC8vIFVubG9jayBzdWNjZWVkIHdpdGggYSBjb3VwbGUgb2YgcmV0cmllcy5cbiAgbGV0IGZpcnN0UnVuID0gdHJ1ZTtcbiAgYXdhaXQgcmV0cnkoMywgYXN5bmMgZnVuY3Rpb24gbGF1bmNoSGVscGVyICgpIHtcbiAgICAvLyBUbyByZWR1Y2UgYSB0aW1lIHRvIGNhbGwgYWRiLmlzU2NyZWVuTG9ja2VkKCkgc2luY2UgYGFkYiBzaGVsbCBkdW1wc3lzIHdpbmRvd2AgaXMgZWFzeSB0byBoYW5nIGFkYiBjb21tYW5kc1xuICAgIGlmIChmaXJzdFJ1bikge1xuICAgICAgZmlyc3RSdW4gPSBmYWxzZTtcbiAgICB9IGVsc2Uge1xuICAgICAgdHJ5IHtcbiAgICAgICAgaWYgKCEoYXdhaXQgYWRiLmlzU2NyZWVuTG9ja2VkKCkpKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIGxvZ2dlci53YXJuKGBFcnJvciBpbiBpc1NjcmVlbkxvY2tlZDogJHtlLm1lc3NhZ2V9YCk7XG4gICAgICAgIGxvZ2dlci53YXJuKCdcImFkYiBzaGVsbCBkdW1wc3lzIHdpbmRvd1wiIGNvbW1hbmQgaGFzIHRpbWVkIG91dC4nKTtcbiAgICAgICAgbG9nZ2VyLndhcm4oJ1RoZSByZWFzb24gb2YgdGhpcyB0aW1lb3V0IGlzIHRoZSBkZWxheWVkIGFkYiByZXNwb25zZS4gUmVzZXR0aW5nIGFkYiBzZXJ2ZXIgY2FuIGltcHJvdmUgaXQuJyk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgbG9nZ2VyLmluZm8oYExhdW5jaGluZyAke1NFVFRJTkdTX0hFTFBFUl9VTkxPQ0tfQUNUSVZJVFl9YCk7XG4gICAgYXdhaXQgYWRiLnNoZWxsKFtcbiAgICAgICdhbScsICdzdGFydCcsXG4gICAgICAnLW4nLCBgJHtTRVRUSU5HU19IRUxQRVJfUEtHX0lEfS8ke1NFVFRJTkdTX0hFTFBFUl9VTkxPQ0tfQUNUSVZJVFl9YCxcbiAgICAgICctYycsICdhbmRyb2lkLmludGVudC5jYXRlZ29yeS5MQVVOQ0hFUicsXG4gICAgICAnLWEnLCAnYW5kcm9pZC5pbnRlbnQuYWN0aW9uLk1BSU4nLFxuICAgICAgJy1mJywgJzB4MTAyMDAwMDAnLFxuICAgIF0pO1xuICAgIGF3YWl0IEIuZGVsYXkoMTAwMCk7XG4gIH0pO1xufTtcblxuaGVscGVycy51bmxvY2sgPSBhc3luYyBmdW5jdGlvbiB1bmxvY2sgKGRyaXZlciwgYWRiLCBjYXBhYmlsaXRpZXMpIHtcbiAgaWYgKCEoYXdhaXQgYWRiLmlzU2NyZWVuTG9ja2VkKCkpKSB7XG4gICAgbG9nZ2VyLmluZm8oJ1NjcmVlbiBhbHJlYWR5IHVubG9ja2VkLCBkb2luZyBub3RoaW5nJyk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgbG9nZ2VyLmRlYnVnKCdTY3JlZW4gaXMgbG9ja2VkLCB0cnlpbmcgdG8gdW5sb2NrJyk7XG4gIGlmIChfLmlzVW5kZWZpbmVkKGNhcGFiaWxpdGllcy51bmxvY2tUeXBlKSkge1xuICAgIGxvZ2dlci53YXJuKCdVc2luZyBhcHAgdW5sb2NrLCB0aGlzIGlzIGdvaW5nIHRvIGJlIGRlcHJlY2F0ZWQhJyk7XG4gICAgYXdhaXQgaGVscGVycy51bmxvY2tXaXRoSGVscGVyQXBwKGFkYik7XG4gIH0gZWxzZSB7XG4gICAgYXdhaXQgaGVscGVycy51bmxvY2tXaXRoVUlBdXRvbWF0aW9uKGRyaXZlciwgYWRiLCB7dW5sb2NrVHlwZTogY2FwYWJpbGl0aWVzLnVubG9ja1R5cGUsIHVubG9ja0tleTogY2FwYWJpbGl0aWVzLnVubG9ja0tleX0pO1xuICAgIGF3YWl0IGhlbHBlcnMudmVyaWZ5VW5sb2NrKGFkYik7XG4gIH1cbn07XG5cbmhlbHBlcnMudmVyaWZ5VW5sb2NrID0gYXN5bmMgZnVuY3Rpb24gdmVyaWZ5VW5sb2NrIChhZGIpIHtcbiAgYXdhaXQgcmV0cnlJbnRlcnZhbCgyLCAxMDAwLCBhc3luYyAoKSA9PiB7XG4gICAgaWYgKGF3YWl0IGFkYi5pc1NjcmVlbkxvY2tlZCgpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1NjcmVlbiBkaWQgbm90IHVubG9jayBzdWNjZXNzZnVsbHksIHJldHJ5aW5nJyk7XG4gICAgfVxuICAgIGxvZ2dlci5kZWJ1ZygnU2NyZWVuIHVubG9ja2VkIHN1Y2Nlc3NmdWxseScpO1xuICB9KTtcbn07XG5cbmhlbHBlcnMuaW5pdERldmljZSA9IGFzeW5jIGZ1bmN0aW9uIGluaXREZXZpY2UgKGFkYiwgb3B0cykge1xuICBpZiAob3B0cy5za2lwRGV2aWNlSW5pdGlhbGl6YXRpb24pIHtcbiAgICBsb2dnZXIuaW5mbyhgJ3NraXBEZXZpY2VJbml0aWFsaXphdGlvbicgaXMgc2V0LiBTa2lwcGluZyBkZXZpY2UgaW5pdGlhbGl6YXRpb24uYCk7XG4gIH0gZWxzZSB7XG4gICAgYXdhaXQgYWRiLndhaXRGb3JEZXZpY2UoKTtcbiAgICAvLyBwdXNoU2V0dGluZ3NBcHAgcmVxdWlyZWQgYmVmb3JlIGNhbGxpbmcgZW5zdXJlRGV2aWNlTG9jYWxlIGZvciBBUEkgTGV2ZWwgMjQrXG5cbiAgICAvLyBTb21lIGZlYXR1cmUgc3VjaCBhcyBsb2NhdGlvbi93aWZpIGFyZSBub3QgbmVjZXNzYXJ5IGZvciBhbGwgdXNlcnMsXG4gICAgLy8gYnV0IHRoZXkgcmVxdWlyZSB0aGUgc2V0dGluZ3MgYXBwLiBTbywgdHJ5IHRvIGNvbmZpZ3VyZSBpdCB3aGlsZSBBcHBpdW1cbiAgICAvLyBkb2VzIG5vdCB0aHJvdyBlcnJvciBldmVuIGlmIHRoZXkgZmFpbC5cbiAgICBjb25zdCBzaG91bGRUaHJvd0Vycm9yID0gb3B0cy5sYW5ndWFnZVxuICAgICAgICAgICAgICAgICAgICAgICAgICB8fCBvcHRzLmxvY2FsZVxuICAgICAgICAgICAgICAgICAgICAgICAgICB8fCBvcHRzLmxvY2FsZVNjcmlwdFxuICAgICAgICAgICAgICAgICAgICAgICAgICB8fCBvcHRzLnVuaWNvZGVLZXlib2FyZFxuICAgICAgICAgICAgICAgICAgICAgICAgICB8fCBvcHRzLmRpc2FibGVXaW5kb3dBbmltYXRpb25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgfHwgIW9wdHMuc2tpcFVubG9jaztcbiAgICBhd2FpdCBoZWxwZXJzLnB1c2hTZXR0aW5nc0FwcChhZGIsIHNob3VsZFRocm93RXJyb3IpO1xuICB9XG5cbiAgaWYgKCFvcHRzLmF2ZCkge1xuICAgIGF3YWl0IGhlbHBlcnMuc2V0TW9ja0xvY2F0aW9uQXBwKGFkYiwgU0VUVElOR1NfSEVMUEVSX1BLR19JRCk7XG4gIH1cblxuICBpZiAob3B0cy5sYW5ndWFnZSB8fCBvcHRzLmxvY2FsZSkge1xuICAgIGF3YWl0IGhlbHBlcnMuZW5zdXJlRGV2aWNlTG9jYWxlKGFkYiwgb3B0cy5sYW5ndWFnZSwgb3B0cy5sb2NhbGUsIG9wdHMubG9jYWxlU2NyaXB0KTtcbiAgfVxuXG4gIGlmIChvcHRzLnNraXBMb2djYXRDYXB0dXJlKSB7XG4gICAgbG9nZ2VyLmluZm8oYCdza2lwTG9nY2F0Q2FwdHVyZScgaXMgc2V0LiBTa2lwcGluZyBzdGFydGluZyBsb2djYXQgY2FwdHVyZS5gKTtcbiAgfSBlbHNlIHtcbiAgICBhd2FpdCBhZGIuc3RhcnRMb2djYXQoKTtcbiAgfVxuXG4gIGlmIChvcHRzLnVuaWNvZGVLZXlib2FyZCkge1xuICAgIHJldHVybiBhd2FpdCBoZWxwZXJzLmluaXRVbmljb2RlS2V5Ym9hcmQoYWRiKTtcbiAgfVxufTtcblxuaGVscGVycy5yZW1vdmVOdWxsUHJvcGVydGllcyA9IGZ1bmN0aW9uIHJlbW92ZU51bGxQcm9wZXJ0aWVzIChvYmopIHtcbiAgZm9yIChsZXQga2V5IG9mIF8ua2V5cyhvYmopKSB7XG4gICAgaWYgKF8uaXNOdWxsKG9ialtrZXldKSB8fCBfLmlzVW5kZWZpbmVkKG9ialtrZXldKSkge1xuICAgICAgZGVsZXRlIG9ialtrZXldO1xuICAgIH1cbiAgfVxufTtcblxuaGVscGVycy50cnVuY2F0ZURlY2ltYWxzID0gZnVuY3Rpb24gdHJ1bmNhdGVEZWNpbWFscyAobnVtYmVyLCBkaWdpdHMpIHtcbiAgbGV0IG11bHRpcGxpZXIgPSBNYXRoLnBvdygxMCwgZGlnaXRzKSxcbiAgICAgIGFkanVzdGVkTnVtID0gbnVtYmVyICogbXVsdGlwbGllcixcbiAgICAgIHRydW5jYXRlZE51bSA9IE1hdGhbYWRqdXN0ZWROdW0gPCAwID8gJ2NlaWwnIDogJ2Zsb29yJ10oYWRqdXN0ZWROdW0pO1xuXG4gIHJldHVybiB0cnVuY2F0ZWROdW0gLyBtdWx0aXBsaWVyO1xufTtcblxuaGVscGVycy5pc0Nocm9tZUJyb3dzZXIgPSBmdW5jdGlvbiBpc0Nocm9tZUJyb3dzZXIgKGJyb3dzZXIpIHtcbiAgcmV0dXJuIF8uaW5jbHVkZXMoT2JqZWN0LmtleXMoQ0hST01FX0JST1dTRVJfUEFDS0FHRV9BQ1RJVklUWSksIChicm93c2VyIHx8ICcnKS50b0xvd2VyQ2FzZSgpKTtcbn07XG5cbmhlbHBlcnMuZ2V0Q2hyb21lUGtnID0gZnVuY3Rpb24gZ2V0Q2hyb21lUGtnIChicm93c2VyKSB7XG4gIHJldHVybiBDSFJPTUVfQlJPV1NFUl9QQUNLQUdFX0FDVElWSVRZW2Jyb3dzZXIudG9Mb3dlckNhc2UoKV0gfHwgQ0hST01FX0JST1dTRVJfUEFDS0FHRV9BQ1RJVklUWS5kZWZhdWx0O1xufTtcblxuaGVscGVycy5yZW1vdmVBbGxTZXNzaW9uV2ViU29ja2V0SGFuZGxlcnMgPSBhc3luYyBmdW5jdGlvbiByZW1vdmVBbGxTZXNzaW9uV2ViU29ja2V0SGFuZGxlcnMgKHNlcnZlciwgc2Vzc2lvbklkKSB7XG4gIGlmICghc2VydmVyIHx8ICFfLmlzRnVuY3Rpb24oc2VydmVyLmdldFdlYlNvY2tldEhhbmRsZXJzKSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IGFjdGl2ZUhhbmRsZXJzID0gYXdhaXQgc2VydmVyLmdldFdlYlNvY2tldEhhbmRsZXJzKHNlc3Npb25JZCk7XG4gIGZvciAoY29uc3QgcGF0aG5hbWUgb2YgXy5rZXlzKGFjdGl2ZUhhbmRsZXJzKSkge1xuICAgIGF3YWl0IHNlcnZlci5yZW1vdmVXZWJTb2NrZXRIYW5kbGVyKHBhdGhuYW1lKTtcbiAgfVxufTtcblxuLyoqXG4gKiBUYWtlcyBhIGRlc2lyZWQgY2FwYWJpbGl0eSBhbmQgdHJpZXMgdG8gSlNPTi5wYXJzZSBpdCBhcyBhbiBhcnJheSxcbiAqIGFuZCBlaXRoZXIgcmV0dXJucyB0aGUgcGFyc2VkIGFycmF5IG9yIGEgc2luZ2xldG9uIGFycmF5LlxuICpcbiAqIEBwYXJhbSB7YW55fSBjYXAgQSBkZXNpcmVkIGNhcGFiaWxpdHlcbiAqL1xuaGVscGVycy5wYXJzZUFycmF5ID0gZnVuY3Rpb24gcGFyc2VBcnJheSAoY2FwKSB7XG4gIGxldCBwYXJzZWRDYXBzO1xuICB0cnkge1xuICAgIHBhcnNlZENhcHMgPSBKU09OLnBhcnNlKGNhcCk7XG4gIH0gY2F0Y2ggKGlnbikgeyB9XG5cbiAgaWYgKF8uaXNBcnJheShwYXJzZWRDYXBzKSkge1xuICAgIHJldHVybiBwYXJzZWRDYXBzO1xuICB9IGVsc2UgaWYgKF8uaXNTdHJpbmcoY2FwKSkge1xuICAgIHJldHVybiBbY2FwXTtcbiAgfVxuXG4gIHRocm93IG5ldyBFcnJvcihgbXVzdCBwcm92aWRlIGEgc3RyaW5nIG9yIEpTT04gQXJyYXk7IHJlY2VpdmVkICR7Y2FwfWApO1xufTtcblxuLyoqXG4gKiBWYWxpZGF0ZSBkZXNpcmVkIGNhcGFiaWxpdGllcy4gUmV0dXJucyB0cnVlIGlmIGNhcGFiaWxpdHkgaXMgdmFsaWRcbiAqXG4gKiBAcGFyYW0geyp9IGNhcCBBIGRlc2lyZWQgY2FwYWJpbGl0eVxuICogQHJldHVybiB7Ym9vbGVhbn0gUmV0dXJucyB0cnVlIGlmIHRoZSBjYXBhYmlsaXR5IGlzIHZhbGlkXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlIGNhcHMgaGFzIGludmFsaWQgY2FwYWJpbGl0eVxuICovXG5oZWxwZXJzLnZhbGlkYXRlRGVzaXJlZENhcHMgPSBmdW5jdGlvbiB2YWxpZGF0ZURlc2lyZWRDYXBzIChjYXBzKSB7XG4gIC8vIG1ha2Ugc3VyZSB0aGF0IHRoZSBjYXBhYmlsaXRpZXMgaGF2ZSBvbmUgb2YgYGFwcGAsIGBhcHBQYWNrYWdlYCBvciBgYnJvd3NlcmBcbiAgaWYgKCghY2Fwcy5icm93c2VyTmFtZSB8fCAhdGhpcy5pc0Nocm9tZUJyb3dzZXIoY2Fwcy5icm93c2VyTmFtZSkpICYmICFjYXBzLmFwcCAmJiAhY2Fwcy5hcHBQYWNrYWdlKSB7XG4gICAgbG9nZ2VyLmVycm9yQW5kVGhyb3coJ1RoZSBkZXNpcmVkIGNhcGFiaWxpdGllcyBtdXN0IGluY2x1ZGUgZWl0aGVyIGFuIGFwcCwgYXBwUGFja2FnZSBvciBicm93c2VyTmFtZScpO1xuICB9XG4gIGlmIChjYXBzLmJyb3dzZXJOYW1lKSB7XG4gICAgaWYgKGNhcHMuYXBwKSB7XG4gICAgICAvLyB3YXJuIGlmIHRoZSBjYXBhYmlsaXRpZXMgaGF2ZSBib3RoIGBhcHBgIGFuZCBgYnJvd3NlciwgYWx0aG91Z2ggdGhpcyBpcyBjb21tb24gd2l0aCBzZWxlbml1bSBncmlkXG4gICAgICBsb2dnZXIud2FybihgVGhlIGRlc2lyZWQgY2FwYWJpbGl0aWVzIHNob3VsZCBnZW5lcmFsbHkgbm90IGluY2x1ZGUgYm90aCBhbiAnYXBwJyBhbmQgYSAnYnJvd3Nlck5hbWUnYCk7XG4gICAgfVxuICAgIGlmIChjYXBzLmFwcFBhY2thZ2UpIHtcbiAgICAgIGxvZ2dlci5lcnJvckFuZFRocm93KGBUaGUgZGVzaXJlZCBzaG91bGQgbm90IGluY2x1ZGUgYm90aCBvZiBhbiAnYXBwUGFja2FnZScgYW5kIGEgJ2Jyb3dzZXJOYW1lJ2ApO1xuICAgIH1cbiAgfVxuXG4gIGlmIChjYXBzLnVuaW5zdGFsbE90aGVyUGFja2FnZXMpIHtcbiAgICB0cnkge1xuICAgICAgdGhpcy5wYXJzZUFycmF5KGNhcHMudW5pbnN0YWxsT3RoZXJQYWNrYWdlcyk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgbG9nZ2VyLmVycm9yQW5kVGhyb3coYENvdWxkIG5vdCBwYXJzZSBcInVuaW5zdGFsbE90aGVyUGFja2FnZXNcIiBjYXBhYmlsaXR5OiAke2UubWVzc2FnZX1gKTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gdHJ1ZTtcbn07XG5cbmhlbHBlcnMuYm9vdHN0cmFwID0gQm9vdHN0cmFwO1xuaGVscGVycy51bmxvY2tlciA9IHVubG9ja2VyO1xuXG5leHBvcnQgeyBoZWxwZXJzLCBTRVRUSU5HU19IRUxQRVJfUEtHX0lEIH07XG5leHBvcnQgZGVmYXVsdCBoZWxwZXJzO1xuIl0sImZpbGUiOiJsaWIvYW5kcm9pZC1oZWxwZXJzLmpzIiwic291cmNlUm9vdCI6Ii4uLy4uIn0=
