"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.DEVICE_CONSOLE_PATH = exports.IOSLog = void 0;

require("source-map-support/register");

var _path = _interopRequireDefault(require("path"));

var _lodash = _interopRequireDefault(require("lodash"));

var _logger = _interopRequireDefault(require("./logger"));

var _appiumSupport = require("appium-support");

var _teen_process = require("teen_process");

var _events = _interopRequireDefault(require("events"));

const {
  EventEmitter
} = _events.default;
const START_TIMEOUT = 10000;

const DEVICE_CONSOLE_PATH = _path.default.resolve(__dirname, '..', '..', '..', 'build', 'deviceconsole');

exports.DEVICE_CONSOLE_PATH = DEVICE_CONSOLE_PATH;
const SYSTEM_LOG_PATH = '/var/log/system.log';
const MAX_LOG_ENTRIES_COUNT = 10000;

class IOSLog extends EventEmitter {
  constructor(opts) {
    super();
    this.sim = opts.sim;
    this.udid = opts.udid;
    this.showLogs = !!opts.showLogs;
    this.realDeviceLogger = opts.realDeviceLogger || 'idevicesyslog';
    this.xcodeVersion = opts.xcodeVersion;
    this.proc = null;
    this.logs = [];
    this.logRow = '';
    this.logIdxSinceLastRequest = -1;
    this.maxBufferSize = MAX_LOG_ENTRIES_COUNT;
  }

  async startCaptureRealDevice() {
    let cmd, args, env;

    if ((this.realDeviceLogger || '').indexOf('idevicesyslog') !== -1) {
      _logger.default.debug('Attempting iOS device log capture via libimobiledevice idevicesyslog');

      if (this.realDeviceLogger.toLowerCase() === 'idevicesyslog') {
        cmd = 'idevicesyslog';

        try {
          await _appiumSupport.fs.which('idevicesyslog');
        } catch (err) {
          throw new Error(`Unable to find system idevicesyslog: ${err.message}`);
        }
      } else {
        if (!(await _appiumSupport.fs.exists(this.realDeviceLogger))) {
          throw new Error(`Unable to find idevicesyslog from 'realDeviceLogger' capability '${this.realDeviceLogger}'`);
        }

        cmd = this.realDeviceLogger;
      }

      args = ['-u', this.udid];
      env = process.env;
    } else if ((this.realDeviceLogger || '').indexOf('deviceconsole') !== -1) {
      _logger.default.debug('Attempting iOS device log capture via deviceconsole');

      let deviceconsole;

      if (this.realDeviceLogger.toLowerCase() === 'deviceconsole') {
        deviceconsole = DEVICE_CONSOLE_PATH;
      } else {
        let stat;

        try {
          stat = await _appiumSupport.fs.stat(this.realDeviceLogger);
        } catch (err) {
          throw new Error(`Unable to find deviceconsole from 'realDeviceLogger' capability '${this.realDeviceLogger}': ${err.message}`);
        }

        if (stat.isDirectory()) {
          deviceconsole = this.realDeviceLogger;
        } else {
          if (!_lodash.default.endsWith(this.realDeviceLogger, 'deviceconsole')) {
            throw new Error(`Unable to parse 'deviceconsole' installation directory from '${this.realDeviceLogger}'`);
          }

          deviceconsole = _path.default.dirname(this.realDeviceLogger);
        }
      }

      _logger.default.debug(`Using 'deviceconsole' from '${deviceconsole}'`);

      cmd = `${deviceconsole}/deviceconsole`;
      args = ['-u', this.udid];
      env = _lodash.default.clone(process.env);
      env.DYLD_LIBRARY_PATH = deviceconsole;

      if (process.env.DYLD_LIBRARY_PATH) {
        env.DYLD_LIBRARY_PATH = `${env.DYLD_LIBRARY_PATH}:${process.env.DYLD_LIBRARY_PATH}`;
      }
    } else {
      _logger.default.errorAndThrow(`Unable to capture device log. Unknown 'realDeviceLogger': '${this.realDeviceLogger}'`);
    }

    this.subprocessId = `${cmd}_${this.udid}`;

    _logger.default.debug(`Starting iOS device log capture with: '${cmd}'`);

    try {
      await this.killExistingSysLogProcesses(cmd, args);
    } catch (e) {}

    this.proc = this.getIDeviceSysLogProcess(cmd, args, env);
    await this.finishStartingLogCapture();
  }

  async startCaptureSimulator() {
    _logger.default.debug(`Starting iOS ${await this.sim.getPlatformVersion()} simulator log capture`);

    if (this.xcodeVersion.major < 5) {
      this.proc = new _teen_process.SubProcess('tail', ['-f', '-n', '1', SYSTEM_LOG_PATH]);
      await this.finishStartingLogCapture();
      return;
    }

    if (_lodash.default.isUndefined(this.sim.udid)) {
      _logger.default.errorAndThrow(`iOS log capture with Xcode ${this.xcodeVersion.versionString} requires a sim udid`);
    }

    let logPath = this.sim.getLogDir();

    try {
      if (logPath.indexOf('*') >= 0) {
        _logger.default.error(`Log path has * in it. Unable to start log capture: ${logPath}`);

        return;
      }

      let systemLogPath = _path.default.resolve(logPath, 'system.log');

      _logger.default.debug(`System log path: ${systemLogPath}`);

      await (0, _appiumSupport.mkdirp)(logPath);
      await _appiumSupport.fs.writeFile(systemLogPath, 'A new Appium session is about to start!\n', {
        flag: 'a'
      });
      let files;

      try {
        files = await _appiumSupport.fs.glob(systemLogPath);

        if (files.length < 1) {
          throw new Error('Could not start log capture');
        }
      } catch (e) {
        _logger.default.error(`Could not start log capture because no iOS ` + `simulator logs could be found at ${systemLogPath}. ` + `Logging will not be functional for this run`);
      }

      let lastModifiedLogPath = files[0];
      let lastModifiedLogTime = (await _appiumSupport.fs.stat(lastModifiedLogPath)).mtime;

      for (let file of files) {
        let {
          mtime
        } = await _appiumSupport.fs.stat(file);

        if (mtime > lastModifiedLogTime) {
          lastModifiedLogPath = file;
          lastModifiedLogTime = mtime;
        }
      }

      const tailArgs = ['-f', '-n', '1', lastModifiedLogPath];

      try {
        await (0, _teen_process.exec)('pkill', ['-xf', ['tail', ...tailArgs].join(' ')]);
      } catch (e) {}

      this.proc = new _teen_process.SubProcess('tail', tailArgs);
      await this.finishStartingLogCapture();
    } catch (err) {
      _logger.default.errorAndThrow(`Simulator log capture failed: ${err.message}`);
    }
  }

  async startCapture() {
    if (this.udid) {
      return await this.startCaptureRealDevice();
    }

    return await this.startCaptureSimulator();
  }

  async finishStartingLogCapture() {
    if (!this.proc) {
      _logger.default.errorAndThrow('Could not capture device log');
    }

    let firstLine = true;
    this.proc.on('output', (stdout, stderr) => {
      if (stdout) {
        if (firstLine) {
          if (stdout.substr(-1, 1) === '\n') {
            firstLine = false;
          }
        } else {
          this.logRow += stdout;

          if (stdout.substr(-1, 1) === '\n') {
            this.onOutput();
            this.logRow = '';
          }
        }
      }

      if (stderr) {
        this.onOutput('STDERR');
      }
    });

    let sd = (stdout, stderr) => {
      if (/execvp\(\)/.test(stderr)) {
        throw new Error('iOS log capture process failed to start');
      }

      return stdout || stderr;
    };

    await this.proc.start(sd, START_TIMEOUT);
  }

  async stopCapture() {
    if (this.proc) {
      if (this.udid) {
        const cachedSysLog = IOSLog.cachedIDeviceSysLogs[this.subprocessId];

        if (cachedSysLog) {
          cachedSysLog.count--;

          if (cachedSysLog.count === 0) {
            await this.killLogSubProcess();
            delete IOSLog.cachedIDeviceSysLogs[this.subprocessId];
          }
        }
      } else {
        await this.killLogSubProcess();
      }
    }

    this.proc = null;
  }

  async killLogSubProcess() {
    if (this.proc.isRunning) {
      _logger.default.debug('Stopping iOS log capture');

      try {
        await this.proc.stop('SIGTERM', 1000);
      } catch (e) {
        if (this.proc.isRunning) {
          _logger.default.warn('Cannot stop log capture process. Sending SIGKILL...');

          await this.proc.stop('SIGKILL');
        }
      }
    }
  }

  onOutput(prefix = '') {
    let logs = this.logRow.split('\n');

    for (let log of logs) {
      if (!log) continue;
      let logObj = {
        timestamp: Date.now(),
        level: 'ALL',
        message: log
      };
      this.logs.push(logObj);
      this.emit('output', logObj);

      if (this.logs.length > this.maxBufferSize) {
        this.logs.shift();

        if (this.logIdxSinceLastRequest > 0) {
          --this.logIdxSinceLastRequest;
        }
      }

      if (this.showLogs) {
        let space = prefix.length > 0 ? ' ' : '';

        _logger.default.info(`[IOS_SYSLOG_ROW${space}${prefix}] ${log}`);
      }
    }
  }

  async getLogs() {
    if (this.logs.length && this.logIdxSinceLastRequest < this.logs.length) {
      let result = this.logs;

      if (this.logIdxSinceLastRequest > 0) {
        result = result.slice(this.logIdxSinceLastRequest);
      }

      this.logIdxSinceLastRequest = this.logs.length;
      return result;
    }

    return [];
  }

  async getAllLogs() {
    return this.logs;
  }

  async killExistingSysLogProcesses(cmd, args) {
    if (!IOSLog.cachedIDeviceSysLogs[this.subprocessId]) {
      await (0, _teen_process.exec)('pkill', ['-xf', [cmd, ...args].join(' ')]);
    }
  }

  getIDeviceSysLogProcess(cmd, args, env) {
    if (!IOSLog.cachedIDeviceSysLogs[this.subprocessId]) {
      let {
        proc
      } = IOSLog.cachedIDeviceSysLogs[this.subprocessId] = {
        proc: new _teen_process.SubProcess(cmd, args, {
          env
        }),
        count: 1
      };
      proc.on('exit', () => delete IOSLog.cachedIDeviceSysLogs[this.subprocessId]);
    } else {
      IOSLog.cachedIDeviceSysLogs[this.subprocessId].count++;
    }

    return IOSLog.cachedIDeviceSysLogs[this.subprocessId].proc;
  }

}

exports.IOSLog = IOSLog;
IOSLog.cachedIDeviceSysLogs = {};
var _default = IOSLog;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9kZXZpY2UtbG9nL2lvcy1sb2cuanMiXSwibmFtZXMiOlsiRXZlbnRFbWl0dGVyIiwiZXZlbnRzIiwiU1RBUlRfVElNRU9VVCIsIkRFVklDRV9DT05TT0xFX1BBVEgiLCJwYXRoIiwicmVzb2x2ZSIsIl9fZGlybmFtZSIsIlNZU1RFTV9MT0dfUEFUSCIsIk1BWF9MT0dfRU5UUklFU19DT1VOVCIsIklPU0xvZyIsImNvbnN0cnVjdG9yIiwib3B0cyIsInNpbSIsInVkaWQiLCJzaG93TG9ncyIsInJlYWxEZXZpY2VMb2dnZXIiLCJ4Y29kZVZlcnNpb24iLCJwcm9jIiwibG9ncyIsImxvZ1JvdyIsImxvZ0lkeFNpbmNlTGFzdFJlcXVlc3QiLCJtYXhCdWZmZXJTaXplIiwic3RhcnRDYXB0dXJlUmVhbERldmljZSIsImNtZCIsImFyZ3MiLCJlbnYiLCJpbmRleE9mIiwibG9nZ2VyIiwiZGVidWciLCJ0b0xvd2VyQ2FzZSIsImZzIiwid2hpY2giLCJlcnIiLCJFcnJvciIsIm1lc3NhZ2UiLCJleGlzdHMiLCJwcm9jZXNzIiwiZGV2aWNlY29uc29sZSIsInN0YXQiLCJpc0RpcmVjdG9yeSIsIl8iLCJlbmRzV2l0aCIsImRpcm5hbWUiLCJjbG9uZSIsIkRZTERfTElCUkFSWV9QQVRIIiwiZXJyb3JBbmRUaHJvdyIsInN1YnByb2Nlc3NJZCIsImtpbGxFeGlzdGluZ1N5c0xvZ1Byb2Nlc3NlcyIsImUiLCJnZXRJRGV2aWNlU3lzTG9nUHJvY2VzcyIsImZpbmlzaFN0YXJ0aW5nTG9nQ2FwdHVyZSIsInN0YXJ0Q2FwdHVyZVNpbXVsYXRvciIsImdldFBsYXRmb3JtVmVyc2lvbiIsIm1ham9yIiwiU3ViUHJvY2VzcyIsImlzVW5kZWZpbmVkIiwidmVyc2lvblN0cmluZyIsImxvZ1BhdGgiLCJnZXRMb2dEaXIiLCJlcnJvciIsInN5c3RlbUxvZ1BhdGgiLCJ3cml0ZUZpbGUiLCJmbGFnIiwiZmlsZXMiLCJnbG9iIiwibGVuZ3RoIiwibGFzdE1vZGlmaWVkTG9nUGF0aCIsImxhc3RNb2RpZmllZExvZ1RpbWUiLCJtdGltZSIsImZpbGUiLCJ0YWlsQXJncyIsImpvaW4iLCJzdGFydENhcHR1cmUiLCJmaXJzdExpbmUiLCJvbiIsInN0ZG91dCIsInN0ZGVyciIsInN1YnN0ciIsIm9uT3V0cHV0Iiwic2QiLCJ0ZXN0Iiwic3RhcnQiLCJzdG9wQ2FwdHVyZSIsImNhY2hlZFN5c0xvZyIsImNhY2hlZElEZXZpY2VTeXNMb2dzIiwiY291bnQiLCJraWxsTG9nU3ViUHJvY2VzcyIsImlzUnVubmluZyIsInN0b3AiLCJ3YXJuIiwicHJlZml4Iiwic3BsaXQiLCJsb2ciLCJsb2dPYmoiLCJ0aW1lc3RhbXAiLCJEYXRlIiwibm93IiwibGV2ZWwiLCJwdXNoIiwiZW1pdCIsInNoaWZ0Iiwic3BhY2UiLCJpbmZvIiwiZ2V0TG9ncyIsInJlc3VsdCIsInNsaWNlIiwiZ2V0QWxsTG9ncyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQSxNQUFNO0FBQUVBLEVBQUFBO0FBQUYsSUFBbUJDLGVBQXpCO0FBRUEsTUFBTUMsYUFBYSxHQUFHLEtBQXRCOztBQUNBLE1BQU1DLG1CQUFtQixHQUFHQyxjQUFLQyxPQUFMLENBQWFDLFNBQWIsRUFBd0IsSUFBeEIsRUFBOEIsSUFBOUIsRUFBb0MsSUFBcEMsRUFBMEMsT0FBMUMsRUFBbUQsZUFBbkQsQ0FBNUI7OztBQUNBLE1BQU1DLGVBQWUsR0FBRyxxQkFBeEI7QUFFQSxNQUFNQyxxQkFBcUIsR0FBRyxLQUE5Qjs7QUFFQSxNQUFNQyxNQUFOLFNBQXFCVCxZQUFyQixDQUFrQztBQUNoQ1UsRUFBQUEsV0FBVyxDQUFFQyxJQUFGLEVBQVE7QUFDakI7QUFDQSxTQUFLQyxHQUFMLEdBQVdELElBQUksQ0FBQ0MsR0FBaEI7QUFDQSxTQUFLQyxJQUFMLEdBQVlGLElBQUksQ0FBQ0UsSUFBakI7QUFDQSxTQUFLQyxRQUFMLEdBQWdCLENBQUMsQ0FBQ0gsSUFBSSxDQUFDRyxRQUF2QjtB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OEIsRUFBOUI7ZUFHZTNFLE0iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgbG9nZ2VyIGZyb20gJy4vbG9nZ2VyJztcbmltcG9ydCB7IGZzLCBta2RpcnAgfSBmcm9tICdhcHBpdW0tc3VwcG9ydCc7XG5pbXBvcnQgeyBTdWJQcm9jZXNzLCBleGVjIH0gZnJvbSAndGVlbl9wcm9jZXNzJztcbmltcG9ydCBldmVudHMgZnJvbSAnZXZlbnRzJztcbmNvbnN0IHsgRXZlbnRFbWl0dGVyIH0gPSBldmVudHM7XG5cbmNvbnN0IFNUQVJUX1RJTUVPVVQgPSAxMDAwMDtcbmNvbnN0IERFVklDRV9DT05TT0xFX1BBVEggPSBwYXRoLnJlc29sdmUoX19kaXJuYW1lLCAnLi4nLCAnLi4nLCAnLi4nLCAnYnVpbGQnLCAnZGV2aWNlY29uc29sZScpO1xuY29uc3QgU1lTVEVNX0xPR19QQVRIID0gJy92YXIvbG9nL3N5c3RlbS5sb2cnO1xuLy8gV2Uga2VlcCBvbmx5IHRoZSBtb3N0IHJlY2VudCBsb2cgZW50cmllcyB0byBhdm9pZCBvdXQgb2YgbWVtb3J5IGVycm9yXG5jb25zdCBNQVhfTE9HX0VOVFJJRVNfQ09VTlQgPSAxMDAwMDtcblxuY2xhc3MgSU9TTG9nIGV4dGVuZHMgRXZlbnRFbWl0dGVyIHtcbiAgY29uc3RydWN0b3IgKG9wdHMpIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMuc2ltID0gb3B0cy5zaW07XG4gICAgdGhpcy51ZGlkID0gb3B0cy51ZGlkO1xuICAgIHRoaXMuc2hvd0xvZ3MgPSAhIW9wdHMuc2hvd0xvZ3M7XG4gICAgdGhpcy5yZWFsRGV2aWNlTG9nZ2VyID0gb3B0cy5yZWFsRGV2aWNlTG9nZ2VyIHx8ICdpZGV2aWNlc3lzbG9nJztcbiAgICB0aGlzLnhjb2RlVmVyc2lvbiA9IG9wdHMueGNvZGVWZXJzaW9uO1xuXG4gICAgdGhpcy5wcm9jID0gbnVsbDtcbiAgICB0aGlzLmxvZ3MgPSBbXTtcbiAgICB0aGlzLmxvZ1JvdyA9ICcnO1xuICAgIHRoaXMubG9nSWR4U2luY2VMYXN0UmVxdWVzdCA9IC0xO1xuICAgIHRoaXMubWF4QnVmZmVyU2l6ZSA9IE1BWF9MT0dfRU5UUklFU19DT1VOVDtcbiAgfVxuXG4gIGFzeW5jIHN0YXJ0Q2FwdHVyZVJlYWxEZXZpY2UgKCkge1xuICAgIGxldCBjbWQsIGFyZ3MsIGVudjtcbiAgICBpZiAoKHRoaXMucmVhbERldmljZUxvZ2dlciB8fCAnJykuaW5kZXhPZignaWRldmljZXN5c2xvZycpICE9PSAtMSkge1xuICAgICAgbG9nZ2VyLmRlYnVnKCdBdHRlbXB0aW5nIGlPUyBkZXZpY2UgbG9nIGNhcHR1cmUgdmlhIGxpYmltb2JpbGVkZXZpY2UgaWRldmljZXN5c2xvZycpO1xuICAgICAgaWYgKHRoaXMucmVhbERldmljZUxvZ2dlci50b0xvd2VyQ2FzZSgpID09PSAnaWRldmljZXN5c2xvZycpIHtcbiAgICAgICAgY21kID0gJ2lkZXZpY2VzeXNsb2cnO1xuICAgICAgICB0cnkge1xuICAgICAgICAgIC8vIG1ha2Ugc3VyZSBpdCBpcyBhdmFpbGFibGUgb24gdGhlIFBBVEhcbiAgICAgICAgICBhd2FpdCBmcy53aGljaCgnaWRldmljZXN5c2xvZycpO1xuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFVuYWJsZSB0byBmaW5kIHN5c3RlbSBpZGV2aWNlc3lzbG9nOiAke2Vyci5tZXNzYWdlfWApO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBtYWtlIHN1cmUgdGhlIGV4ZWN1dGFibGUgZXhpc3RzXG4gICAgICAgIGlmICghYXdhaXQgZnMuZXhpc3RzKHRoaXMucmVhbERldmljZUxvZ2dlcikpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFVuYWJsZSB0byBmaW5kIGlkZXZpY2VzeXNsb2cgZnJvbSAncmVhbERldmljZUxvZ2dlcicgY2FwYWJpbGl0eSAnJHt0aGlzLnJlYWxEZXZpY2VMb2dnZXJ9J2ApO1xuICAgICAgICB9XG4gICAgICAgIGNtZCA9IHRoaXMucmVhbERldmljZUxvZ2dlcjtcbiAgICAgIH1cblxuICAgICAgYXJncyA9IFsnLXUnLCB0aGlzLnVkaWRdO1xuICAgICAgZW52ID0gcHJvY2Vzcy5lbnY7XG4gICAgfSBlbHNlIGlmICgodGhpcy5yZWFsRGV2aWNlTG9nZ2VyIHx8ICcnKS5pbmRleE9mKCdkZXZpY2Vjb25zb2xlJykgIT09IC0xKSB7XG4gICAgICBsb2dnZXIuZGVidWcoJ0F0dGVtcHRpbmcgaU9TIGRldmljZSBsb2cgY2FwdHVyZSB2aWEgZGV2aWNlY29uc29sZScpO1xuICAgICAgbGV0IGRldmljZWNvbnNvbGU7XG4gICAgICBpZiAodGhpcy5yZWFsRGV2aWNlTG9nZ2VyLnRvTG93ZXJDYXNlKCkgPT09ICdkZXZpY2Vjb25zb2xlJykge1xuICAgICAgICBkZXZpY2Vjb25zb2xlID0gREVWSUNFX0NPTlNPTEVfUEFUSDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIG1ha2Ugc3VyZSB0aGF0IHdlIGhhdmUgdGhlIHBhdGggdG8gdGhlIGRpcmVjdG9yeSxcbiAgICAgICAgLy8gbm90IHRoZSBhY3R1YWwgZXhlY3V0YWJsZVxuICAgICAgICBsZXQgc3RhdDtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBzdGF0ID0gYXdhaXQgZnMuc3RhdCh0aGlzLnJlYWxEZXZpY2VMb2dnZXIpO1xuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFVuYWJsZSB0byBmaW5kIGRldmljZWNvbnNvbGUgZnJvbSAncmVhbERldmljZUxvZ2dlcicgY2FwYWJpbGl0eSAnJHt0aGlzLnJlYWxEZXZpY2VMb2dnZXJ9JzogJHtlcnIubWVzc2FnZX1gKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoc3RhdC5pc0RpcmVjdG9yeSgpKSB7XG4gICAgICAgICAgZGV2aWNlY29uc29sZSA9IHRoaXMucmVhbERldmljZUxvZ2dlcjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBtYWtlIHN1cmUgdGhleSd2ZSBwYXNzZWQgaW4gYGRldmljZWNvbnNvbGVgIGFuZCBub3Qgc29tZXRoaW5nIHJhbmRvbVxuICAgICAgICAgIGlmICghXy5lbmRzV2l0aCh0aGlzLnJlYWxEZXZpY2VMb2dnZXIsICdkZXZpY2Vjb25zb2xlJykpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgVW5hYmxlIHRvIHBhcnNlICdkZXZpY2Vjb25zb2xlJyBpbnN0YWxsYXRpb24gZGlyZWN0b3J5IGZyb20gJyR7dGhpcy5yZWFsRGV2aWNlTG9nZ2VyfSdgKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgLy8gcmVtb3ZlIHRoZSBleGVjdXRhYmxlLCBhbmQgdHJhaWxpbmcgYC9gLCB0byBnZXQgdGhlIGluc3RhbGwgZGlyZWN0b3J5XG4gICAgICAgICAgZGV2aWNlY29uc29sZSA9IHBhdGguZGlybmFtZSh0aGlzLnJlYWxEZXZpY2VMb2dnZXIpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGxvZ2dlci5kZWJ1ZyhgVXNpbmcgJ2RldmljZWNvbnNvbGUnIGZyb20gJyR7ZGV2aWNlY29uc29sZX0nYCk7XG5cbiAgICAgIGNtZCA9IGAke2RldmljZWNvbnNvbGV9L2RldmljZWNvbnNvbGVgO1xuICAgICAgYXJncyA9IFsnLXUnLCB0aGlzLnVkaWRdO1xuXG4gICAgICAvLyBzZXQgdXAgdGhlIGVudmlyb25tZW50IHRvIGJlIGFibGUgdG8gcnVuIGRldmljZWNvbnNvbGVcbiAgICAgIGVudiA9IF8uY2xvbmUocHJvY2Vzcy5lbnYpO1xuICAgICAgZW52LkRZTERfTElCUkFSWV9QQVRIID0gZGV2aWNlY29uc29sZTtcbiAgICAgIGlmIChwcm9jZXNzLmVudi5EWUxEX0xJQlJBUllfUEFUSCkge1xuICAgICAgICBlbnYuRFlMRF9MSUJSQVJZX1BBVEggPSBgJHtlbnYuRFlMRF9MSUJSQVJZX1BBVEh9OiR7cHJvY2Vzcy5lbnYuRFlMRF9MSUJSQVJZX1BBVEh9YDtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgbG9nZ2VyLmVycm9yQW5kVGhyb3coYFVuYWJsZSB0byBjYXB0dXJlIGRldmljZSBsb2cuIFVua25vd24gJ3JlYWxEZXZpY2VMb2dnZXInOiAnJHt0aGlzLnJlYWxEZXZpY2VMb2dnZXJ9J2ApO1xuICAgIH1cblxuICAgIHRoaXMuc3VicHJvY2Vzc0lkID0gYCR7Y21kfV8ke3RoaXMudWRpZH1gO1xuXG4gICAgbG9nZ2VyLmRlYnVnKGBTdGFydGluZyBpT1MgZGV2aWNlIGxvZyBjYXB0dXJlIHdpdGg6ICcke2NtZH0nYCk7XG5cbiAgICB0cnkge1xuICAgICAgLy8gY2xlYW51cCBleGlzdGluZyBsaXN0ZW5lcnMgaWYgdGhlIHByZXZpb3VzIHNlc3Npb24gaGFzIG5vdCBiZWVuIHRlcm1pbmF0ZWQgcHJvcGVybHlcbiAgICAgIGF3YWl0IHRoaXMua2lsbEV4aXN0aW5nU3lzTG9nUHJvY2Vzc2VzKGNtZCwgYXJncyk7XG4gICAgfSBjYXRjaCAoZSkge31cblxuICAgIC8vIGp1c3QgdXNlIG9uZSBpbnN0YW5jZSBvZiAnaWRldmljZXN5c2xvZycgcGVyIHVkaWRcbiAgICB0aGlzLnByb2MgPSB0aGlzLmdldElEZXZpY2VTeXNMb2dQcm9jZXNzKGNtZCwgYXJncywgZW52KTtcblxuICAgIGF3YWl0IHRoaXMuZmluaXNoU3RhcnRpbmdMb2dDYXB0dXJlKCk7XG4gIH1cblxuICBhc3luYyBzdGFydENhcHR1cmVTaW11bGF0b3IgKCkge1xuICAgIC8vIG90aGVyd2lzZSwgaWYgd2UgaGF2ZSBhIHNpbXVsYXRvci4uLlxuICAgIGxvZ2dlci5kZWJ1ZyhgU3RhcnRpbmcgaU9TICR7YXdhaXQgdGhpcy5zaW0uZ2V0UGxhdGZvcm1WZXJzaW9uKCl9IHNpbXVsYXRvciBsb2cgY2FwdHVyZWApO1xuICAgIGlmICh0aGlzLnhjb2RlVmVyc2lvbi5tYWpvciA8IDUpIHtcbiAgICAgIHRoaXMucHJvYyA9IG5ldyBTdWJQcm9jZXNzKCd0YWlsJywgWyctZicsICctbicsICcxJywgU1lTVEVNX0xPR19QQVRIXSk7XG4gICAgICBhd2FpdCB0aGlzLmZpbmlzaFN0YXJ0aW5nTG9nQ2FwdHVyZSgpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIHRoaXMgaXMgeGNvZGUgNitcbiAgICBpZiAoXy5pc1VuZGVmaW5lZCh0aGlzLnNpbS51ZGlkKSkge1xuICAgICAgbG9nZ2VyLmVycm9yQW5kVGhyb3coYGlPUyBsb2cgY2FwdHVyZSB3aXRoIFhjb2RlICR7dGhpcy54Y29kZVZlcnNpb24udmVyc2lvblN0cmluZ30gcmVxdWlyZXMgYSBzaW0gdWRpZGApO1xuICAgIH1cblxuICAgIGxldCBsb2dQYXRoID0gdGhpcy5zaW0uZ2V0TG9nRGlyKCk7XG4gICAgdHJ5IHtcbiAgICAgIGlmIChsb2dQYXRoLmluZGV4T2YoJyonKSA+PSAwKSB7XG4gICAgICAgIGxvZ2dlci5lcnJvcihgTG9nIHBhdGggaGFzICogaW4gaXQuIFVuYWJsZSB0byBzdGFydCBsb2cgY2FwdHVyZTogJHtsb2dQYXRofWApO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBsZXQgc3lzdGVtTG9nUGF0aCA9IHBhdGgucmVzb2x2ZShsb2dQYXRoLCAnc3lzdGVtLmxvZycpO1xuICAgICAgbG9nZ2VyLmRlYnVnKGBTeXN0ZW0gbG9nIHBhdGg6ICR7c3lzdGVtTG9nUGF0aH1gKTtcbiAgICAgIGF3YWl0IG1rZGlycChsb2dQYXRoKTtcbiAgICAgIGF3YWl0IGZzLndyaXRlRmlsZShzeXN0ZW1Mb2dQYXRoLCAnQSBuZXcgQXBwaXVtIHNlc3Npb24gaXMgYWJvdXQgdG8gc3RhcnQhXFxuJywge2ZsYWc6ICdhJ30pO1xuICAgICAgbGV0IGZpbGVzO1xuICAgICAgdHJ5IHtcbiAgICAgICAgZmlsZXMgPSBhd2FpdCBmcy5nbG9iKHN5c3RlbUxvZ1BhdGgpO1xuICAgICAgICBpZiAoZmlsZXMubGVuZ3RoIDwgMSkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQ291bGQgbm90IHN0YXJ0IGxvZyBjYXB0dXJlJyk7XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgbG9nZ2VyLmVycm9yKGBDb3VsZCBub3Qgc3RhcnQgbG9nIGNhcHR1cmUgYmVjYXVzZSBubyBpT1MgYCArXG4gICAgICAgICAgICAgICAgICAgICBgc2ltdWxhdG9yIGxvZ3MgY291bGQgYmUgZm91bmQgYXQgJHtzeXN0ZW1Mb2dQYXRofS4gYCArXG4gICAgICAgICAgICAgICAgICAgICBgTG9nZ2luZyB3aWxsIG5vdCBiZSBmdW5jdGlvbmFsIGZvciB0aGlzIHJ1bmApO1xuICAgICAgfVxuXG4gICAgICBsZXQgbGFzdE1vZGlmaWVkTG9nUGF0aCA9IGZpbGVzWzBdO1xuICAgICAgbGV0IGxhc3RNb2RpZmllZExvZ1RpbWUgPSAoYXdhaXQgZnMuc3RhdChsYXN0TW9kaWZpZWRMb2dQYXRoKSkubXRpbWU7XG4gICAgICBmb3IgKGxldCBmaWxlIG9mIGZpbGVzKSB7XG4gICAgICAgIGxldCB7bXRpbWV9ID0gYXdhaXQgZnMuc3RhdChmaWxlKTtcbiAgICAgICAgaWYgKG10aW1lID4gbGFzdE1vZGlmaWVkTG9nVGltZSkge1xuICAgICAgICAgIGxhc3RNb2RpZmllZExvZ1BhdGggPSBmaWxlO1xuICAgICAgICAgIGxhc3RNb2RpZmllZExvZ1RpbWUgPSBtdGltZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgY29uc3QgdGFpbEFyZ3MgPSBbJy1mJywgJy1uJywgJzEnLCBsYXN0TW9kaWZpZWRMb2dQYXRoXTtcbiAgICAgIHRyeSB7XG4gICAgICAgIC8vIGNsZWFudXAgZXhpc3RpbmcgbGlzdGVuZXJzIGlmIHRoZSBwcmV2aW91cyBzZXNzaW9uIGhhcyBub3QgYmVlbiB0ZXJtaW5hdGVkIHByb3Blcmx5XG4gICAgICAgIGF3YWl0IGV4ZWMoJ3BraWxsJywgWycteGYnLCBbJ3RhaWwnLCAuLi50YWlsQXJnc10uam9pbignICcpXSk7XG4gICAgICB9IGNhdGNoIChlKSB7fVxuICAgICAgdGhpcy5wcm9jID0gbmV3IFN1YlByb2Nlc3MoJ3RhaWwnLCB0YWlsQXJncyk7XG4gICAgICBhd2FpdCB0aGlzLmZpbmlzaFN0YXJ0aW5nTG9nQ2FwdHVyZSgpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgbG9nZ2VyLmVycm9yQW5kVGhyb3coYFNpbXVsYXRvciBsb2cgY2FwdHVyZSBmYWlsZWQ6ICR7ZXJyLm1lc3NhZ2V9YCk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgc3RhcnRDYXB0dXJlICgpIHtcbiAgICBpZiAodGhpcy51ZGlkKSB7XG4gICAgICAvLyBpZiB3ZSBoYXZlIGEgcmVhbCBkZXZpY2VcbiAgICAgIHJldHVybiBhd2FpdCB0aGlzLnN0YXJ0Q2FwdHVyZVJlYWxEZXZpY2UoKTtcbiAgICB9XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuc3RhcnRDYXB0dXJlU2ltdWxhdG9yKCk7XG4gIH1cblxuICBhc3luYyBmaW5pc2hTdGFydGluZ0xvZ0NhcHR1cmUgKCkge1xuICAgIGlmICghdGhpcy5wcm9jKSB7XG4gICAgICBsb2dnZXIuZXJyb3JBbmRUaHJvdygnQ291bGQgbm90IGNhcHR1cmUgZGV2aWNlIGxvZycpO1xuICAgIH1cbiAgICBsZXQgZmlyc3RMaW5lID0gdHJ1ZTtcbiAgICB0aGlzLnByb2Mub24oJ291dHB1dCcsIChzdGRvdXQsIHN0ZGVycikgPT4ge1xuICAgICAgaWYgKHN0ZG91dCkge1xuICAgICAgICBpZiAoZmlyc3RMaW5lKSB7XG4gICAgICAgICAgaWYgKHN0ZG91dC5zdWJzdHIoLTEsIDEpID09PSAnXFxuJykge1xuICAgICAgICAgICAgLy8gZG9uJ3Qgc3RvcmUgdGhlIGZpcnN0IGxpbmUgb2YgdGhlIGxvZyBiZWNhdXNlIGl0IGNhbWUgYmVmb3JlIHRoZSBzaW0gb3IgZGV2aWNlIHdhcyBsYXVuY2hlZFxuICAgICAgICAgICAgZmlyc3RMaW5lID0gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMubG9nUm93ICs9IHN0ZG91dDtcbiAgICAgICAgICBpZiAoc3Rkb3V0LnN1YnN0cigtMSwgMSkgPT09ICdcXG4nKSB7XG4gICAgICAgICAgICB0aGlzLm9uT3V0cHV0KCk7XG4gICAgICAgICAgICB0aGlzLmxvZ1JvdyA9ICcnO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKHN0ZGVycikge1xuICAgICAgICB0aGlzLm9uT3V0cHV0KCdTVERFUlInKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGxldCBzZCA9IChzdGRvdXQsIHN0ZGVycikgPT4ge1xuICAgICAgaWYgKC9leGVjdnBcXChcXCkvLnRlc3Qoc3RkZXJyKSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2lPUyBsb2cgY2FwdHVyZSBwcm9jZXNzIGZhaWxlZCB0byBzdGFydCcpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHN0ZG91dCB8fCBzdGRlcnI7XG4gICAgfTtcbiAgICBhd2FpdCB0aGlzLnByb2Muc3RhcnQoc2QsIFNUQVJUX1RJTUVPVVQpO1xuICB9XG5cbiAgYXN5bmMgc3RvcENhcHR1cmUgKCkge1xuICAgIGlmICh0aGlzLnByb2MpIHtcbiAgICAgIGlmICh0aGlzLnVkaWQpIHtcbiAgICAgICAgLy8gSWYgbm8gb3RoZXIgVURJRCdzIGFyZSB1c2luZyAnaWRldmljZXN5c2xvZycga2lsbCBpdFxuICAgICAgICBjb25zdCBjYWNoZWRTeXNMb2cgPSBJT1NMb2cuY2FjaGVkSURldmljZVN5c0xvZ3NbdGhpcy5zdWJwcm9jZXNzSWRdO1xuICAgICAgICBpZiAoY2FjaGVkU3lzTG9nKSB7XG4gICAgICAgICAgY2FjaGVkU3lzTG9nLmNvdW50LS07XG4gICAgICAgICAgaWYgKGNhY2hlZFN5c0xvZy5jb3VudCA9PT0gMCkge1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5raWxsTG9nU3ViUHJvY2VzcygpO1xuICAgICAgICAgICAgZGVsZXRlIElPU0xvZy5jYWNoZWRJRGV2aWNlU3lzTG9nc1t0aGlzLnN1YnByb2Nlc3NJZF07XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBhd2FpdCB0aGlzLmtpbGxMb2dTdWJQcm9jZXNzKCk7XG4gICAgICB9XG4gICAgfVxuICAgIHRoaXMucHJvYyA9IG51bGw7XG4gIH1cblxuICBhc3luYyBraWxsTG9nU3ViUHJvY2VzcyAoKSB7XG4gICAgaWYgKHRoaXMucHJvYy5pc1J1bm5pbmcpIHtcbiAgICAgIGxvZ2dlci5kZWJ1ZygnU3RvcHBpbmcgaU9TIGxvZyBjYXB0dXJlJyk7XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCB0aGlzLnByb2Muc3RvcCgnU0lHVEVSTScsIDEwMDApO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICBpZiAodGhpcy5wcm9jLmlzUnVubmluZykge1xuICAgICAgICAgIGxvZ2dlci53YXJuKCdDYW5ub3Qgc3RvcCBsb2cgY2FwdHVyZSBwcm9jZXNzLiBTZW5kaW5nIFNJR0tJTEwuLi4nKTtcbiAgICAgICAgICBhd2FpdCB0aGlzLnByb2Muc3RvcCgnU0lHS0lMTCcpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgb25PdXRwdXQgKHByZWZpeCA9ICcnKSB7XG4gICAgbGV0IGxvZ3MgPSB0aGlzLmxvZ1Jvdy5zcGxpdCgnXFxuJyk7XG4gICAgZm9yIChsZXQgbG9nIG9mIGxvZ3MpIHtcbiAgICAgIGlmICghbG9nKSBjb250aW51ZTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBjdXJseVxuICAgICAgbGV0IGxvZ09iaiA9IHtcbiAgICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLFxuICAgICAgICBsZXZlbDogJ0FMTCcsXG4gICAgICAgIG1lc3NhZ2U6IGxvZ1xuICAgICAgfTtcbiAgICAgIHRoaXMubG9ncy5wdXNoKGxvZ09iaik7XG4gICAgICB0aGlzLmVtaXQoJ291dHB1dCcsIGxvZ09iaik7XG4gICAgICBpZiAodGhpcy5sb2dzLmxlbmd0aCA+IHRoaXMubWF4QnVmZmVyU2l6ZSkge1xuICAgICAgICB0aGlzLmxvZ3Muc2hpZnQoKTtcbiAgICAgICAgaWYgKHRoaXMubG9nSWR4U2luY2VMYXN0UmVxdWVzdCA+IDApIHtcbiAgICAgICAgICAtLXRoaXMubG9nSWR4U2luY2VMYXN0UmVxdWVzdDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKHRoaXMuc2hvd0xvZ3MpIHtcbiAgICAgICAgbGV0IHNwYWNlID0gcHJlZml4Lmxlbmd0aCA+IDAgPyAnICcgOiAnJztcbiAgICAgICAgbG9nZ2VyLmluZm8oYFtJT1NfU1lTTE9HX1JPVyR7c3BhY2V9JHtwcmVmaXh9XSAke2xvZ31gKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBhc3luYyBnZXRMb2dzICgpIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSByZXF1aXJlLWF3YWl0XG4gICAgaWYgKHRoaXMubG9ncy5sZW5ndGggJiYgdGhpcy5sb2dJZHhTaW5jZUxhc3RSZXF1ZXN0IDwgdGhpcy5sb2dzLmxlbmd0aCkge1xuICAgICAgbGV0IHJlc3VsdCA9IHRoaXMubG9ncztcbiAgICAgIGlmICh0aGlzLmxvZ0lkeFNpbmNlTGFzdFJlcXVlc3QgPiAwKSB7XG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdC5zbGljZSh0aGlzLmxvZ0lkeFNpbmNlTGFzdFJlcXVlc3QpO1xuICAgICAgfVxuICAgICAgdGhpcy5sb2dJZHhTaW5jZUxhc3RSZXF1ZXN0ID0gdGhpcy5sb2dzLmxlbmd0aDtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuICAgIHJldHVybiBbXTtcbiAgfVxuXG4gIGFzeW5jIGdldEFsbExvZ3MgKCkgeyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHJlcXVpcmUtYXdhaXRcbiAgICByZXR1cm4gdGhpcy5sb2dzO1xuICB9XG5cbiAgYXN5bmMga2lsbEV4aXN0aW5nU3lzTG9nUHJvY2Vzc2VzIChjbWQsIGFyZ3MpIHtcbiAgICBpZiAoIUlPU0xvZy5jYWNoZWRJRGV2aWNlU3lzTG9nc1t0aGlzLnN1YnByb2Nlc3NJZF0pIHtcbiAgICAgIGF3YWl0IGV4ZWMoJ3BraWxsJywgWycteGYnLCBbY21kLCAuLi5hcmdzXS5qb2luKCcgJyldKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2V0ICdpZGV2aWNlc3lzbG9nJyBzdWJwcm9jZXNzIGZvciBhIGdpdmVuIHVkaWQuXG4gICAqXG4gICAqIFRoaXMgZnVuY3Rpb24gY2FjaGVzIGFuZCByZS11c2VzIGluc3RhbmNlcyBzbyB0aGF0IHRoZXJlJ3NcbiAgICoganVzdCBvbmUgaW5zdGFuY2UgcGVyIGRldmljZSAoY2FjaGUgYnkgVURJRClcbiAgICovXG4gIGdldElEZXZpY2VTeXNMb2dQcm9jZXNzIChjbWQsIGFyZ3MsIGVudikge1xuICAgIGlmICghSU9TTG9nLmNhY2hlZElEZXZpY2VTeXNMb2dzW3RoaXMuc3VicHJvY2Vzc0lkXSkge1xuICAgICAgbGV0IHtwcm9jfSA9IElPU0xvZy5jYWNoZWRJRGV2aWNlU3lzTG9nc1t0aGlzLnN1YnByb2Nlc3NJZF0gPSB7XG4gICAgICAgIHByb2M6IG5ldyBTdWJQcm9jZXNzKGNtZCwgYXJncywge2Vudn0pLFxuICAgICAgICBjb3VudDogMSxcbiAgICAgIH07XG4gICAgICAvLyBJZiB0aGUgcHJvY2VzcyBkaWVzLCByZW1vdmUgaXQgZnJvbSB0aGUgY2FjaGVcbiAgICAgIHByb2Mub24oJ2V4aXQnLCAoKSA9PiBkZWxldGUgSU9TTG9nLmNhY2hlZElEZXZpY2VTeXNMb2dzW3RoaXMuc3VicHJvY2Vzc0lkXSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIElPU0xvZy5jYWNoZWRJRGV2aWNlU3lzTG9nc1t0aGlzLnN1YnByb2Nlc3NJZF0uY291bnQrKztcbiAgICB9XG4gICAgcmV0dXJuIElPU0xvZy5jYWNoZWRJRGV2aWNlU3lzTG9nc1t0aGlzLnN1YnByb2Nlc3NJZF0ucHJvYztcbiAgfVxufVxuXG5JT1NMb2cuY2FjaGVkSURldmljZVN5c0xvZ3MgPSB7fTtcblxuZXhwb3J0IHsgSU9TTG9nLCBERVZJQ0VfQ09OU09MRV9QQVRIIH07XG5leHBvcnQgZGVmYXVsdCBJT1NMb2c7XG4iXSwiZmlsZSI6ImxpYi9kZXZpY2UtbG9nL2lvcy1sb2cuanMiLCJzb3VyY2VSb290IjoiLi4vLi4vLi4ifQ==
