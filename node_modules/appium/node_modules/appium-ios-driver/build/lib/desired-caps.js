"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.desiredCapValidation = desiredCapValidation;
exports.default = exports.desiredCapConstraints = void 0;

require("source-map-support/register");

var _lodash = _interopRequireDefault(require("lodash"));

var _logger = _interopRequireDefault(require("./logger"));

const desiredCapConstraints = {
  platformName: {
    presence: true,
    isString: true,
    inclusionCaseInsensitive: ['iOS']
  },
  browserName: {
    isString: true
  },
  app: {
    isString: true
  },
  launchTimeout: {},
  calendarFormat: {
    isString: true
  },
  bundleId: {
    isString: true
  },
  udid: {
    isString: true
  },
  locationServicesEnabled: {
    isBoolean: true
  },
  locationServicesAuthorized: {
    isBoolean: true
  },
  autoAcceptAlerts: {
    isBoolean: true
  },
  autoDismissAlerts: {
    isBoolean: true
  },
  nativeInstrumentsLib: {
    isBoolean: true
  },
  nativeWebTap: {
    isBoolean: true
  },
  safariInitialUrl: {
    isString: true
  },
  safariAllowPopups: {
    isBoolean: true
  },
  safariIgnoreFraudWarning: {
    isBoolean: true
  },
  safariOpenLinksInBackground: {
    isBoolean: true
  },
  safariShowFullResponse: {
    isBoolean: true
  },
  keepKeyChains: {
    isBoolean: true
  },
  localizableStringsDir: {
    isString: true
  },
  processArguments: {},
  interKeyDelay: {
    isNumber: true
  },
  showIOSLog: {
    isBoolean: true
  },
  sendKeyStrategy: {
    isString: true,
    inclusion: ['oneByOne', 'grouped', 'setValue']
  },
  screenshotWaitTimeout: {
    isNumber: true
  },
  waitForAppScript: {
    isString: true
  },
  webviewConnectRetries: {
    isNumber: true
  },
  appName: {
    isString: true
  },
  clearSystemFiles: {
    isBoolean: true
  },
  customSSLCert: {
    isString: true
  },
  webkitResponseTimeout: {
    isNumber: true
  },
  webkitDebugProxyPort: {
    isNumber: true
  },
  remoteDebugProxy: {
    isString: true
  },
  enablePerformanceLogging: {
    isBoolean: true
  },
  enableAsyncExecuteFromHttps: {
    isBoolean: true
  },
  realDeviceLogger: {
    isString: true
  },
  fullContextList: {
    isBoolean: true
  },
  ignoreAboutBlankUrl: {
    isBoolean: true
  },
  startIWDP: {
    isBoolean: true
  },
  showIWDPLog: {
    isBoolean: true
  },
  skipLogCapture: {
    isBoolean: true
  }
};
exports.desiredCapConstraints = desiredCapConstraints;

function desiredCapValidation(caps) {
  if ((caps.browserName || '').toLowerCase() !== 'safari' && !caps.app && !caps.bundleId) {
    let msg = 'The desired capabilities must include either an app or a bundleId for iOS';

    _logger.default.errorAndThrow(msg);
  }

  if (caps.launchTimeout) {
    let msg = 'launchTimeout must be a number, object, or string JSON object';

    if (!_lodash.default.isNumber(caps.launchTimeout)) {
      if (_lodash.default.isString(caps.launchTimeout)) {
        try {
          caps.launchTimeout = JSON.parse(caps.launchTimeout);
        } catch (err) {
          _logger.default.errorAndThrow(msg);
        }
      }

      if (!_lodash.default.isObject(caps.launchTimeout)) {
        _logger.default.errorAndThrow(msg);
      }
    }
  }

  if (caps.processArguments) {
    if (_lodash.default.isString(caps.processArguments)) {
      try {
        caps.processArguments = JSON.parse(caps.processArguments);
      } catch (ign) {}
    } else if (!_lodash.default.isObject(caps.processArguments)) {
      _logger.default.errorAndThrow('processArguments must be a string, object, or a string JSON object');
    }
  }

  if (typeof caps.enablePerformanceLogging !== 'boolean' && typeof caps.loggingPrefs === 'object' && caps.loggingPrefs.performance) {
    caps.enablePerformanceLogging = !!caps.loggingPrefs.performance;
  }

  return true;
}

var _default = desiredCapConstraints;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9kZXNpcmVkLWNhcHMuanMiXSwibmFtZXMiOlsiZGVzaXJlZENhcENvbnN0cmFpbnRzIiwicGxhdGZvcm1OYW1lIiwicHJlc2VuY2UiLCJpc1N0cmluZyIsImluY2x1c2lvbkNhc2VJbnNlbnNpdGl2ZSIsImJyb3dzZXJOYW1lIiwiYXBwIiwibGF1bmNoVGltZW91dCIsImNhbGVuZGFyRm9ybWF0IiwiYnVuZGxlSWQiLCJ1ZGlkIiwibG9jYXRpb25TZXJ2aWNlc0VuYWJsZWQiLCJpc0Jvb2xlYW4iLCJsb2NhdGlvblNlcnZpY2VzQXV0aG9yaXplZCIsImF1dG9BY2NlcHRBbGVydHMiLCJhdXRvRGlzbWlzc0FsZXJ0cyIsIm5hdGl2ZUluc3RydW1lbnRzTGliIiwibmF0aXZlV2ViVGFwIiwic2FmYXJpSW5pdGlhbFVybCIsInNhZmFyaUFsbG93UG9wdXBzIiwic2FmYXJpSWdub3JlRnJhdWRXYXJuaW5nIiwic2FmYXJpT3BlbkxpbmtzSW5CYWNrZ3JvdW5kIiwic2FmYXJpU2hvd0Z1bGxSZXNwb25zZSIsImtlZXBLZXlDaGFpbnMiLCJsb2NhbGl6YWJsZVN0cmluZ3NEaXIiLCJwcm9jZXNzQXJndW1lbnRzIiwiaW50ZXJLZXlEZWxheSIsImlzTnVtYmVyIiwic2hvd0lPU0xvZyIsInNlbmRLZXlTdHJhdGVneSIsImluY2x1c2lvbiIsInNjcmVlbnNob3RXYWl0VGltZW91dCIsIndhaXRGb3JBcHBTY3JpcHQiLCJ3ZWJ2aWV3Q29ubmVjdFJldHJpZXMiLCJhcHBOYW1lIiwiY2xlYXJTeXN0ZW1GaWxlcyIsImN1c3RvbVNTTENlcnQiLCJ3ZWJraXRSZXNwb25zZVRpbWVvdXQiLCJ3ZWJraXREZWJ1Z1Byb3h5UG9ydCIsInJlbW90ZURlYnVnUHJveHkiLCJlbmFibGVQZXJmb3JtYW5jZUxvZ2dpbmciLCJlbmFibGVBc3luY0V4ZWN1dGVGcm9tSHR0cHMiLCJyZWFsRGV2aWNlTG9nZ2VyIiwiZnVsbENvbnRleHRMaXN0IiwiaWdub3JlQWJvdXRCbGFua1VybCIsInN0YXJ0SVdEUCIsInNob3dJV0RQTG9nIiwic2tpcExvZ0NhcHR1cmUiLCJkZXNpcmVkQ2FwVmFsaWRhdGlvbiIsImNhcHMiLCJ0b0xvd2VyQ2FzZSIsIm1zZyIsImxvZ2dlciIsImVycm9yQW5kVGhyb3ciLCJfIiwiSlNPTiIsInBhcnNlIiwiZXJyIiwiaXNPYmplY3QiLCJpZ24iLCJsb2dnaW5nUHJlZnMiLCJwZXJmb3JtYW5jZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBR0EsTUFBTUEscUJBQXFCLEdBQUc7QUFDNUJDLEVBQUFBLFlBQVksRUFBRTtBQUNaQyxJQUFBQSxRQUFRLEVBQUUsSUFERTtBQUVaQyxJQUFBQSxRQUFRLEVBQUUsSUFGRTtBQUdaQyxJQUFBQSx3QkFBd0IsRUFBRSxDQUFDLEtBQUQ7QUFIZCxHQURjO0FBTTVCQyxFQUFBQSxXQUFXLEVBQUU7QUFDWEYsSUFBQUEsUUFBUSxFQUFFO0FBREMsR0FOZTtBQVM1QkcsRUFBQUEsR0FBRyxFQUFFO0FBQ0hILElBQUFBLFFBQVEsRUFBRTtBQURQLEdBVHVCO0FBWTVCSSxFQUFBQSxhQUFhLEVBQUUsRUFaYTtBQWdCNUJDLEVBQUFBLGNBQWMsRUFBRTtBQUNkTCxJQUFBQSxRQUFRLEVBQUU7QUFESSxHQWhCWTtBQW1CNUJNLEVBQUFBLFFBQVEsRUFBRTtBQUNSTixJQUFBQSxRQUFRLEVBQUU7QUFERixHQW5Ca0I7QUFzQjVCTyxFQUFBQSxJQUFJLEVBQUU7QUFDSlAsSUFBQUEsUUFBUSxFQUFFO0FBRE4sR0F0QnNCO0FBeUI1QlEsRUFBQUEsdUJBQXVCLEVBQUU7QUFDdkJDLElBQUFBLFNBQVMsRUFBRTtBQURZLEdBekJHO0FBNEI1QkMsRUFBQUEsMEJBQTBCLEVBQUU7QUFDMUJELElBQUFBLFNBQVMsRUFBRTtBQURlLEdBNUJBO0FBK0I1QkUsRUFBQUEsZ0JBQWdCLEVBQUU7QUFDaEJGLElBQUFBLFNBQVMsRUFBRTtBQURLLEdBL0JVO0FBa0M1QkcsRUFBQUEsaUJBQWlCLEVBQUU7QUFDakJILElB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QUEsSUFBSSxDQUFDeEIsZ0JBQUwsR0FBd0I4QixJQUFJLENBQUNDLEtBQUwsQ0FBV1AsSUFBSSxDQUFDeEIsZ0JBQWhCLENBQXhCO0FBQ0QsT0FIRCxDQUdFLE9BQU9rQyxHQUFQLEVBQVksQ0FFYjtBQUNGLEtBUEQsTUFPTyxJQUFJLENBQUNMLGdCQUFFSSxRQUFGLENBQVdULElBQUksQ0FBQ3hCLGdCQUFoQixDQUFMLEVBQXdDO0FBQzdDMkIsc0JBQU9DLGFBQVAsQ0FBcUIsb0VBQXJCO0FBQ0Q7QUFDRjs7QUFJRCxNQUFJLE9BQU9KLElBQUksQ0FBQ1Qsd0JBQVosS0FBeUMsU0FBekMsSUFDQSxPQUFPUyxJQUFJLENBQUNXLFlBQVosS0FBNkIsUUFEN0IsSUFDeUNYLElBQUksQ0FBQ1csWUFBTCxDQUFrQkMsV0FEL0QsRUFDNEU7QUFDMUVaLElBQUFBLElBQUksQ0FBQ1Qsd0JBQUwsR0FBZ0MsQ0FBQyxDQUFDUyxJQUFJLENBQUNXLFlBQUwsQ0FBa0JDLFdBQXBEO0FBQ0Q7O0FBR0QsU0FBTyxJQUFQO0FBQ0Q7O2VBR2M3RCxxQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgbG9nZ2VyIGZyb20gJy4vbG9nZ2VyJztcblxuXG5jb25zdCBkZXNpcmVkQ2FwQ29uc3RyYWludHMgPSB7XG4gIHBsYXRmb3JtTmFtZToge1xuICAgIHByZXNlbmNlOiB0cnVlLFxuICAgIGlzU3RyaW5nOiB0cnVlLFxuICAgIGluY2x1c2lvbkNhc2VJbnNlbnNpdGl2ZTogWydpT1MnXVxuICB9LFxuICBicm93c2VyTmFtZToge1xuICAgIGlzU3RyaW5nOiB0cnVlXG4gIH0sXG4gIGFwcDoge1xuICAgIGlzU3RyaW5nOiB0cnVlXG4gIH0sXG4gIGxhdW5jaFRpbWVvdXQ6IHtcbiAgICAvLyByZWNvZ25pemUgdGhlIGNhcCxcbiAgICAvLyBidXQgdmFsaWRhdGUgaW4gdGhlIGRyaXZlciN2YWxpZGF0ZURlc2lyZWRDYXBzIG1ldGhvZFxuICB9LFxuICBjYWxlbmRhckZvcm1hdDoge1xuICAgIGlzU3RyaW5nOiB0cnVlXG4gIH0sXG4gIGJ1bmRsZUlkOiB7XG4gICAgaXNTdHJpbmc6IHRydWVcbiAgfSxcbiAgdWRpZDoge1xuICAgIGlzU3RyaW5nOiB0cnVlXG4gIH0sXG4gIGxvY2F0aW9uU2VydmljZXNFbmFibGVkOiB7XG4gICAgaXNCb29sZWFuOiB0cnVlXG4gIH0sXG4gIGxvY2F0aW9uU2VydmljZXNBdXRob3JpemVkOiB7XG4gICAgaXNCb29sZWFuOiB0cnVlXG4gIH0sXG4gIGF1dG9BY2NlcHRBbGVydHM6IHtcbiAgICBpc0Jvb2xlYW46IHRydWVcbiAgfSxcbiAgYXV0b0Rpc21pc3NBbGVydHM6IHtcbiAgICBpc0Jvb2xlYW46IHRydWVcbiAgfSxcbiAgbmF0aXZlSW5zdHJ1bWVudHNMaWI6IHtcbiAgICBpc0Jvb2xlYW46IHRydWVcbiAgfSxcbiAgbmF0aXZlV2ViVGFwOiB7XG4gICAgaXNCb29sZWFuOiB0cnVlXG4gIH0sXG4gIHNhZmFyaUluaXRpYWxVcmw6IHtcbiAgICBpc1N0cmluZzogdHJ1ZVxuICB9LFxuICBzYWZhcmlBbGxvd1BvcHVwczoge1xuICAgIGlzQm9vbGVhbjogdHJ1ZVxuICB9LFxuICBzYWZhcmlJZ25vcmVGcmF1ZFdhcm5pbmc6IHtcbiAgICBpc0Jvb2xlYW46IHRydWVcbiAgfSxcbiAgc2FmYXJpT3BlbkxpbmtzSW5CYWNrZ3JvdW5kOiB7XG4gICAgaXNCb29sZWFuOiB0cnVlXG4gIH0sXG4gIHNhZmFyaVNob3dGdWxsUmVzcG9uc2U6IHtcbiAgICBpc0Jvb2xlYW46IHRydWVcbiAgfSxcbiAga2VlcEtleUNoYWluczoge1xuICAgIGlzQm9vbGVhbjogdHJ1ZVxuICB9LFxuICBsb2NhbGl6YWJsZVN0cmluZ3NEaXI6IHtcbiAgICBpc1N0cmluZzogdHJ1ZVxuICB9LFxuICBwcm9jZXNzQXJndW1lbnRzOiB7XG4gICAgLy8gcmVjb2duaXplIHRoZSBjYXAsXG4gICAgLy8gYnV0IHZhbGlkYXRlIGluIHRoZSBkcml2ZXIjdmFsaWRhdGVEZXNpcmVkQ2FwcyBtZXRob2RcbiAgfSxcbiAgaW50ZXJLZXlEZWxheToge1xuICAgIGlzTnVtYmVyOiB0cnVlXG4gIH0sXG4gIHNob3dJT1NMb2c6IHtcbiAgICBpc0Jvb2xlYW46IHRydWVcbiAgfSxcbiAgc2VuZEtleVN0cmF0ZWd5OiB7XG4gICAgaXNTdHJpbmc6IHRydWUsXG4gICAgaW5jbHVzaW9uOiBbJ29uZUJ5T25lJywgJ2dyb3VwZWQnLCAnc2V0VmFsdWUnXVxuICB9LFxuICBzY3JlZW5zaG90V2FpdFRpbWVvdXQ6IHtcbiAgICBpc051bWJlcjogdHJ1ZVxuICB9LFxuICB3YWl0Rm9yQXBwU2NyaXB0OiB7XG4gICAgaXNTdHJpbmc6IHRydWVcbiAgfSxcbiAgd2Vidmlld0Nvbm5lY3RSZXRyaWVzOiB7XG4gICAgaXNOdW1iZXI6IHRydWVcbiAgfSxcbiAgYXBwTmFtZToge1xuICAgIGlzU3RyaW5nOiB0cnVlXG4gIH0sXG4gIGNsZWFyU3lzdGVtRmlsZXM6IHtcbiAgICBpc0Jvb2xlYW46IHRydWVcbiAgfSxcbiAgY3VzdG9tU1NMQ2VydDoge1xuICAgIGlzU3RyaW5nOiB0cnVlXG4gIH0sXG4gIHdlYmtpdFJlc3BvbnNlVGltZW91dDoge1xuICAgIGlzTnVtYmVyOiB0cnVlXG4gIH0sXG4gIHdlYmtpdERlYnVnUHJveHlQb3J0OiB7XG4gICAgaXNOdW1iZXI6IHRydWVcbiAgfSxcbiAgcmVtb3RlRGVidWdQcm94eToge1xuICAgIGlzU3RyaW5nOiB0cnVlXG4gIH0sXG4gIGVuYWJsZVBlcmZvcm1hbmNlTG9nZ2luZzoge1xuICAgIGlzQm9vbGVhbjogdHJ1ZVxuICB9LFxuICBlbmFibGVBc3luY0V4ZWN1dGVGcm9tSHR0cHM6IHtcbiAgICBpc0Jvb2xlYW46IHRydWVcbiAgfSxcbiAgcmVhbERldmljZUxvZ2dlcjoge1xuICAgIGlzU3RyaW5nOiB0cnVlXG4gIH0sXG4gIGZ1bGxDb250ZXh0TGlzdDoge1xuICAgIGlzQm9vbGVhbjogdHJ1ZVxuICB9LFxuICBpZ25vcmVBYm91dEJsYW5rVXJsOiB7XG4gICAgaXNCb29sZWFuOiB0cnVlXG4gIH0sXG4gIHN0YXJ0SVdEUDoge1xuICAgIGlzQm9vbGVhbjogdHJ1ZVxuICB9LFxuICBzaG93SVdEUExvZzoge1xuICAgIGlzQm9vbGVhbjogdHJ1ZVxuICB9LFxuICBza2lwTG9nQ2FwdHVyZToge1xuICAgIGlzQm9vbGVhbjogdHJ1ZVxuICB9LFxufTtcblxuZnVuY3Rpb24gZGVzaXJlZENhcFZhbGlkYXRpb24gKGNhcHMpIHtcbiAgLy8gbWFrZSBzdXJlIHRoYXQgdGhlIGNhcGFiaWxpdGllcyBoYXZlIG9uZSBvZiBgYXBwYCBvciBgYnVuZGxlSWRgXG4gIGlmICgoY2Fwcy5icm93c2VyTmFtZSB8fCAnJykudG9Mb3dlckNhc2UoKSAhPT0gJ3NhZmFyaScgJiZcbiAgICAgICFjYXBzLmFwcCAmJiAhY2Fwcy5idW5kbGVJZCkge1xuICAgIGxldCBtc2cgPSAnVGhlIGRlc2lyZWQgY2FwYWJpbGl0aWVzIG11c3QgaW5jbHVkZSBlaXRoZXIgYW4gYXBwIG9yIGEgYnVuZGxlSWQgZm9yIGlPUyc7XG4gICAgbG9nZ2VyLmVycm9yQW5kVGhyb3cobXNnKTtcbiAgfVxuXG4gIC8vIGBsYXVuY2hUaW1lb3V0YCBpcyBtb3JlIGNvbXBsZXggdGhhbiB0aGUgdmFsaWRhdG9ycyBjYW4gZWFzaWx5IGhhbmRsZVxuICAvLyBhbmQgdG9vIHNwZWNpZmljIGZvciBhIGdlbmVyYWxpemVkIHZhbGlkYXRvciBvZiBpdHMgb3duXG4gIGlmIChjYXBzLmxhdW5jaFRpbWVvdXQpIHtcbiAgICAvLyBpdCBjYW4gYmUgYSBudW1iZXIsIGEgSlNPTiBzdHJpbmcsIG9yIGFuIG9iamVjdFxuICAgIGxldCBtc2cgPSAnbGF1bmNoVGltZW91dCBtdXN0IGJlIGEgbnVtYmVyLCBvYmplY3QsIG9yIHN0cmluZyBKU09OIG9iamVjdCc7XG4gICAgaWYgKCFfLmlzTnVtYmVyKGNhcHMubGF1bmNoVGltZW91dCkpIHtcbiAgICAgIGlmIChfLmlzU3RyaW5nKGNhcHMubGF1bmNoVGltZW91dCkpIHtcbiAgICAgICAgLy8gaWYgdGhpcyBpcyBhIHN0cmluZywgaXQgbXVzdCBiZSBhIEpTT04gc3RyaW5nXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgLy8gY2hhbmdlIGBsYXVuY2hUaW1lb3V0YCB0byBhbiBvYmplY3RcbiAgICAgICAgICBjYXBzLmxhdW5jaFRpbWVvdXQgPSBKU09OLnBhcnNlKGNhcHMubGF1bmNoVGltZW91dCk7XG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgIC8vIGl0IHdhcyBhIHN0cmluZywgYnV0IG5vdCBzb21ldGhpbmcgcGFyc2FibGUgYXMgSlNPTlxuICAgICAgICAgIGxvZ2dlci5lcnJvckFuZFRocm93KG1zZyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmICghXy5pc09iamVjdChjYXBzLmxhdW5jaFRpbWVvdXQpKSB7XG4gICAgICAgIGxvZ2dlci5lcnJvckFuZFRocm93KG1zZyk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLy8gYHByb2Nlc3NBcmd1bWVudHNgIGlzIG1vcmUgY29tcGxleCBhcyBpdCBjYW4gYmUgYSBzdHJpbmdcbiAgLy8gb3IgYSBoYXNoXG4gIGlmIChjYXBzLnByb2Nlc3NBcmd1bWVudHMpIHtcbiAgICBpZiAoXy5pc1N0cmluZyhjYXBzLnByb2Nlc3NBcmd1bWVudHMpKSB7XG4gICAgICB0cnkge1xuICAgICAgICAvLyB0cnkgdG8gcGFyc2UgdGhlIHN0cmluZyBhcyBKU09OXG4gICAgICAgIGNhcHMucHJvY2Vzc0FyZ3VtZW50cyA9IEpTT04ucGFyc2UoY2Fwcy5wcm9jZXNzQXJndW1lbnRzKTtcbiAgICAgIH0gY2F0Y2ggKGlnbikge1xuICAgICAgICAvLyBpZiB3ZSBjYW5ub3QgcGFyc2UsIGp1c3QgbGVhdmUgYXMgYSBzdHJpbmdcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKCFfLmlzT2JqZWN0KGNhcHMucHJvY2Vzc0FyZ3VtZW50cykpIHtcbiAgICAgIGxvZ2dlci5lcnJvckFuZFRocm93KCdwcm9jZXNzQXJndW1lbnRzIG11c3QgYmUgYSBzdHJpbmcsIG9iamVjdCwgb3IgYSBzdHJpbmcgSlNPTiBvYmplY3QnKTtcbiAgICB9XG4gIH1cblxuICAvLyB0aGVyZSBpcyBhbiB1bmRvY3VtZW50ZWQgbGVnYWN5IGNhcCBgbG9nZ2luZ1ByZWZzLnBlcmZvcm1hbmNlYCB0byBlbmFibGVcbiAgLy8gcGVyZm9ybWFuY2UgbG9nZ2luZy4gVHJhbnNsYXRlIHRvIGBlbmFibGVQZXJmb3JtYW5jZUxvZ2dpbmdgXG4gIGlmICh0eXBlb2YgY2Fwcy5lbmFibGVQZXJmb3JtYW5jZUxvZ2dpbmcgIT09ICdib29sZWFuJyAmJlxuICAgICAgdHlwZW9mIGNhcHMubG9nZ2luZ1ByZWZzID09PSAnb2JqZWN0JyAmJiBjYXBzLmxvZ2dpbmdQcmVmcy5wZXJmb3JtYW5jZSkge1xuICAgIGNhcHMuZW5hYmxlUGVyZm9ybWFuY2VMb2dnaW5nID0gISFjYXBzLmxvZ2dpbmdQcmVmcy5wZXJmb3JtYW5jZTtcbiAgfVxuXG4gIC8vIGZpbmFsbHksIHJldHVybiB0cnVlIHNpbmNlIHRoZSBzdXBlcmNsYXNzIGNoZWNrIHBhc3NlZCwgYXMgZGlkIHRoaXNcbiAgcmV0dXJuIHRydWU7XG59XG5cbmV4cG9ydCB7IGRlc2lyZWRDYXBDb25zdHJhaW50cywgZGVzaXJlZENhcFZhbGlkYXRpb24gfTtcbmV4cG9ydCBkZWZhdWx0IGRlc2lyZWRDYXBDb25zdHJhaW50cztcbiJdLCJmaWxlIjoibGliL2Rlc2lyZWQtY2Fwcy5qcyIsInNvdXJjZVJvb3QiOiIuLi8uLiJ9
