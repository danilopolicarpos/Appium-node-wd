"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.removeInstrumentsSocket = removeInstrumentsSocket;
exports.getAndCheckXcodeVersion = getAndCheckXcodeVersion;
exports.prepareIosOpts = prepareIosOpts;
exports.appIsPackageOrBundle = appIsPackageOrBundle;
exports.getAndCheckIosSdkVersion = getAndCheckIosSdkVersion;
exports.detectUdid = detectUdid;
exports.parseLocalizableStrings = parseLocalizableStrings;
exports.setBundleIdFromApp = setBundleIdFromApp;
exports.shouldPrelaunchSimulator = shouldPrelaunchSimulator;
exports.setDeviceTypeInInfoPlist = setDeviceTypeInInfoPlist;
exports.getSimForDeviceString = getSimForDeviceString;
exports.unwrapEl = unwrapEl;
exports.clearLogs = clearLogs;
exports.rootDir = void 0;

require("source-map-support/register");

var _appiumSupport = require("appium-support");

var _appiumXcode = _interopRequireDefault(require("appium-xcode"));

var _appUtils = require("./app-utils");

var _logger = _interopRequireDefault(require("./logger"));

var _path = _interopRequireDefault(require("path"));

var _lodash = _interopRequireDefault(require("lodash"));

var _teen_process = require("teen_process");

var _safari = require("./commands/safari");

var _safariLauncher = require("./safari-launcher");

const rootDir = _path.default.resolve(__dirname, '..', '..');

exports.rootDir = rootDir;
const STRINGSDICT_RESOURCE = '.stringsdict';
const STRINGS_RESOURCE = '.strings';

async function prepareIosOpts(opts) {
  opts.backendRetries = 4;
  opts.withoutDelay = !opts.nativeInstrumentsLib;
  opts.reset = !opts.noReset;
  opts.initialOrientation = opts.deviceOrientation || opts.orientation || 'PORTRAIT';
  opts.useRobot = opts.robotPort > 0;
  opts.robotUrl = opts.useRobot ? `http://${opts.robotAddress}:${opts.robotPort}` : null;

  if (opts.locationServicesAuthorized && !opts.bundleId) {
    throw new Error('You must set the bundleId cap if using locationServicesEnabled');
  }

  opts.platformVersion = opts.platformVersion || (await _appiumXcode.default.getMaxIOSSDK());
  let pv = parseFloat(opts.platformVersion);

  if (pv < 8) {
    _logger.default.warn(`iOS version ${opts.platformVersion} support has been ` + `deprecated and will be removed in a future version of ` + `Appium.`);
  }

  opts.localizableStringsDir = opts.localizableStringsDir || 'en.lproj';
  opts.autoAcceptAlerts = _lodash.default.isNull(opts.autoAcceptAlerts) || _lodash.default.isUndefined(opts.autoAcceptAlerts) ? false : opts.autoAcceptAlerts;
  opts.autoDismissAlerts = _lodash.default.isNull(opts.autoDismissAlerts) || _lodash.default.isUndefined(opts.autoDismissAlerts) ? false : opts.autoDismissAlerts;

  if ((opts.browserName || '').toLowerCase() === 'safari' || (opts.app || '').toLowerCase() === 'safari' || (opts.bundleId || '').toLowerCase() === _safari.SAFARI_BUNDLE) {
    if (opts.udid) {
      opts.app = opts.app || _safariLauncher.SAFARI_LAUNCHER_APP_FILE;
      opts.bundleId = opts.bundleId || _safariLauncher.SAFARI_LAUNCHER_BUNDLE;
    } else {
      if (parseFloat(opts.platformVersion) <= 8) {
        opts.app = 'safari';
        opts.bundleId = null;
      } else {
        opts.app = null;
        opts.bundleId = _safari.SAFARI_BUNDLE;
      }
    }

    opts.safari = true;
  }
}

function appIsPackageOrBundle(app) {
  return /^([a-zA-Z0-9\-_]+\.[a-zA-Z0-9\-_]+)+$/.test(app);
}

async function removeInstrumentsSocket(sock) {
  _logger.default.debug('Removing any remaining instruments sockets');

  await _appiumSupport.fs.rimraf(sock);

  _logger.default.debug(`Cleaned up instruments socket ${sock}`);
}

async function getAndCheckXcodeVersion(caps) {
  let version;

  try {
    version = await _appiumXcode.default.getVersion(true);
  } catch (err) {
    _logger.default.debug(err);

    _logger.default.error(`Could not determine Xcode version: ${err.message}`);

    throw err;
  }

  let minorVersion = version.versionFloat;
  let pv = parseFloat(caps.platformVersion);

  if (minorVersion < 6.3 && !(minorVersion === 6.0 && pv === 8.0)) {
    _logger.default.warn(`Xcode version '${version.versionString}'. Support for Xcode ` + `${version.versionString} has been deprecated and will be removed ` + `in a future version. Please upgrade to version 6.3 or ` + `higher (or version 6.0.1 for iOS 8.0)`);
  }

  return version;
}

async function getAndCheckIosSdkVersion() {
  let versionNumber;

  try {
    versionNumber = await _appiumXcode.default.getMaxIOSSDK();
  } catch (err) {
    _logger.default.error('Could not determine iOS SDK version');

    throw err;
  }

  return versionNumber;
}

function getSimForDeviceString(dString, availDevices) {
  let matchedDevice = null;
  let matchedUdid = null;

  _lodash.default.each(availDevices, function matchDevice(device) {
    if (device.indexOf(dString) !== -1) {
      matchedDevice = device;

      try {
        matchedUdid = /.+\[([^\]]+)\]/.exec(device)[1];
      } catch (e) {
        matchedUdid = null;
      }
    }
  });

  return [matchedDevice, matchedUdid];
}

async function detectUdid(caps) {
  if (caps.udid !== null && caps.udid === 'auto') {
    _logger.default.debug('Auto-detecting iOS udid...');

    let cmd,
        args = [];

    try {
      cmd = await _appiumSupport.fs.which('idevice_id');
      args.push('-l');
    } catch (err) {
      cmd = require.resolve('udidetect');
    }

    let udid;

    try {
      let {
        stdout
      } = await (0, _teen_process.exec)(cmd, args, {
        timeout: 3000
      });
      udid = stdout.split('\n')[0];
    } catch (err) {
      _logger.default.error('Error detecting udid');

      throw err;
    }

    if (udid && udid.length > 2) {
      caps.udid = udid;

      _logger.default.debug(`Detected udid as '${caps.udid}'`);
    } else {
      throw new Error('Could not detect udid.');
    }
  } else {
    _logger.default.debug('Not auto-detecting udid.');
  }
}

async function readResource(resourcePath) {
  const data = await _appiumSupport.plist.parsePlistFile(resourcePath);
  const result = {};

  for (const [key, value] of _lodash.default.toPairs(data)) {
    result[key] = _lodash.default.isString(value) ? value : JSON.stringify(value);
  }

  return result;
}

async function parseLocalizableStrings(opts) {
  const {
    app,
    language = 'en',
    localizableStringsDir,
    stringFile,
    strictMode
  } = opts;

  if (!app) {
    const message = "Strings extraction is not supported if 'app' capability is not set";

    if (strictMode) {
      throw new Error(message);
    }

    _logger.default.info(message);

    return {};
  }

  let lprojRoot;

  for (const subfolder of [`${language}.lproj`, localizableStringsDir, '']) {
    lprojRoot = _path.default.resolve(app, subfolder);

    if (await _appiumSupport.fs.exists(lprojRoot)) {
      break;
    }

    const message = `No '${lprojRoot}' resources folder has been found`;

    if (strictMode) {
      throw new Error(message);
    }

    _logger.default.debug(message);
  }

  _logger.default.info(`Will extract resource strings from '${lprojRoot}'`);

  const resourcePaths = [];

  if (stringFile) {
    const dstPath = _path.default.resolve(lprojRoot, stringFile);

    if (await _appiumSupport.fs.exists(dstPath)) {
      resourcePaths.push(dstPath);
    } else {
      const message = `No '${dstPath}' resource file has been found for '${app}'`;

      if (strictMode) {
        throw new Error(message);
      }

      _logger.default.info(message);

      _logger.default.info(`Getting all the available strings from '${lprojRoot}'`);
    }
  }

  if (_lodash.default.isEmpty(resourcePaths) && (await _appiumSupport.fs.exists(lprojRoot))) {
    const resourceFiles = (await _appiumSupport.fs.readdir(lprojRoot)).filter(name => _lodash.default.some([STRINGS_RESOURCE, STRINGSDICT_RESOURCE], x => name.endsWith(x))).map(name => _path.default.resolve(lprojRoot, name));
    resourcePaths.push(...resourceFiles);
  }

  _logger.default.info(`Got ${resourcePaths.length} resource file(s) in '${lprojRoot}'`);

  if (_lodash.default.isEmpty(resourcePaths)) {
    return {};
  }

  const resultStrings = {};

  const toAbsolutePath = function (p) {
    return _path.default.isAbsolute(p) ? p : _path.default.resolve(process.cwd(), p);
  };

  for (const resourcePath of resourcePaths) {
    if (!_appiumSupport.util.isSubPath(toAbsolutePath(resourcePath), toAbsolutePath(app))) {
      throw new Error(`'${resourcePath}' is expected to be located under '${app}'`);
    }

    try {
      const data = await readResource(resourcePath);

      _logger.default.debug(`Parsed ${_lodash.default.keys(data).length} string(s) from '${resourcePath}'`);

      _lodash.default.merge(resultStrings, data);
    } catch (e) {
      _logger.default.warn(`Cannot parse '${resourcePath}' resource. Original error: ${e.message}`);
    }
  }

  _logger.default.info(`Got ${_lodash.default.keys(resultStrings).length} string(s) from '${lprojRoot}'`);

  return resultStrings;
}

async function setBundleIdFromApp(caps) {
  if (!caps.bundleId) {
    try {
      caps.bundleId = await (0, _appUtils.extractBundleId)(caps.app);

      _logger.default.info(`Extracted bundleID: ${caps.bundleId} from app: ${caps.app}`);
    } catch (err) {
      _logger.default.error('Could not set the bundleId from app.');

      throw err;
    }
  }
}

function shouldPrelaunchSimulator(caps, iosSdkVersion) {
  let shouldPrelaunch = false;

  if (caps.defaultDevice || iosSdkVersion >= 7.1) {
    if (this.iosSdkVersion >= 7.1) {
      _logger.default.debug("We're on iOS7.1+ so forcing defaultDevice on");
    } else {
      _logger.default.debug('User specified default device, letting instruments launch it');
    }
  } else {
    shouldPrelaunch = true;
  }

  return shouldPrelaunch;
}

async function setDeviceTypeInInfoPlist(app, deviceString) {
  if (_lodash.default.isNull(app) || _lodash.default.isUndefined(app)) {
    return;
  }

  let plistFile = _path.default.resolve(app, 'Info.plist');

  let isiPhone = deviceString.toLowerCase().indexOf('ipad') === -1;
  let deviceTypeCode = isiPhone ? 1 : 2;
  await _appiumSupport.plist.updatePlistFile(plistFile, {
    UIDeviceFamily: [deviceTypeCode]
  });
}

function unwrapEl(el) {
  if (typeof el === 'object' && el.ELEMENT) {
    return el.ELEMENT;
  }

  return el;
}

async function clearLogs(locations) {
  _logger.default.debug('Clearing log files');

  for (let location of locations) {
    if (await _appiumSupport.fs.exists(location)) {
      let size;

      try {
        let {
          stdout
        } = await (0, _teen_process.exec)('du', ['-sh', location]);
        size = stdout.trim().split(/\s+/)[0];
      } catch (ign) {}

      try {
        _logger.default.debug(`Deleting '${location}'. ${size ? `Freeing ${size}.` : ''}`);

        await _appiumSupport.fs.rimraf(location);
      } catch (err) {
        _logger.default.warn(`Unable to delete '${location}': ${err.message}`);
      }
    }
  }

  _logger.default.debug('Finished clearing log files');
}require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi91dGlscy5qcyJdLCJuYW1lcyI6WyJyb290RGlyIiwicGF0aCIsInJlc29sdmUiLCJfX2Rpcm5hbWUiLCJTVFJJTkdTRElDVF9SRVNPVVJDRSIsIlNUUklOR1NfUkVTT1VSQ0UiLCJwcmVwYXJlSW9zT3B0cyIsIm9wdHMiLCJiYWNrZW5kUmV0cmllcyIsIndpdGhvdXREZWxheSIsIm5hdGl2ZUluc3RydW1lbnRzTGliIiwicmVzZXQiLCJub1Jlc2V0IiwiaW5pdGlhbE9yaWVudGF0aW9uIiwiZGV2aWNlT3JpZW50YXRpb24iLCJvcmllbnRhdGlvbiIsInVzZVJvYm90Iiwicm9ib3RQb3J0Iiwicm9ib3RVcmwiLCJyb2JvdEFkZHJlc3MiLCJsb2NhdGlvblNlcnZpY2VzQXV0aG9yaXplZCIsImJ1bmRsZUlkIiwiRXJyb3IiLCJwbGF0Zm9ybVZlcnNpb24iLCJ4Y29kZSIsImdldE1heElPU1NESyIsInB2IiwicGFyc2VGbG9hdCIsImxvZ2dlciIsIndhcm4iLCJsb2NhbGl6YWJsZVN0cmluZ3NEaXIiLCJhdXRvQWNjZXB0QWxlcnRzIiwiXyIsImlzTnVsbCIsImlzVW5kZWZpbmVkIiwiYXV0b0Rpc21pc3NBbGVydHMiLCJicm93c2VyTmFtZSIsInRvTG93ZXJDYXNlIiwiYXBwIiwiU0FGQVJJX0JVTkRMRSIsInVkaWQiLCJTQUZBUklfTEFVTkNIRVJfQVBQX0ZJTEUiLCJTQUZBUklfTEFVTkNIRVJfQlVORExFIiwic2FmYXJpIiwiYXBwSXNQYWNrYWdlT3JCdW5kbGUiLCJ0ZXN0IiwicmVtb3ZlSW5zdHJ1bWVudHNTb2NrZXQiLCJzb2NrIiwiZGVidWciLCJmcyIsInJpbXJhZiIsImdldEFuZENoZWNrWGNvZGVWZXJzaW9uIiwiY2FwcyIsInZlcnNpb24iLCJnZXRWZXJzaW9uIiwiZXJyIiwiZXJyb3IiLCJtZXNzYWdlIiwibWlub3JWZXJzaW9uIiwidmVyc2lvbkZsb2F0IiwidmVyc2lvblN0cmluZyIsImdldEFuZENoZWNrSW9zU2RrVmVyc2lvbiIsInZlcnNpb25OdW1iZXIiLCJnZXRTaW1Gb3JEZXZpY2VTdHJpbmciLCJkU3RyaW5nIiwiYXZhaWxEZXZpY2VzIiwibWF0Y2hlZERldmljZSIsIm1hdGNoZWRVZGlkIiwiZWFjaCIsIm1hdGNoRGV2aWNlIiwiZGV2aWNlIiwiaW5kZXhPZiIsImV4ZWMiLCJlIiwiZGV0ZWN0VWRpZCIsImNtZCIsImFyZ3MiLCJ3aGljaCIsInB1c2giLCJyZXF1aXJlIiwic3Rkb3V0IiwidGltZW91dCIsInNwbGl0IiwibGVuZ3RoIiwicmVhZFJlc291cmNlIiwicmVzb3VyY2VQYXRoIiwiZGF0YSIsInBsaXN0IiwicGFyc2VQbGlzdEZpbGUiLCJyZXN1bHQiLCJrZXkiLCJ2YWx1ZSIsInRvUGFpcnMiLCJpc1N0cmluZyIsIkpTT04iLCJzdHJpbmdpZnkiLCJwYXJzZUxvY2FsaXphYmxlU3RyaW5ncyIsImxhbmd1YWdlIiwic3RyaW5nRmlsZSIsInN0cmljdE1vZGUiLCJpbmZvIiwibHByb2pSb290Iiwic3ViZm9sZGVyIiwiZXhpc3RzIiwicmVzb3VyY2VQYXRocyIsImRzdFBhdGgiLCJpc0VtcHR5IiwicmVzb3VyY2VGaWxlcyIsInJlYWRkaXIiLCJmaWx0ZXIiLCJuYW1lIiwic29tZSIsIngiLCJlbmRzV2l0aCIsIm1hcCIsInJlc3VsdFN0cmluZ3MiLCJ0b0Fic29sdXRlUGF0aCIsInAiLCJpc0Fic29sdXRlIiwicHJvY2VzcyIsImN3ZCIsInV0aWwiLCJpc1N1YlBhdGgiLCJrZXlzIiwibWVyZ2UiLCJzZXRCdW5kbGVJZEZyb21BcHAiLCJzaG91bGRQcmVsYXVuY2hTaW11bGF0b3IiLCJpb3NTZGtWZXJzaW9uIiwic2hvdWxkUHJlbGF1bmNoIiwiZGVmYXVsdERldmljZSIsInNldERldmljZVR5cGVJbkluZm9QbGlzdCIsImRldmljZVN0cmluZyIsInBsaXN0RmlsZSIsImlzaVBob25lIiwiZGV2aWNlVHlwZUNvZGUiLCJ1cGRhdGVQbGlzdEZpbGUiLCJVSURldmljZUZhbWlseSIsInVud3JhcEVsIiwiZWwiLCJF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QUFJLE1BQU01RixrQkFBR3NELE1BQUgsQ0FBVXVDLFFBQVYsQ0FBVixFQUErQjtBQUM3QixVQUFJQyxJQUFKOztBQUNBLFVBQUk7QUFDRixZQUFJO0FBQUMvRCxVQUFBQTtBQUFELFlBQVcsTUFBTSx3QkFBSyxJQUFMLEVBQVcsQ0FBQyxLQUFELEVBQVE4RCxRQUFSLENBQVgsQ0FBckI7QUFDQUMsUUFBQUEsSUFBSSxHQUFHL0QsTUFBTSxDQUFDZ0UsSUFBUCxHQUFjOUQsS0FBZCxDQUFvQixLQUFwQixFQUEyQixDQUEzQixDQUFQO0FBQ0QsT0FIRCxDQUdFLE9BQU8rRCxHQUFQLEVBQVksQ0FBRTs7QUFDaEIsVUFBSTtBQUNGckgsd0JBQU9vQixLQUFQLENBQWMsYUFBWThGLFFBQVMsTUFBS0MsSUFBSSxHQUFJLFdBQVVBLElBQUssR0FBbkIsR0FBd0IsRUFBRyxFQUF2RTs7QUFDQSxjQUFNOUYsa0JBQUdDLE1BQUgsQ0FBVTRGLFFBQVYsQ0FBTjtBQUNELE9BSEQsQ0FHRSxPQUFPdkYsR0FBUCxFQUFZO0FBQ1ozQix3QkFBT0MsSUFBUCxDQUFhLHFCQUFvQmlILFFBQVMsTUFBS3ZGLEdBQUcsQ0FBQ0UsT0FBUSxFQUEzRDtBQUNEO0FBQ0Y7QUFDRjs7QUFDRDdCLGtCQUFPb0IsS0FBUCxDQUFhLDZCQUFiO0FBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBmcywgcGxpc3QsIHV0aWwgfSBmcm9tICdhcHBpdW0tc3VwcG9ydCc7XG5pbXBvcnQgeGNvZGUgZnJvbSAnYXBwaXVtLXhjb2RlJztcbmltcG9ydCB7IGV4dHJhY3RCdW5kbGVJZCB9IGZyb20gJy4vYXBwLXV0aWxzJztcbmltcG9ydCBsb2dnZXIgZnJvbSAnLi9sb2dnZXInO1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHsgZXhlYyB9IGZyb20gJ3RlZW5fcHJvY2Vzcyc7XG5pbXBvcnQgeyBTQUZBUklfQlVORExFIH0gZnJvbSAnLi9jb21tYW5kcy9zYWZhcmknO1xuaW1wb3J0IHsgU0FGQVJJX0xBVU5DSEVSX0FQUF9GSUxFLCBTQUZBUklfTEFVTkNIRVJfQlVORExFIH0gZnJvbSAnLi9zYWZhcmktbGF1bmNoZXInO1xuXG5cbmNvbnN0IHJvb3REaXIgPSBwYXRoLnJlc29sdmUoX19kaXJuYW1lLCAnLi4nLCAnLi4nKTtcbmNvbnN0IFNUUklOR1NESUNUX1JFU09VUkNFID0gJy5zdHJpbmdzZGljdCc7XG5jb25zdCBTVFJJTkdTX1JFU09VUkNFID0gJy5zdHJpbmdzJztcblxuYXN5bmMgZnVuY3Rpb24gcHJlcGFyZUlvc09wdHMgKG9wdHMpIHtcbiAgb3B0cy5iYWNrZW5kUmV0cmllcyA9IDQ7XG4gIG9wdHMud2l0aG91dERlbGF5ID0gIW9wdHMubmF0aXZlSW5zdHJ1bWVudHNMaWI7XG4gIG9wdHMucmVzZXQgPSAhb3B0cy5ub1Jlc2V0O1xuICBvcHRzLmluaXRpYWxPcmllbnRhdGlvbiA9IG9wdHMuZGV2aWNlT3JpZW50YXRpb24gfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRzLm9yaWVudGF0aW9uIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1BPUlRSQUlUJztcbiAgb3B0cy51c2VSb2JvdCA9IG9wdHMucm9ib3RQb3J0ID4gMDtcbiAgb3B0cy5yb2JvdFVybCA9IG9wdHMudXNlUm9ib3QgP1xuICAgIGBodHRwOi8vJHtvcHRzLnJvYm90QWRkcmVzc306JHtvcHRzLnJvYm90UG9ydH1gIDogbnVsbDtcbiAgaWYgKG9wdHMubG9jYXRpb25TZXJ2aWNlc0F1dGhvcml6ZWQgJiYgIW9wdHMuYnVuZGxlSWQpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ1lvdSBtdXN0IHNldCB0aGUgYnVuZGxlSWQgY2FwIGlmIHVzaW5nIGxvY2F0aW9uU2VydmljZXNFbmFibGVkJyk7XG4gIH1cblxuICBvcHRzLnBsYXRmb3JtVmVyc2lvbiA9IG9wdHMucGxhdGZvcm1WZXJzaW9uIHx8IGF3YWl0IHhjb2RlLmdldE1heElPU1NESygpO1xuICBsZXQgcHYgPSBwYXJzZUZsb2F0KG9wdHMucGxhdGZvcm1WZXJzaW9uKTtcbiAgaWYgKHB2IDwgOCkge1xuICAgIGxvZ2dlci53YXJuKGBpT1MgdmVyc2lvbiAke29wdHMucGxhdGZvcm1WZXJzaW9ufSBzdXBwb3J0IGhhcyBiZWVuIGAgK1xuICAgICAgICAgICAgICAgIGBkZXByZWNhdGVkIGFuZCB3aWxsIGJlIHJlbW92ZWQgaW4gYSBmdXR1cmUgdmVyc2lvbiBvZiBgICtcbiAgICAgICAgICAgICAgICBgQXBwaXVtLmApO1xuICB9XG4gIG9wdHMubG9jYWxpemFibGVTdHJpbmdzRGlyID0gb3B0cy5sb2NhbGl6YWJsZVN0cmluZ3NEaXIgfHwgJ2VuLmxwcm9qJztcbiAgb3B0cy5hdXRvQWNjZXB0QWxlcnRzID0gXy5pc051bGwob3B0cy5hdXRvQWNjZXB0QWxlcnRzKSB8fCBfLmlzVW5kZWZpbmVkKG9wdHMuYXV0b0FjY2VwdEFsZXJ0cykgPyBmYWxzZSA6IG9wdHMuYXV0b0FjY2VwdEFsZXJ0cztcbiAgb3B0cy5hdXRvRGlzbWlzc0FsZXJ0cyA9IF8uaXNOdWxsKG9wdHMuYXV0b0Rpc21pc3NBbGVydHMpIHx8IF8uaXNVbmRlZmluZWQob3B0cy5hdXRvRGlzbWlzc0FsZXJ0cykgPyBmYWxzZSA6IG9wdHMuYXV0b0Rpc21pc3NBbGVydHM7XG5cbiAgaWYgKChvcHRzLmJyb3dzZXJOYW1lIHx8ICcnKS50b0xvd2VyQ2FzZSgpID09PSAnc2FmYXJpJyB8fFxuICAgICAgKG9wdHMuYXBwIHx8ICcnKS50b0xvd2VyQ2FzZSgpID09PSAnc2FmYXJpJyB8fFxuICAgICAgKG9wdHMuYnVuZGxlSWQgfHwgJycpLnRvTG93ZXJDYXNlKCkgPT09IFNBRkFSSV9CVU5ETEUpIHtcbiAgICAvLyBwcmVwYXJpbmcgYSBzYWZhcmkgc2Vzc2lvblxuICAgIGlmIChvcHRzLnVkaWQpIHtcbiAgICAgIC8vIG9uIGEgcmVhbCBkZXZpY2VcbiAgICAgIG9wdHMuYXBwID0gb3B0cy5hcHAgfHwgU0FGQVJJX0xBVU5DSEVSX0FQUF9GSUxFO1xuICAgICAgb3B0cy5idW5kbGVJZCA9IG9wdHMuYnVuZGxlSWQgfHwgU0FGQVJJX0xBVU5DSEVSX0JVTkRMRTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKHBhcnNlRmxvYXQob3B0cy5wbGF0Zm9ybVZlcnNpb24pIDw9IDgpIHtcbiAgICAgICAgLy8gbWFrZSBzdXJlIGFyZ3MuYXBwIGhhcyBzb21ldGhpbmcgaW4gaXQgc28gd2UgZ2V0IHRvIHRoZSByaWdodCBzcG90c1xuICAgICAgICAvLyBpbiBtb3ZlQnVpbHRJbkFwcCgpXG4gICAgICAgIG9wdHMuYXBwID0gJ3NhZmFyaSc7XG4gICAgICAgIG9wdHMuYnVuZGxlSWQgPSBudWxsO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgb3B0cy5hcHAgPSBudWxsO1xuICAgICAgICBvcHRzLmJ1bmRsZUlkID0gU0FGQVJJX0JVTkRMRTtcbiAgICAgIH1cbiAgICB9XG4gICAgb3B0cy5zYWZhcmkgPSB0cnVlO1xuICB9XG59XG5cbmZ1bmN0aW9uIGFwcElzUGFja2FnZU9yQnVuZGxlIChhcHApIHtcbiAgcmV0dXJuICgvXihbYS16QS1aMC05XFwtX10rXFwuW2EtekEtWjAtOVxcLV9dKykrJC8pLnRlc3QoYXBwKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gcmVtb3ZlSW5zdHJ1bWVudHNTb2NrZXQgKHNvY2spIHtcbiAgbG9nZ2VyLmRlYnVnKCdSZW1vdmluZyBhbnkgcmVtYWluaW5nIGluc3RydW1lbnRzIHNvY2tldHMnKTtcbiAgYXdhaXQgZnMucmltcmFmKHNvY2spO1xuICBsb2dnZXIuZGVidWcoYENsZWFuZWQgdXAgaW5zdHJ1bWVudHMgc29ja2V0ICR7c29ja31gKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2V0QW5kQ2hlY2tYY29kZVZlcnNpb24gKGNhcHMpIHtcbiAgbGV0IHZlcnNpb247XG4gIHRyeSB7XG4gICAgdmVyc2lvbiA9IGF3YWl0IHhjb2RlLmdldFZlcnNpb24odHJ1ZSk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGxvZ2dlci5kZWJ1ZyhlcnIpO1xuICAgIGxvZ2dlci5lcnJvcihgQ291bGQgbm90IGRldGVybWluZSBYY29kZSB2ZXJzaW9uOiAke2Vyci5tZXNzYWdlfWApO1xuICAgIHRocm93IGVycjtcbiAgfVxuICBsZXQgbWlub3JWZXJzaW9uID0gdmVyc2lvbi52ZXJzaW9uRmxvYXQ7XG4gIGxldCBwdiA9IHBhcnNlRmxvYXQoY2Fwcy5wbGF0Zm9ybVZlcnNpb24pO1xuICAvLyB3ZSBkZXByZWNhdGUgWGNvZGVzIDwgNi4zLCBleGNlcHQgZm9yIGlPUyA4LjAgaW4gd2hpY2ggY2FzZSB3ZVxuICAvLyBzdXBwb3J0IFhjb2RlIDYuMCBhcyB3ZWxsXG4gIGlmIChtaW5vclZlcnNpb24gPCA2LjMgJiYgKCEobWlub3JWZXJzaW9uID09PSA2LjAgJiYgcHYgPT09IDguMCkpKSB7XG4gICAgbG9nZ2VyLndhcm4oYFhjb2RlIHZlcnNpb24gJyR7dmVyc2lvbi52ZXJzaW9uU3RyaW5nfScuIFN1cHBvcnQgZm9yIFhjb2RlIGAgK1xuICAgICAgICAgICAgICAgIGAke3ZlcnNpb24udmVyc2lvblN0cmluZ30gaGFzIGJlZW4gZGVwcmVjYXRlZCBhbmQgd2lsbCBiZSByZW1vdmVkIGAgK1xuICAgICAgICAgICAgICAgIGBpbiBhIGZ1dHVyZSB2ZXJzaW9uLiBQbGVhc2UgdXBncmFkZSB0byB2ZXJzaW9uIDYuMyBvciBgICtcbiAgICAgICAgICAgICAgICBgaGlnaGVyIChvciB2ZXJzaW9uIDYuMC4xIGZvciBpT1MgOC4wKWApO1xuICB9XG4gIHJldHVybiB2ZXJzaW9uO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRBbmRDaGVja0lvc1Nka1ZlcnNpb24gKCkge1xuICBsZXQgdmVyc2lvbk51bWJlcjtcbiAgdHJ5IHtcbiAgICB2ZXJzaW9uTnVtYmVyID0gYXdhaXQgeGNvZGUuZ2V0TWF4SU9TU0RLKCk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGxvZ2dlci5lcnJvcignQ291bGQgbm90IGRldGVybWluZSBpT1MgU0RLIHZlcnNpb24nKTtcbiAgICB0aHJvdyBlcnI7XG4gIH1cbiAgcmV0dXJuIHZlcnNpb25OdW1iZXI7XG59XG5cbmZ1bmN0aW9uIGdldFNpbUZvckRldmljZVN0cmluZyAoZFN0cmluZywgYXZhaWxEZXZpY2VzKSB7XG4gIGxldCBtYXRjaGVkRGV2aWNlID0gbnVsbDtcbiAgbGV0IG1hdGNoZWRVZGlkID0gbnVsbDtcbiAgXy5lYWNoKGF2YWlsRGV2aWNlcywgZnVuY3Rpb24gbWF0Y2hEZXZpY2UgKGRldmljZSkge1xuICAgIGlmIChkZXZpY2UuaW5kZXhPZihkU3RyaW5nKSAhPT0gLTEpIHtcbiAgICAgIG1hdGNoZWREZXZpY2UgPSBkZXZpY2U7XG4gICAgICB0cnkge1xuICAgICAgICBtYXRjaGVkVWRpZCA9IC8uK1xcWyhbXlxcXV0rKVxcXS8uZXhlYyhkZXZpY2UpWzFdO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICBtYXRjaGVkVWRpZCA9IG51bGw7XG4gICAgICB9XG4gICAgfVxuICB9KTtcbiAgcmV0dXJuIFttYXRjaGVkRGV2aWNlLCBtYXRjaGVkVWRpZF07XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGRldGVjdFVkaWQgKGNhcHMpIHtcbiAgaWYgKGNhcHMudWRpZCAhPT0gbnVsbCAmJiBjYXBzLnVkaWQgPT09ICdhdXRvJykge1xuICAgIGxvZ2dlci5kZWJ1ZygnQXV0by1kZXRlY3RpbmcgaU9TIHVkaWQuLi4nKTtcbiAgICBsZXQgY21kLCBhcmdzID0gW107XG4gICAgdHJ5IHtcbiAgICAgIGNtZCA9IGF3YWl0IGZzLndoaWNoKCdpZGV2aWNlX2lkJyk7XG4gICAgICBhcmdzLnB1c2goJy1sJyk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBjbWQgPSByZXF1aXJlLnJlc29sdmUoJ3VkaWRldGVjdCcpO1xuICAgIH1cbiAgICBsZXQgdWRpZDtcbiAgICB0cnkge1xuICAgICAgbGV0IHtzdGRvdXR9ID0gYXdhaXQgZXhlYyhjbWQsIGFyZ3MsIHt0aW1lb3V0OiAzMDAwfSk7XG4gICAgICB1ZGlkID0gc3Rkb3V0LnNwbGl0KCdcXG4nKVswXTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignRXJyb3IgZGV0ZWN0aW5nIHVkaWQnKTtcbiAgICAgIHRocm93IGVycjtcbiAgICB9XG4gICAgaWYgKHVkaWQgJiYgdWRpZC5sZW5ndGggPiAyKSB7XG4gICAgICBjYXBzLnVkaWQgPSB1ZGlkO1xuICAgICAgbG9nZ2VyLmRlYnVnKGBEZXRlY3RlZCB1ZGlkIGFzICcke2NhcHMudWRpZH0nYCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignQ291bGQgbm90IGRldGVjdCB1ZGlkLicpO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBsb2dnZXIuZGVidWcoJ05vdCBhdXRvLWRldGVjdGluZyB1ZGlkLicpO1xuICB9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHJlYWRSZXNvdXJjZSAocmVzb3VyY2VQYXRoKSB7XG4gIGNvbnN0IGRhdGEgPSBhd2FpdCBwbGlzdC5wYXJzZVBsaXN0RmlsZShyZXNvdXJjZVBhdGgpO1xuICBjb25zdCByZXN1bHQgPSB7fTtcbiAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgXy50b1BhaXJzKGRhdGEpKSB7XG4gICAgcmVzdWx0W2tleV0gPSBfLmlzU3RyaW5nKHZhbHVlKSA/IHZhbHVlIDogSlNPTi5zdHJpbmdpZnkodmFsdWUpO1xuICB9XG4gIHJldHVybiByZXN1bHQ7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHBhcnNlTG9jYWxpemFibGVTdHJpbmdzIChvcHRzKSB7XG4gIGNvbnN0IHtcbiAgICBhcHAsXG4gICAgbGFuZ3VhZ2UgPSAnZW4nLFxuICAgIGxvY2FsaXphYmxlU3RyaW5nc0RpcixcbiAgICBzdHJpbmdGaWxlLFxuICAgIHN0cmljdE1vZGUsXG4gIH0gPSBvcHRzO1xuXG4gIGlmICghYXBwKSB7XG4gICAgY29uc3QgbWVzc2FnZSA9IFwiU3RyaW5ncyBleHRyYWN0aW9uIGlzIG5vdCBzdXBwb3J0ZWQgaWYgJ2FwcCcgY2FwYWJpbGl0eSBpcyBub3Qgc2V0XCI7XG4gICAgaWYgKHN0cmljdE1vZGUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihtZXNzYWdlKTtcbiAgICB9XG4gICAgbG9nZ2VyLmluZm8obWVzc2FnZSk7XG4gICAgcmV0dXJuIHt9O1xuICB9XG5cbiAgbGV0IGxwcm9qUm9vdDtcbiAgZm9yIChjb25zdCBzdWJmb2xkZXIgb2YgW2Ake2xhbmd1YWdlfS5scHJvamAsIGxvY2FsaXphYmxlU3RyaW5nc0RpciwgJyddKSB7XG4gICAgbHByb2pSb290ID0gcGF0aC5yZXNvbHZlKGFwcCwgc3ViZm9sZGVyKTtcbiAgICBpZiAoYXdhaXQgZnMuZXhpc3RzKGxwcm9qUm9vdCkpIHtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgICBjb25zdCBtZXNzYWdlID0gYE5vICcke2xwcm9qUm9vdH0nIHJlc291cmNlcyBmb2xkZXIgaGFzIGJlZW4gZm91bmRgO1xuICAgIGlmIChzdHJpY3RNb2RlKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IobWVzc2FnZSk7XG4gICAgfVxuICAgIGxvZ2dlci5kZWJ1ZyhtZXNzYWdlKTtcbiAgfVxuICBsb2dnZXIuaW5mbyhgV2lsbCBleHRyYWN0IHJlc291cmNlIHN0cmluZ3MgZnJvbSAnJHtscHJvalJvb3R9J2ApO1xuXG4gIGNvbnN0IHJlc291cmNlUGF0aHMgPSBbXTtcbiAgaWYgKHN0cmluZ0ZpbGUpIHtcbiAgICBjb25zdCBkc3RQYXRoID0gcGF0aC5yZXNvbHZlKGxwcm9qUm9vdCwgc3RyaW5nRmlsZSk7XG4gICAgaWYgKGF3YWl0IGZzLmV4aXN0cyhkc3RQYXRoKSkge1xuICAgICAgcmVzb3VyY2VQYXRocy5wdXNoKGRzdFBhdGgpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBtZXNzYWdlID0gYE5vICcke2RzdFBhdGh9JyByZXNvdXJjZSBmaWxlIGhhcyBiZWVuIGZvdW5kIGZvciAnJHthcHB9J2A7XG4gICAgICBpZiAoc3RyaWN0TW9kZSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IobWVzc2FnZSk7XG4gICAgICB9XG4gICAgICBsb2dnZXIuaW5mbyhtZXNzYWdlKTtcbiAgICAgIGxvZ2dlci5pbmZvKGBHZXR0aW5nIGFsbCB0aGUgYXZhaWxhYmxlIHN0cmluZ3MgZnJvbSAnJHtscHJvalJvb3R9J2ApO1xuICAgIH1cbiAgfVxuXG4gIGlmIChfLmlzRW1wdHkocmVzb3VyY2VQYXRocykgJiYgYXdhaXQgZnMuZXhpc3RzKGxwcm9qUm9vdCkpIHtcbiAgICBjb25zdCByZXNvdXJjZUZpbGVzID0gKGF3YWl0IGZzLnJlYWRkaXIobHByb2pSb290KSlcbiAgICAgIC5maWx0ZXIoKG5hbWUpID0+IF8uc29tZShbU1RSSU5HU19SRVNPVVJDRSwgU1RSSU5HU0RJQ1RfUkVTT1VSQ0VdLCAoeCkgPT4gbmFtZS5lbmRzV2l0aCh4KSkpXG4gICAgICAubWFwKChuYW1lKSA9PiBwYXRoLnJlc29sdmUobHByb2pSb290LCBuYW1lKSk7XG4gICAgcmVzb3VyY2VQYXRocy5wdXNoKC4uLnJlc291cmNlRmlsZXMpO1xuICB9XG4gIGxvZ2dlci5pbmZvKGBHb3QgJHtyZXNvdXJjZVBhdGhzLmxlbmd0aH0gcmVzb3VyY2UgZmlsZShzKSBpbiAnJHtscHJvalJvb3R9J2ApO1xuXG4gIGlmIChfLmlzRW1wdHkocmVzb3VyY2VQYXRocykpIHtcbiAgICByZXR1cm4ge307XG4gIH1cblxuICBjb25zdCByZXN1bHRTdHJpbmdzID0ge307XG4gIGNvbnN0IHRvQWJzb2x1dGVQYXRoID0gZnVuY3Rpb24gKHApIHtcbiAgICByZXR1cm4gcGF0aC5pc0Fic29sdXRlKHApID8gcCA6IHBhdGgucmVzb2x2ZShwcm9jZXNzLmN3ZCgpLCBwKTtcbiAgfTtcbiAgZm9yIChjb25zdCByZXNvdXJjZVBhdGggb2YgcmVzb3VyY2VQYXRocykge1xuICAgIGlmICghdXRpbC5pc1N1YlBhdGgodG9BYnNvbHV0ZVBhdGgocmVzb3VyY2VQYXRoKSwgdG9BYnNvbHV0ZVBhdGgoYXBwKSkpIHtcbiAgICAgIC8vIHNlY3VyaXR5IHByZWNhdXRpb25cbiAgICAgIHRocm93IG5ldyBFcnJvcihgJyR7cmVzb3VyY2VQYXRofScgaXMgZXhwZWN0ZWQgdG8gYmUgbG9jYXRlZCB1bmRlciAnJHthcHB9J2ApO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlYWRSZXNvdXJjZShyZXNvdXJjZVBhdGgpO1xuICAgICAgbG9nZ2VyLmRlYnVnKGBQYXJzZWQgJHtfLmtleXMoZGF0YSkubGVuZ3RofSBzdHJpbmcocykgZnJvbSAnJHtyZXNvdXJjZVBhdGh9J2ApO1xuICAgICAgXy5tZXJnZShyZXN1bHRTdHJpbmdzLCBkYXRhKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBsb2dnZXIud2FybihgQ2Fubm90IHBhcnNlICcke3Jlc291cmNlUGF0aH0nIHJlc291cmNlLiBPcmlnaW5hbCBlcnJvcjogJHtlLm1lc3NhZ2V9YCk7XG4gICAgfVxuICB9XG5cbiAgbG9nZ2VyLmluZm8oYEdvdCAke18ua2V5cyhyZXN1bHRTdHJpbmdzKS5sZW5ndGh9IHN0cmluZyhzKSBmcm9tICcke2xwcm9qUm9vdH0nYCk7XG4gIHJldHVybiByZXN1bHRTdHJpbmdzO1xufVxuXG5hc3luYyBmdW5jdGlvbiBzZXRCdW5kbGVJZEZyb21BcHAgKGNhcHMpIHtcbiAgLy8gVGhpcyBtZXRob2Qgd2lsbCB0cnkgdG8gZXh0cmFjdCB0aGUgYnVuZGxlSWQgZnJvbSB0aGUgYXBwXG4gIGlmICghY2Fwcy5idW5kbGVJZCkge1xuICAgIHRyeSB7XG4gICAgICBjYXBzLmJ1bmRsZUlkID0gYXdhaXQgZXh0cmFjdEJ1bmRsZUlkKGNhcHMuYXBwKTtcbiAgICAgIGxvZ2dlci5pbmZvKGBFeHRyYWN0ZWQgYnVuZGxlSUQ6ICR7Y2Fwcy5idW5kbGVJZH0gZnJvbSBhcHA6ICR7Y2Fwcy5hcHB9YCk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ0NvdWxkIG5vdCBzZXQgdGhlIGJ1bmRsZUlkIGZyb20gYXBwLicpO1xuICAgICAgdGhyb3cgZXJyO1xuICAgIH1cbiAgfVxufVxuXG5mdW5jdGlvbiBzaG91bGRQcmVsYXVuY2hTaW11bGF0b3IgKGNhcHMsIGlvc1Nka1ZlcnNpb24pIHtcbiAgbGV0IHNob3VsZFByZWxhdW5jaCA9IGZhbHNlO1xuXG4gIGlmIChjYXBzLmRlZmF1bHREZXZpY2UgfHwgaW9zU2RrVmVyc2lvbiA+PSA3LjEpIHtcbiAgICBpZiAodGhpcy5pb3NTZGtWZXJzaW9uID49IDcuMSkge1xuICAgICAgbG9nZ2VyLmRlYnVnKFwiV2UncmUgb24gaU9TNy4xKyBzbyBmb3JjaW5nIGRlZmF1bHREZXZpY2Ugb25cIik7XG4gICAgfSBlbHNlIHtcbiAgICAgIGxvZ2dlci5kZWJ1ZygnVXNlciBzcGVjaWZpZWQgZGVmYXVsdCBkZXZpY2UsIGxldHRpbmcgaW5zdHJ1bWVudHMgbGF1bmNoIGl0Jyk7XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIHNob3VsZFByZWxhdW5jaCA9IHRydWU7XG4gIH1cbiAgcmV0dXJuIHNob3VsZFByZWxhdW5jaDtcbn1cblxuYXN5bmMgZnVuY3Rpb24gc2V0RGV2aWNlVHlwZUluSW5mb1BsaXN0IChhcHAsIGRldmljZVN0cmluZykge1xuICBpZiAoXy5pc051bGwoYXBwKSB8fCBfLmlzVW5kZWZpbmVkKGFwcCkpIHsgcmV0dXJuOyB9XG4gIGxldCBwbGlzdEZpbGUgPSBwYXRoLnJlc29sdmUoYXBwLCAnSW5mby5wbGlzdCcpO1xuICBsZXQgaXNpUGhvbmUgPSBkZXZpY2VTdHJpbmcudG9Mb3dlckNhc2UoKS5pbmRleE9mKCdpcGFkJykgPT09IC0xO1xuICBsZXQgZGV2aWNlVHlwZUNvZGUgPSBpc2lQaG9uZSA/IDEgOiAyO1xuICBhd2FpdCBwbGlzdC51cGRhdGVQbGlzdEZpbGUocGxpc3RGaWxlLCB7VUlEZXZpY2VGYW1pbHk6IFtkZXZpY2VUeXBlQ29kZV19KTtcbn1cblxuZnVuY3Rpb24gdW53cmFwRWwgKGVsKSB7XG4gIGlmICh0eXBlb2YgZWwgPT09ICdvYmplY3QnICYmIGVsLkVMRU1FTlQpIHtcbiAgICByZXR1cm4gZWwuRUxFTUVOVDtcbiAgfVxuICByZXR1cm4gZWw7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGNsZWFyTG9ncyAobG9jYXRpb25zKSB7XG4gIGxvZ2dlci5kZWJ1ZygnQ2xlYXJpbmcgbG9nIGZpbGVzJyk7XG4gIGZvciAobGV0IGxvY2F0aW9uIG9mIGxvY2F0aW9ucykge1xuICAgIGlmIChhd2FpdCBmcy5leGlzdHMobG9jYXRpb24pKSB7XG4gICAgICBsZXQgc2l6ZTtcbiAgICAgIHRyeSB7XG4gICAgICAgIGxldCB7c3Rkb3V0fSA9IGF3YWl0IGV4ZWMoJ2R1JywgWyctc2gnLCBsb2NhdGlvbl0pO1xuICAgICAgICBzaXplID0gc3Rkb3V0LnRyaW0oKS5zcGxpdCgvXFxzKy8pWzBdO1xuICAgICAgfSBjYXRjaCAoaWduKSB7fVxuICAgICAgdHJ5IHtcbiAgICAgICAgbG9nZ2VyLmRlYnVnKGBEZWxldGluZyAnJHtsb2NhdGlvbn0nLiAke3NpemUgPyBgRnJlZWluZyAke3NpemV9LmAgOiAnJ31gKTtcbiAgICAgICAgYXdhaXQgZnMucmltcmFmKGxvY2F0aW9uKTtcbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICBsb2dnZXIud2FybihgVW5hYmxlIHRvIGRlbGV0ZSAnJHtsb2NhdGlvbn0nOiAke2Vyci5tZXNzYWdlfWApO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICBsb2dnZXIuZGVidWcoJ0ZpbmlzaGVkIGNsZWFyaW5nIGxvZyBmaWxlcycpO1xufVxuXG5leHBvcnQge1xuICByb290RGlyLCByZW1vdmVJbnN0cnVtZW50c1NvY2tldCwgZ2V0QW5kQ2hlY2tYY29kZVZlcnNpb24sIHByZXBhcmVJb3NPcHRzLFxuICBhcHBJc1BhY2thZ2VPckJ1bmRsZSwgZ2V0QW5kQ2hlY2tJb3NTZGtWZXJzaW9uLCBkZXRlY3RVZGlkLCBwYXJzZUxvY2FsaXphYmxlU3RyaW5ncyxcbiAgc2V0QnVuZGxlSWRGcm9tQXBwLCBzaG91bGRQcmVsYXVuY2hTaW11bGF0b3IsIHNldERldmljZVR5cGVJbkluZm9QbGlzdCxcbiAgZ2V0U2ltRm9yRGV2aWNlU3RyaW5nLCB1bndyYXBFbCwgY2xlYXJMb2dzLFxufTtcbiJdLCJmaWxlIjoibGliL3V0aWxzLmpzIiwic291cmNlUm9vdCI6Ii4uLy4uIn0=
