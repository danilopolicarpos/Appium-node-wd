"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.helpers = exports.commands = void 0;

require("source-map-support/register");

var _lodash = _interopRequireDefault(require("lodash"));

var _bluebird = _interopRequireDefault(require("bluebird"));

var _appiumBaseDriver = require("appium-base-driver");

var _appiumSupport = require("appium-support");

var _cookies = _interopRequireDefault(require("../cookies"));

var _logger = _interopRequireDefault(require("../logger"));

let commands = {},
    helpers = {},
    extensions = {};
exports.helpers = helpers;
exports.commands = commands;
const ELEMENT_OFFSET = 5000;
const {
  W3C_WEB_ELEMENT_IDENTIFIER
} = _appiumSupport.util;

commands.setFrame = async function setFrame(frame) {
  if (!this.isWebContext()) {
    frame = frame ? frame : 'target.frontMostApp()';
    let command = `wd_frame = ${frame}`;
    return await this.uiAutoClient.sendCommand(command);
  }

  let atom;

  if (_lodash.default.isNull(frame)) {
    this.curWebFrames = [];

    _logger.default.debug('Leaving web frame and going back to default content');

    return;
  }

  if (helpers.hasElementId(frame)) {
    let atomsElement = this.useAtomsElement(helpers.getElementId(frame));
    let value = await this.executeAtom('get_frame_window', [atomsElement]);

    _logger.default.debug(`Entering new web frame: '${value.WINDOW}'`);

    this.curWebFrames.unshift(value.WINDOW);
  } else {
    atom = _lodash.default.isNumber(frame) ? 'frame_by_index' : 'frame_by_id_or_name';
    let value = await this.executeAtom(atom, [frame]);

    if (_lodash.default.isNull(value) || _lodash.default.isUndefined(value.WINDOW)) {
      throw new _appiumBaseDriver.errors.NoSuchFrameError();
    }

    _logger.default.debug(`Entering new web frame: '${value.WINDOW}'`);

    this.curWebFrames.unshift(value.WINDOW);
  }
};

commands.getCssProperty = async function getCssProperty(propertyName, el) {
  let atomsElement = this.useAtomsElement(el);
  return await this.executeAtom('get_value_of_css_property', [atomsElement, propertyName]);
};

commands.submit = async function submit(el) {
  if (this.isWebContext()) {
    let atomsElement = this.useAtomsElement(el);
    await this.executeAtom('submit', [atomsElement]);
  } else {
    throw new _appiumBaseDriver.errors.NotImplementedError();
  }
};

commands.refresh = async function refresh() {
  if (this.isWebContext()) {
    await this.executeAtom('refresh', []);
  } else {
    throw new _appiumBaseDriver.errors.NotImplementedError();
  }
};

commands.getUrl = async function getUrl() {
  if (!this.isWebContext()) {
    throw new _appiumBaseDriver.errors.NotImplementedError();
  }

  let url = await this.remote.execute('window.location.href');
  return url;
};

commands.title = async function title() {
  if (!this.isWebContext()) {
    throw new _appiumBaseDriver.errors.NotImplementedError();
  }

  return await this.executeAtom('title', [], true);
};

commands.getCookies = async function getCookies() {
  if (!this.isWebContext()) {
    throw new _appiumBaseDriver.errors.NotImplementedError();
  }

  _logger.default.debug('Retrieving all cookies');

  let script = 'return document.cookie';
  let jsCookies = await this.executeAtom('execute_script', [script, []]);
  let cookies = [];

  try {
    for (let [name, value] of _lodash.default.toPairs(_cookies.default.createJWPCookie(undefined, jsCookies))) {
      cookies.push({
        name,
        value
      });
    }

    return cookies;
  } catch (err) {
    _logger.default.error(err);

    throw new _appiumBaseDriver.errors.UnknownError(`Error parsing cookies from result: '${jsCookies}'`);
  }
};

commands.setCookie = async function setCookie(cookie) {
  if (!this.isWebContext()) {
    throw new _appiumBaseDriver.errors.NotImplementedError();
  }

  cookie = _lodash.default.clone(cookie);

  if (!cookie.path) {
    cookie.path = '/';
  }

  const jsCookie = _cookies.default.createJSCookie(cookie.name, cookie.value, {
    expires: _lodash.default.isNumber(cookie.expiry) ? new Date(cookie.expiry * 1000).toUTCString() : cookie.expiry,
    path: cookie.path,
    domain: cookie.domain,
    httpOnly: cookie.httpOnly,
    secure: cookie.secure
  });

  let script = `document.cookie = ${JSON.stringify(jsCookie)}`;
  await this.executeAtom('execute_script', [script, []]);
};

commands.deleteCookie = async function deleteCookie(cookieName) {
  if (!this.isWebContext()) {
    throw new _appiumBaseDriver.errors.NotImplementedError();
  }

  let cookies = await this.getCookies();

  if (_lodash.default.indexOf(_lodash.default.map(cookies, 'name'), cookieName) === -1) {
    _logger.default.debug(`Cookie '${cookieName}' not found. Ignoring.`);

    return true;
  }

  return await this._deleteCookie(cookieName);
};

commands.deleteCookies = async function deleteCookies() {
  if (!this.isWebContext()) {
    throw new _appiumBaseDriver.errors.NotImplementedError();
  }

  let cookies = await this.getCookies();

  if (cookies.length) {
    for (let cookie of cookies) {
      await this._deleteCookie(cookie.name);
    }
  }

  return true;
};

helpers._deleteCookie = async function _deleteCookie(cookieName) {
  _logger.default.debug(`Deleting cookie '${cookieName}'`);

  let webCookie = _cookies.default.expireCookie(cookieName, {
    path: '/'
  });

  let script = `document.cookie = ${JSON.stringify(webCookie)}`;
  await this.executeAtom('execute_script', [script, []]);
};

extensions.findWebElementOrElements = async function findWebElementOrElements(strategy, selector, many, ctx) {
  let atomsElement = this.getAtomsElement(ctx);
  let element;

  let doFind = async () => {
    element = await this.executeAtom(`find_element${many ? 's' : ''}`, [strategy, selector, atomsElement]);
    return !_lodash.default.isNull(element);
  };

  try {
    await this.implicitWaitForCondition(doFind);
  } catch (err) {
    if (err.message && _lodash.default.isFunction(err.message.match) && err.message.match(/Condition unmet/)) {
      element = [];
    } else {
      throw err;
    }
  }

  if (many) {
    return element;
  } else {
    if (!element || _lodash.default.size(element) === 0) {
      throw new _appiumBaseDriver.errors.NoSuchElementError();
    }

    return element;
  }
};

extensions.webFlickElement = async function webFlickElement(el, xoffset, yoffset) {
  let atomsElement = await this.useAtomsElement(el);
  let {
    x,
    y
  } = await this.executeAtom('get_top_left_coordinates', [atomsElement]);
  let {
    width,
    height
  } = await this.executeAtom('get_size', [atomsElement]);
  x = x + width / 2;
  y = y + height / 2;
  let from = await this.translateWebCoords({
    x,
    y
  });
  let to = await this.translateWebCoords({
    x: x + xoffset,
    y: y + yoffset
  });
  let args = {
    from,
    to
  };
  let command = `au.flick(${JSON.stringify(args)})`;
  await this.uiAutoClient.sendCommand(command);
};

extensions.mobileWebNav = async function mobileWebNav(navType) {
  this.remote.allowNavigationWithoutReload();
  await this.executeAtom('execute_script', [`history.${navType}();`, null]);
};

extensions.nativeWebTap = async function nativeWebTap(el) {
  let atomsElement = this.useAtomsElement(el);
  let {
    x,
    y
  } = await this.executeAtom('get_top_left_coordinates', [atomsElement]);
  let {
    width,
    height
  } = await this.executeAtom('get_size', [atomsElement]);
  x = x + width / 2;
  y = y + height / 2 + (await this.getExtraNativeWebTapOffset());
  this.curWebCoords = {
    x,
    y
  };
  await this.clickWebCoords();
  await _bluebird.default.delay(500);
};

extensions.getExtraNativeWebTapOffset = async function getExtraNativeWebTapOffset() {
  return 0;
};

extensions.clickWebCoords = async function clickWebCoords() {
  let coords = await this.translateWebCoords(this.curWebCoords);
  await this.clickCoords(coords);
};

extensions.translateWebCoords = async function translateWebCoords(coords) {
  _logger.default.debug(`Translating coordinates (${JSON.stringify(coords)}) to web coordinates`);

  let wvCmd = 'au.getElementsByType(\'webview\')';
  let webviewIndex = this.webContextIndex();
  let yOffset = this.opts.curOrientation === 'LANDSCAPE' ? this.landscapeWebCoordsOffset : 0;
  let webviews = await this.uiAutoClient.sendCommand(wvCmd);

  if (webviews.length < 1) {
    throw new _appiumBaseDriver.errors.UnknownError.code('Could not find any webviews to click inside!');
  }

  if (_lodash.default.isUndefined(webviews[webviewIndex])) {
    _logger.default.warn(`Could not find webview at index ${webviewIndex}, taking ` + `last available one for clicking purposes`);

    webviewIndex = webviews.length - 1;
  }

  let wvId = helpers.getElementId(webviews[webviewIndex]);
  let locCmd = `au.getElement('${wvId}').rect()`;
  let rect = await this.uiAutoClient.sendCommand(locCmd);
  let wvPos = {
    x: rect.origin.x,
    y: rect.origin.y
  };
  let realDims = {
    w: rect.size.width,
    h: rect.size.height
  };
  let cmd = '(function () { return {w: document.width, h: document.height}; })()';
  let {
    w,
    h
  } = await this.remote.execute(cmd);
  let wvDims = {
    w,
    h
  };

  if (wvDims && realDims && wvPos) {
    let xRatio = realDims.w / wvDims.w;
    let yRatio = realDims.h / wvDims.h;
    let serviceBarHeight = 20;

    if (parseFloat(this.opts.platformVersion) >= 8) {
      serviceBarHeight = 0;
    }

    let newCoords = {
      x: wvPos.x + Math.round(xRatio * coords.x),
      y: wvPos.y + yOffset + Math.round(yRatio * coords.y) - serviceBarHeight
    };

    _logger.default.debug(`Converted web coords ${JSON.stringify(coords)} ` + `into real coords ${JSON.stringify(newCoords)}`);

    return newCoords;
  }
};

helpers.clickCoords = async function clickCoords(coords) {
  if (this.useRobot) {
    throw new _appiumBaseDriver.errors.NotYetImplementedError();
  } else {
    let opts = coords;
    opts.tapCount = 1;
    opts.duration = 0.3;
    opts.touchCount = 1;
    let command = `au.complexTap(${JSON.stringify(opts)})`;
    await this.uiAutoClient.sendCommand(command);
  }
};

helpers.executeAtom = async function executeAtom(atom, args, alwaysDefaultFrame = false) {
  let frames = alwaysDefaultFrame === true ? [] : this.curWebFrames;
  let promise = this.remote.executeAtom(atom, args, frames);
  return await this.waitForAtom(promise);
};

helpers.executeAtomAsync = async function executeAtomAsync(atom, args, responseUrl) {
  let promise = new _bluebird.default((resolve, reject) => {
    this.asyncPromise = {
      resolve,
      reject
    };
  });
  await this.remote.executeAtomAsync(atom, args, this.curWebFrames, responseUrl);
  return await this.waitForAtom(promise);
};

helpers.waitForAtom = async function waitForAtom(promise) {
  let done = false;
  let error = null;
  promise.then(res => {
    done = true;
    return res;
  }).catch(err => {
    _logger.default.debug(`Error received while executing atom: ${err.message}`);

    done = true;
    error = err;
  });

  for (let i = 0; i < 10; i++) {
    if (done) break;
    await _bluebird.default.delay(500);
    if (done) break;

    if (await this.checkForAlert()) {
      return '';
    }
  }

  let res = await promise;

  if (error) {
    throw error;
  }

  return this.parseExecuteResponse(res);
};

helpers.checkForAlert = async function checkForAlert() {
  if (!_lodash.default.isNull(this.uiAutoClient)) {
    _logger.default.debug('atom did not return yet, checking to see if ' + 'we are blocked by an alert');

    let present = await this.uiAutoClient.sendCommand('au.alertIsPresent()');

    if (!present) {
      _logger.default.debug('No alert found.');
    } else {
      _logger.default.debug('Found an alert, returning control to client');
    }

    return present;
  }
};

helpers.getAtomsElement = function getAtomsElement(wdId) {
  let atomsId;

  try {
    atomsId = this.webElementIds[parseInt(wdId, 10) - ELEMENT_OFFSET];
  } catch (e) {
    return null;
  }

  if (_lodash.default.isUndefined(atomsId)) {
    return null;
  }

  return {
    ELEMENT: atomsId
  };
};

helpers.useAtomsElement = function useAtomsElement(el) {
  if (parseInt(el, 10) < ELEMENT_OFFSET) {
    _logger.default.debug(`Element with id '${el}' passed in for use with ` + `atoms, but it's out of our internal scope. Adding ${ELEMENT_OFFSET}.`);

    el = (parseInt(el, 10) + ELEMENT_OFFSET).toString();
  }

  let atomsElement = this.getAtomsElement(el);

  if (atomsElement === null) {
    throw new _appiumBaseDriver.errors.UnknownError(`Error converting element ID for using in WD atoms: '${el}'`);
  }

  return atomsElement;
};

helpers.convertElementsForAtoms = function convertElementsForAtoms(args = []) {
  const resultArgs = [];

  for (const arg of args) {
    if (helpers.hasElementId(arg)) {
      const elementId = helpers.getElementId(arg);
      const atomsElement = this.getAtomsElement(elementId);

      if (atomsElement === null) {
        throw new _appiumBaseDriver.errors.UnknownError(`Error converting element ID for using in WD atoms: '${elementId}'`);
      }

      resultArgs.push(atomsElement);
    } else if (_lodash.default.isArray(arg)) {
      resultArgs.push(this.convertElementsForAtoms(arg));
    } else {
      resultArgs.push(arg);
    }
  }

  return resultArgs;
};

helpers.parseExecuteResponse = function parseExecuteResponse(res) {
  if (_lodash.default.isNull(res) || _lodash.default.isUndefined(res)) return null;
  let wdElement = null;

  if (!_lodash.default.isArray(res)) {
    if (helpers.hasElementId(res)) {
      wdElement = this.parseElementResponse(res);

      if (wdElement === null) {
        throw new _appiumBaseDriver.errors.UnknownError(`Error converting element ID atom for using in WD: '${helpers.getElementId(res)}'`);
      }

      res = wdElement;
    }
  } else {
    let args = [];

    for (let arg of res) {
      wdElement = arg;

      if (helpers.hasElementId(arg)) {
        wdElement = this.parseElementResponse(arg);

        if (wdElement === null) {
          throw new _appiumBaseDriver.errors.UnknownError(`Error converting element ID atom for using in WD: '${helpers.getElementId(arg)}'`);
        }

        args.push(wdElement);
      } else {
        args.push(arg);
      }
    }

    res = args;
  }

  return res;
};

helpers.parseElementResponse = function parseElementResponse(element) {
  let objId = helpers.getElementId(element);
  let clientId = (ELEMENT_OFFSET + this.webElementIds.length).toString();
  this.webElementIds.push(objId);
  return {
    ELEMENT: clientId
  };
};

helpers.getElementId = function getElementId(element) {
  return element.ELEMENT || element[W3C_WEB_ELEMENT_IDENTIFIER];
};

helpers.hasElementId = function hasElementId(element) {
  return _appiumSupport.util.hasValue(element) && (_appiumSupport.util.hasValue(element.ELEMENT) || _appiumSupport.util.hasValue(element[W3C_WEB_ELEMENT_IDENTIFIER]));
};

Object.assign(extensions, commands, helpers);
var _default = extensions;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jb21tYW5kcy93ZWIuanMiXSwibmFtZXMiOlsiY29tbWFuZHMiLCJoZWxwZXJzIiwiZXh0ZW5zaW9ucyIsIkVMRU1FTlRfT0ZGU0VUIiwiVzNDX1dFQl9FTEVNRU5UX0lERU5USUZJRVIiLCJ1dGlsIiwic2V0RnJhbWUiLCJmcmFtZSIsImlzV2ViQ29udGV4dCIsImNvbW1hbmQiLCJ1aUF1dG9DbGllbnQiLCJzZW5kQ29tbWFuZCIsImF0b20iLCJfIiwiaXNOdWxsIiwiY3VyV2ViRnJhbWVzIiwibG9nZ2VyIiwiZGVidWciLCJoYXNFbGVtZW50SWQiLCJhdG9tc0VsZW1lbnQiLCJ1c2VBdG9tc0VsZW1lbnQiLCJnZXRFbGVtZW50SWQiLCJ2YWx1ZSIsImV4ZWN1dGVBdG9tIiwiV0lORE9XIiwidW5zaGlmdCIsImlzTnVtYmVyIiwiaXNVbmRlZmluZWQiLCJlcnJvcnMiLCJOb1N1Y2hGcmFtZUVycm9yIiwiZ2V0Q3NzUHJvcGVydHkiLCJwcm9wZXJ0eU5hbWUiLCJlbCIsInN1Ym1pdCIsIk5vdEltcGxlbWVudGVkRXJyb3IiLCJyZWZyZXNoIiwiZ2V0VXJsIiwidXJsIiwicmVtb3RlIiwiZXhlY3V0ZSIsInRpdGxlIiwiZ2V0Q29va2llcyIsInNjcmlwdCIsImpzQ29va2llcyIsImNvb2tpZXMiLCJuYW1lIiwidG9QYWlycyIsImNvb2tpZVV0aWxzIiwiY3JlYXRlSldQQ29va2llIiwidW5kZWZpbmVkIiwicHVzaCIsImVyciIsImVycm9yIiwiVW5rbm93bkVycm9yIiwic2V0Q29va2llIiwiY29va2llIiwiY2xvbmUiLCJwYXRoIiwianNDb29raWUiLCJjcmVhdGVKU0Nvb2tpZSIsImV4cGlyZXMiLCJleHBpcnkiLCJEYXRlIiwidG9VVENTdHJpbmciLCJkb21haW4iLCJodHRwT25seSIsInNlY3VyZSIsIkpTT04iLCJzdHJpbmdpZnkiLCJkZWxldGVDb29raWUiLCJjb29raWVOYW1lIiwiaW5kZXhPZiIsIm1hcCIsIl9kZWxldGVDb29raWUiLCJkZWxldGVDb29raWVzIiwibGVuZ3RoIiwid2ViQ29va2llIiwiZXhwaXJlQ29va2llIiwiZmluZFdlYkVsZW1lbnRPckVsZW1lbnRzIiwic3RyYXRlZ3kiLCJzZWxlY3RvciIsIm1hbnkiLCJjdHgiLCJnZXRBdG9tc0VsZW1lbnQiLCJlbGVtZW50IiwiZG9GaW5kIiwiaW1wbGljaXRXYWl0Rm9yQ29uZGl0aW9uIiwibWVzc2FnZSIsImlzRnVuY3Rpb24iLCJtYXRjaCIsInNpemUiLCJOb1N1Y2hFbGVtZW50RXJyb3IiLCJ3ZWJGbGlja0VsZW1lbnQiLCJ4b2Zmc2V0IiwieW9mZnNldCIsIngiLCJ5Iiwid2lkdGgiLCJoZWlnaHQiLCJmcm9tIiwidHJhbnNsYXRlV2ViQ29vcmRzIiwidG8iLCJhcmdzIiwibW9iaWxlV2ViTmF2IiwibmF2VHlwZSIsImFsbG93TmF2aWdhdGlvbldpdGhvdXRSZWxvYWQiLCJuYXRpdmVXZWJUYXAiLCJnZXRFeHRyYU5hdGl2ZVdlYlRhcE9mZnNldCIsImN1cldlYkNvb3JkcyIsImNsaWNrV2ViQ29vcmRzIiwiQiIsImRlbGF5IiwiY29vcmRzIiwiY2xpY2tDb29yZHMiLCJ3dkNtZCIsIndlYnZpZXdJbmRleCIsIndlYkNvbnRleHRJbmRleCIsInlPZmZzZXQiLCJvcHRzIiwiY3VyT3JpZW50YXRpb24iLCJsYW5kc2NhcGVXZWJDb29yZHNPZmZzZXQiLCJ3ZWJ2aWV3cyIsImNvZGUiLCJ3YXJuIiwid3ZJZCIsImxvY0NtZCIsInJlY3QiLCJ3dlBvcyIsIm9yaWdpbiIsInJlYWxEaW1zIiwidyIsImgiLCJjbWQiLCJ3dkRpbXMiLCJ4UmF0aW8iLCJ5UmF0aW8iLCJzZXJ2aWNlQmFySGVpZ2h0IiwicGFyc2VGbG9hdCIsInBsYXRmb3JtVmVyc2lvbiIsIm5ld0Nvb3JkcyIsIk1hdGgiLCJyb3VuZCIsInVzZVJvYm90IiwiTm90WWV0SW1wbGVtZW50ZWRFcnJvciIsInRhcENvdW50IiwiZHVyYXRpb24iLCJ0b3VjaENvdW50IiwiYWx3YXlzRGVmYXVsdEZyYW1lIiwiZnJhbWVzIiwicHJvbWlzZSIsIndhaXRGb3JBdG9tIiwiZXhlY3V0ZUF0b21Bc3luYyIsInJlc3BvbnNlVXJsIiwicmVzb2x2ZSIsInJlamVjdCIsImFzeW5jUHJvbWlzZSIsImRvbmUiLCJ0aGVuIiwicmVzIiwiY2F0Y2giLCJpIiwiY2hlY2tGb3JBbGVydCIsInBhcnNlRXhlY3V0ZVJlc3BvbnNlIiwicHJlc2VudCIsIndkSWQiLCJhdG9tc0lkIiwid2ViRWxlbWVudElkcyIsInBhcnNlSW50IiwiZSIsIkVMRU1FTlQiLCJ0b1N0cmluZyIsImNvbnZlcnRFbGVtZW50c0ZvckF0b21zIiwicmVzdWx0QXJncyIsImFyZyIsImVsZW1lbnRJZCIsImlzQXJyYXkiLCJ3ZEVsZW1lbnQiLCJwYXJzZUVsZW1lbnRSZXNwb25zZSIsIm9iaklkIiwiY2xpZW50SWQiLCJoYXNWYWx1ZSIsIk9iamVjdCIsImFzc2lnbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFHQSxJQUFJQSxRQUFRLEdBQUcsRUFBZjtBQUFBLElBQW1CQyxPQUFPLEdBQUcsRUFBN0I7QUFBQSxJQUFpQ0MsVUFBVSxHQUFHLEVBQTlDOzs7QUFFQSxNQUFNQyxjQUFjLEdBQUcsSUFBdkI7QUFDQSxNQUFNO0FBQUVDLEVBQUFBO0FBQUYsSUFBaUNDLG1CQUF2Qzs7QUFFQUwsUUFBUSxDQUFDTSxRQUFULEdBQW9CLGVBQWVBLFFBQWYsQ0FBeUJDLEtBQXpCLEVBQWdDO0FBQ2xELE1BQUksQ0FBQyxLQUFLQyxZQUFMLEVBQUwsRUFBMEI7QUFDeEJELElBQUFBLEtBQUssR0FBR0EsS0FBSyxHQUFHQSxLQUFILEdBQVcsdUJBQXhCO0FBQ0EsUUFBSUUsT0FBTyxHQUFJLGNBQWFGLEtBQU0sRUFBbEM7QUFDQSxXQUFPLE1BQU0sS0FBS0csWUFBTCxDQUFrQkMsV0FBbEIsQ0FBOEJGLE9BQTlCLENBQWI7QUFDRDs7QUFFRCxNQUFJRyxJQUFKOztBQUNBLE1BQUlDLGdCQUFFQyxNQUFGLENBQVNQ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QytGLFFBQTdDLEVBQWY7QUFDQSxPQUFLSixhQUFMLENBQW1CcEgsSUFBbkIsQ0FBd0JnSSxLQUF4QjtBQUNBLFNBQU87QUFBQ1QsSUFBQUEsT0FBTyxFQUFFVTtBQUFWLEdBQVA7QUFDRCxDQUxEOztBQU9BbEwsT0FBTyxDQUFDb0IsWUFBUixHQUF1QixTQUFTQSxZQUFULENBQXVCK0QsT0FBdkIsRUFBZ0M7QUFDckQsU0FBT0EsT0FBTyxDQUFDcUYsT0FBUixJQUFtQnJGLE9BQU8sQ0FBQ2hGLDBCQUFELENBQWpDO0FBQ0QsQ0FGRDs7QUFJQUgsT0FBTyxDQUFDaUIsWUFBUixHQUF1QixTQUFTQSxZQUFULENBQXVCa0UsT0FBdkIsRUFBZ0M7QUFDckQsU0FBTy9FLG9CQUFLK0ssUUFBTCxDQUFjaEcsT0FBZCxNQUEyQi9FLG9CQUFLK0ssUUFBTCxDQUFjaEcsT0FBTyxDQUFDcUYsT0FBdEIsS0FBa0NwSyxvQkFBSytLLFFBQUwsQ0FBY2hHLE9BQU8sQ0FBQ2hGLDBCQUFELENBQXJCLENBQTdELENBQVA7QUFDRCxDQUZEOztBQUtBaUwsTUFBTSxDQUFDQyxNQUFQLENBQWNwTCxVQUFkLEVBQTBCRixRQUExQixFQUFvQ0MsT0FBcEM7ZUFFZUMsVSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgQiBmcm9tICdibHVlYmlyZCc7XG5pbXBvcnQgeyBlcnJvcnMgfSBmcm9tICdhcHBpdW0tYmFzZS1kcml2ZXInO1xuaW1wb3J0IHsgdXRpbCB9IGZyb20gJ2FwcGl1bS1zdXBwb3J0JztcbmltcG9ydCBjb29raWVVdGlscyBmcm9tICcuLi9jb29raWVzJztcbmltcG9ydCBsb2dnZXIgZnJvbSAnLi4vbG9nZ2VyJztcblxuXG5sZXQgY29tbWFuZHMgPSB7fSwgaGVscGVycyA9IHt9LCBleHRlbnNpb25zID0ge307XG5cbmNvbnN0IEVMRU1FTlRfT0ZGU0VUID0gNTAwMDtcbmNvbnN0IHsgVzNDX1dFQl9FTEVNRU5UX0lERU5USUZJRVIgfSA9IHV0aWw7XG5cbmNvbW1hbmRzLnNldEZyYW1lID0gYXN5bmMgZnVuY3Rpb24gc2V0RnJhbWUgKGZyYW1lKSB7XG4gIGlmICghdGhpcy5pc1dlYkNvbnRleHQoKSkge1xuICAgIGZyYW1lID0gZnJhbWUgPyBmcmFtZSA6ICd0YXJnZXQuZnJvbnRNb3N0QXBwKCknO1xuICAgIGxldCBjb21tYW5kID0gYHdkX2ZyYW1lID0gJHtmcmFtZX1gO1xuICAgIHJldHVybiBhd2FpdCB0aGlzLnVpQXV0b0NsaWVudC5zZW5kQ29tbWFuZChjb21tYW5kKTtcbiAgfVxuXG4gIGxldCBhdG9tO1xuICBpZiAoXy5pc051bGwoZnJhbWUpKSB7XG4gICAgdGhpcy5jdXJXZWJGcmFtZXMgPSBbXTtcbiAgICBsb2dnZXIuZGVidWcoJ0xlYXZpbmcgd2ViIGZyYW1lIGFuZCBnb2luZyBiYWNrIHRvIGRlZmF1bHQgY29udGVudCcpO1xuICAgIHJldHVybjtcbiAgfVxuICBpZiAoaGVscGVycy5oYXNFbGVtZW50SWQoZnJhbWUpKSB7XG4gICAgbGV0IGF0b21zRWxlbWVudCA9IHRoaXMudXNlQXRvbXNFbGVtZW50KGhlbHBlcnMuZ2V0RWxlbWVudElkKGZyYW1lKSk7XG4gICAgbGV0IHZhbHVlID0gYXdhaXQgdGhpcy5leGVjdXRlQXRvbSgnZ2V0X2ZyYW1lX3dpbmRvdycsIFthdG9tc0VsZW1lbnRdKTtcbiAgICBsb2dnZXIuZGVidWcoYEVudGVyaW5nIG5ldyB3ZWIgZnJhbWU6ICcke3ZhbHVlLldJTkRPV30nYCk7XG4gICAgdGhpcy5jdXJXZWJGcmFtZXMudW5zaGlmdCh2YWx1ZS5XSU5ET1cpO1xuICB9IGVsc2Uge1xuICAgIGF0b20gPSBfLmlzTnVtYmVyKGZyYW1lKSA/ICdmcmFtZV9ieV9pbmRleCcgOiAnZnJhbWVfYnlfaWRfb3JfbmFtZSc7XG4gICAgbGV0IHZhbHVlID0gYXdhaXQgdGhpcy5leGVjdXRlQXRvbShhdG9tLCBbZnJhbWVdKTtcbiAgICBpZiAoXy5pc051bGwodmFsdWUpIHx8IF8uaXNVbmRlZmluZWQodmFsdWUuV0lORE9XKSkge1xuICAgICAgdGhyb3cgbmV3IGVycm9ycy5Ob1N1Y2hGcmFtZUVycm9yKCk7XG4gICAgfVxuICAgIGxvZ2dlci5kZWJ1ZyhgRW50ZXJpbmcgbmV3IHdlYiBmcmFtZTogJyR7dmFsdWUuV0lORE9XfSdgKTtcbiAgICB0aGlzLmN1cldlYkZyYW1lcy51bnNoaWZ0KHZhbHVlLldJTkRPVyk7XG4gIH1cbn07XG5cbmNvbW1hbmRzLmdldENzc1Byb3BlcnR5ID0gYXN5bmMgZnVuY3Rpb24gZ2V0Q3NzUHJvcGVydHkgKHByb3BlcnR5TmFtZSwgZWwpIHtcbiAgbGV0IGF0b21zRWxlbWVudCA9IHRoaXMudXNlQXRvbXNFbGVtZW50KGVsKTtcbiAgcmV0dXJuIGF3YWl0IHRoaXMuZXhlY3V0ZUF0b20oJ2dldF92YWx1ZV9vZl9jc3NfcHJvcGVydHknLCBbYXRvbXNFbGVtZW50LCBwcm9wZXJ0eU5hbWVdKTtcbn07XG5cbmNvbW1hbmRzLnN1Ym1pdCA9IGFzeW5jIGZ1bmN0aW9uIHN1Ym1pdCAoZWwpIHtcbiAgaWYgKHRoaXMuaXNXZWJDb250ZXh0KCkpIHtcbiAgICBsZXQgYXRvbXNFbGVtZW50ID0gdGhpcy51c2VBdG9tc0VsZW1lbnQoZWwpO1xuICAgIGF3YWl0IHRoaXMuZXhlY3V0ZUF0b20oJ3N1Ym1pdCcsIFthdG9tc0VsZW1lbnRdKTtcbiAgfSBlbHNlIHtcbiAgICB0aHJvdyBuZXcgZXJyb3JzLk5vdEltcGxlbWVudGVkRXJyb3IoKTtcbiAgfVxufTtcblxuY29tbWFuZHMucmVmcmVzaCA9IGFzeW5jIGZ1bmN0aW9uIHJlZnJlc2ggKCkge1xuICBpZiAodGhpcy5pc1dlYkNvbnRleHQoKSkge1xuICAgIGF3YWl0IHRoaXMuZXhlY3V0ZUF0b20oJ3JlZnJlc2gnLCBbXSk7XG4gIH0gZWxzZSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5Ob3RJbXBsZW1lbnRlZEVycm9yKCk7XG4gIH1cbn07XG5cbmNvbW1hbmRzLmdldFVybCA9IGFzeW5jIGZ1bmN0aW9uIGdldFVybCAoKSB7XG4gIGlmICghdGhpcy5pc1dlYkNvbnRleHQoKSkge1xuICAgIHRocm93IG5ldyBlcnJvcnMuTm90SW1wbGVtZW50ZWRFcnJvcigpO1xuICB9XG4gIGxldCB1cmwgPSBhd2FpdCB0aGlzLnJlbW90ZS5leGVjdXRlKCd3aW5kb3cubG9jYXRpb24uaHJlZicpO1xuICByZXR1cm4gdXJsO1xufTtcblxuY29tbWFuZHMudGl0bGUgPSBhc3luYyBmdW5jdGlvbiB0aXRsZSAoKSB7XG4gIGlmICghdGhpcy5pc1dlYkNvbnRleHQoKSkge1xuICAgIHRocm93IG5ldyBlcnJvcnMuTm90SW1wbGVtZW50ZWRFcnJvcigpO1xuICB9XG4gIHJldHVybiBhd2FpdCB0aGlzLmV4ZWN1dGVBdG9tKCd0aXRsZScsIFtdLCB0cnVlKTtcbn07XG5cbmNvbW1hbmRzLmdldENvb2tpZXMgPSBhc3luYyBmdW5jdGlvbiBnZXRDb29raWVzICgpIHtcbiAgaWYgKCF0aGlzLmlzV2ViQ29udGV4dCgpKSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5Ob3RJbXBsZW1lbnRlZEVycm9yKCk7XG4gIH1cblxuICBsb2dnZXIuZGVidWcoJ1JldHJpZXZpbmcgYWxsIGNvb2tpZXMnKTtcblxuICBsZXQgc2NyaXB0ID0gJ3JldHVybiBkb2N1bWVudC5jb29raWUnO1xuICBsZXQganNDb29raWVzID0gYXdhaXQgdGhpcy5leGVjdXRlQXRvbSgnZXhlY3V0ZV9zY3JpcHQnLCBbc2NyaXB0LCBbXV0pO1xuXG4gIGxldCBjb29raWVzID0gW107XG4gIHRyeSB7XG4gICAgZm9yIChsZXQgW25hbWUsIHZhbHVlXSBvZiBfLnRvUGFpcnMoY29va2llVXRpbHMuY3JlYXRlSldQQ29va2llKHVuZGVmaW5lZCwganNDb29raWVzKSkpIHtcbiAgICAgIGNvb2tpZXMucHVzaCh7bmFtZSwgdmFsdWV9KTtcbiAgICB9XG4gICAgcmV0dXJuIGNvb2tpZXM7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGxvZ2dlci5lcnJvcihlcnIpO1xuICAgIHRocm93IG5ldyBlcnJvcnMuVW5rbm93bkVycm9yKGBFcnJvciBwYXJzaW5nIGNvb2tpZXMgZnJvbSByZXN1bHQ6ICcke2pzQ29va2llc30nYCk7XG4gIH1cbn07XG5cbmNvbW1hbmRzLnNldENvb2tpZSA9IGFzeW5jIGZ1bmN0aW9uIHNldENvb2tpZSAoY29va2llKSB7XG4gIGlmICghdGhpcy5pc1dlYkNvbnRleHQoKSkge1xuICAgIHRocm93IG5ldyBlcnJvcnMuTm90SW1wbGVtZW50ZWRFcnJvcigpO1xuICB9XG5cbiAgY29va2llID0gXy5jbG9uZShjb29raWUpO1xuXG4gIC8vIGlmIGBwYXRoYCBmaWVsZCBpcyBub3Qgc3BlY2lmaWVkLCBTYWZhcmkgd2lsbCBub3QgdXBkYXRlIGNvb2tpZXMgYXMgZXhwZWN0ZWQ7IGVnIGlzc3VlICMxNzA4XG4gIGlmICghY29va2llLnBhdGgpIHtcbiAgICBjb29raWUucGF0aCA9ICcvJztcbiAgfVxuXG4gIGNvbnN0IGpzQ29va2llID0gY29va2llVXRpbHMuY3JlYXRlSlNDb29raWUoY29va2llLm5hbWUsIGNvb2tpZS52YWx1ZSwge1xuICAgIGV4cGlyZXM6IF8uaXNOdW1iZXIoY29va2llLmV4cGlyeSkgPyAobmV3IERhdGUoY29va2llLmV4cGlyeSAqIDEwMDApKS50b1VUQ1N0cmluZygpIDpcbiAgICAgIGNvb2tpZS5leHBpcnksXG4gICAgcGF0aDogY29va2llLnBhdGgsXG4gICAgZG9tYWluOiBjb29raWUuZG9tYWluLFxuICAgIGh0dHBPbmx5OiBjb29raWUuaHR0cE9ubHksXG4gICAgc2VjdXJlOiBjb29raWUuc2VjdXJlXG4gIH0pO1xuICBsZXQgc2NyaXB0ID0gYGRvY3VtZW50LmNvb2tpZSA9ICR7SlNPTi5zdHJpbmdpZnkoanNDb29raWUpfWA7XG4gIGF3YWl0IHRoaXMuZXhlY3V0ZUF0b20oJ2V4ZWN1dGVfc2NyaXB0JywgW3NjcmlwdCwgW11dKTtcbn07XG5cbmNvbW1hbmRzLmRlbGV0ZUNvb2tpZSA9IGFzeW5jIGZ1bmN0aW9uIGRlbGV0ZUNvb2tpZSAoY29va2llTmFtZSkge1xuICBpZiAoIXRoaXMuaXNXZWJDb250ZXh0KCkpIHtcbiAgICB0aHJvdyBuZXcgZXJyb3JzLk5vdEltcGxlbWVudGVkRXJyb3IoKTtcbiAgfVxuXG4gIC8vIGNoZWNrIGNvb2tpZSBleGlzdGVuY2VcbiAgbGV0IGNvb2tpZXMgPSBhd2FpdCB0aGlzLmdldENvb2tpZXMoKTtcbiAgaWYgKF8uaW5kZXhPZihfLm1hcChjb29raWVzLCAnbmFtZScpLCBjb29raWVOYW1lKSA9PT0gLTEpIHtcbiAgICBsb2dnZXIuZGVidWcoYENvb2tpZSAnJHtjb29raWVOYW1lfScgbm90IGZvdW5kLiBJZ25vcmluZy5gKTtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIHJldHVybiBhd2FpdCB0aGlzLl9kZWxldGVDb29raWUoY29va2llTmFtZSk7XG59O1xuXG5jb21tYW5kcy5kZWxldGVDb29raWVzID0gYXN5bmMgZnVuY3Rpb24gZGVsZXRlQ29va2llcyAoKSB7XG4gIGlmICghdGhpcy5pc1dlYkNvbnRleHQoKSkge1xuICAgIHRocm93IG5ldyBlcnJvcnMuTm90SW1wbGVtZW50ZWRFcnJvcigpO1xuICB9XG5cbiAgbGV0IGNvb2tpZXMgPSBhd2FpdCB0aGlzLmdldENvb2tpZXMoKTtcbiAgaWYgKGNvb2tpZXMubGVuZ3RoKSB7XG4gICAgZm9yIChsZXQgY29va2llIG9mIGNvb2tpZXMpIHtcbiAgICAgIGF3YWl0IHRoaXMuX2RlbGV0ZUNvb2tpZShjb29raWUubmFtZSk7XG4gICAgfVxuICB9XG4gIHJldHVybiB0cnVlO1xufTtcblxuaGVscGVycy5fZGVsZXRlQ29va2llID0gYXN5bmMgZnVuY3Rpb24gX2RlbGV0ZUNvb2tpZSAoY29va2llTmFtZSkge1xuICBsb2dnZXIuZGVidWcoYERlbGV0aW5nIGNvb2tpZSAnJHtjb29raWVOYW1lfSdgKTtcbiAgbGV0IHdlYkNvb2tpZSA9IGNvb2tpZVV0aWxzLmV4cGlyZUNvb2tpZShjb29raWVOYW1lLCB7cGF0aDogJy8nfSk7XG4gIGxldCBzY3JpcHQgPSBgZG9jdW1lbnQuY29va2llID0gJHtKU09OLnN0cmluZ2lmeSh3ZWJDb29raWUpfWA7XG4gIGF3YWl0IHRoaXMuZXhlY3V0ZUF0b20oJ2V4ZWN1dGVfc2NyaXB0JywgW3NjcmlwdCwgW11dKTtcbn07XG5cbmV4dGVuc2lvbnMuZmluZFdlYkVsZW1lbnRPckVsZW1lbnRzID0gYXN5bmMgZnVuY3Rpb24gZmluZFdlYkVsZW1lbnRPckVsZW1lbnRzIChzdHJhdGVneSwgc2VsZWN0b3IsIG1hbnksIGN0eCkge1xuICBsZXQgYXRvbXNFbGVtZW50ID0gdGhpcy5nZXRBdG9tc0VsZW1lbnQoY3R4KTtcbiAgbGV0IGVsZW1lbnQ7XG4gIGxldCBkb0ZpbmQgPSBhc3luYyAoKSA9PiB7XG4gICAgZWxlbWVudCA9IGF3YWl0IHRoaXMuZXhlY3V0ZUF0b20oYGZpbmRfZWxlbWVudCR7bWFueSA/ICdzJyA6ICcnfWAsIFtzdHJhdGVneSwgc2VsZWN0b3IsIGF0b21zRWxlbWVudF0pO1xuICAgIHJldHVybiAhXy5pc051bGwoZWxlbWVudCk7XG4gIH07XG4gIHRyeSB7XG4gICAgYXdhaXQgdGhpcy5pbXBsaWNpdFdhaXRGb3JDb25kaXRpb24oZG9GaW5kKTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgaWYgKGVyci5tZXNzYWdlICYmIF8uaXNGdW5jdGlvbihlcnIubWVzc2FnZS5tYXRjaCkgJiYgZXJyLm1lc3NhZ2UubWF0Y2goL0NvbmRpdGlvbiB1bm1ldC8pKSB7XG4gICAgICAvLyBjb25kaXRpb24gd2FzIG5vdCBtZXQgc2V0dGluZyByZXMgdG8gZW1wdHkgYXJyYXlcbiAgICAgIGVsZW1lbnQgPSBbXTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgZXJyO1xuICAgIH1cbiAgfVxuXG4gIGlmIChtYW55KSB7XG4gICAgcmV0dXJuIGVsZW1lbnQ7XG4gIH0gZWxzZSB7XG4gICAgaWYgKCFlbGVtZW50IHx8IF8uc2l6ZShlbGVtZW50KSA9PT0gMCkge1xuICAgICAgdGhyb3cgbmV3IGVycm9ycy5Ob1N1Y2hFbGVtZW50RXJyb3IoKTtcbiAgICB9XG4gICAgcmV0dXJuIGVsZW1lbnQ7XG4gIH1cbn07XG5cbmV4dGVuc2lvbnMud2ViRmxpY2tFbGVtZW50ID0gYXN5bmMgZnVuY3Rpb24gd2ViRmxpY2tFbGVtZW50IChlbCwgeG9mZnNldCwgeW9mZnNldCkge1xuICBsZXQgYXRvbXNFbGVtZW50ID0gYXdhaXQgdGhpcy51c2VBdG9tc0VsZW1lbnQoZWwpO1xuXG4gIGxldCB7eCwgeX0gPSBhd2FpdCB0aGlzLmV4ZWN1dGVBdG9tKCdnZXRfdG9wX2xlZnRfY29vcmRpbmF0ZXMnLCBbYXRvbXNFbGVtZW50XSk7XG4gIGxldCB7d2lkdGgsIGhlaWdodH0gPSBhd2FpdCB0aGlzLmV4ZWN1dGVBdG9tKCdnZXRfc2l6ZScsIFthdG9tc0VsZW1lbnRdKTtcblxuICAvLyB0cmFuc2xhdGUgdG8gcHJvcGVyIGNvb3JkaW5hdGVzXG4gIHggPSB4ICsgKHdpZHRoIC8gMik7XG4gIHkgPSB5ICsgKGhlaWdodCAvIDIpO1xuXG4gIGxldCBmcm9tID0gYXdhaXQgdGhpcy50cmFuc2xhdGVXZWJDb29yZHMoe3gsIHl9KTtcbiAgbGV0IHRvID0gYXdhaXQgdGhpcy50cmFuc2xhdGVXZWJDb29yZHMoe3g6IHggKyB4b2Zmc2V0LCB5OiB5ICsgeW9mZnNldH0pO1xuXG4gIGxldCBhcmdzID0ge2Zyb20sIHRvfTtcbiAgbGV0IGNvbW1hbmQgPSBgYXUuZmxpY2soJHtKU09OLnN0cmluZ2lmeShhcmdzKX0pYDtcbiAgYXdhaXQgdGhpcy51aUF1dG9DbGllbnQuc2VuZENvbW1hbmQoY29tbWFuZCk7XG59O1xuXG5leHRlbnNpb25zLm1vYmlsZVdlYk5hdiA9IGFzeW5jIGZ1bmN0aW9uIG1vYmlsZVdlYk5hdiAobmF2VHlwZSkge1xuICB0aGlzLnJlbW90ZS5hbGxvd05hdmlnYXRpb25XaXRob3V0UmVsb2FkKCk7XG4gIGF3YWl0IHRoaXMuZXhlY3V0ZUF0b20oJ2V4ZWN1dGVfc2NyaXB0JywgW2BoaXN0b3J5LiR7bmF2VHlwZX0oKTtgLCBudWxsXSk7XG59O1xuXG5cbmV4dGVuc2lvbnMubmF0aXZlV2ViVGFwID0gYXN5bmMgZnVuY3Rpb24gbmF0aXZlV2ViVGFwIChlbCkge1xuICBsZXQgYXRvbXNFbGVtZW50ID0gdGhpcy51c2VBdG9tc0VsZW1lbnQoZWwpO1xuICBsZXQge3gsIHl9ID0gYXdhaXQgdGhpcy5leGVjdXRlQXRvbSgnZ2V0X3RvcF9sZWZ0X2Nvb3JkaW5hdGVzJywgW2F0b21zRWxlbWVudF0pO1xuICBsZXQge3dpZHRoLCBoZWlnaHR9ID0gYXdhaXQgdGhpcy5leGVjdXRlQXRvbSgnZ2V0X3NpemUnLCBbYXRvbXNFbGVtZW50XSk7XG4gIHggPSB4ICsgKHdpZHRoIC8gMik7XG4gIHkgPSB5ICsgKGhlaWdodCAvIDIpICsgYXdhaXQgdGhpcy5nZXRFeHRyYU5hdGl2ZVdlYlRhcE9mZnNldCgpO1xuXG4gIHRoaXMuY3VyV2ViQ29vcmRzID0ge3gsIHl9O1xuICBhd2FpdCB0aGlzLmNsaWNrV2ViQ29vcmRzKCk7XG4gIC8vIG1ha2Ugc3VyZSByZWFsIHRhcCBhY3R1YWxseSBoYXMgdGltZSB0byByZWdpc3RlclxuICBhd2FpdCBCLmRlbGF5KDUwMCk7XG59O1xuXG5leHRlbnNpb25zLmdldEV4dHJhTmF0aXZlV2ViVGFwT2Zmc2V0ID0gYXN5bmMgZnVuY3Rpb24gZ2V0RXh0cmFOYXRpdmVXZWJUYXBPZmZzZXQgKCkgeyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHJlcXVpcmUtYXdhaXRcbiAgLy8gdGhpcyB3aWxsIGJlIGZpbGxlZCBpbiBieSBkcml2ZXJzIHVzaW5nIGl0XG4gIHJldHVybiAwO1xufTtcblxuZXh0ZW5zaW9ucy5jbGlja1dlYkNvb3JkcyA9IGFzeW5jIGZ1bmN0aW9uIGNsaWNrV2ViQ29vcmRzICgpIHtcbiAgbGV0IGNvb3JkcyA9IGF3YWl0IHRoaXMudHJhbnNsYXRlV2ViQ29vcmRzKHRoaXMuY3VyV2ViQ29vcmRzKTtcbiAgYXdhaXQgdGhpcy5jbGlja0Nvb3Jkcyhjb29yZHMpO1xufTtcblxuZXh0ZW5zaW9ucy50cmFuc2xhdGVXZWJDb29yZHMgPSBhc3luYyBmdW5jdGlvbiB0cmFuc2xhdGVXZWJDb29yZHMgKGNvb3Jkcykge1xuICBsb2dnZXIuZGVidWcoYFRyYW5zbGF0aW5nIGNvb3JkaW5hdGVzICgke0pTT04uc3RyaW5naWZ5KGNvb3Jkcyl9KSB0byB3ZWIgY29vcmRpbmF0ZXNgKTtcbiAgbGV0IHd2Q21kID0gJ2F1LmdldEVsZW1lbnRzQnlUeXBlKFxcJ3dlYnZpZXdcXCcpJztcbiAgbGV0IHdlYnZpZXdJbmRleCA9IHRoaXMud2ViQ29udGV4dEluZGV4KCk7XG5cbiAgLy8gYWRkIHN0YXRpYyBvZmZzZXQgZm9yIHNhZmFyaSBpbiBsYW5kc2NhcGUgbW9kZVxuICBsZXQgeU9mZnNldCA9IHRoaXMub3B0cy5jdXJPcmllbnRhdGlvbiA9PT0gJ0xBTkRTQ0FQRScgPyB0aGlzLmxhbmRzY2FwZVdlYkNvb3Jkc09mZnNldCA6IDA7XG5cbiAgLy8gYWJzb2x1dGl6ZSB3ZWIgY29vcmRzXG4gIGxldCB3ZWJ2aWV3cyA9IGF3YWl0IHRoaXMudWlBdXRvQ2xpZW50LnNlbmRDb21tYW5kKHd2Q21kKTtcbiAgaWYgKHdlYnZpZXdzLmxlbmd0aCA8IDEpIHtcbiAgICB0aHJvdyBuZXcgZXJyb3JzLlVua25vd25FcnJvci5jb2RlKCdDb3VsZCBub3QgZmluZCBhbnkgd2Vidmlld3MgdG8gY2xpY2sgaW5zaWRlIScpO1xuICB9XG4gIGlmIChfLmlzVW5kZWZpbmVkKHdlYnZpZXdzW3dlYnZpZXdJbmRleF0pKSB7XG4gICAgbG9nZ2VyLndhcm4oYENvdWxkIG5vdCBmaW5kIHdlYnZpZXcgYXQgaW5kZXggJHt3ZWJ2aWV3SW5kZXh9LCB0YWtpbmcgYCArXG4gICAgICAgICAgICAgICAgYGxhc3QgYXZhaWxhYmxlIG9uZSBmb3IgY2xpY2tpbmcgcHVycG9zZXNgKTtcbiAgICB3ZWJ2aWV3SW5kZXggPSB3ZWJ2aWV3cy5sZW5ndGggLSAxO1xuICB9XG5cbiAgbGV0IHd2SWQgPSBoZWxwZXJzLmdldEVsZW1lbnRJZCh3ZWJ2aWV3c1t3ZWJ2aWV3SW5kZXhdKTtcbiAgbGV0IGxvY0NtZCA9IGBhdS5nZXRFbGVtZW50KCcke3d2SWR9JykucmVjdCgpYDtcbiAgbGV0IHJlY3QgPSBhd2FpdCB0aGlzLnVpQXV0b0NsaWVudC5zZW5kQ29tbWFuZChsb2NDbWQpO1xuICBsZXQgd3ZQb3MgPSB7eDogcmVjdC5vcmlnaW4ueCwgeTogcmVjdC5vcmlnaW4ueX07XG4gIGxldCByZWFsRGltcyA9IHt3OiByZWN0LnNpemUud2lkdGgsIGg6IHJlY3Quc2l6ZS5oZWlnaHR9O1xuXG4gIGxldCBjbWQgPSAnKGZ1bmN0aW9uICgpIHsgcmV0dXJuIHt3OiBkb2N1bWVudC53aWR0aCwgaDogZG9jdW1lbnQuaGVpZ2h0fTsgfSkoKSc7XG4gIGxldCB7dywgaH0gPSBhd2FpdCB0aGlzLnJlbW90ZS5leGVjdXRlKGNtZCk7XG4gIGxldCB3dkRpbXMgPSB7dywgaH07XG5cbiAgaWYgKHd2RGltcyAmJiByZWFsRGltcyAmJiB3dlBvcykge1xuICAgIGxldCB4UmF0aW8gPSByZWFsRGltcy53IC8gd3ZEaW1zLnc7XG4gICAgbGV0IHlSYXRpbyA9IHJlYWxEaW1zLmggLyB3dkRpbXMuaDtcbiAgICBsZXQgc2VydmljZUJhckhlaWdodCA9IDIwO1xuICAgIGlmIChwYXJzZUZsb2F0KHRoaXMub3B0cy5wbGF0Zm9ybVZlcnNpb24pID49IDgpIHtcbiAgICAgIC8vIGlvczggaW5jbHVkZXMgdGhlIHNlcnZpY2UgYmFyIGhlaWdodCBpbiB0aGUgYXBwXG4gICAgICBzZXJ2aWNlQmFySGVpZ2h0ID0gMDtcbiAgICB9XG4gICAgbGV0IG5ld0Nvb3JkcyA9IHtcbiAgICAgIHg6IHd2UG9zLnggKyBNYXRoLnJvdW5kKHhSYXRpbyAqIGNvb3Jkcy54KSxcbiAgICAgIHk6IHd2UG9zLnkgKyB5T2Zmc2V0ICsgTWF0aC5yb3VuZCh5UmF0aW8gKiBjb29yZHMueSkgLSBzZXJ2aWNlQmFySGVpZ2h0XG4gICAgfTtcbiAgICBsb2dnZXIuZGVidWcoYENvbnZlcnRlZCB3ZWIgY29vcmRzICR7SlNPTi5zdHJpbmdpZnkoY29vcmRzKX0gYCArXG4gICAgICAgICAgICAgICAgYGludG8gcmVhbCBjb29yZHMgJHtKU09OLnN0cmluZ2lmeShuZXdDb29yZHMpfWApO1xuICAgIHJldHVybiBuZXdDb29yZHM7XG4gIH1cbn07XG5cbmhlbHBlcnMuY2xpY2tDb29yZHMgPSBhc3luYyBmdW5jdGlvbiBjbGlja0Nvb3JkcyAoY29vcmRzKSB7XG4gIGlmICh0aGlzLnVzZVJvYm90KSB7XG4gICAgLy8gdmFyIHRhcFVybCA9IHRoaXMuYXJncy5yb2JvdFVybCArIFwiL3RhcFwiO1xuICAgIC8vIHJlcXVlc3QucG9zdCh7dXJsOnRhcFVybCwgZm9ybToge3g6Y29vcmRzLngsIHk6Y29vcmRzLnl9fSwgY2IpO1xuICAgIC8qVE9ETyovdGhyb3cgbmV3IGVycm9ycy5Ob3RZZXRJbXBsZW1lbnRlZEVycm9yKCk7XG4gIH0gZWxzZSB7XG4gICAgbGV0IG9wdHMgPSBjb29yZHM7XG4gICAgb3B0cy50YXBDb3VudCA9IDE7XG4gICAgb3B0cy5kdXJhdGlvbiA9IDAuMztcbiAgICBvcHRzLnRvdWNoQ291bnQgPSAxO1xuICAgIGxldCBjb21tYW5kID0gYGF1LmNvbXBsZXhUYXAoJHtKU09OLnN0cmluZ2lmeShvcHRzKX0pYDtcbiAgICBhd2FpdCB0aGlzLnVpQXV0b0NsaWVudC5zZW5kQ29tbWFuZChjb21tYW5kKTtcbiAgfVxufTtcblxuaGVscGVycy5leGVjdXRlQXRvbSA9IGFzeW5jIGZ1bmN0aW9uIGV4ZWN1dGVBdG9tIChhdG9tLCBhcmdzLCBhbHdheXNEZWZhdWx0RnJhbWUgPSBmYWxzZSkge1xuICBsZXQgZnJhbWVzID0gYWx3YXlzRGVmYXVsdEZyYW1lID09PSB0cnVlID8gW10gOiB0aGlzLmN1cldlYkZyYW1lcztcbiAgbGV0IHByb21pc2UgPSB0aGlzLnJlbW90ZS5leGVjdXRlQXRvbShhdG9tLCBhcmdzLCBmcmFtZXMpO1xuICByZXR1cm4gYXdhaXQgdGhpcy53YWl0Rm9yQXRvbShwcm9taXNlKTtcbn07XG5cbmhlbHBlcnMuZXhlY3V0ZUF0b21Bc3luYyA9IGFzeW5jIGZ1bmN0aW9uIGV4ZWN1dGVBdG9tQXN5bmMgKGF0b20sIGFyZ3MsIHJlc3BvbnNlVXJsKSB7XG4gIC8vIHNhdmUgdGhlIHJlc29sdmUgYW5kIHJlamVjdCBtZXRob2RzIG9mIHRoZSBwcm9taXNlIHRvIGJlIHdhaXRlZCBmb3JcbiAgbGV0IHByb21pc2UgPSBuZXcgQigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgdGhpcy5hc3luY1Byb21pc2UgPSB7cmVzb2x2ZSwgcmVqZWN0fTtcbiAgfSk7XG4gIGF3YWl0IHRoaXMucmVtb3RlLmV4ZWN1dGVBdG9tQXN5bmMoYXRvbSwgYXJncywgdGhpcy5jdXJXZWJGcmFtZXMsIHJlc3BvbnNlVXJsKTtcbiAgcmV0dXJuIGF3YWl0IHRoaXMud2FpdEZvckF0b20ocHJvbWlzZSk7XG59O1xuXG5oZWxwZXJzLndhaXRGb3JBdG9tID0gYXN5bmMgZnVuY3Rpb24gd2FpdEZvckF0b20gKHByb21pc2UpIHtcbiAgLy8gbmVlZCB0byBjaGVjayBmb3IgYWxlcnQgd2hpbGUgdGhlIGF0b20gaXMgYmVpbmcgZXhlY3V0ZWQuXG4gIC8vIHNvIG5vdGlmeSBvdXJzZWx2ZXMgd2hlbiBpdCBoYXBwZW5zXG4gIGxldCBkb25lID0gZmFsc2U7XG4gIGxldCBlcnJvciA9IG51bGw7XG4gIHByb21pc2UudGhlbigocmVzKSA9PiB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgcHJvbWlzZS9wcmVmZXItYXdhaXQtdG8tdGhlblxuICAgIGRvbmUgPSB0cnVlO1xuICAgIHJldHVybiByZXM7XG4gIH0pXG4gIC5jYXRjaCgoZXJyKSA9PiB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgcHJvbWlzZS9wcmVmZXItYXdhaXQtdG8tY2FsbGJhY2tzXG4gICAgbG9nZ2VyLmRlYnVnKGBFcnJvciByZWNlaXZlZCB3aGlsZSBleGVjdXRpbmcgYXRvbTogJHtlcnIubWVzc2FnZX1gKTtcbiAgICAvLyBlcnJvciBnZXRzIHN3YWxsb3dlZCwgc28gc2F2ZSBhbmQgY2hlY2sgbGF0ZXJcbiAgICBkb25lID0gdHJ1ZTtcbiAgICBlcnJvciA9IGVycjtcbiAgfSk7XG4gIC8vIHRyeSB0ZW4gdGltZXMgdG8gY2hlY2sgYWxlcnQsIGlmIHdlIGFyZSBub3QgZG9uZSB5ZXRcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMDsgaSsrKSB7XG4gICAgLy8gY2hlY2sgaWYgdGhlIHByb21pc2UgaGFzIGJlZW4gcmVzb2x2ZWRcbiAgICBpZiAoZG9uZSkgYnJlYWs7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgY3VybHlcbiAgICBhd2FpdCBCLmRlbGF5KDUwMCk7XG4gICAgaWYgKGRvbmUpIGJyZWFrOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIGN1cmx5XG4gICAgLy8gY2hlY2sgaWYgdGhlcmUgaXMgYW4gYWxlcnRcbiAgICBpZiAoYXdhaXQgdGhpcy5jaGVja0ZvckFsZXJ0KCkpIHtcbiAgICAgIC8vIHdlIGZvdW5kIGFuIGFsZXJ0LCBhbmQgc2hvdWxkIGp1c3QgcmV0dXJuIGNvbnRyb2xcbiAgICAgIHJldHVybiAnJztcbiAgICB9XG4gIH1cblxuICBsZXQgcmVzID0gYXdhaXQgcHJvbWlzZTtcbiAgaWYgKGVycm9yKSB7XG4gICAgdGhyb3cgZXJyb3I7XG4gIH1cbiAgcmV0dXJuIHRoaXMucGFyc2VFeGVjdXRlUmVzcG9uc2UocmVzKTtcbn07XG5cbmhlbHBlcnMuY2hlY2tGb3JBbGVydCA9IGFzeW5jIGZ1bmN0aW9uIGNoZWNrRm9yQWxlcnQgKCkge1xuICBpZiAoIV8uaXNOdWxsKHRoaXMudWlBdXRvQ2xpZW50KSkge1xuICAgIGxvZ2dlci5kZWJ1ZygnYXRvbSBkaWQgbm90IHJldHVybiB5ZXQsIGNoZWNraW5nIHRvIHNlZSBpZiAnICtcbiAgICAgICAgICAgICAgICAgJ3dlIGFyZSBibG9ja2VkIGJ5IGFuIGFsZXJ0Jyk7XG4gICAgbGV0IHByZXNlbnQgPSBhd2FpdCB0aGlzLnVpQXV0b0NsaWVudC5zZW5kQ29tbWFuZCgnYXUuYWxlcnRJc1ByZXNlbnQoKScpO1xuICAgIGlmICghcHJlc2VudCkge1xuICAgICAgbG9nZ2VyLmRlYnVnKCdObyBhbGVydCBmb3VuZC4nKTtcbiAgICB9IGVsc2Uge1xuICAgICAgbG9nZ2VyLmRlYnVnKCdGb3VuZCBhbiBhbGVydCwgcmV0dXJuaW5nIGNvbnRyb2wgdG8gY2xpZW50Jyk7XG4gICAgfVxuICAgIHJldHVybiBwcmVzZW50O1xuICB9XG59O1xuXG5oZWxwZXJzLmdldEF0b21zRWxlbWVudCA9IGZ1bmN0aW9uIGdldEF0b21zRWxlbWVudCAod2RJZCkge1xuICBsZXQgYXRvbXNJZDtcbiAgdHJ5IHtcbiAgICBhdG9tc0lkID0gdGhpcy53ZWJFbGVtZW50SWRzW3BhcnNlSW50KHdkSWQsIDEwKSAtIEVMRU1FTlRfT0ZGU0VUXTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIHJldHVybiBudWxsO1xuICB9XG4gIGlmIChfLmlzVW5kZWZpbmVkKGF0b21zSWQpKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbiAgcmV0dXJuIHtFTEVNRU5UOiBhdG9tc0lkfTtcbn07XG5cbmhlbHBlcnMudXNlQXRvbXNFbGVtZW50ID0gZnVuY3Rpb24gdXNlQXRvbXNFbGVtZW50IChlbCkge1xuICBpZiAocGFyc2VJbnQoZWwsIDEwKSA8IEVMRU1FTlRfT0ZGU0VUKSB7XG4gICAgbG9nZ2VyLmRlYnVnKGBFbGVtZW50IHdpdGggaWQgJyR7ZWx9JyBwYXNzZWQgaW4gZm9yIHVzZSB3aXRoIGAgK1xuICAgICAgICAgICAgICAgICBgYXRvbXMsIGJ1dCBpdCdzIG91dCBvZiBvdXIgaW50ZXJuYWwgc2NvcGUuIEFkZGluZyAke0VMRU1FTlRfT0ZGU0VUfS5gKTtcbiAgICBlbCA9IChwYXJzZUludChlbCwgMTApICsgRUxFTUVOVF9PRkZTRVQpLnRvU3RyaW5nKCk7XG4gIH1cbiAgbGV0IGF0b21zRWxlbWVudCA9IHRoaXMuZ2V0QXRvbXNFbGVtZW50KGVsKTtcbiAgaWYgKGF0b21zRWxlbWVudCA9PT0gbnVsbCkge1xuICAgIHRocm93IG5ldyBlcnJvcnMuVW5rbm93bkVycm9yKGBFcnJvciBjb252ZXJ0aW5nIGVsZW1lbnQgSUQgZm9yIHVzaW5nIGluIFdEIGF0b21zOiAnJHtlbH0nYCk7XG4gIH1cbiAgcmV0dXJuIGF0b21zRWxlbWVudDtcbn07XG5cbmhlbHBlcnMuY29udmVydEVsZW1lbnRzRm9yQXRvbXMgPSBmdW5jdGlvbiBjb252ZXJ0RWxlbWVudHNGb3JBdG9tcyAoYXJncyA9IFtdKSB7XG4gIGNvbnN0IHJlc3VsdEFyZ3MgPSBbXTtcbiAgZm9yIChjb25zdCBhcmcgb2YgYXJncykge1xuICAgIGlmIChoZWxwZXJzLmhhc0VsZW1lbnRJZChhcmcpKSB7XG4gICAgICAvLyBHZXQgdGhlIGVsZW1lbnQga2V5IGZyb20gVzNDIG9yIE1KU09OV1Aga2V5XG4gICAgICBjb25zdCBlbGVtZW50SWQgPSBoZWxwZXJzLmdldEVsZW1lbnRJZChhcmcpO1xuICAgICAgY29uc3QgYXRvbXNFbGVtZW50ID0gdGhpcy5nZXRBdG9tc0VsZW1lbnQoZWxlbWVudElkKTtcbiAgICAgIGlmIChhdG9tc0VsZW1lbnQgPT09IG51bGwpIHtcbiAgICAgICAgdGhyb3cgbmV3IGVycm9ycy5Vbmtub3duRXJyb3IoYEVycm9yIGNvbnZlcnRpbmcgZWxlbWVudCBJRCBmb3IgdXNpbmcgaW4gV0QgYXRvbXM6ICcke2VsZW1lbnRJZH0nYCk7XG4gICAgICB9XG4gICAgICByZXN1bHRBcmdzLnB1c2goYXRvbXNFbGVtZW50KTtcbiAgICB9IGVsc2UgaWYgKF8uaXNBcnJheShhcmcpKSB7XG4gICAgICByZXN1bHRBcmdzLnB1c2godGhpcy5jb252ZXJ0RWxlbWVudHNGb3JBdG9tcyhhcmcpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmVzdWx0QXJncy5wdXNoKGFyZyk7XG4gICAgfVxuICB9XG4gIHJldHVybiByZXN1bHRBcmdzO1xufTtcblxuaGVscGVycy5wYXJzZUV4ZWN1dGVSZXNwb25zZSA9IGZ1bmN0aW9uIHBhcnNlRXhlY3V0ZVJlc3BvbnNlIChyZXMpIHtcbiAgaWYgKF8uaXNOdWxsKHJlcykgfHwgXy5pc1VuZGVmaW5lZChyZXMpKSByZXR1cm4gbnVsbDsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBjdXJseVxuXG4gIGxldCB3ZEVsZW1lbnQgPSBudWxsO1xuICBpZiAoIV8uaXNBcnJheShyZXMpKSB7XG4gICAgaWYgKGhlbHBlcnMuaGFzRWxlbWVudElkKHJlcykpIHtcbiAgICAgIHdkRWxlbWVudCA9IHRoaXMucGFyc2VFbGVtZW50UmVzcG9uc2UocmVzKTtcbiAgICAgIGlmICh3ZEVsZW1lbnQgPT09IG51bGwpIHtcbiAgICAgICAgdGhyb3cgbmV3IGVycm9ycy5Vbmtub3duRXJyb3IoYEVycm9yIGNvbnZlcnRpbmcgZWxlbWVudCBJRCBhdG9tIGZvciB1c2luZyBpbiBXRDogJyR7aGVscGVycy5nZXRFbGVtZW50SWQocmVzKX0nYCk7XG4gICAgICB9XG4gICAgICByZXMgPSB3ZEVsZW1lbnQ7XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIC8vIHZhbHVlIGlzIGFuIGFycmF5LCBzbyBnbyB0aHJvdWdoIGFuZCBjb252ZXJ0IGVhY2hcbiAgICBsZXQgYXJncyA9IFtdO1xuICAgIGZvciAobGV0IGFyZyBvZiByZXMpIHtcbiAgICAgIHdkRWxlbWVudCA9IGFyZztcbiAgICAgIGlmIChoZWxwZXJzLmhhc0VsZW1lbnRJZChhcmcpKSB7XG4gICAgICAgIHdkRWxlbWVudCA9IHRoaXMucGFyc2VFbGVtZW50UmVzcG9uc2UoYXJnKTtcbiAgICAgICAgaWYgKHdkRWxlbWVudCA9PT0gbnVsbCkge1xuICAgICAgICAgIHRocm93IG5ldyBlcnJvcnMuVW5rbm93bkVycm9yKGBFcnJvciBjb252ZXJ0aW5nIGVsZW1lbnQgSUQgYXRvbSBmb3IgdXNpbmcgaW4gV0Q6ICcke2hlbHBlcnMuZ2V0RWxlbWVudElkKGFyZyl9J2ApO1xuICAgICAgICB9XG4gICAgICAgIGFyZ3MucHVzaCh3ZEVsZW1lbnQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYXJncy5wdXNoKGFyZyk7XG4gICAgICB9XG4gICAgfVxuICAgIHJlcyA9IGFyZ3M7XG4gIH1cbiAgcmV0dXJuIHJlcztcbn07XG5cbmhlbHBlcnMucGFyc2VFbGVtZW50UmVzcG9uc2UgPSBmdW5jdGlvbiBwYXJzZUVsZW1lbnRSZXNwb25zZSAoZWxlbWVudCkge1xuICBsZXQgb2JqSWQgPSBoZWxwZXJzLmdldEVsZW1lbnRJZChlbGVtZW50KTtcbiAgbGV0IGNsaWVudElkID0gKEVMRU1FTlRfT0ZGU0VUICsgdGhpcy53ZWJFbGVtZW50SWRzLmxlbmd0aCkudG9TdHJpbmcoKTtcbiAgdGhpcy53ZWJFbGVtZW50SWRzLnB1c2gob2JqSWQpO1xuICByZXR1cm4ge0VMRU1FTlQ6IGNsaWVudElkfTtcbn07XG5cbmhlbHBlcnMuZ2V0RWxlbWVudElkID0gZnVuY3Rpb24gZ2V0RWxlbWVudElkIChlbGVtZW50KSB7XG4gIHJldHVybiBlbGVtZW50LkVMRU1FTlQgfHwgZWxlbWVudFtXM0NfV0VCX0VMRU1FTlRfSURFTlRJRklFUl07XG59O1xuXG5oZWxwZXJzLmhhc0VsZW1lbnRJZCA9IGZ1bmN0aW9uIGhhc0VsZW1lbnRJZCAoZWxlbWVudCkge1xuICByZXR1cm4gdXRpbC5oYXNWYWx1ZShlbGVtZW50KSAmJiAodXRpbC5oYXNWYWx1ZShlbGVtZW50LkVMRU1FTlQpIHx8IHV0aWwuaGFzVmFsdWUoZWxlbWVudFtXM0NfV0VCX0VMRU1FTlRfSURFTlRJRklFUl0pKTtcbn07XG5cblxuT2JqZWN0LmFzc2lnbihleHRlbnNpb25zLCBjb21tYW5kcywgaGVscGVycyk7XG5leHBvcnQgeyBjb21tYW5kcywgaGVscGVycyB9O1xuZXhwb3J0IGRlZmF1bHQgZXh0ZW5zaW9ucztcbiJdLCJmaWxlIjoibGliL2NvbW1hbmRzL3dlYi5qcyIsInNvdXJjZVJvb3QiOiIuLi8uLi8uLiJ9
