"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.WEBVIEW_BASE = exports.WEBVIEW_WIN = exports.NATIVE_WIN = exports.helpers = exports.commands = void 0;

require("source-map-support/register");

var _lodash = _interopRequireDefault(require("lodash"));

var _bluebird = _interopRequireDefault(require("bluebird"));

var _asyncbox = require("asyncbox");

var _appiumRemoteDebugger = require("appium-remote-debugger");

var _iosPerformanceLog = _interopRequireDefault(require("../device-log/ios-performance-log"));

var _appiumBaseDriver = require("appium-base-driver");

var _logger = _interopRequireDefault(require("../logger"));

var _appiumSupport = require("appium-support");

const NATIVE_WIN = 'NATIVE_APP';
exports.NATIVE_WIN = NATIVE_WIN;
const WEBVIEW_WIN = 'WEBVIEW';
exports.WEBVIEW_WIN = WEBVIEW_WIN;
const WEBVIEW_BASE = `${WEBVIEW_WIN}_`;
exports.WEBVIEW_BASE = WEBVIEW_BASE;
let commands = {},
    helpers = {},
    extensions = {};
exports.helpers = helpers;
exports.commands = commands;

commands.getCurrentContext = async function getCurrentContext() {
  if (this.curContext && this.curContext !== NATIVE_WIN) {
    return `${WEBVIEW_BASE}${this.curContext}`;
  } else {
    return NATIVE_WIN;
  }
};

commands.getContexts = async function getContexts() {
  _logger.default.debug('Getting list of available contexts');

  let contexts = await this.getContextsAndViews(false);

  let mapFn = context => context.id.toString();

  if (this.opts.fullContextList) {
    mapFn = context => {
      return {
        id: context.id.toString(),
        title: context.view.title,
        url: context.view.url
      };
    };
  }

  return contexts.map(mapFn);
};

commands.setContext = async function setContext(name, callback, skipReadyCheck) {
  function alreadyInContext(desired, current) {
    return desired === current || desired === null && current === NATIVE_WIN || desired === NATIVE_WIN && current === null;
  }

  _logger.default.debug(`Attempting to set context to '${name}'`);

  if (alreadyInContext(name, this.curContext)) {} else if (name === NATIVE_WIN || name === null) {
    this.curContext = null;

    if (this.isRealDevice()) {
      this.remote.disconnect();
    }
  } else {
    if (_lodash.default.isUndefined(this.contexts)) {
      await this.getContexts();
    }

    let contextId = name.replace(WEBVIEW_BASE, '');

    if (contextId === '') {
      contextId = this.contexts[1];
    }

    if (!_lodash.default.includes(this.contexts, contextId)) {
      throw new _appiumBaseDriver.errors.NoSuchContextError();
    }

    if (this.isRealDevice()) {
      if (this.remote) {
        await this.remote.disconnect();
      }

      this.curContext = contextId;
      await this.remote.connect(contextId);
    } else {
      let [appIdKey, pageIdKey] = _lodash.default.map(contextId.split('.'), id => parseInt(id, 10));

      await this.remote.selectPage(appIdKey, pageIdKey, skipReadyCheck);
      this.curContext = contextId;
    }
  }

  if (this.opts.enablePerformanceLogging && this.remote) {
    _logger.default.debug(`Starting performance log on '${this.curContext}'`);

    this.logs.performance = new _iosPerformanceLog.default(this.remote);
    await this.logs.performance.startCapture();
  }
};

commands.getWindowHandle = async function getWindowHandle() {
  if (!this.isWebContext()) {
    throw new _appiumBaseDriver.errors.NotImplementedError();
  }

  return this.curContext.toString();
};

commands.getWindowHandles = async function getWindowHandles() {
  if (!this.isWebContext()) {
    throw new _appiumBaseDriver.errors.NotImplementedError();
  }

  this.windowHandleCache = await this.listWebFrames(false);

  const idArray = _lodash.default.map(this.windowHandleCache, 'id');

  if (!this.contexts) {
    this.contexts = idArray;
  }

  return _lodash.default.map(idArray, id => id.toString());
};

commands.setWindow = async function setWindow(name, skipReadyCheck) {
  if (!this.isWebContext()) {
    throw new _appiumBaseDriver.errors.NotImplementedError();
  }

  if (!_lodash.default.includes(_lodash.default.map(this.windowHandleCache, 'id'), name)) {
    throw new _appiumBaseDriver.errors.NoSuchWindowError();
  }

  let pageIdKey = parseInt(name, 10);

  if (!this.isRealDevice()) {
    await this.remote.selectPage(pageIdKey, skipReadyCheck);
    this.curContext = this.curWindowHandle = name;
  } else {
    if (name === this.curWindowHandle) {
      _logger.default.debug(`Remote debugger is already connected to window '${name}'`);
    } else if (!_lodash.default.includes(_lodash.default.map(this.windowHandleCache, 'id'), name)) {
      throw new _appiumBaseDriver.errors.NoSuchWindowError();
    } else {
      await this.remote.disconnect();
      this.curContext = this.curWindowHandle = name;
      await this.remote.connect(name);
    }
  }
};

helpers.webContextIndex = function webContextIndex() {
  return this.curContext.replace(WEBVIEW_BASE, '') - 1;
};

extensions.initAutoWebview = async function initAutoWebview() {
  if (this.opts.autoWebview) {
    _logger.default.debug('Setting auto webview');

    await this.navToInitialWebview(this);
  }
};

extensions.getContextsAndViews = async function getContextsAndViews(useUrl = true) {
  _logger.default.debug('Retrieving contexts and views');

  let webviews = await this.listWebFrames(useUrl);
  let ctxs = [{
    id: NATIVE_WIN,
    view: {}
  }];
  this.contexts = [NATIVE_WIN];

  for (let view of webviews) {
    ctxs.push({
      id: `${WEBVIEW_BASE}${view.id}`,
      view
    });
    this.contexts.push(view.id.toString());
  }

  return ctxs;
};

extensions.getNewRemoteDebugger = async function getNewRemoteDebugger() {
  return new _appiumRemoteDebugger.RemoteDebugger({
    bundleId: this.opts.bundleId,
    useNewSafari: this.useNewSafari(),
    pageLoadMs: this.pageLoadMs,
    platformVersion: this.opts.platformVersion,
    isSafari: this.isSafari(),
    remoteDebugProxy: this.opts.remoteDebugProxy,
    garbageCollectOnExecute: false,
    logFullResponse: !!this.opts.safariShowFullResponse
  });
};

extensions.listWebFrames = async function listWebFrames(useUrl = true) {
  if (!this.opts.bundleId) {
    _logger.default.errorAndThrow('Cannot enter web frame without a bundle ID');
  }

  useUrl = useUrl && !!this.getCurrentUrl();

  _logger.default.debug(`Selecting by url: ${useUrl} ${useUrl ? `(expected url: '${this.getCurrentUrl()}')` : ''}`);

  let currentUrl = useUrl ? this.getCurrentUrl() : undefined;
  let pageArray;

  if (this.isRealDevice() && this.remote && this.opts.bundleId) {
    pageArray = await this.remote.pageArrayFromJson(this.opts.ignoreAboutBlankUrl);
  } else if (this.remote && this.remote.appIdKey) {
    pageArray = await this.remote.selectApp(currentUrl, this.opts.webviewConnectRetries, this.opts.ignoreAboutBlankUrl);
  } else if (this.isRealDevice()) {
    try {
      this.remote = new _appiumRemoteDebugger.WebKitRemoteDebugger({
        port: this.opts.webkitDebugProxyPort,
        webkitResponseTimeout: this.opts.webkitResponseTimeout,
        platformVersion: this.opts.platformVersion,
        isSafari: this.isSafari(),
        garbageCollectOnExecute: false,
        logFullResponse: !!this.opts.safariShowFullResponse
      });
      pageArray = await this.remote.pageArrayFromJson(this.opts.ignoreAboutBlankUrl);
    } catch (err) {
      if (!_lodash.default.includes(err.message, 'connect ECONNREFUSED')) throw err;

      _logger.default.warn('Attempted to get a list of webview contexts but could not connect to ' + 'ios-webkit-debug-proxy. If you expect to find webviews, please ensure ' + 'that the proxy is running and accessible');

      this.remote = null;
      pageArray = [];
    }
  } else {
    this.remote = await this.getNewRemoteDebugger();
    let appInfo = await this.remote.connect();

    if (!appInfo) {
      _logger.default.debug('Unable to connect to the remote debugger.');

      return [];
    }

    pageArray = await this.remote.selectApp(currentUrl, this.opts.webviewConnectRetries, this.opts.ignoreAboutBlankUrl);
    this.remote.on(_appiumRemoteDebugger.RemoteDebugger.EVENT_PAGE_CHANGE, this.onPageChange.bind(this));
    this.remote.on(_appiumRemoteDebugger.RemoteDebugger.EVENT_FRAMES_DETACHED, () => {
      if (!_lodash.default.isEmpty(this.curWebFrames)) {
        _logger.default.debug(`Clearing ${this.curWebFrames.length} frames: ${this.curWebFrames.join(', ')}`);
      }

      this.curWebFrames = [];
    });

    let tryClosingAlert = async () => {
      let didDismiss = await this.closeAlertBeforeTest();

      if (!didDismiss) {
        throw new Error('Close alert failed. Retry.');
      }
    };

    try {
      await (0, _asyncbox.retryInterval)(3, 4000, tryClosingAlert);
    } catch (err) {
      if (err.message !== 'Close alert failed. Retry.') {
        _logger.default.errorAndThrow(err);
      }
    }
  }

  if (pageArray.length === 0) {
    _logger.default.debug('No web frames found.');
  }

  return pageArray;
};

extensions.onPageChange = async function onPageChange(pageChangeNotification) {
  _logger.default.debug(`Remote debugger notified us of a new page listing: ${JSON.stringify(pageChangeNotification)}`);

  if (this.selectingNewPage) {
    _logger.default.debug('We are in the middle of selecting a page, ignoring');

    return;
  }

  if (!this.remote || !this.remote.isConnected()) {
    _logger.default.debug('We have not yet connected, ignoring');

    return;
  }

  const {
    appIdKey,
    pageArray
  } = pageChangeNotification;
  let newIds = [];
  let newPages = [];
  let keyId = null;

  for (const page of pageArray) {
    const id = page.id.toString();
    newIds.push(id);

    if (page.isKey) {
      keyId = id;
    }

    const contextId = `${appIdKey}.${id}`;

    if (!_lodash.default.includes(this.contexts, contextId)) {
      newPages.push(id);
      this.contexts.push(contextId);
    }
  }

  if (!keyId) {
    _logger.default.debug('No key id found. Choosing first id from page array');

    keyId = newIds[0] || null;
  }

  if (!_appiumSupport.util.hasValue(this.curContext)) {
    _logger.default.debug('We do not appear to have window set yet, ignoring');

    return;
  }

  const [curAppIdKey, curPageIdKey] = this.curContext.split('.');

  if (curAppIdKey !== appIdKey) {
    _logger.default.debug('Page change not referring to currently selected app, ignoring.');

    return;
  }

  let newPage = null;

  if (newPages.length) {
    newPage = _lodash.default.last(newPages);

    _logger.default.debug(`We have new pages, selecting page '${newPage}'`);
  } else if (!_lodash.default.includes(newIds, curPageIdKey)) {
    _logger.default.debug('New page listing from remote debugger does not contain ' + 'current window; assuming it is closed');

    if (!_appiumSupport.util.hasValue(keyId)) {
      _logger.default.error('Do not have our current window anymore, and there ' + 'are not any more to load! Doing nothing...');

      this.setCurrentUrl(undefined);
      return;
    }

    _logger.default.debug(`Debugger already selected page '${keyId}', ` + `confirming that choice.`);

    this.curContext = `${appIdKey}.${keyId}`;
    newPage = keyId;
  } else {
    _logger.default.debug('Checking if page needs to load');

    const needsPageLoad = (() => {
      const contextArray = _lodash.default.map(pageArray, page => `${appIdKey}.${page.id}`);

      return !_lodash.default.isEqual(_lodash.default.find(this.contexts, this.curContext), _lodash.default.find(contextArray, this.curContext));
    })();

    if (needsPageLoad) {
      _logger.default.debug('Page load needed. Loading...');

      await this.remote.pageLoad();
    }

    _logger.default.debug('New page listing is same as old, doing nothing');
  }

  if (_appiumSupport.util.hasValue(this.curContext)) {
    let currentPageId = parseInt(_lodash.default.last(this.curContext.split('.')), 10);

    let page = _lodash.default.find(pageArray, p => parseInt(p.id, 10) === currentPageId);

    if (page && page.url !== this.getCurrentUrl()) {
      _logger.default.debug(`Redirected from '${this.getCurrentUrl()}' to '${page.url}'`);

      this.setCurrentUrl(page.url);
    }
  }

  if (_appiumSupport.util.hasValue(newPage)) {
    this.selectingNewPage = true;
    await this.remote.selectPage(appIdKey, parseInt(newPage, 10));
    this.selectingNewPage = false;
    this.curContext = `${appIdKey}.${newPage}`;
  }

  this.windowHandleCache = pageArray;
};

extensions.getLatestWebviewContextForTitle = async function getLatestWebviewContextForTitle(regExp) {
  let contexts = await this.getContextsAndViews();
  let matchingCtx;

  for (let ctx of contexts) {
    if (ctx.view && (ctx.view.title && ctx.view.title.match(regExp) || ctx.view.url && ctx.view.url.match(regExp))) {
      if (ctx.view.url !== 'about:blank') {
        matchingCtx = ctx;
      } else {
        if (parseFloat(this.iosSdkVersion) < 7 || parseFloat(this.iosSdkVersion) >= 9 || this.opts.platformVersion === '7.1' && this.opts.app && this.opts.app.toLowerCase() !== 'safari') {
          matchingCtx = ctx;
        }
      }

      break;
    }
  }

  return matchingCtx ? matchingCtx.id : undefined;
};

extensions.useNewSafari = function useNewSafari() {
  return parseFloat(this.iosSdkVersion) >= 8.1 && parseFloat(this.opts.platformVersion) >= 8.1 && !this.isRealDevice() && this.opts.safari;
};

extensions.navToInitialWebview = async function navToInitialWebview() {
  let timeout = 0;

  if (this.isRealDevice()) {
    timeout = 3000;

    _logger.default.debug(`Waiting for ${timeout} ms before navigating to view.`);
  }

  await _bluebird.default.delay(timeout);

  if (this.useNewSafari()) {
    await this.typeAndNavToUrl();
  } else if (parseInt(this.iosSdkVersion, 10) >= 7 && !this.isRealDevice() && this.opts.safari) {
    await this.navToViewThroughFavorites();
  } else {
    await this.navToViewWithTitle(/.*/);
  }
};

async function openNewPage() {
  let newPageButton = await this.findElement('xpath', "//UIAButton[contains(@name,'New page')]");
  await this.nativeTap(newPageButton.ELEMENT);
}

extensions.typeAndNavToUrl = async function typeAndNavToUrl() {
  let address = this.opts.address ? this.opts.address : '127.0.0.1';
  this.setCurrentUrl(this.caps.safariInitialUrl || `http://${address}:${this.opts.port}/welcome`);
  let tries = 0;
  const MAX_TRIES = 2;

  let navigate = async () => {
    let oldImpWait = this.implicitWaitMs;
    this.implicitWaitMs = 7000;
    let el = await (0, _asyncbox.retryInterval)(3, 1000, async () => {
      return await this.findElement('accessibility id', 'URL');
    });
    this.implicitWaitMs = oldImpWait;

    try {
      await this.nativeTap(el.ELEMENT);
    } catch (err) {
      if (_lodash.default.includes(err.message, 'could not be tapped')) {
        if (tries++ >= MAX_TRIES) throw err;
        await openNewPage();
        return await navigate();
      } else {
        throw err;
      }
    }

    try {
      let el = await this.findElement('class name', 'UIATextField');
      await this.setValueImmediate(this.getCurrentUrl(), el);
    } catch (err) {
      if (tries++ >= MAX_TRIES) throw err;
      return await navigate();
    }

    try {
      el = await this.findElement('accessibility id', 'Go');
      await this.nativeTap(el.ELEMENT);
    } catch (err) {
      if (_lodash.default.includes(err.message, 'could not be tapped')) {
        _logger.default.error('Unable to submit URL because \'Go\' button could not be tapped. ' + 'Please make sure your keyboard is toggled on.');
      }

      throw err;
    }

    await this.navToViewWithTitle(undefined, new RegExp(this.getCurrentUrl(), 'i'));
    await this.remote.pageUnload();
  };

  await navigate();
};

extensions.navToViewThroughFavorites = async function navToViewThroughFavorites() {
  _logger.default.debug('We are on iOS7+ simulator: clicking apple button to get into a webview');

  let oldImpWait = this.implicitWaitMs;
  this.implicitWaitMs = 7000;
  let el;

  try {
    el = await this.findElement('xpath', '//UIAScrollView[1]/UIAButton[1]');
  } catch (err) {
    let msg = 'Could not find button to click to get into webview. ' + 'Proceeding on the assumption we have a working one.';

    _logger.default.error(msg);

    this.implicitWaitMs = oldImpWait;
    return await this.navToViewWithTitle(/.*/i);
  }

  this.implicitWaitMs = oldImpWait;

  try {
    await this.nativeTap(el.ELEMENT);
  } catch (err) {
    let msg = 'Could not click button to get into webview. ' + 'Proceeding on the assumption we have a working one.';

    _logger.default.error(msg);
  }

  await this.navToViewWithTitle(/apple/i);
};

extensions.navToViewWithTitle = async function navToViewWithTitle(titleRegex, urlRegExp) {
  _logger.default.debug('Navigating to most recently opened webview');

  let start = Date.now();
  let spinTime = 500;

  let spinHandles = async () => {
    let res;

    try {
      res = await this.getLatestWebviewContextForTitle(titleRegex || urlRegExp);
    } catch (err) {
      if (!err.message.includes('Could not connect to a valid app after')) {
        const error = new Error(`Could not navigate to webview! Err: ${err.message}`);
        error.stack += `\nCaused by: ${err.stack}`;
        throw error;
      }

      _logger.default.debug('Could not navigate to webview. Retrying if possible.');
    }

    if (res) {
      let latestWindow = res;

      _logger.default.debug(`Picking webview '${latestWindow}'`);

      await this.setContext(latestWindow);
      await this.remote.cancelPageLoad();
      return;
    }

    if (Date.now() - start >= 90000) {
      throw new Error('Could not navigate to webview; there are none!');
    }

    _logger.default.warn('Could not find any webviews yet, refreshing/retrying');

    if (this.isRealDevice() || !this.opts.safari) {
      await _bluebird.default.delay(spinTime);
      return await spinHandles();
    }

    let element;

    try {
      _logger.default.debug('Finding and tapping reload button');

      element = await this.findUIElementOrElements('accessibility id', 'ReloadButton', '', false);
      await this.nativeTap(element.ELEMENT);
    } catch (err) {
      _logger.default.warn(`Error finding and tapping reload button: ${err.message}`);

      _logger.default.warn('Retrying.');

      await _bluebird.default.delay(spinTime);
    }

    return await spinHandles();
  };

  await spinHandles();
};

helpers.closeAlertBeforeTest = async function closeAlertBeforeTest() {
  let present = await this.uiAutoClient.sendCommand('au.alertIsPresent()');

  if (!present) {
    return false;
  }

  _logger.default.debug('Alert present before starting test, let us banish it');

  await this.uiAutoClient.sendCommand('au.dismissAlert()');

  _logger.default.debug('Alert banished!');

  return true;
};

helpers.stopRemote = async function stopRemote(closeWindowBeforeDisconnecting = false) {
  if (!this.remote) {
    _logger.default.errorAndThrow('Tried to leave a web frame but were not in one');
  }

  if (closeWindowBeforeDisconnecting) {
    await this.closeWindow();
  }

  await this.remote.disconnect();
  this.curContext = null;
  this.curWebFrames = [];
  this.curWebCoords = null;
  this.remote = null;
};

helpers.isWebContext = function isWebContext() {
  return !!this.curContext && this.curContext !== NATIVE_WIN;
};

helpers.setCurrentUrl = function setCurrentUrl(url) {
  this._currentUrl = url;
};

helpers.getCurrentUrl = function getCurrentUrl() {
  return this._currentUrl;
};

Object.assign(extensions, commands, helpers);
var _default = extensions;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jb21tYW5kcy9jb250ZXh0LmpzIl0sIm5hbWVzIjpbIk5BVElWRV9XSU4iLCJXRUJWSUVXX1dJTiIsIldFQlZJRVdfQkFTRSIsImNvbW1hbmRzIiwiaGVscGVycyIsImV4dGVuc2lvbnMiLCJnZXRDdXJyZW50Q29udGV4dCIsImN1ckNvbnRleHQiLCJnZXRDb250ZXh0cyIsImxvZ2dlciIsImRlYnVnIiwiY29udGV4dHMiLCJnZXRDb250ZXh0c0FuZFZpZXdzIiwibWFwRm4iLCJjb250ZXh0IiwiaWQiLCJ0b1N0cmluZyIsIm9wdHMiLCJmdWxsQ29udGV4dExpc3QiLCJ0aXRsZSIsInZpZXciLCJ1cmwiLCJtYXAiLCJzZXRDb250ZXh0IiwibmFtZSIsImNhbGxiYWNrIiwic2tpcFJlYWR5Q2hlY2siLCJhbHJlYWR5SW5Db250ZXh0IiwiZGVzaXJlZCIsImN1cnJlbnQiLCJpc1JlYWxEZXZpY2UiLCJyZW1vdGUiLCJkaXNjb25uZWN0IiwiXyIsImlzVW5kZWZpbmVkIiwiY29udGV4dElkIiwicmVwbGFjZSIsImluY2x1ZGVzIiwiZXJyb3JzIiwiTm9TdWNoQ29udGV4dEVycm9yIiwiY29ubmVjdCIsImFwcElkS2V5IiwicGFnZUlkS2V5Iiwic3BsaXQiLCJwYXJzZUludCIsInNlbGVjdFBhZ2UiLCJlbmFibGVQZXJmb3JtYW5jZUxvZ2dpbmciLCJsb2dzIiwicGVyZm9ybWFuY2UiLCJJT1NQZXJmb3JtYW5jZUxvZyIsInN0YXJ0Q2FwdHVyZSIsImdldFdpbmRvd0hhbmRsZSIsImlzV2ViQ29udGV4dCIsIk5vdEltcGxlbWVudGVkRXJyb3IiLCJnZXRXaW5kb3dIYW5kbGVzIiwid2luZG93SGFuZGxlQ2FjaGUiLCJsaXN0V2ViRnJhbWVzIiwiaWRBcnJheSIsInNldFdpbmRvdyIsIk5vU3VjaFdpbmRvd0Vycm9yIiwiY3VyV2luZG93SGFuZGxlIiwid2ViQ29udGV4dEluZGV4IiwiaW5pdEF1dG9XZWJ2aWV3IiwiYXV0b1dlYnZpZXciLCJuYXZUb0luaXRpYWxXZWJ2aWV3IiwidXNlVXJsIiwid2Vidmlld3MiLCJjdHhzIiwicHVzaCIsImdldE5ld1JlbW90ZURlYnVnZ2VyIiwiUmVtb3RlRGVidWdnZXIiLCJidW5kbGVJZCIsInVzZU5ld1NhZmFyaSIsInBhZ2VMb2FkTXMiLCJwbGF0Zm9ybVZlcnNpb24iLCJpc1NhZmFyaSIsInJlbW90ZURlYnVnUHJveHkiLCJnYXJiYWdlQ29sbGVjdE9uRXhlY3V0ZSIsImxvZ0Z1bGxSZXNwb25zZSIsInNhZmFyaVNob3dGdWxsUmVzcG9uc2UiLCJlcnJvckFuZFRocm93IiwiZ2V0Q3VycmVudFVybCIsImN1cnJlbnRVcmwiLCJ1bmRlZmluZWQiLCJwYWdlQXJyYXkiLCJwYWdlQXJyYXlGcm9tSnNvbiIsImlnbm9yZUFib3V0QmxhbmtVcmwiLCJzZWxlY3RBcHAiLCJ3ZWJ2aWV3Q29ubmVjdFJldHJpZXMiLCJXZWJLaXRSZW1vdGVEZWJ1Z2dlciIsInBvcnQiLCJ3ZWJraXREZWJ1Z1Byb3h5UG9ydCIsIndlYmtpdFJlc3BvbnNlVGltZW91dCIsImVyciIsIm1lc3NhZ2UiLCJ3YXJuIiwiYXBwSW5mbyIsIm9uIiwiRVZFTlRfUEFHRV9DSEFOR0UiLCJvblBhZ2VDaGFuZ2UiLCJiaW5kIiwiRVZFTlRfRlJBTUVTX0RFVEFDSEVEIiwiaXNFbXB0eSIsImN1cldlYkZyYW1lcyIsImxlbmd0aCIsImpvaW4iLCJ0cnlDbG9zaW5nQWxlcnQiLCJkaWREaXNtaXNzIiwiY2xvc2VBbGVydEJlZm9yZVRlc3QiLCJFcnJvciIsInBhZ2VDaGFuZ2VOb3RpZmljYXRpb24iLCJKU09OIiwic3RyaW5naWZ5Iiwic2VsZWN0aW5nTmV3UGFnZSIsImlzQ29ubmVjdGVkIiwibmV3SWRzIiwibmV3UGFnZXMiLCJrZXlJZCIsInBhZ2UiLCJpc0tleSIsInV0aWwiLCJoYXNWYWx1ZSIsImN1ckFwcElkS2V5IiwiY3VyUGFnZUlkS2V5IiwibmV3UGFnZSIsImxhc3QiLCJlcnJvciIsInNldEN1cnJlbnRVcmwiLCJuZWVkc1BhZ2VMb2FkIiwiY29udGV4dEFycmF5IiwiaXNFcXVhbCIsImZpbmQiLCJwYWdlTG9hZCIsImN1cnJlbnRQYWdlSWQiLCJwIiwiZ2V0TGF0ZXN0V2Vidmlld0NvbnRleHRGb3JUaXRsZSIsInJlZ0V4cCIsIm1hdGNoaW5nQ3R4IiwiY3R4IiwibWF0Y2giLCJwYXJzZUZsb2F0IiwiaW9zU2RrVmVyc2lvbiIsImFwcCIsInRvTG93ZXJDYXNlIiwic2FmYXJpIiwidGltZW91dCIsIkIiLCJkZWxheSIsInR5cGVBbmROYXZUb1VybCIsIm5hdlRvVmlld1Rocm91Z2hGYXZvcml0ZXMiLCJuYXZUb1ZpZXdXaXRoVGl0bGUiLCJvcGVuTmV3UGFnZSIsIm5ld1BhZ2VCdXR0b24iLCJmaW5kRWxlbWVudCIsIm5hdGl2ZVRhcCIsIkVMRU1FTlQiLCJhZGRyZXNzIiwiY2FwcyIsInNhZmFyaUluaXRpYWxVcmwiLCJ0cmllcyIsIk1BWF9UUklFUyIsIm5hdmlnYXRlIiwib2xkSW1wV2FpdCIsImltcGxpY2l0V2FpdE1zIiwiZWwiLCJzZXRWYWx1ZUltbWVkaWF0ZSIsIlJlZ0V4cCIsInBhZ2VVbmxvYWQiLCJtc2ciLCJ0aXRsZVJlZ2V4IiwidXJsUmVnRXhwIiwic3RhcnQiLCJEYXRlIiwibm93Iiwic3BpblRpbWUiLCJzcGluSGFuZGxlcyIsInJlcyIsInN0YWNrIiwibGF0ZXN0V2luZG93IiwiY2FuY2VsUGFnZUxvYWQiLCJlbGVtZW50IiwiZmluZFVJRWxlbWVudE9yRWxlbWVudHMiLCJwcmVzZW50IiwidWlBdXRvQ2xpZW50Iiwic2VuZENvbW1hbmQiLCJzdG9wUmVtb3RlIiwiY2xvc2VXaW5kb3dCZWZvcmVEaXNjb25uZWN0aW5nIiwiY2xvc2VXaW5kb3ciLCJjdXJXZWJDb29yZHMiLCJfY3VycmVudFVybCIsIk9iamVjdCIsImFzc2lnbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFHQSxNQUFNQSxVQUFVLEdBQUcsWUFBbkI7O0FBQ0Es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OztBQUNELFFBQU0sS0FBSzVKLE1BQUwsQ0FBWUMsVUFBWixFQUFOO0FBQ0EsT0FBS3pCLFVBQUwsR0FBa0IsSUFBbEI7QUFDQSxPQUFLZ0csWUFBTCxHQUFvQixFQUFwQjtBQUNBLE9BQUtxRixZQUFMLEdBQW9CLElBQXBCO0FBQ0EsT0FBSzdKLE1BQUwsR0FBYyxJQUFkO0FBQ0QsQ0FiRDs7QUFlQTNCLE9BQU8sQ0FBQ2dELFlBQVIsR0FBdUIsU0FBU0EsWUFBVCxHQUF5QjtBQUM5QyxTQUFPLENBQUMsQ0FBQyxLQUFLN0MsVUFBUCxJQUFxQixLQUFLQSxVQUFMLEtBQW9CUCxVQUFoRDtBQUNELENBRkQ7O0FBSUFJLE9BQU8sQ0FBQzJILGFBQVIsR0FBd0IsU0FBU0EsYUFBVCxDQUF3QjFHLEdBQXhCLEVBQTZCO0FBQ25ELE9BQUt3SyxXQUFMLEdBQW1CeEssR0FBbkI7QUFDRCxDQUZEOztBQUlBakIsT0FBTyxDQUFDNkUsYUFBUixHQUF3QixTQUFTQSxhQUFULEdBQTBCO0FBQ2hELFNBQU8sS0FBSzRHLFdBQVo7QUFDRCxDQUZEOztBQUtBQyxNQUFNLENBQUNDLE1BQVAsQ0FBYzFMLFVBQWQsRUFBMEJGLFFBQTFCLEVBQW9DQyxPQUFwQztlQUVlQyxVIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCBCIGZyb20gJ2JsdWViaXJkJztcbmltcG9ydCB7IHJldHJ5SW50ZXJ2YWwgfSBmcm9tICdhc3luY2JveCc7XG5pbXBvcnQgeyBSZW1vdGVEZWJ1Z2dlciwgV2ViS2l0UmVtb3RlRGVidWdnZXIgfSBmcm9tICdhcHBpdW0tcmVtb3RlLWRlYnVnZ2VyJztcbmltcG9ydCBJT1NQZXJmb3JtYW5jZUxvZyBmcm9tICcuLi9kZXZpY2UtbG9nL2lvcy1wZXJmb3JtYW5jZS1sb2cnO1xuaW1wb3J0IHsgZXJyb3JzIH0gZnJvbSAnYXBwaXVtLWJhc2UtZHJpdmVyJztcbmltcG9ydCBsb2dnZXIgZnJvbSAnLi4vbG9nZ2VyJztcbmltcG9ydCB7IHV0aWwgfSBmcm9tICdhcHBpdW0tc3VwcG9ydCc7XG5cblxuY29uc3QgTkFUSVZFX1dJTiA9ICdOQVRJVkVfQVBQJztcbmNvbnN0IFdFQlZJRVdfV0lOID0gJ1dFQlZJRVcnO1xuY29uc3QgV0VCVklFV19CQVNFID0gYCR7V0VCVklFV19XSU59X2A7XG5cbmxldCBjb21tYW5kcyA9IHt9LCBoZWxwZXJzID0ge30sIGV4dGVuc2lvbnMgPSB7fTtcblxuY29tbWFuZHMuZ2V0Q3VycmVudENvbnRleHQgPSBhc3luYyBmdW5jdGlvbiBnZXRDdXJyZW50Q29udGV4dCAoKSB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgcmVxdWlyZS1hd2FpdFxuICBpZiAodGhpcy5jdXJDb250ZXh0ICYmIHRoaXMuY3VyQ29udGV4dCAhPT0gTkFUSVZFX1dJTikge1xuICAgIHJldHVybiBgJHtXRUJWSUVXX0JBU0V9JHt0aGlzLmN1ckNvbnRleHR9YDtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gTkFUSVZFX1dJTjtcbiAgfVxufTtcblxuY29tbWFuZHMuZ2V0Q29udGV4dHMgPSBhc3luYyBmdW5jdGlvbiBnZXRDb250ZXh0cyAoKSB7XG4gIGxvZ2dlci5kZWJ1ZygnR2V0dGluZyBsaXN0IG9mIGF2YWlsYWJsZSBjb250ZXh0cycpO1xuICBsZXQgY29udGV4dHMgPSBhd2FpdCB0aGlzLmdldENvbnRleHRzQW5kVmlld3MoZmFsc2UpO1xuXG4gIGxldCBtYXBGbiA9IChjb250ZXh0KSA9PiBjb250ZXh0LmlkLnRvU3RyaW5nKCk7XG4gIGlmICh0aGlzLm9wdHMuZnVsbENvbnRleHRMaXN0KSB7XG4gICAgbWFwRm4gPSAoY29udGV4dCkgPT4ge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgaWQ6IGNvbnRleHQuaWQudG9TdHJpbmcoKSxcbiAgICAgICAgdGl0bGU6IGNvbnRleHQudmlldy50aXRsZSxcbiAgICAgICAgdXJsOiBjb250ZXh0LnZpZXcudXJsLFxuICAgICAgfTtcbiAgICB9O1xuICB9XG4gIHJldHVybiBjb250ZXh0cy5tYXAobWFwRm4pO1xufTtcblxuY29tbWFuZHMuc2V0Q29udGV4dCA9IGFzeW5jIGZ1bmN0aW9uIHNldENvbnRleHQgKG5hbWUsIGNhbGxiYWNrLCBza2lwUmVhZHlDaGVjaykge1xuICBmdW5jdGlvbiBhbHJlYWR5SW5Db250ZXh0IChkZXNpcmVkLCBjdXJyZW50KSB7XG4gICAgcmV0dXJuIChkZXNpcmVkID09PSBjdXJyZW50IHx8XG4gICAgICAgICAgIChkZXNpcmVkID09PSBudWxsICYmIGN1cnJlbnQgPT09IE5BVElWRV9XSU4pIHx8XG4gICAgICAgICAgIChkZXNpcmVkID09PSBOQVRJVkVfV0lOICYmIGN1cnJlbnQgPT09IG51bGwpKTtcbiAgfVxuXG4gIGxvZ2dlci5kZWJ1ZyhgQXR0ZW1wdGluZyB0byBzZXQgY29udGV4dCB0byAnJHtuYW1lfSdgKTtcbiAgaWYgKGFscmVhZHlJbkNvbnRleHQobmFtZSwgdGhpcy5jdXJDb250ZXh0KSkge1xuICAgIC8vIGFscmVhZHkgaW4gdGhlIG5hbWVkIGNvbnRleHQsIG5vIG5lZWQgdG8gZG8gYW55dGhpbmdcbiAgfSBlbHNlIGlmIChuYW1lID09PSBOQVRJVkVfV0lOIHx8IG5hbWUgPT09IG51bGwpIHtcbiAgICAvLyBzd2l0Y2hpbmcgaW50byB0aGUgbmF0aXZlIGNvbnRleHRcbiAgICB0aGlzLmN1ckNvbnRleHQgPSBudWxsO1xuICAgIGlmICh0aGlzLmlzUmVhbERldmljZSgpKSB7XG4gICAgICB0aGlzLnJlbW90ZS5kaXNjb25uZWN0KCk7XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIC8vIHN3aXRjaGluZyBpbnRvIGEgd2VidmlldyBjb250ZXh0XG5cbiAgICAvLyBpZiBjb250ZXh0cyBoYXZlIG5vdCBhbHJlYWR5IGJlZW4gcmV0cmlldmVkLCBnZXQgdGhlbVxuICAgIGlmIChfLmlzVW5kZWZpbmVkKHRoaXMuY29udGV4dHMpKSB7XG4gICAgICBhd2FpdCB0aGlzLmdldENvbnRleHRzKCk7XG4gICAgfVxuXG4gICAgbGV0IGNvbnRleHRJZCA9IG5hbWUucmVwbGFjZShXRUJWSUVXX0JBU0UsICcnKTtcbiAgICBpZiAoY29udGV4dElkID09PSAnJykge1xuICAgICAgLy8gYWxsb3cgdXNlciB0byBwYXNzIGluIFwiV0VCVklFV1wiIHdpdGhvdXQgYW4gaW5kZXhcbiAgICAgIC8vIHRoZSBzZWNvbmQgY29udGV4dCB3aWxsIGJlIHRoZSBmaXJzdCB3ZWJ2aWV3IGFzXG4gICAgICAvLyB0aGUgZmlyc3QgaXMgYWx3YXlzIE5BVElWRV9BUFBcbiAgICAgIGNvbnRleHRJZCA9IHRoaXMuY29udGV4dHNbMV07XG4gICAgfVxuICAgIGlmICghXy5pbmNsdWRlcyh0aGlzLmNvbnRleHRzLCBjb250ZXh0SWQpKSB7XG4gICAgICB0aHJvdyBuZXcgZXJyb3JzLk5vU3VjaENvbnRleHRFcnJvcigpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmlzUmVhbERldmljZSgpKSB7XG4gICAgICBpZiAodGhpcy5yZW1vdGUpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5yZW1vdGUuZGlzY29ubmVjdCgpO1xuICAgICAgfVxuICAgICAgdGhpcy5jdXJDb250ZXh0ID0gY29udGV4dElkO1xuICAgICAgYXdhaXQgdGhpcy5yZW1vdGUuY29ubmVjdChjb250ZXh0SWQpO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBgY29udGV4dElkYCB3aWxsIGJlIGluIHRoZSBmb3JtIG9mIGBhcHBJZC5wYWdlSWRgIGluIHRoaXMgY2FzZVxuICAgICAgbGV0IFthcHBJZEtleSwgcGFnZUlkS2V5XSA9IF8ubWFwKGNvbnRleHRJZC5zcGxpdCgnLicpLCAoaWQpID0+IHBhcnNlSW50KGlkLCAxMCkpO1xuICAgICAgYXdhaXQgdGhpcy5yZW1vdGUuc2VsZWN0UGFnZShhcHBJZEtleSwgcGFnZUlkS2V5LCBza2lwUmVhZHlDaGVjayk7XG4gICAgICB0aGlzLmN1ckNvbnRleHQgPSBjb250ZXh0SWQ7XG4gICAgfVxuICB9XG5cbiAgLy8gYXR0ZW1wdCB0byBzdGFydCBwZXJmb3JtYW5jZSBsb2dnaW5nLCBpZiByZXF1ZXN0ZWRcbiAgaWYgKHRoaXMub3B0cy5lbmFibGVQZXJmb3JtYW5jZUxvZ2dpbmcgJiYgdGhpcy5yZW1vdGUpIHtcbiAgICBsb2dnZXIuZGVidWcoYFN0YXJ0aW5nIHBlcmZvcm1hbmNlIGxvZyBvbiAnJHt0aGlzLmN1ckNvbnRleHR9J2ApO1xuICAgIHRoaXMubG9ncy5wZXJmb3JtYW5jZSA9IG5ldyBJT1NQZXJmb3JtYW5jZUxvZyh0aGlzLnJlbW90ZSk7XG4gICAgYXdhaXQgdGhpcy5sb2dzLnBlcmZvcm1hbmNlLnN0YXJ0Q2FwdHVyZSgpO1xuICB9XG59O1xuXG5jb21tYW5kcy5nZXRXaW5kb3dIYW5kbGUgPSBhc3luYyBmdW5jdGlvbiBnZXRXaW5kb3dIYW5kbGUgKCkgeyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHJlcXVpcmUtYXdhaXRcbiAgaWYgKCF0aGlzLmlzV2ViQ29udGV4dCgpKSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5Ob3RJbXBsZW1lbnRlZEVycm9yKCk7XG4gIH1cbiAgcmV0dXJuIHRoaXMuY3VyQ29udGV4dC50b1N0cmluZygpO1xufTtcblxuY29tbWFuZHMuZ2V0V2luZG93SGFuZGxlcyA9IGFzeW5jIGZ1bmN0aW9uIGdldFdpbmRvd0hhbmRsZXMgKCkge1xuICBpZiAoIXRoaXMuaXNXZWJDb250ZXh0KCkpIHtcbiAgICB0aHJvdyBuZXcgZXJyb3JzLk5vdEltcGxlbWVudGVkRXJyb3IoKTtcbiAgfVxuXG4gIHRoaXMud2luZG93SGFuZGxlQ2FjaGUgPSBhd2FpdCB0aGlzLmxpc3RXZWJGcmFtZXMoZmFsc2UpO1xuICBjb25zdCBpZEFycmF5ID0gXy5tYXAodGhpcy53aW5kb3dIYW5kbGVDYWNoZSwgJ2lkJyk7XG4gIC8vIHNpbmNlIHdlIHVzZSB0aGlzLmNvbnRleHRzIHRvIG1hbmFnZSBzZWxlY3RpbmcgZGVidWdnZXIgcGFnZXMsIG1ha2VcbiAgLy8gc3VyZSBpdCBnZXRzIHBvcHVsYXRlZCBldmVuIGlmIHNvbWVvbmUgZGlkIG5vdCB1c2UgdGhlXG4gIC8vIGdldENvbnRleHRzIG1ldGhvZFxuICBpZiAoIXRoaXMuY29udGV4dHMpIHtcbiAgICB0aGlzLmNvbnRleHRzID0gaWRBcnJheTtcbiAgfVxuICByZXR1cm4gXy5tYXAoaWRBcnJheSwgKGlkKSA9PiBpZC50b1N0cmluZygpKTtcbn07XG5cbmNvbW1hbmRzLnNldFdpbmRvdyA9IGFzeW5jIGZ1bmN0aW9uIHNldFdpbmRvdyAobmFtZSwgc2tpcFJlYWR5Q2hlY2spIHtcbiAgaWYgKCF0aGlzLmlzV2ViQ29udGV4dCgpKSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5Ob3RJbXBsZW1lbnRlZEVycm9yKCk7XG4gIH1cblxuICBpZiAoIV8uaW5jbHVkZXMoXy5tYXAodGhpcy53aW5kb3dIYW5kbGVDYWNoZSwgJ2lkJyksIG5hbWUpKSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5Ob1N1Y2hXaW5kb3dFcnJvcigpO1xuICB9XG4gIGxldCBwYWdlSWRLZXkgPSBwYXJzZUludChuYW1lLCAxMCk7XG4gIGlmICghdGhpcy5pc1JlYWxEZXZpY2UoKSkge1xuICAgIGF3YWl0IHRoaXMucmVtb3RlLnNlbGVjdFBhZ2UocGFnZUlkS2V5LCBza2lwUmVhZHlDaGVjayk7XG4gICAgdGhpcy5jdXJDb250ZXh0ID0gdGhpcy5jdXJXaW5kb3dIYW5kbGUgPSBuYW1lO1xuICB9IGVsc2Uge1xuICAgIGlmIChuYW1lID09PSB0aGlzLmN1cldpbmRvd0hhbmRsZSkge1xuICAgICAgbG9nZ2VyLmRlYnVnKGBSZW1vdGUgZGVidWdnZXIgaXMgYWxyZWFkeSBjb25uZWN0ZWQgdG8gd2luZG93ICcke25hbWV9J2ApO1xuICAgIH0gZWxzZSBpZiAoIV8uaW5jbHVkZXMoXy5tYXAodGhpcy53aW5kb3dIYW5kbGVDYWNoZSwgJ2lkJyksIG5hbWUpKSB7XG4gICAgICB0aHJvdyBuZXcgZXJyb3JzLk5vU3VjaFdpbmRvd0Vycm9yKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGF3YWl0IHRoaXMucmVtb3RlLmRpc2Nvbm5lY3QoKTtcbiAgICAgIHRoaXMuY3VyQ29udGV4dCA9IHRoaXMuY3VyV2luZG93SGFuZGxlID0gbmFtZTtcbiAgICAgIGF3YWl0IHRoaXMucmVtb3RlLmNvbm5lY3QobmFtZSk7XG4gICAgfVxuICB9XG59O1xuXG5oZWxwZXJzLndlYkNvbnRleHRJbmRleCA9IGZ1bmN0aW9uIHdlYkNvbnRleHRJbmRleCAoKSB7XG4gIHJldHVybiB0aGlzLmN1ckNvbnRleHQucmVwbGFjZShXRUJWSUVXX0JBU0UsICcnKSAtIDE7XG59O1xuXG5leHRlbnNpb25zLmluaXRBdXRvV2VidmlldyA9IGFzeW5jIGZ1bmN0aW9uIGluaXRBdXRvV2VidmlldyAoKSB7XG4gIGlmICh0aGlzLm9wdHMuYXV0b1dlYnZpZXcpIHtcbiAgICBsb2dnZXIuZGVidWcoJ1NldHRpbmcgYXV0byB3ZWJ2aWV3Jyk7XG4gICAgYXdhaXQgdGhpcy5uYXZUb0luaXRpYWxXZWJ2aWV3KHRoaXMpO1xuICB9XG59O1xuXG5leHRlbnNpb25zLmdldENvbnRleHRzQW5kVmlld3MgPSBhc3luYyBmdW5jdGlvbiBnZXRDb250ZXh0c0FuZFZpZXdzICh1c2VVcmwgPSB0cnVlKSB7XG4gIGxvZ2dlci5kZWJ1ZygnUmV0cmlldmluZyBjb250ZXh0cyBhbmQgdmlld3MnKTtcbiAgbGV0IHdlYnZpZXdzID0gYXdhaXQgdGhpcy5saXN0V2ViRnJhbWVzKHVzZVVybCk7XG5cbiAgbGV0IGN0eHMgPSBbe2lkOiBOQVRJVkVfV0lOLCB2aWV3OiB7fX1dO1xuICB0aGlzLmNvbnRleHRzID0gW05BVElWRV9XSU5dO1xuICBmb3IgKGxldCB2aWV3IG9mIHdlYnZpZXdzKSB7XG4gICAgY3R4cy5wdXNoKHtpZDogYCR7V0VCVklFV19CQVNFfSR7dmlldy5pZH1gLCB2aWV3fSk7XG4gICAgdGhpcy5jb250ZXh0cy5wdXNoKHZpZXcuaWQudG9TdHJpbmcoKSk7XG4gIH1cbiAgcmV0dXJuIGN0eHM7XG59O1xuXG5leHRlbnNpb25zLmdldE5ld1JlbW90ZURlYnVnZ2VyID0gYXN5bmMgZnVuY3Rpb24gZ2V0TmV3UmVtb3RlRGVidWdnZXIgKCkgeyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHJlcXVpcmUtYXdhaXRcbiAgcmV0dXJuIG5ldyBSZW1vdGVEZWJ1Z2dlcih7XG4gICAgYnVuZGxlSWQ6IHRoaXMub3B0cy5idW5kbGVJZCxcbiAgICB1c2VOZXdTYWZhcmk6IHRoaXMudXNlTmV3U2FmYXJpKCksXG4gICAgcGFnZUxvYWRNczogdGhpcy5wYWdlTG9hZE1zLFxuICAgIHBsYXRmb3JtVmVyc2lvbjogdGhpcy5vcHRzLnBsYXRmb3JtVmVyc2lvbixcbiAgICBpc1NhZmFyaTogdGhpcy5pc1NhZmFyaSgpLFxuICAgIHJlbW90ZURlYnVnUHJveHk6IHRoaXMub3B0cy5yZW1vdGVEZWJ1Z1Byb3h5LFxuICAgIGdhcmJhZ2VDb2xsZWN0T25FeGVjdXRlOiBmYWxzZSxcbiAgICBsb2dGdWxsUmVzcG9uc2U6ICEhdGhpcy5vcHRzLnNhZmFyaVNob3dGdWxsUmVzcG9uc2UsXG4gIH0pO1xufTtcblxuZXh0ZW5zaW9ucy5saXN0V2ViRnJhbWVzID0gYXN5bmMgZnVuY3Rpb24gbGlzdFdlYkZyYW1lcyAodXNlVXJsID0gdHJ1ZSkge1xuICBpZiAoIXRoaXMub3B0cy5idW5kbGVJZCkge1xuICAgIGxvZ2dlci5lcnJvckFuZFRocm93KCdDYW5ub3QgZW50ZXIgd2ViIGZyYW1lIHdpdGhvdXQgYSBidW5kbGUgSUQnKTtcbiAgfVxuXG4gIHVzZVVybCA9IHVzZVVybCAmJiAhIXRoaXMuZ2V0Q3VycmVudFVybCgpO1xuICBsb2dnZXIuZGVidWcoYFNlbGVjdGluZyBieSB1cmw6ICR7dXNlVXJsfSAke3VzZVVybCA/IGAoZXhwZWN0ZWQgdXJsOiAnJHt0aGlzLmdldEN1cnJlbnRVcmwoKX0nKWAgOiAnJ31gKTtcblxuICBsZXQgY3VycmVudFVybCA9IHVzZVVybCA/IHRoaXMuZ2V0Q3VycmVudFVybCgpIDogdW5kZWZpbmVkO1xuICBsZXQgcGFnZUFycmF5O1xuICBpZiAodGhpcy5pc1JlYWxEZXZpY2UoKSAmJiB0aGlzLnJlbW90ZSAmJiB0aGlzLm9wdHMuYnVuZGxlSWQpIHtcbiAgICAvLyByZWFsIGRldmljZSwgYW5kIGFscmVhZHkgY29ubmVjdGVkXG4gICAgcGFnZUFycmF5ID0gYXdhaXQgdGhpcy5yZW1vdGUucGFnZUFycmF5RnJvbUpzb24odGhpcy5vcHRzLmlnbm9yZUFib3V0QmxhbmtVcmwpO1xuICB9IGVsc2UgaWYgKHRoaXMucmVtb3RlICYmIHRoaXMucmVtb3RlLmFwcElkS2V5KSB7XG4gICAgLy8gc2ltdWxhdG9yLCBhbmQgYWxyZWFkeSBjb25uZWN0ZWRcbiAgICBwYWdlQXJyYXkgPSBhd2FpdCB0aGlzLnJlbW90ZS5zZWxlY3RBcHAoY3VycmVudFVybCwgdGhpcy5vcHRzLndlYnZpZXdDb25uZWN0UmV0cmllcywgdGhpcy5vcHRzLmlnbm9yZUFib3V0QmxhbmtVcmwpO1xuICB9IGVsc2UgaWYgKHRoaXMuaXNSZWFsRGV2aWNlKCkpIHtcbiAgICAvLyByZWFsIGRldmljZSwgYW5kIG5vdCBjb25uZWN0ZWRcbiAgICB0cnkge1xuICAgICAgdGhpcy5yZW1vdGUgPSBuZXcgV2ViS2l0UmVtb3RlRGVidWdnZXIoe1xuICAgICAgICBwb3J0OiB0aGlzLm9wdHMud2Via2l0RGVidWdQcm94eVBvcnQsXG4gICAgICAgIHdlYmtpdFJlc3BvbnNlVGltZW91dDogdGhpcy5vcHRzLndlYmtpdFJlc3BvbnNlVGltZW91dCxcbiAgICAgICAgcGxhdGZvcm1WZXJzaW9uOiB0aGlzLm9wdHMucGxhdGZvcm1WZXJzaW9uLFxuICAgICAgICBpc1NhZmFyaTogdGhpcy5pc1NhZmFyaSgpLFxuICAgICAgICBnYXJiYWdlQ29sbGVjdE9uRXhlY3V0ZTogZmFsc2UsXG4gICAgICAgIGxvZ0Z1bGxSZXNwb25zZTogISF0aGlzLm9wdHMuc2FmYXJpU2hvd0Z1bGxSZXNwb25zZSxcbiAgICAgIH0pO1xuICAgICAgcGFnZUFycmF5ID0gYXdhaXQgdGhpcy5yZW1vdGUucGFnZUFycmF5RnJvbUpzb24odGhpcy5vcHRzLmlnbm9yZUFib3V0QmxhbmtVcmwpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgLy8gaXQgaXMgcmVhc29uYWJsZSB0byBleHBlY3QgdGhhdCB0aGlzIG1pZ2h0IGJlIGNhbGxlZCB3aGVuIHRoZXJlIGlzIG5vXG4gICAgICAvLyB3ZWJraXQgcmVtb3RlIGRlYnVnZ2VyIHRvIGNvbm5lY3QgdG9cbiAgICAgIGlmICghXy5pbmNsdWRlcyhlcnIubWVzc2FnZSwgJ2Nvbm5lY3QgRUNPTk5SRUZVU0VEJykpIHRocm93IGVycjsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBjdXJseVxuXG4gICAgICBsb2dnZXIud2FybignQXR0ZW1wdGVkIHRvIGdldCBhIGxpc3Qgb2Ygd2VidmlldyBjb250ZXh0cyBidXQgY291bGQgbm90IGNvbm5lY3QgdG8gJyArXG4gICAgICAgICAgICAgICAgICAnaW9zLXdlYmtpdC1kZWJ1Zy1wcm94eS4gSWYgeW91IGV4cGVjdCB0byBmaW5kIHdlYnZpZXdzLCBwbGVhc2UgZW5zdXJlICcgK1xuICAgICAgICAgICAgICAgICAgJ3RoYXQgdGhlIHByb3h5IGlzIHJ1bm5pbmcgYW5kIGFjY2Vzc2libGUnKTtcbiAgICAgIHRoaXMucmVtb3RlID0gbnVsbDtcbiAgICAgIHBhZ2VBcnJheSA9IFtdO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICAvLyBzaW11bGF0b3IsIGFuZCBub3QgY29ubmVjdGVkXG4gICAgdGhpcy5yZW1vdGUgPSBhd2FpdCB0aGlzLmdldE5ld1JlbW90ZURlYnVnZ2VyKCk7XG5cbiAgICBsZXQgYXBwSW5mbyA9IGF3YWl0IHRoaXMucmVtb3RlLmNvbm5lY3QoKTtcbiAgICBpZiAoIWFwcEluZm8pIHtcbiAgICAgIGxvZ2dlci5kZWJ1ZygnVW5hYmxlIHRvIGNvbm5lY3QgdG8gdGhlIHJlbW90ZSBkZWJ1Z2dlci4nKTtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gICAgcGFnZUFycmF5ID0gYXdhaXQgdGhpcy5yZW1vdGUuc2VsZWN0QXBwKGN1cnJlbnRVcmwsIHRoaXMub3B0cy53ZWJ2aWV3Q29ubmVjdFJldHJpZXMsIHRoaXMub3B0cy5pZ25vcmVBYm91dEJsYW5rVXJsKTtcbiAgICB0aGlzLnJlbW90ZS5vbihSZW1vdGVEZWJ1Z2dlci5FVkVOVF9QQUdFX0NIQU5HRSwgdGhpcy5vblBhZ2VDaGFuZ2UuYmluZCh0aGlzKSk7XG4gICAgdGhpcy5yZW1vdGUub24oUmVtb3RlRGVidWdnZXIuRVZFTlRfRlJBTUVTX0RFVEFDSEVELCAoKSA9PiB7XG4gICAgICBpZiAoIV8uaXNFbXB0eSh0aGlzLmN1cldlYkZyYW1lcykpIHtcbiAgICAgICAgbG9nZ2VyLmRlYnVnKGBDbGVhcmluZyAke3RoaXMuY3VyV2ViRnJhbWVzLmxlbmd0aH0gZnJhbWVzOiAke3RoaXMuY3VyV2ViRnJhbWVzLmpvaW4oJywgJyl9YCk7XG4gICAgICB9XG4gICAgICB0aGlzLmN1cldlYkZyYW1lcyA9IFtdO1xuICAgIH0pO1xuXG4gICAgbGV0IHRyeUNsb3NpbmdBbGVydCA9IGFzeW5jICgpID0+IHtcbiAgICAgIGxldCBkaWREaXNtaXNzID0gYXdhaXQgdGhpcy5jbG9zZUFsZXJ0QmVmb3JlVGVzdCgpO1xuICAgICAgaWYgKCFkaWREaXNtaXNzKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignQ2xvc2UgYWxlcnQgZmFpbGVkLiBSZXRyeS4nKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCByZXRyeUludGVydmFsKDMsIDQwMDAsIHRyeUNsb3NpbmdBbGVydCk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAvLyBpZiB0aGUgbG9vcCB0byBjbG9zZSBhbGVydHMgZmFpbGVkIHRvIGRpc21pc3MsIGlnbm9yZSxcbiAgICAgIC8vIG90aGVyd2lzZSBsb2cgYW5kIHRocm93IHRoZSBlcnJvclxuICAgICAgaWYgKGVyci5tZXNzYWdlICE9PSAnQ2xvc2UgYWxlcnQgZmFpbGVkLiBSZXRyeS4nKSB7XG4gICAgICAgIGxvZ2dlci5lcnJvckFuZFRocm93KGVycik7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgaWYgKHBhZ2VBcnJheS5sZW5ndGggPT09IDApIHtcbiAgICAvLyB3ZSBoYXZlIG5vIHdlYiBmcmFtZXMsIGJ1dCBjb250aW51ZSBhbnl3YXlcbiAgICBsb2dnZXIuZGVidWcoJ05vIHdlYiBmcmFtZXMgZm91bmQuJyk7XG4gIH1cbiAgcmV0dXJuIHBhZ2VBcnJheTtcbn07XG5cbmV4dGVuc2lvbnMub25QYWdlQ2hhbmdlID0gYXN5bmMgZnVuY3Rpb24gb25QYWdlQ2hhbmdlIChwYWdlQ2hhbmdlTm90aWZpY2F0aW9uKSB7XG4gIGxvZ2dlci5kZWJ1ZyhgUmVtb3RlIGRlYnVnZ2VyIG5vdGlmaWVkIHVzIG9mIGEgbmV3IHBhZ2UgbGlzdGluZzogJHtKU09OLnN0cmluZ2lmeShwYWdlQ2hhbmdlTm90aWZpY2F0aW9uKX1gKTtcbiAgaWYgKHRoaXMuc2VsZWN0aW5nTmV3UGFnZSkge1xuICAgIGxvZ2dlci5kZWJ1ZygnV2UgYXJlIGluIHRoZSBtaWRkbGUgb2Ygc2VsZWN0aW5nIGEgcGFnZSwgaWdub3JpbmcnKTtcbiAgICByZXR1cm47XG4gIH1cbiAgaWYgKCF0aGlzLnJlbW90ZSB8fCAhdGhpcy5yZW1vdGUuaXNDb25uZWN0ZWQoKSkge1xuICAgIGxvZ2dlci5kZWJ1ZygnV2UgaGF2ZSBub3QgeWV0IGNvbm5lY3RlZCwgaWdub3JpbmcnKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCB7YXBwSWRLZXksIHBhZ2VBcnJheX0gPSBwYWdlQ2hhbmdlTm90aWZpY2F0aW9uO1xuXG4gIGxldCBuZXdJZHMgPSBbXTtcbiAgbGV0IG5ld1BhZ2VzID0gW107XG4gIGxldCBrZXlJZCA9IG51bGw7XG4gIGZvciAoY29uc3QgcGFnZSBvZiBwYWdlQXJyYXkpIHtcbiAgICBjb25zdCBpZCA9IHBhZ2UuaWQudG9TdHJpbmcoKTtcbiAgICBuZXdJZHMucHVzaChpZCk7XG4gICAgaWYgKHBhZ2UuaXNLZXkpIHtcbiAgICAgIGtleUlkID0gaWQ7XG4gICAgfVxuICAgIGNvbnN0IGNvbnRleHRJZCA9IGAke2FwcElkS2V5fS4ke2lkfWA7XG5cbiAgICAvLyBhZGQgaWYgdGhpcyBpcyBhIG5ldyBwYWdlXG4gICAgaWYgKCFfLmluY2x1ZGVzKHRoaXMuY29udGV4dHMsIGNvbnRleHRJZCkpIHtcbiAgICAgIG5ld1BhZ2VzLnB1c2goaWQpO1xuICAgICAgdGhpcy5jb250ZXh0cy5wdXNoKGNvbnRleHRJZCk7XG4gICAgfVxuICB9XG5cbiAgaWYgKCFrZXlJZCkge1xuICAgIC8vIGlmIHRoZXJlIGlzIG5vIGtleSBpZCwgcHVsbCB0aGUgZmlyc3QgaWQgZnJvbSB0aGUgcGFnZSBhcnJheSBhbmQgdXNlIHRoYXRcbiAgICAvLyBhcyBhIHN0YW5kIGluXG4gICAgbG9nZ2VyLmRlYnVnKCdObyBrZXkgaWQgZm91bmQuIENob29zaW5nIGZpcnN0IGlkIGZyb20gcGFnZSBhcnJheScpO1xuICAgIGtleUlkID0gbmV3SWRzWzBdIHx8IG51bGw7XG4gIH1cblxuICBpZiAoIXV0aWwuaGFzVmFsdWUodGhpcy5jdXJDb250ZXh0KSkge1xuICAgIGxvZ2dlci5kZWJ1ZygnV2UgZG8gbm90IGFwcGVhciB0byBoYXZlIHdpbmRvdyBzZXQgeWV0LCBpZ25vcmluZycpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IFtjdXJBcHBJZEtleSwgY3VyUGFnZUlkS2V5XSA9IHRoaXMuY3VyQ29udGV4dC5zcGxpdCgnLicpO1xuXG4gIGlmIChjdXJBcHBJZEtleSAhPT0gYXBwSWRLZXkpIHtcbiAgICBsb2dnZXIuZGVidWcoJ1BhZ2UgY2hhbmdlIG5vdCByZWZlcnJpbmcgdG8gY3VycmVudGx5IHNlbGVjdGVkIGFwcCwgaWdub3JpbmcuJyk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgbGV0IG5ld1BhZ2UgPSBudWxsO1xuICBpZiAobmV3UGFnZXMubGVuZ3RoKSB7XG4gICAgbmV3UGFnZSA9IF8ubGFzdChuZXdQYWdlcyk7XG4gICAgbG9nZ2VyLmRlYnVnKGBXZSBoYXZlIG5ldyBwYWdlcywgc2VsZWN0aW5nIHBhZ2UgJyR7bmV3UGFnZX0nYCk7XG4gIH0gZWxzZSBpZiAoIV8uaW5jbHVkZXMobmV3SWRzLCBjdXJQYWdlSWRLZXkpKSB7XG4gICAgbG9nZ2VyLmRlYnVnKCdOZXcgcGFnZSBsaXN0aW5nIGZyb20gcmVtb3RlIGRlYnVnZ2VyIGRvZXMgbm90IGNvbnRhaW4gJyArXG4gICAgICAgICAgICAgICAgICdjdXJyZW50IHdpbmRvdzsgYXNzdW1pbmcgaXQgaXMgY2xvc2VkJyk7XG4gICAgaWYgKCF1dGlsLmhhc1ZhbHVlKGtleUlkKSkge1xuICAgICAgbG9nZ2VyLmVycm9yKCdEbyBub3QgaGF2ZSBvdXIgY3VycmVudCB3aW5kb3cgYW55bW9yZSwgYW5kIHRoZXJlICcgK1xuICAgICAgICAgICAgICAgICAgICdhcmUgbm90IGFueSBtb3JlIHRvIGxvYWQhIERvaW5nIG5vdGhpbmcuLi4nKTtcbiAgICAgIHRoaXMuc2V0Q3VycmVudFVybCh1bmRlZmluZWQpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGxvZ2dlci5kZWJ1ZyhgRGVidWdnZXIgYWxyZWFkeSBzZWxlY3RlZCBwYWdlICcke2tleUlkfScsIGAgK1xuICAgICAgICAgICAgICAgICBgY29uZmlybWluZyB0aGF0IGNob2ljZS5gKTtcbiAgICB0aGlzLmN1ckNvbnRleHQgPSBgJHthcHBJZEtleX0uJHtrZXlJZH1gO1xuICAgIG5ld1BhZ2UgPSBrZXlJZDtcbiAgfSBlbHNlIHtcbiAgICAvLyBhdCB0aGlzIHBvaW50LCB0aGVyZSBhcmUgbm8gbmV3IHBhZ2VzLCBhbmQgdGhlIGN1cnJlbnQgcGFnZSBzdGlsbCBleGlzdHNcbiAgICBsb2dnZXIuZGVidWcoJ0NoZWNraW5nIGlmIHBhZ2UgbmVlZHMgdG8gbG9hZCcpO1xuICAgIC8vIElmIGEgd2luZG93IG5hdmlnYXRlcyB0byBhbiBhbmNob3IgaXQgZG9lc24ndCBhbHdheXMgZmlyZSBhIHBhZ2VcbiAgICAvLyBjYWxsYmFjayBldmVudC4gTGV0J3MgY2hlY2sgaWYgd2Ugd291bmQgdXAgaW4gc3VjaCBhIHNpdHVhdGlvbi5cbiAgICBjb25zdCBuZWVkc1BhZ2VMb2FkID0gKCgpID0+IHtcbiAgICAgIC8vIG5lZWQgdG8gbWFwIHRoZSBwYWdlIGlkcyB0byBjb250ZXh0IGlkc1xuICAgICAgY29uc3QgY29udGV4dEFycmF5ID0gXy5tYXAocGFnZUFycmF5LCAocGFnZSkgPT4gYCR7YXBwSWRLZXl9LiR7cGFnZS5pZH1gKTtcbiAgICAgIC8vIGNoZWNrIGlmIHRoZSBjdXJyZW50IGNvbnRleHQgZXhpc3RzIGluIGJvdGggb3VyIHJlY29yZGVkIGNvbnRleHRzLFxuICAgICAgLy8gYW5kIHRoZSBwYWdlIGFycmF5XG4gICAgICByZXR1cm4gIV8uaXNFcXVhbChfLmZpbmQodGhpcy5jb250ZXh0cywgdGhpcy5jdXJDb250ZXh0KSwgXy5maW5kKGNvbnRleHRBcnJheSwgdGhpcy5jdXJDb250ZXh0KSk7XG4gICAgfSkoKTtcblxuICAgIGlmIChuZWVkc1BhZ2VMb2FkKSB7XG4gICAgICBsb2dnZXIuZGVidWcoJ1BhZ2UgbG9hZCBuZWVkZWQuIExvYWRpbmcuLi4nKTtcbiAgICAgIGF3YWl0IHRoaXMucmVtb3RlLnBhZ2VMb2FkKCk7XG4gICAgfVxuXG4gICAgbG9nZ2VyLmRlYnVnKCdOZXcgcGFnZSBsaXN0aW5nIGlzIHNhbWUgYXMgb2xkLCBkb2luZyBub3RoaW5nJyk7XG4gIH1cblxuICAvLyBtYWtlIHN1cmUgdGhhdCB0aGUgcGFnZSBsaXN0aW5nIGlzbid0IGluZGljYXRpbmcgYSByZWRpcmVjdFxuICBpZiAodXRpbC5oYXNWYWx1ZSh0aGlzLmN1ckNvbnRleHQpKSB7XG4gICAgbGV0IGN1cnJlbnRQYWdlSWQgPSBwYXJzZUludChfLmxhc3QodGhpcy5jdXJDb250ZXh0LnNwbGl0KCcuJykpLCAxMCk7XG4gICAgbGV0IHBhZ2UgPSBfLmZpbmQocGFnZUFycmF5LCAocCkgPT4gcGFyc2VJbnQocC5pZCwgMTApID09PSBjdXJyZW50UGFnZUlkKTtcbiAgICBpZiAocGFnZSAmJiBwYWdlLnVybCAhPT0gdGhpcy5nZXRDdXJyZW50VXJsKCkpIHtcbiAgICAgIGxvZ2dlci5kZWJ1ZyhgUmVkaXJlY3RlZCBmcm9tICcke3RoaXMuZ2V0Q3VycmVudFVybCgpfScgdG8gJyR7cGFnZS51cmx9J2ApO1xuICAgICAgdGhpcy5zZXRDdXJyZW50VXJsKHBhZ2UudXJsKTtcbiAgICB9XG4gIH1cblxuICBpZiAodXRpbC5oYXNWYWx1ZShuZXdQYWdlKSkge1xuICAgIHRoaXMuc2VsZWN0aW5nTmV3UGFnZSA9IHRydWU7XG4gICAgYXdhaXQgdGhpcy5yZW1vdGUuc2VsZWN0UGFnZShhcHBJZEtleSwgcGFyc2VJbnQobmV3UGFnZSwgMTApKTtcbiAgICB0aGlzLnNlbGVjdGluZ05ld1BhZ2UgPSBmYWxzZTtcbiAgICB0aGlzLmN1ckNvbnRleHQgPSBgJHthcHBJZEtleX0uJHtuZXdQYWdlfWA7XG4gIH1cbiAgdGhpcy53aW5kb3dIYW5kbGVDYWNoZSA9IHBhZ2VBcnJheTtcbn07XG5cbmV4dGVuc2lvbnMuZ2V0TGF0ZXN0V2Vidmlld0NvbnRleHRGb3JUaXRsZSA9IGFzeW5jIGZ1bmN0aW9uIGdldExhdGVzdFdlYnZpZXdDb250ZXh0Rm9yVGl0bGUgKHJlZ0V4cCkge1xuICBsZXQgY29udGV4dHMgPSBhd2FpdCB0aGlzLmdldENvbnRleHRzQW5kVmlld3MoKTtcbiAgbGV0IG1hdGNoaW5nQ3R4O1xuICBmb3IgKGxldCBjdHggb2YgY29udGV4dHMpIHtcbiAgICBpZiAoY3R4LnZpZXcgJiYgKChjdHgudmlldy50aXRsZSAmJiBjdHgudmlldy50aXRsZS5tYXRjaChyZWdFeHApKSB8fCAoY3R4LnZpZXcudXJsICYmIGN0eC52aWV3LnVybC5tYXRjaChyZWdFeHApKSkpIHtcbiAgICAgIGlmIChjdHgudmlldy51cmwgIT09ICdhYm91dDpibGFuaycpIHtcbiAgICAgICAgbWF0Y2hpbmdDdHggPSBjdHg7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBpbiB0aGUgY2FzZXMgb2YgWGNvZGUgPCA1IChpLmUuLCBpT1MgU0RLIFZlcnNpb24gbGVzcyB0aGFuIDcpXG4gICAgICAgIC8vIGlPUyA3LjEsIGlPUyA5LjAgJiBpT1MgOS4xIGluIGEgd2VidmlldyAobm90IGluIFNhZmFyaSlcbiAgICAgICAgLy8gd2UgY2FuIGhhdmUgdGhlIHVybCBiZSBgYWJvdXQ6YmxhbmtgXG4gICAgICAgIGlmIChwYXJzZUZsb2F0KHRoaXMuaW9zU2RrVmVyc2lvbikgPCA3IHx8IHBhcnNlRmxvYXQodGhpcy5pb3NTZGtWZXJzaW9uKSA+PSA5IHx8XG4gICAgICAgICAgICAodGhpcy5vcHRzLnBsYXRmb3JtVmVyc2lvbiA9PT0gJzcuMScgJiYgdGhpcy5vcHRzLmFwcCAmJiB0aGlzLm9wdHMuYXBwLnRvTG93ZXJDYXNlKCkgIT09ICdzYWZhcmknKSkge1xuICAgICAgICAgIG1hdGNoaW5nQ3R4ID0gY3R4O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBicmVhaztcbiAgICB9XG4gIH1cbiAgcmV0dXJuIG1hdGNoaW5nQ3R4ID8gbWF0Y2hpbmdDdHguaWQgOiB1bmRlZmluZWQ7XG59O1xuXG4vLyBSaWdodCBub3cgd2UgZG9uJ3QgbmVjZXNzYXJpbHkgd2FpdCBmb3Igd2Vidmlld1xuLy8gYW5kIGZyYW1lIHRvIGxvYWQsIHdoaWNoIGxlYWRzIHRvIHJhY2UgY29uZGl0aW9ucyBhbmQgZmxha2luZXNzLFxuLy8gbGV0J3Mgc2VlIGlmIHdlIGNhbiB0cmFuc2l0aW9uIHRvIHNvbWV0aGluZyBiZXR0ZXJcbmV4dGVuc2lvbnMudXNlTmV3U2FmYXJpID0gZnVuY3Rpb24gdXNlTmV3U2FmYXJpICgpIHtcbiAgcmV0dXJuIHBhcnNlRmxvYXQodGhpcy5pb3NTZGtWZXJzaW9uKSA+PSA4LjEgJiZcbiAgICAgICAgIHBhcnNlRmxvYXQodGhpcy5vcHRzLnBsYXRmb3JtVmVyc2lvbikgPj0gOC4xICYmXG4gICAgICAgICAhdGhpcy5pc1JlYWxEZXZpY2UoKSAmJlxuICAgICAgICAgdGhpcy5vcHRzLnNhZmFyaTtcbn07XG5cbmV4dGVuc2lvbnMubmF2VG9Jbml0aWFsV2VidmlldyA9IGFzeW5jIGZ1bmN0aW9uIG5hdlRvSW5pdGlhbFdlYnZpZXcgKCkge1xuICBsZXQgdGltZW91dCA9IDA7XG4gIGlmICh0aGlzLmlzUmVhbERldmljZSgpKSB7XG4gICAgdGltZW91dCA9IDMwMDA7XG4gICAgbG9nZ2VyLmRlYnVnKGBXYWl0aW5nIGZvciAke3RpbWVvdXR9IG1zIGJlZm9yZSBuYXZpZ2F0aW5nIHRvIHZpZXcuYCk7XG4gIH1cbiAgYXdhaXQgQi5kZWxheSh0aW1lb3V0KTtcbiAgaWYgKHRoaXMudXNlTmV3U2FmYXJpKCkpIHtcbiAgICBhd2FpdCB0aGlzLnR5cGVBbmROYXZUb1VybCgpO1xuICB9IGVsc2UgaWYgKHBhcnNlSW50KHRoaXMuaW9zU2RrVmVyc2lvbiwgMTApID49IDcgJiYgIXRoaXMuaXNSZWFsRGV2aWNlKCkgJiYgdGhpcy5vcHRzLnNhZmFyaSkge1xuICAgIGF3YWl0IHRoaXMubmF2VG9WaWV3VGhyb3VnaEZhdm9yaXRlcygpO1xuICB9IGVsc2Uge1xuICAgIGF3YWl0IHRoaXMubmF2VG9WaWV3V2l0aFRpdGxlKC8uKi8pO1xuICB9XG59O1xuXG5hc3luYyBmdW5jdGlvbiBvcGVuTmV3UGFnZSAoKSB7XG4gIGxldCBuZXdQYWdlQnV0dG9uID0gYXdhaXQgdGhpcy5maW5kRWxlbWVudCgneHBhdGgnLCBcIi8vVUlBQnV0dG9uW2NvbnRhaW5zKEBuYW1lLCdOZXcgcGFnZScpXVwiKTtcbiAgYXdhaXQgdGhpcy5uYXRpdmVUYXAobmV3UGFnZUJ1dHRvbi5FTEVNRU5UKTtcbn1cblxuZXh0ZW5zaW9ucy50eXBlQW5kTmF2VG9VcmwgPSBhc3luYyBmdW5jdGlvbiB0eXBlQW5kTmF2VG9VcmwgKCkge1xuICBsZXQgYWRkcmVzcyA9IHRoaXMub3B0cy5hZGRyZXNzID8gdGhpcy5vcHRzLmFkZHJlc3MgOiAnMTI3LjAuMC4xJztcbiAgdGhpcy5zZXRDdXJyZW50VXJsKHRoaXMuY2Fwcy5zYWZhcmlJbml0aWFsVXJsIHx8IGBodHRwOi8vJHthZGRyZXNzfToke3RoaXMub3B0cy5wb3J0fS93ZWxjb21lYCk7XG5cbiAgbGV0IHRyaWVzID0gMDtcbiAgY29uc3QgTUFYX1RSSUVTID0gMjtcbiAgbGV0IG5hdmlnYXRlID0gYXN5bmMgKCkgPT4ge1xuICAgIGxldCBvbGRJbXBXYWl0ID0gdGhpcy5pbXBsaWNpdFdhaXRNcztcbiAgICB0aGlzLmltcGxpY2l0V2FpdE1zID0gNzAwMDtcblxuICAgIC8vIGZpbmQgdGhlIHVybCBiYXIsIGFuZCB0YXAgb24gaXQuIHJldHJ5IHRvIG1ha2Ugc3VyZSB3ZSBkb24ndCB0cnlcbiAgICAvLyB0b28gc29vbiB3aGlsZSB0aGUgdmlldyBpcyBzdGlsbCBsb2FkaW5nXG4gICAgbGV0IGVsID0gYXdhaXQgcmV0cnlJbnRlcnZhbCgzLCAxMDAwLCBhc3luYyAoKSA9PiB7XG4gICAgICByZXR1cm4gYXdhaXQgdGhpcy5maW5kRWxlbWVudCgnYWNjZXNzaWJpbGl0eSBpZCcsICdVUkwnKTtcbiAgICB9KTtcbiAgICB0aGlzLmltcGxpY2l0V2FpdE1zID0gb2xkSW1wV2FpdDtcblxuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0aGlzLm5hdGl2ZVRhcChlbC5FTEVNRU5UKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGlmIChfLmluY2x1ZGVzKGVyci5tZXNzYWdlLCAnY291bGQgbm90IGJlIHRhcHBlZCcpKSB7XG4gICAgICAgIGlmICh0cmllcysrID49IE1BWF9UUklFUykgdGhyb3cgZXJyOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIGN1cmx5XG5cbiAgICAgICAgLy8gZ2VuZXJhbGx5IHRoaXMgbWVhbnMgdGhhdCBTYWZhcmkgaXMgaW4gcGFnZSB2aWV3aW5nIG1vZGVcbiAgICAgICAgLy8gc28gdHJ5IHRvIG9wZW4gYSBuZXcgcGFnZSBhbmQgdGhlbiByZWRvIHRoZSBuYXZpZ2F0aW9uXG4gICAgICAgIGF3YWl0IG9wZW5OZXdQYWdlKCk7XG4gICAgICAgIHJldHVybiBhd2FpdCBuYXZpZ2F0ZSgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgZXJyO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIGdldCB0aGUgbGFzdCBhZGRyZXNzIGVsZW1lbnQgYW5kIHNldCB0aGUgdXJsXG4gICAgdHJ5IHtcbiAgICAgIGxldCBlbCA9IGF3YWl0IHRoaXMuZmluZEVsZW1lbnQoJ2NsYXNzIG5hbWUnLCAnVUlBVGV4dEZpZWxkJyk7XG4gICAgICBhd2FpdCB0aGlzLnNldFZhbHVlSW1tZWRpYXRlKHRoaXMuZ2V0Q3VycmVudFVybCgpLCBlbCk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAvLyB0aGlzIGlzIGZsYWtleSBvbiBjZXJ0YWluIHN5c3RlbXMgc28gd2UgcmV0cnkgdW50aWwgd2UgZ2V0IHNvbWV0aGluZ1xuICAgICAgLy8gaW9zIHNpbXM6IHNhZmFyaSBvcGVucyBidXQgdGhlIHRleHQgZmllbGQgY2FuJ3QgYmUgZm91bmRcbiAgICAgIGlmICh0cmllcysrID49IE1BWF9UUklFUykgdGhyb3cgZXJyOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIGN1cmx5XG4gICAgICByZXR1cm4gYXdhaXQgbmF2aWdhdGUoKTtcbiAgICB9XG5cbiAgICAvLyBtYWtlIGl0IGhhcHBlblxuICAgIHRyeSB7XG4gICAgICBlbCA9IGF3YWl0IHRoaXMuZmluZEVsZW1lbnQoJ2FjY2Vzc2liaWxpdHkgaWQnLCAnR28nKTtcbiAgICAgIGF3YWl0IHRoaXMubmF0aXZlVGFwKGVsLkVMRU1FTlQpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgaWYgKF8uaW5jbHVkZXMoZXJyLm1lc3NhZ2UsICdjb3VsZCBub3QgYmUgdGFwcGVkJykpIHtcbiAgICAgICAgbG9nZ2VyLmVycm9yKCdVbmFibGUgdG8gc3VibWl0IFVSTCBiZWNhdXNlIFxcJ0dvXFwnIGJ1dHRvbiBjb3VsZCBub3QgYmUgdGFwcGVkLiAnICtcbiAgICAgICAgICAgICAgICAgICAgICdQbGVhc2UgbWFrZSBzdXJlIHlvdXIga2V5Ym9hcmQgaXMgdG9nZ2xlZCBvbi4nKTtcbiAgICAgIH1cbiAgICAgIHRocm93IGVycjtcbiAgICB9XG4gICAgYXdhaXQgdGhpcy5uYXZUb1ZpZXdXaXRoVGl0bGUodW5kZWZpbmVkLCBuZXcgUmVnRXhwKHRoaXMuZ2V0Q3VycmVudFVybCgpLCAnaScpKTtcblxuICAgIC8vIHdhaXQgZm9yIHBhZ2UgdG8gZmluaXNoIGxvYWRpbmcuXG4gICAgYXdhaXQgdGhpcy5yZW1vdGUucGFnZVVubG9hZCgpO1xuICB9O1xuICBhd2FpdCBuYXZpZ2F0ZSgpO1xufTtcblxuZXh0ZW5zaW9ucy5uYXZUb1ZpZXdUaHJvdWdoRmF2b3JpdGVzID0gYXN5bmMgZnVuY3Rpb24gbmF2VG9WaWV3VGhyb3VnaEZhdm9yaXRlcyAoKSB7XG4gIGxvZ2dlci5kZWJ1ZygnV2UgYXJlIG9uIGlPUzcrIHNpbXVsYXRvcjogY2xpY2tpbmcgYXBwbGUgYnV0dG9uIHRvIGdldCBpbnRvIGEgd2VidmlldycpO1xuICBsZXQgb2xkSW1wV2FpdCA9IHRoaXMuaW1wbGljaXRXYWl0TXM7XG4gIHRoaXMuaW1wbGljaXRXYWl0TXMgPSA3MDAwOyAvLyB3YWl0IDdzIGZvciBhcHBsZSBidXR0b24gdG8gZXhpc3RcblxuICBsZXQgZWw7XG4gIHRyeSB7XG4gICAgZWwgPSBhd2FpdCB0aGlzLmZpbmRFbGVtZW50KCd4cGF0aCcsICcvL1VJQVNjcm9sbFZpZXdbMV0vVUlBQnV0dG9uWzFdJyk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGxldCBtc2cgPSAnQ291bGQgbm90IGZpbmQgYnV0dG9uIHRvIGNsaWNrIHRvIGdldCBpbnRvIHdlYnZpZXcuICcgK1xuICAgICAgICAgICAgICAnUHJvY2VlZGluZyBvbiB0aGUgYXNzdW1wdGlvbiB3ZSBoYXZlIGEgd29ya2luZyBvbmUuJztcbiAgICBsb2dnZXIuZXJyb3IobXNnKTtcbiAgICB0aGlzLmltcGxpY2l0V2FpdE1zID0gb2xkSW1wV2FpdDtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5uYXZUb1ZpZXdXaXRoVGl0bGUoLy4qL2kpO1xuICB9XG4gIHRoaXMuaW1wbGljaXRXYWl0TXMgPSBvbGRJbXBXYWl0O1xuICB0cnkge1xuICAgIGF3YWl0IHRoaXMubmF0aXZlVGFwKGVsLkVMRU1FTlQpO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBsZXQgbXNnID0gJ0NvdWxkIG5vdCBjbGljayBidXR0b24gdG8gZ2V0IGludG8gd2Vidmlldy4gJyArXG4gICAgICAgICAgICAgICdQcm9jZWVkaW5nIG9uIHRoZSBhc3N1bXB0aW9uIHdlIGhhdmUgYSB3b3JraW5nIG9uZS4nO1xuICAgIGxvZ2dlci5lcnJvcihtc2cpO1xuICB9XG4gIGF3YWl0IHRoaXMubmF2VG9WaWV3V2l0aFRpdGxlKC9hcHBsZS9pKTtcbn07XG5cbmV4dGVuc2lvbnMubmF2VG9WaWV3V2l0aFRpdGxlID0gYXN5bmMgZnVuY3Rpb24gbmF2VG9WaWV3V2l0aFRpdGxlICh0aXRsZVJlZ2V4LCB1cmxSZWdFeHApIHtcbiAgbG9nZ2VyLmRlYnVnKCdOYXZpZ2F0aW5nIHRvIG1vc3QgcmVjZW50bHkgb3BlbmVkIHdlYnZpZXcnKTtcbiAgbGV0IHN0YXJ0ID0gRGF0ZS5ub3coKTtcbiAgbGV0IHNwaW5UaW1lID0gNTAwO1xuICBsZXQgc3BpbkhhbmRsZXMgPSBhc3luYyAoKSA9PiB7XG4gICAgbGV0IHJlcztcbiAgICB0cnkge1xuICAgICAgcmVzID0gYXdhaXQgdGhpcy5nZXRMYXRlc3RXZWJ2aWV3Q29udGV4dEZvclRpdGxlKHRpdGxlUmVnZXggfHwgdXJsUmVnRXhwKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGlmICghZXJyLm1lc3NhZ2UuaW5jbHVkZXMoJ0NvdWxkIG5vdCBjb25uZWN0IHRvIGEgdmFsaWQgYXBwIGFmdGVyJykpIHtcbiAgICAgICAgY29uc3QgZXJyb3IgPSBuZXcgRXJyb3IoYENvdWxkIG5vdCBuYXZpZ2F0ZSB0byB3ZWJ2aWV3ISBFcnI6ICR7ZXJyLm1lc3NhZ2V9YCk7XG4gICAgICAgIGVycm9yLnN0YWNrICs9IGBcXG5DYXVzZWQgYnk6ICR7ZXJyLnN0YWNrfWA7XG4gICAgICAgIHRocm93IGVycm9yO1xuICAgICAgfVxuICAgICAgbG9nZ2VyLmRlYnVnKCdDb3VsZCBub3QgbmF2aWdhdGUgdG8gd2Vidmlldy4gUmV0cnlpbmcgaWYgcG9zc2libGUuJyk7XG4gICAgfVxuICAgIGlmIChyZXMpIHtcbiAgICAgIGxldCBsYXRlc3RXaW5kb3cgPSByZXM7XG4gICAgICBsb2dnZXIuZGVidWcoYFBpY2tpbmcgd2VidmlldyAnJHtsYXRlc3RXaW5kb3d9J2ApO1xuICAgICAgYXdhaXQgdGhpcy5zZXRDb250ZXh0KGxhdGVzdFdpbmRvdyk7XG4gICAgICBhd2FpdCB0aGlzLnJlbW90ZS5jYW5jZWxQYWdlTG9hZCgpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIG5vIHdlYnZpZXcgd2FzIGZvdW5kXG4gICAgaWYgKChEYXRlLm5vdygpIC0gc3RhcnQpID49IDkwMDAwKSB7XG4gICAgICAvLyB0b28gc2xvdywgZ2V0IG91dFxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdDb3VsZCBub3QgbmF2aWdhdGUgdG8gd2VidmlldzsgdGhlcmUgYXJlIG5vbmUhJyk7XG4gICAgfVxuXG4gICAgbG9nZ2VyLndhcm4oJ0NvdWxkIG5vdCBmaW5kIGFueSB3ZWJ2aWV3cyB5ZXQsIHJlZnJlc2hpbmcvcmV0cnlpbmcnKTtcbiAgICBpZiAodGhpcy5pc1JlYWxEZXZpY2UoKSB8fCAhdGhpcy5vcHRzLnNhZmFyaSkge1xuICAgICAgLy8gb24gYSByZWFsIGRldmljZSwgd2hlbiBub3QgdXNpbmcgU2FmYXJpLCB3ZSBqdXN0IHdhbnQgdG8gdHJ5IGFnYWluXG4gICAgICBhd2FpdCBCLmRlbGF5KHNwaW5UaW1lKTtcbiAgICAgIHJldHVybiBhd2FpdCBzcGluSGFuZGxlcygpO1xuICAgIH1cblxuICAgIC8vIGZpbmQgdGhlIHJlbG9hZCBidXR0b24gYW5kIHRhcCBpdCwgaWYgcG9zc2libGVcbiAgICBsZXQgZWxlbWVudDtcbiAgICB0cnkge1xuICAgICAgbG9nZ2VyLmRlYnVnKCdGaW5kaW5nIGFuZCB0YXBwaW5nIHJlbG9hZCBidXR0b24nKTtcbiAgICAgIGVsZW1lbnQgPSBhd2FpdCB0aGlzLmZpbmRVSUVsZW1lbnRPckVsZW1lbnRzKCdhY2Nlc3NpYmlsaXR5IGlkJywgJ1JlbG9hZEJ1dHRvbicsICcnLCBmYWxzZSk7XG4gICAgICBhd2FpdCB0aGlzLm5hdGl2ZVRhcChlbGVtZW50LkVMRU1FTlQpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgbG9nZ2VyLndhcm4oYEVycm9yIGZpbmRpbmcgYW5kIHRhcHBpbmcgcmVsb2FkIGJ1dHRvbjogJHtlcnIubWVzc2FnZX1gKTtcbiAgICAgIGxvZ2dlci53YXJuKCdSZXRyeWluZy4nKTtcbiAgICAgIGF3YWl0IEIuZGVsYXkoc3BpblRpbWUpO1xuICAgIH1cblxuICAgIC8vIHRyeSBpdCBhbGwgYWdhaW5cbiAgICByZXR1cm4gYXdhaXQgc3BpbkhhbmRsZXMoKTtcbiAgfTtcbiAgYXdhaXQgc3BpbkhhbmRsZXMoKTtcbn07XG5cbmhlbHBlcnMuY2xvc2VBbGVydEJlZm9yZVRlc3QgPSBhc3luYyBmdW5jdGlvbiBjbG9zZUFsZXJ0QmVmb3JlVGVzdCAoKSB7XG4gIGxldCBwcmVzZW50ID0gYXdhaXQgdGhpcy51aUF1dG9DbGllbnQuc2VuZENvbW1hbmQoJ2F1LmFsZXJ0SXNQcmVzZW50KCknKTtcbiAgaWYgKCFwcmVzZW50KSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgbG9nZ2VyLmRlYnVnKCdBbGVydCBwcmVzZW50IGJlZm9yZSBzdGFydGluZyB0ZXN0LCBsZXQgdXMgYmFuaXNoIGl0Jyk7XG4gIGF3YWl0IHRoaXMudWlBdXRvQ2xpZW50LnNlbmRDb21tYW5kKCdhdS5kaXNtaXNzQWxlcnQoKScpO1xuICBsb2dnZXIuZGVidWcoJ0FsZXJ0IGJhbmlzaGVkIScpO1xuICByZXR1cm4gdHJ1ZTtcbn07XG5cbmhlbHBlcnMuc3RvcFJlbW90ZSA9IGFzeW5jIGZ1bmN0aW9uIHN0b3BSZW1vdGUgKGNsb3NlV2luZG93QmVmb3JlRGlzY29ubmVjdGluZyA9IGZhbHNlKSB7XG4gIGlmICghdGhpcy5yZW1vdGUpIHtcbiAgICBsb2dnZXIuZXJyb3JBbmRUaHJvdygnVHJpZWQgdG8gbGVhdmUgYSB3ZWIgZnJhbWUgYnV0IHdlcmUgbm90IGluIG9uZScpO1xuICB9XG5cbiAgaWYgKGNsb3NlV2luZG93QmVmb3JlRGlzY29ubmVjdGluZykge1xuICAgIGF3YWl0IHRoaXMuY2xvc2VXaW5kb3coKTtcbiAgfVxuICBhd2FpdCB0aGlzLnJlbW90ZS5kaXNjb25uZWN0KCk7XG4gIHRoaXMuY3VyQ29udGV4dCA9IG51bGw7XG4gIHRoaXMuY3VyV2ViRnJhbWVzID0gW107XG4gIHRoaXMuY3VyV2ViQ29vcmRzID0gbnVsbDtcbiAgdGhpcy5yZW1vdGUgPSBudWxsO1xufTtcblxuaGVscGVycy5pc1dlYkNvbnRleHQgPSBmdW5jdGlvbiBpc1dlYkNvbnRleHQgKCkge1xuICByZXR1cm4gISF0aGlzLmN1ckNvbnRleHQgJiYgdGhpcy5jdXJDb250ZXh0ICE9PSBOQVRJVkVfV0lOO1xufTtcblxuaGVscGVycy5zZXRDdXJyZW50VXJsID0gZnVuY3Rpb24gc2V0Q3VycmVudFVybCAodXJsKSB7XG4gIHRoaXMuX2N1cnJlbnRVcmwgPSB1cmw7XG59O1xuXG5oZWxwZXJzLmdldEN1cnJlbnRVcmwgPSBmdW5jdGlvbiBnZXRDdXJyZW50VXJsICgpIHtcbiAgcmV0dXJuIHRoaXMuX2N1cnJlbnRVcmw7XG59O1xuXG5cbk9iamVjdC5hc3NpZ24oZXh0ZW5zaW9ucywgY29tbWFuZHMsIGhlbHBlcnMpO1xuZXhwb3J0IHsgY29tbWFuZHMsIGhlbHBlcnMsIE5BVElWRV9XSU4sIFdFQlZJRVdfV0lOLCBXRUJWSUVXX0JBU0UgfTtcbmV4cG9ydCBkZWZhdWx0IGV4dGVuc2lvbnM7XG4iXSwiZmlsZSI6ImxpYi9jb21tYW5kcy9jb250ZXh0LmpzIiwic291cmNlUm9vdCI6Ii4uLy4uLy4uIn0=
