"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getSimulator = getSimulator;
exports.getDeviceString = getDeviceString;

require("source-map-support/register");

var _simulatorXcode = _interopRequireDefault(require("./simulator-xcode-6"));

var _simulatorXcode2 = _interopRequireDefault(require("./simulator-xcode-7"));

var _simulatorXcode3 = _interopRequireDefault(require("./simulator-xcode-7.3"));

var _simulatorXcode4 = _interopRequireDefault(require("./simulator-xcode-8"));

var _simulatorXcode5 = _interopRequireDefault(require("./simulator-xcode-9"));

var _simulatorXcode6 = _interopRequireDefault(require("./simulator-xcode-9.3"));

var _simulatorXcode7 = _interopRequireDefault(require("./simulator-xcode-10"));

var _utils = require("./utils");

var _appiumXcode = _interopRequireDefault(require("appium-xcode"));

var _logger = require("./logger");

function handleUnsupportedXcode(xcodeVersion) {
  if (xcodeVersion.major < 6) {
    throw new Error(`Tried to use an iOS simulator with xcode ` + `version ${xcodeVersion.versionString} but only Xcode version ` + `6.0.0 and up are supported`);
  }
}

async function getSimulator(udid) {
  const xcodeVersion = await _appiumXcode.default.getVersion(true);
  const simulatorInfo = await (0, _utils.getSimulatorInfo)(udid);

  if (!simulatorInfo) {
    throw new Error(`No sim found with udid '${udid}'`);
  }

  (0, _logger.setLoggingPlatform)(simulatorInfo.platform);

  _logger.log.info(`Constructing ${simulatorInfo.platform || 'iOS'} simulator for Xcode version ${xcodeVersion.versionString} ` + `with udid '${udid}'`);

  let SimClass;

  switch (xcodeVersion.major) {
    case 6:
      SimClass = _simulatorXcode.default;
      break;

    case 7:
      if (xcodeVersion.minor < 3) {
        SimClass = _simulatorXcode2.default;
      } else {
        SimClass = _simulatorXcode3.default;
      }

      break;

    case 8:
      SimClass = _simulatorXcode4.default;
      break;

    case 9:
      if (xcodeVersion.minor < 3) {
        SimClass = _simulatorXcode5.default;
      } else {
        SimClass = _simulatorXcode6.default;
      }

      break;

    case 10:
      SimClass = _simulatorXcode7.default;
      break;

    default:
      handleUnsupportedXcode(xcodeVersion);
      SimClass = _simulatorXcode6.default;
  }

  return new SimClass(udid, xcodeVersion);
}

async function getDeviceString(opts) {
  let xcodeVersion = await _appiumXcode.default.getVersion(true);
  handleUnsupportedXcode(xcodeVersion);

  _logger.log.info(`Retrieving device name string for Xcode version ${xcodeVersion.versionString}`);

  if (xcodeVersion.major >= 8) {
    return await _simulatorXcode2.default.getDeviceString(opts);
  } else if (xcodeVersion.major === 7) {
    return await _simulatorXcode2.default.getDeviceString(opts);
  } else if (xcodeVersion.major === 6) {
    return await _simulatorXcode.default.getDeviceString(opts);
  }
}require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9zaW11bGF0b3IuanMiXSwibmFtZXMiOlsiaGFuZGxlVW5zdXBwb3J0ZWRYY29kZSIsInhjb2RlVmVyc2lvbiIsIm1ham9yIiwiRXJyb3IiLCJ2ZXJzaW9uU3RyaW5nIiwiZ2V0U2ltdWxhdG9yIiwidWRpZCIsInhjb2RlIiwiZ2V0VmVyc2lvbiIsInNpbXVsYXRvckluZm8iLCJwbGF0Zm9ybSIsImxvZyIsImluZm8iLCJTaW1DbGFzcyIsIlNpbXVsYXRvclhjb2RlNiIsIm1pbm9yIiwiU2ltdWxhdG9yWGNvZGU3IiwiU2ltdWxhdG9yWGNvZGU3MyIsIlNpbXVsYXRvclhjb2RlOCIsIlNpbXVsYXRvclhjb2RlOSIsIlNpbXVsYXRvclhjb2RlOTMiLCJTaW11bGF0b3JYY29kZTEwIiwiZ2V0RGV2aWNlU3RyaW5nIiwib3B0cyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBR0EsU0FBU0Esc0JBQVQsQ0FBaUNDLFlBQWpDLEVBQStDO0FBQzdDLE1BQUlBLFlBQVksQ0FBQ0MsS0FBYixHQUFxQixDQUF6QixFQUE0QjtBQUMxQixVQUFNLElBQUlDLEtBQUosQ0FBVywyQ0FBRCxHQUNDLFdBQVVGLFlBQVksQ0FBQ0csYUFBYywwQkFEdEMsR0FFQyw0QkFGWCxDQUFOO0FBR0Q7QUFDRjs7QUFXRCxlQUFlQyxZQUFmLENBQTZCQyxJQUE3QixFQUFtQztBQUNqQyxRQUFNTCxZQUFZLEdBQUcsTUFBTU0scUJBQU1DLFVBQU4sQ0FBaUIsSUFBakIsQ0FBM0I7QUFDQSxRQUFNQyxhQUFhLEdBQUcsTUFBTSw2QkFBaUJILElBQWpCLENBQTVCOztBQUVBLE1BQUksQ0FBQ0csYUFBTCxFQUFvQjtBQUNsQixVQUFNLElBQUlOLEtBQUosQ0FBVywyQkFBMEJHLElBQUssR0FBMUMsQ0FBTjtBQUNEOztBQUdELGtDQUFtQkcsYUFBYSxDQUFDQyxRQUFqQzs7QUFFQUMsY0FBSUMsSUFBSixDQUFVLGdCQUFlSCxhQUFhLENBQUNDLFFBQWQsSUFBMEIsS0FBTSxnQ0FBK0JULFlBQVksQ0FBQ0csYUFBYyxHQUExRyxHQUNDLGNBQWFFLElBQUssR0FENUI7O0FBRUEsTUFBSU8sUUFBSjs7QUFDQSxVQUFRWixZQUFZLENBQUNDLEtBQXJCO0FBQ0UsU0FBSyxDQUFMO0FBQ0VXLE1BQUFBLFFBQVEsR0FBR0MsdUJBQVg7QUFDQTs7QUFDRixTQUFLLENBQUw7QUFDRSxVQUFJYixZQUFZLENBQUNjLEtBQWIsR0FBcUIsQ0FBekIsRUFBNEI7QUFDMUJGLFFBQUFBLFFBQVEsR0FBR0csd0JBQVg7QUFDRCxPQUZELE1BRU87QUFDTEgsUUFBQUEsUUFBUSxHQUFHSSx3QkFBWDtBQUNEOztBQUNEOztBQUNGLFNBQUssQ0FBTDtBQUNFSixNQUFBQSxRQUFRLEdBQUdLLHdCQUFYO0FBQ0E7O0FBQ0YsU0FBSyxDQUFMO0FBQ0UsVUFBSWpCLFlBQVksQ0FBQ2MsS0FBYixHQUFxQixDQUF6QixFQUE0QjtBQUMxQkYsUUFBQUEsUUFBUSxHQUFHTSx3QkFBWDtBQUNELE9BRkQsTUFFTztBQUNMTixRQUFBQSxRQUFRLEdBQUdPLHdCQUFYO0FBQ0Q7O0FBQ0Q7O0FBQ0YsU0FBSyxFQUFMO0FBQ0VQLE1BQUFBLFFBQVEsR0FBR1Esd0JBQVg7QUFDQTs7QUFDRjtBQUNFckIsTUFBQUEsc0JBQXNCLENBQUNDLFlBQUQsQ0FBdEI7QUFDQVksTUFBQUEsUUFBUSxHQUFHTyx3QkFBWDtBQTFCSjs7QUE0QkEsU0FBTyxJQUFJUCxRQUFKLENBQWFQLElBQWIsRUFBbUJMLFlBQW5CLENBQVA7QUFDRDs7QUFpQkQsZUFBZXFCLGVBQWYsQ0FBZ0NDLElBQWhDLEVBQXNDO0FBQ3BDLE1BQUl0QixZQUFZLEdBQUcsTUFBTU0scUJBQU1DLFVBQU4sQ0FBaUIsSUFBakIsQ0FBekI7QUFFQVIsRUFBQUEsc0JBQXNCLENBQUNDLFlBQUQsQ0FBdEI7O0FBRUFVLGNBQUlDLElBQUosQ0FBVSxtREFBa0RYLFlBQVksQ0FBQ0csYUFBYyxFQUF2Rjs7QUFDQSxNQUFJSCxZQUFZLENBQUNDLEtBQWIsSUFBc0IsQ0FBMUIsRUFBNkI7QUFDM0IsV0FBTyxNQUFNYyx5QkFBZ0JNLGVBQWhCLENBQWdDQyxJQUFoQyxDQUFiO0FBQ0QsR0FGRCxNQUVPLElBQUl0QixZQUFZLENBQUNDLEtBQWIsS0FBdUIsQ0FBM0IsRUFBOEI7QUFDbkMsV0FBTyxNQUFNYyx5QkFBZ0JNLGVBQWhCLENBQWdDQyxJQUFoQyxDQUFiO0FBQ0QsR0FGTSxNQUVBLElBQUl0QixZQUFZLENBQUNDLEtBQWIsS0FBdUIsQ0FBM0IsRUFBOEI7QUFDbkMsV0FBTyxNQUFNWSx3QkFBZ0JRLGVBQWhCLENBQWdDQyxJQUFoQyxDQUFiO0FBQ0Q7QUFDRiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBTaW11bGF0b3JYY29kZTYgZnJvbSAnLi9zaW11bGF0b3IteGNvZGUtNic7XG5pbXBvcnQgU2ltdWxhdG9yWGNvZGU3IGZyb20gJy4vc2ltdWxhdG9yLXhjb2RlLTcnO1xuaW1wb3J0IFNpbXVsYXRvclhjb2RlNzMgZnJvbSAnLi9zaW11bGF0b3IteGNvZGUtNy4zJztcbmltcG9ydCBTaW11bGF0b3JYY29kZTggZnJvbSAnLi9zaW11bGF0b3IteGNvZGUtOCc7XG5pbXBvcnQgU2ltdWxhdG9yWGNvZGU5IGZyb20gJy4vc2ltdWxhdG9yLXhjb2RlLTknO1xuaW1wb3J0IFNpbXVsYXRvclhjb2RlOTMgZnJvbSAnLi9zaW11bGF0b3IteGNvZGUtOS4zJztcbmltcG9ydCBTaW11bGF0b3JYY29kZTEwIGZyb20gJy4vc2ltdWxhdG9yLXhjb2RlLTEwJztcbmltcG9ydCB7IGdldFNpbXVsYXRvckluZm8gfSBmcm9tICcuL3V0aWxzJztcbmltcG9ydCB4Y29kZSBmcm9tICdhcHBpdW0teGNvZGUnO1xuaW1wb3J0IHsgbG9nLCBzZXRMb2dnaW5nUGxhdGZvcm0gfSBmcm9tICcuL2xvZ2dlcic7XG5cblxuZnVuY3Rpb24gaGFuZGxlVW5zdXBwb3J0ZWRYY29kZSAoeGNvZGVWZXJzaW9uKSB7XG4gIGlmICh4Y29kZVZlcnNpb24ubWFqb3IgPCA2KSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBUcmllZCB0byB1c2UgYW4gaU9TIHNpbXVsYXRvciB3aXRoIHhjb2RlIGAgK1xuICAgICAgICAgICAgICAgICAgICBgdmVyc2lvbiAke3hjb2RlVmVyc2lvbi52ZXJzaW9uU3RyaW5nfSBidXQgb25seSBYY29kZSB2ZXJzaW9uIGAgK1xuICAgICAgICAgICAgICAgICAgICBgNi4wLjAgYW5kIHVwIGFyZSBzdXBwb3J0ZWRgKTtcbiAgfVxufVxuXG4vKipcbiAqIEZpbmRzIGFuZCByZXR1cm5zIHRoZSBjb3JyZXNwb25kaW5nIFNpbXVsYXRvciBpbnN0YW5jZSBmb3IgdGhlIGdpdmVuIElELlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSB1ZGlkIC0gVGhlIElEIG9mIGFuIGV4aXN0aW5nIFNpbXVsYXRvci5cbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGUgU2ltdWxhdG9yIHdpdGggZ2l2ZW4gdWRpZCBkb2VzIG5vdCBleGlzdCBpbiBkZXZpY2VzIGxpc3QuXG4gKiAgIElmIHlvdSB3YW50IHRvIGNyZWF0ZSBhIG5ldyBzaW11bGF0b3IsIHlvdSBjYW4gdXNlIHRoZSBgY3JlYXRlRGV2aWNlKClgIG1ldGhvZCBvZlxuICogICBbbm9kZS1zaW1jdGxdKGdpdGh1Yi5jb20vYXBwaXVtL25vZGUtc2ltY3RsKS5cbiAqIEByZXR1cm4ge29iamVjdH0gU2ltdWxhdG9yIG9iamVjdCBhc3NvY2lhdGVkIHdpdGggdGhlIHVkaWQgcGFzc2VkIGluLlxuICovXG5hc3luYyBmdW5jdGlvbiBnZXRTaW11bGF0b3IgKHVkaWQpIHtcbiAgY29uc3QgeGNvZGVWZXJzaW9uID0gYXdhaXQgeGNvZGUuZ2V0VmVyc2lvbih0cnVlKTtcbiAgY29uc3Qgc2ltdWxhdG9ySW5mbyA9IGF3YWl0IGdldFNpbXVsYXRvckluZm8odWRpZCk7XG5cbiAgaWYgKCFzaW11bGF0b3JJbmZvKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBObyBzaW0gZm91bmQgd2l0aCB1ZGlkICcke3VkaWR9J2ApO1xuICB9XG5cbiAgLy8gbWFrZSBzdXJlIHdlIGhhdmUgdGhlIHJpZ2h0IGxvZ2dpbmcgcHJlZml4XG4gIHNldExvZ2dpbmdQbGF0Zm9ybShzaW11bGF0b3JJbmZvLnBsYXRmb3JtKTtcblxuICBsb2cuaW5mbyhgQ29uc3RydWN0aW5nICR7c2ltdWxhdG9ySW5mby5wbGF0Zm9ybSB8fCAnaU9TJ30gc2ltdWxhdG9yIGZvciBYY29kZSB2ZXJzaW9uICR7eGNvZGVWZXJzaW9uLnZlcnNpb25TdHJpbmd9IGAgK1xuICAgICAgICAgICBgd2l0aCB1ZGlkICcke3VkaWR9J2ApO1xuICBsZXQgU2ltQ2xhc3M7XG4gIHN3aXRjaCAoeGNvZGVWZXJzaW9uLm1ham9yKSB7XG4gICAgY2FzZSA2OlxuICAgICAgU2ltQ2xhc3MgPSBTaW11bGF0b3JYY29kZTY7XG4gICAgICBicmVhaztcbiAgICBjYXNlIDc6XG4gICAgICBpZiAoeGNvZGVWZXJzaW9uLm1pbm9yIDwgMykge1xuICAgICAgICBTaW1DbGFzcyA9IFNpbXVsYXRvclhjb2RlNztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIFNpbUNsYXNzID0gU2ltdWxhdG9yWGNvZGU3MztcbiAgICAgIH1cbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgODpcbiAgICAgIFNpbUNsYXNzID0gU2ltdWxhdG9yWGNvZGU4O1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSA5OlxuICAgICAgaWYgKHhjb2RlVmVyc2lvbi5taW5vciA8IDMpIHtcbiAgICAgICAgU2ltQ2xhc3MgPSBTaW11bGF0b3JYY29kZTk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBTaW1DbGFzcyA9IFNpbXVsYXRvclhjb2RlOTM7XG4gICAgICB9XG4gICAgICBicmVhaztcbiAgICBjYXNlIDEwOlxuICAgICAgU2ltQ2xhc3MgPSBTaW11bGF0b3JYY29kZTEwO1xuICAgICAgYnJlYWs7XG4gICAgZGVmYXVsdDpcbiAgICAgIGhhbmRsZVVuc3VwcG9ydGVkWGNvZGUoeGNvZGVWZXJzaW9uKTtcbiAgICAgIFNpbUNsYXNzID0gU2ltdWxhdG9yWGNvZGU5MztcbiAgfVxuICByZXR1cm4gbmV3IFNpbUNsYXNzKHVkaWQsIHhjb2RlVmVyc2lvbik7XG59XG5cbi8qKlxuICogVGFrZXMgYSBzZXQgb2Ygb3B0aW9ucyBhbmQgZmluZHMgdGhlIGNvcnJlY3QgZGV2aWNlIHN0cmluZyBpbiBvcmRlciBmb3IgSW5zdHJ1bWVudHMgdG9cbiAqIGlkZW50aWZ5IHRoZSBjb3JyZWN0IHNpbXVsYXRvci5cbiAqXG4gKiBAcGFyYW0ge29iamVjdH0gb3B0cyAtIFRoZSBvcHRpb25zIGF2YWlsYWJsZSBhcmU6XG4gKiAgIC0gYGRldmljZU5hbWVgIC0gYSBuYW1lIGZvciB0aGUgZGV2aWNlLiBJZiB0aGUgZ2l2ZW4gZGV2aWNlIG5hbWUgc3RhcnRzIHdpdGggYD1gLCB0aGUgbmFtZSwgbGVzcyB0aGUgZXF1YWxzIHNpZ24sIGlzIHJldHVybmVkLlxuICogICAtIGBwbGF0Zm9ybVZlcnNpb25gIC0gdGhlIHZlcnNpb24gb2YgaU9TIHRvIHVzZS4gRGVmYXVsdHMgdG8gdGhlIGN1cnJlbnQgWGNvZGUncyBtYXhpbXVtIFNESyB2ZXJzaW9uLlxuICogICAtIGBmb3JjZUlwaG9uZWAgLSBmb3JjZSB0aGUgY29uZmlndXJhdGlvbiBvZiB0aGUgZGV2aWNlIHN0cmluZyB0byBpUGhvbmUuIERlZmF1bHRzIHRvIGBmYWxzZWAuXG4gKiAgIC0gYGZvcmNlSXBhZGAgLSBmb3JjZSB0aGUgY29uZmlndXJhdGlvbiBvZiB0aGUgZGV2aWNlIHN0cmluZyB0byBpUGFkLiBEZWZhdWx0cyB0byBgZmFsc2VgLlxuICogICBJZiBib3RoIGBmb3JjZUlwaG9uZWAgYW5kIGBmb3JjZUlwYWRgIGFyZSB0cnVlLCB0aGUgZGV2aWNlIHdpbGwgYmUgZm9yY2VkIHRvIGlQaG9uZS5cbiAqXG4gKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBmb3VuZCBkZXZpY2Ugc3RyaW5nLCBmb3IgZXhhbXBsZTpcbiAqICAgJ2lQaG9uZSA1ICg4LjQpJyB3aXRoIFhjb2RlIDcrXG4gKiAgICdpUGhvbmUgNSAoOC40IFNpbXVsYXRvciknIHdpdGggWGNvZGUgNitcbiAqL1xuYXN5bmMgZnVuY3Rpb24gZ2V0RGV2aWNlU3RyaW5nIChvcHRzKSB7XG4gIGxldCB4Y29kZVZlcnNpb24gPSBhd2FpdCB4Y29kZS5nZXRWZXJzaW9uKHRydWUpO1xuXG4gIGhhbmRsZVVuc3VwcG9ydGVkWGNvZGUoeGNvZGVWZXJzaW9uKTtcblxuICBsb2cuaW5mbyhgUmV0cmlldmluZyBkZXZpY2UgbmFtZSBzdHJpbmcgZm9yIFhjb2RlIHZlcnNpb24gJHt4Y29kZVZlcnNpb24udmVyc2lvblN0cmluZ31gKTtcbiAgaWYgKHhjb2RlVmVyc2lvbi5tYWpvciA+PSA4KSB7XG4gICAgcmV0dXJuIGF3YWl0IFNpbXVsYXRvclhjb2RlNy5nZXREZXZpY2VTdHJpbmcob3B0cyk7XG4gIH0gZWxzZSBpZiAoeGNvZGVWZXJzaW9uLm1ham9yID09PSA3KSB7XG4gICAgcmV0dXJuIGF3YWl0IFNpbXVsYXRvclhjb2RlNy5nZXREZXZpY2VTdHJpbmcob3B0cyk7XG4gIH0gZWxzZSBpZiAoeGNvZGVWZXJzaW9uLm1ham9yID09PSA2KSB7XG4gICAgcmV0dXJuIGF3YWl0IFNpbXVsYXRvclhjb2RlNi5nZXREZXZpY2VTdHJpbmcob3B0cyk7XG4gIH1cbn1cblxuZXhwb3J0IHsgZ2V0U2ltdWxhdG9yLCBnZXREZXZpY2VTdHJpbmcgfTtcbiJdLCJmaWxlIjoibGliL3NpbXVsYXRvci5qcyIsInNvdXJjZVJvb3QiOiIuLi8uLiJ9
