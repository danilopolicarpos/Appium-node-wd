"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.SPRINGBOARD_BUNDLE_ID = exports.BOOT_COMPLETED_EVENT = exports.SimulatorXcode6 = exports.default = void 0;

require("source-map-support/register");

var _path = _interopRequireDefault(require("path"));

var simctl = _interopRequireWildcard(require("node-simctl"));

var _appiumXcode = _interopRequireWildcard(require("appium-xcode"));

var _logger = _interopRequireDefault(require("./logger"));

var _appiumSupport = require("appium-support");

var _bluebird = _interopRequireDefault(require("bluebird"));

var _lodash = _interopRequireDefault(require("lodash"));

var _asyncLock = _interopRequireDefault(require("async-lock"));

var _utils = require("./utils.js");

var _asyncbox = require("asyncbox");

var settings = _interopRequireWildcard(require("./settings"));

var _teen_process = require("teen_process");

var _tailUntil = require("./tail-until.js");

var _index = _interopRequireDefault(require("./extensions/index"));

var _events = require("events");

var _calendar = _interopRequireDefault(require("./calendar"));

var _permissions = _interopRequireDefault(require("./permissions"));

const STARTUP_TIMEOUT = 60 * 1000;
const EXTRA_STARTUP_TIME = 2000;
const UI_CLIENT_ACCESS_GUARD = new _asyncLock.default();
const UI_CLIENT_BUNDLE_ID = 'com.apple.iphonesimulator';
const SPRINGBOARD_BUNDLE_ID = 'com.apple.SpringBoard';
exports.SPRINGBOARD_BUNDLE_ID = SPRINGBOARD_BUNDLE_ID;
const BOOT_COMPLETED_EVENT = 'bootCompleted';
exports.BOOT_COMPLETED_EVENT = BOOT_COMPLETED_EVENT;

class SimulatorXcode6 extends _events.EventEmitter {
  constructor(udid, xcodeVersion) {
    super();
    this.udid = String(udid);
    this.xcodeVersion = xcodeVersion;
    this._platformVersion = null;
    this.keychainPath = _path.default.resolve(this.getDir(), 'Library', 'Keychains');
    this.simulatorApp = 'iOS Simulator.app';
    this.appDataBundlePaths = {};
    this.isFreshFiles = ['Library/ConfigurationProfiles', 'Library/Cookies', 'Library/Preferences/.GlobalPreferences.plist', 'Library/Preferences/com.apple.springboard.plist', 'var/run/syslog.pid'];
    this.extraStartupTime = EXTRA_STARTUP_TIME;
    this.calendar = new _calendar.default(xcodeVersion, this.getDir());
    this.permissions = new _permissions.default(xcodeVersion, this.getDir(), this.udid);
  }

  get uiClientBundleId() {
    return UI_CLIENT_BUNDLE_ID;
  }

  async getUIClientPid() {
    let stdout;

    try {
      ({
        stdout
      } = await (0, _teen_process.exec)('pgrep', ['-fn', `${this.simulatorApp}/Contents/MacOS/`]));
    } catch (e) {
      return null;
    }

    if (isNaN(parseInt(stdout, 10))) {
      return null;
    }

    stdout = stdout.trim();

    _logger.default.debug(`Got Simulator UI client PID: ${stdout}`);

    return stdout;
  }

  async isUIClientRunning() {
    return !_lodash.default.isNull((await this.getUIClientPid()));
  }

  get startupTimeout() {
    return STARTUP_TIMEOUT;
  }

  async getPlatformVersion() {
    if (!this._platformVersion) {
      let {
        sdk
      } = await this.stat();
      this._platformVersion = sdk;
    }

    return this._platformVersion;
  }

  getRootDir() {
    let home = process.env.HOME;
    return _path.default.resolve(home, 'Library', 'Developer', 'CoreSimulator', 'Devices');
  }

  getDir() {
    return _path.default.resolve(this.getRootDir(), this.udid, 'data');
  }

  getLogDir() {
    let home = process.env.HOME;
    return _path.default.resolve(home, 'Library', 'Logs', 'CoreSimulator', this.udid);
  }

  async installApp(app) {
    return await simctl.installApp(this.udid, app);
  }

  async isAppInstalled(bundleId, appFile = null) {
    let appDirs = await this.getAppDirs(appFile, bundleId);
    return appDirs.length !== 0;
  }

  async getAppDir(id, subDir = 'Data') {
    this.appDataBundlePaths[subDir] = this.appDataBundlePaths[subDir] || {};

    if (_lodash.default.isEmpty(this.appDataBundlePaths[subDir]) && !(await this.isFresh())) {
      this.appDataBundlePaths[subDir] = await this.buildBundlePathMap(subDir);
    }

    return this.appDataBundlePaths[subDir][id];
  }

  async buildBundlePathMap(subDir = 'Data') {
    _logger.default.debug('Building bundle path map');

    let applicationList;
    let pathBundlePair;

    if ((await this.getPlatformVersion()) === '7.1') {
      applicationList = _path.default.resolve(this.getDir(), 'Applications');

      pathBundlePair = async dir => {
        dir = _path.default.resolve(applicationList, dir);
        let appFiles = await _appiumSupport.fs.glob(`${dir}/*.app`);
        let bundleId = appFiles[0].match(/.*\/(.*)\.app/)[1];
        return {
          path: dir,
          bundleId
        };
      };
    } else {
      applicationList = _path.default.resolve(this.getDir(), 'Containers', subDir, 'Application');

      let readBundleId = async dir => {
        let plist = _path.default.resolve(dir, '.com.apple.mobile_container_manager.metadata.plist');

        let metadata = await settings.read(plist);
        return metadata.MCMMetadataIdentifier;
      };

      pathBundlePair = async dir => {
        dir = _path.default.resolve(applicationList, dir);
        let bundleId = await readBundleId(dir);
        return {
          path: dir,
          bundleId
        };
      };
    }

    let bundlePathDirs = await _appiumSupport.fs.readdir(applicationList);
    let bundlePathPairs = await (0, _asyncbox.asyncmap)(bundlePathDirs, async dir => {
      return await pathBundlePair(dir);
    }, false);
    return bundlePathPairs.reduce((bundleMap, bundlePath) => {
      bundleMap[bundlePath.bundleId] = bundlePath.path;
      return bundleMap;
    }, {});
  }

  async stat() {
    for (let [sdk, deviceArr] of _lodash.default.toPairs((await simctl.getDevices()))) {
      for (let device of deviceArr) {
        if (device.udid === this.udid) {
          device.sdk = sdk;
          return device;
        }
      }
    }

    return {};
  }

  async isFresh() {
    let files = this.isFreshFiles;
    let pv = await this.getPlatformVersion();

    if (pv !== '7.1') {
      files.push('Library/Preferences/com.apple.Preferences.plist');
    } else {
      files.push('Applications');
    }

    const dir = this.getDir();
    files = files.map(s => _path.default.resolve(dir, s));
    const existences = await (0, _asyncbox.asyncmap)(files, async f => await _appiumSupport.fs.hasAccess(f));
    const fresh = _lodash.default.compact(existences).length !== files.length;

    _logger.default.debug(`Checking whether simulator has been run before: ${fresh ? 'no' : 'yes'}`);

    return fresh;
  }

  async isRunning() {
    let stat = await this.stat();
    return stat.state === 'Booted';
  }

  async waitForBoot(startupTimeout) {
    let bootedIndicator = await this.getBootedIndicatorString();
    await this.tailLogsUntil(bootedIndicator, startupTimeout);

    _logger.default.debug(`Waiting an extra ${this.extraStartupTime}ms for the simulator to really finish booting`);

    await _bluebird.default.delay(this.extraStartupTime);

    _logger.default.debug('Done waiting extra time for simulator');

    this.emit(BOOT_COMPLETED_EVENT);
  }

  async getBootedIndicatorString() {
    let indicator;
    let platformVersion = await this.getPlatformVersion();

    switch (platformVersion) {
      case '7.1':
      case '8.1':
      case '8.2':
      case '8.3':
      case '8.4':
        indicator = 'profiled: Service starting...';
        break;

      case '9.0':
      case '9.1':
      case '9.2':
      case '9.3':
        indicator = 'System app "com.apple.springboard" finished startup';
        break;

      case '10.0':
        indicator = 'Switching to keyboard';
        break;

      default:
        _logger.default.warn(`No boot indicator case for platform version '${platformVersion}'`);

        indicator = 'no boot indicator string available';
    }

    return indicator;
  }

  async startUIClient(opts = {}) {
    opts = Object.assign({
      scaleFactor: null,
      connectHardwareKeyboard: false,
      startupTimeout: this.startupTimeout
    }, opts);

    const simulatorApp = _path.default.resolve((await (0, _appiumXcode.getPath)()), 'Applications', this.simulatorApp);

    const args = ['-Fn', simulatorApp, '--args', '-CurrentDeviceUDID', this.udid];

    if (opts.scaleFactor) {
      const stat = await this.stat();
      const formattedDeviceName = stat.name.replace(/\s+/g, '-');
      const argumentName = `-SimulatorWindowLastScale-com.apple.CoreSimulator.SimDeviceType.${formattedDeviceName}`;
      args.push(argumentName, opts.scaleFactor);
    }

    if (_lodash.default.isBoolean(opts.connectHardwareKeyboard)) {
      args.push('-ConnectHardwareKeyboard', opts.connectHardwareKeyboard ? '1' : '0');
    }

    _logger.default.info(`Starting Simulator UI with command: open ${args.join(' ')}`);

    try {
      await (0, _teen_process.exec)('open', args, {
        timeout: opts.startupTimeout
      });
    } catch (err) {
      if (!(err.stdout || '').includes('-10825') && !(err.stderr || '').includes('-10825')) {
        throw err;
      }

      _logger.default.warn(`Error while opening UI: ${err.stdout || err.stderr}. Continuing`);
    }
  }

  async run(opts = {}) {
    opts = Object.assign({
      startupTimeout: this.startupTimeout
    }, opts);
    const {
      state
    } = await this.stat();
    const isServerRunning = state === 'Booted';
    const isUIClientRunning = await this.isUIClientRunning();

    if (isServerRunning && isUIClientRunning) {
      _logger.default.info(`Both Simulator with UDID ${this.udid} and the UI client are currently running`);

      return;
    }

    const startTime = process.hrtime();

    try {
      await this.shutdown();
    } catch (err) {
      _logger.default.warn(`Error on Simulator shutdown: ${err.message}`);
    }

    await this.startUIClient(opts);
    await this.waitForBoot(opts.startupTimeout);

    _logger.default.info(`Simulator with UDID ${this.udid} booted in ${process.hrtime(startTime)[0]} seconds`);
  }

  async clean() {
    await this.endSimulatorDaemon();

    _logger.default.info(`Cleaning simulator ${this.udid}`);

    await simctl.eraseDevice(this.udid, 10000);
  }

  async scrubCustomApp(appFile, appBundleId) {
    return await this.cleanCustomApp(appFile, appBundleId, true);
  }

  async cleanCustomApp(appFile, appBundleId, scrub = false) {
    _logger.default.debug(`Cleaning app data files for '${appFile}', '${appBundleId}'`);

    if (!scrub) {
      _logger.default.debug(`Deleting app altogether`);
    }

    let appDirs = await this.getAppDirs(appFile, appBundleId, scrub);

    if (appDirs.length === 0) {
      _logger.default.debug('Could not find app directories to delete. It is probably not installed');

      return;
    }

    let deletePromises = [];

    for (let dir of appDirs) {
      _logger.default.debug(`Deleting directory: '${dir}'`);

      deletePromises.push(_appiumSupport.fs.rimraf(dir));
    }

    if ((await this.getPlatformVersion()) >= 8) {
      let relRmPath = `Library/Preferences/${appBundleId}.plist`;

      let rmPath = _path.default.resolve(this.getRootDir(), relRmPath);

      _logger.default.debug(`Deleting file: '${rmPath}'`);

      deletePromises.push(_appiumSupport.fs.rimraf(rmPath));
    }

    await _bluebird.default.all(deletePromises);
  }

  async getAppDirs(appFile, appBundleId, scrub = false) {
    let dirs = [];

    if ((await this.getPlatformVersion()) >= 8) {
      let data = await this.getAppDir(appBundleId);
      if (!data) return dirs;
      let bundle = !scrub ? await this.getAppDir(appBundleId, 'Bundle') : undefined;

      for (let src of [data, bundle]) {
        if (src) {
          dirs.push(src);
        }
      }
    } else {
      let data = await this.getAppDir(appFile);

      if (data) {
        dirs.push(data);
      }
    }

    return dirs;
  }

  async launchAndQuit(safari = false, startupTimeout = this.startupTimeout) {
    _logger.default.debug('Attempting to launch and quit the simulator, to create directory structure');

    _logger.default.debug(`Will launch with Safari? ${safari}`);

    await this.run(startupTimeout);

    if (safari) {
      await this.openUrl('http://www.appium.io');
    }

    try {
      await (0, _asyncbox.retryInterval)(60, 250, async () => {
        if (await this.isFresh()) {
          throw new Error('Simulator files not fully created. Waiting a bit');
        }
      });
    } catch (err) {
      _logger.default.warn(`Timeout waiting for simulator files to be created. Continuing`);
    }

    await this.shutdown();
  }

  async endSimulatorDaemon() {
    _logger.default.debug(`Killing any simulator daemons for ${this.udid}`);

    let launchctlCmd = `launchctl list | grep ${this.udid} | cut -f 3 | xargs -n 1 launchctl`;

    try {
      let stopCmd = `${launchctlCmd} stop`;
      await (0, _teen_process.exec)('bash', ['-c', stopCmd]);
    } catch (err) {
      _logger.default.warn(`Could not stop simulator daemons: ${err.message}`);

      _logger.default.debug('Carrying on anyway!');
    }

    try {
      let removeCmd = `${launchctlCmd} remove`;
      await (0, _teen_process.exec)('bash', ['-c', removeCmd]);
    } catch (err) {
      _logger.default.warn(`Could not remove simulator daemons: ${err.message}`);

      _logger.default.debug('Carrying on anyway!');
    }

    try {
      await (0, _asyncbox.waitForCondition)(async () => {
        let {
          stdout
        } = await (0, _teen_process.exec)('bash', ['-c', `ps -e  | grep ${this.udid} | grep launchd_sim | grep -v bash | grep -v grep | awk {'print$1'}`]);
        return stdout.trim().length === 0;
      }, {
        waitMs: 10000,
        intervalMs: 500
      });
    } catch (err) {
      _logger.default.warn(`Could not end simulator daemon for ${this.udid}: ${err.message}`);

      _logger.default.debug('Carrying on anyway!');
    }
  }

  async shutdown() {
    await (0, _utils.killAllSimulators)();
  }

  async delete() {
    await simctl.deleteDevice(this.udid);
  }

  async updateSettings(plist, updates) {
    return await settings.updateSettings(this, plist, updates);
  }

  async updateLocationSettings(bundleId, authorized) {
    return await settings.updateLocationSettings(this, bundleId, authorized);
  }

  async setReduceMotion(reduceMotion = true) {
    if (await this.isFresh()) {
      await this.launchAndQuit(false, STARTUP_TIMEOUT);
    }

    await settings.setReduceMotion(this, reduceMotion);
  }

  async updateSafariSettings(updates) {
    let updated = await settings.updateSafariUserSettings(this, updates);
    return (await settings.updateSettings(this, 'mobileSafari', updates)) || updated;
  }

  async updateLocale(language, locale, calendarFormat) {
    return await settings.updateLocale(this, language, locale, calendarFormat);
  }

  async deleteSafari() {
    _logger.default.debug('Deleting Safari apps from simulator');

    let dirs = [];
    dirs.push((await this.getAppDir('com.apple.mobilesafari')));
    let pv = await this.getPlatformVersion();

    if (pv >= 8) {
      dirs.push((await this.getAppDir('com.apple.mobilesafari', 'Bundle')));
    }

    let deletePromises = [];

    for (let dir of _lodash.default.compact(dirs)) {
      _logger.default.debug(`Deleting directory: '${dir}'`);

      deletePromises.push(_appiumSupport.fs.rimraf(dir));
    }

    await _bluebird.default.all(deletePromises);
  }

  async cleanSafari(keepPrefs = true) {
    _logger.default.debug('Cleaning mobile safari data files');

    if (await this.isFresh()) {
      _logger.default.info('Could not find Safari support directories to clean out old ' + 'data. Probably there is nothing to clean out');

      return;
    }

    let libraryDir = _path.default.resolve(this.getDir(), 'Library');

    let safariRoot = await this.getAppDir('com.apple.mobilesafari');

    if (!safariRoot) {
      _logger.default.info('Could not find Safari support directories to clean out old ' + 'data. Probably there is nothing to clean out');

      return;
    }

    let safariLibraryDir = _path.default.resolve(safariRoot, 'Library');

    let filesToDelete = ['Caches/Snapshots/com.apple.mobilesafari', 'Caches/com.apple.mobilesafari/*', 'Caches/com.apple.WebAppCache/*', 'Caches/com.apple.WebKit.Networking/*', 'Caches/com.apple.WebKit.WebContent/*', 'Image Cache/*', 'WebKit/com.apple.mobilesafari/*', 'WebKit/GeolocationSites.plist', 'WebKit/LocalStorage/*.*', 'Safari/*', 'Cookies/*.binarycookies', 'Caches/com.apple.UIStatusBar/*', 'Caches/com.apple.keyboards/images/*', 'Caches/com.apple.Safari.SafeBrowsing/*', '../tmp/com.apple.mobilesafari/*'];
    let deletePromises = [];

    for (let file of filesToDelete) {
      deletePromises.push(_appiumSupport.fs.rimraf(_path.default.resolve(libraryDir, file)));
      deletePromises.push(_appiumSupport.fs.rimraf(_path.default.resolve(safariLibraryDir, file)));
    }

    if (!keepPrefs) {
      deletePromises.push(_appiumSupport.fs.rimraf(_path.default.resolve(safariLibraryDir, 'Preferences/*.plist')));
    }

    await _bluebird.default.all(deletePromises);
  }

  async removeApp(bundleId) {
    await simctl.removeApp(this.udid, bundleId);
  }

  async moveBuiltInApp(appName, appPath, newAppPath) {
    await (0, _utils.safeRimRaf)(newAppPath);
    await _appiumSupport.fs.copyFile(appPath, newAppPath);

    _logger.default.debug(`Copied '${appName}' to '${newAppPath}'`);

    await _appiumSupport.fs.rimraf(appPath);

    _logger.default.debug(`Temporarily deleted original app at '${appPath}'`);

    return [newAppPath, appPath];
  }

  async openUrl(url) {
    const SAFARI_BOOTED_INDICATOR = 'MobileSafari[';
    const SAFARI_STARTUP_TIMEOUT = 15 * 1000;
    const EXTRA_STARTUP_TIME = 3 * 1000;

    if (await this.isRunning()) {
      await (0, _asyncbox.retry)(5000, simctl.openUrl, this.udid, url);
      await this.tailLogsUntil(SAFARI_BOOTED_INDICATOR, SAFARI_STARTUP_TIMEOUT);

      _logger.default.debug(`Safari started, waiting ${EXTRA_STARTUP_TIME}ms for it to fully start`);

      await _bluebird.default.delay(EXTRA_STARTUP_TIME);

      _logger.default.debug('Done waiting for Safari');

      return;
    } else {
      throw new Error('Tried to open a url, but the Simulator is not Booted');
    }
  }

  async clearCaches(...folderNames) {
    const cachesRoot = _path.default.resolve(this.getDir(), 'Library', 'Caches');

    if (!(await _appiumSupport.fs.hasAccess(cachesRoot))) {
      _logger.default.debug(`Caches root at '${cachesRoot}' does not exist or is not accessible. Nothing to do there`);

      return 0;
    }

    let itemsToRemove = folderNames.length ? folderNames : await _appiumSupport.fs.readdir(cachesRoot);
    itemsToRemove = itemsToRemove.map(x => _path.default.resolve(cachesRoot, x));

    if (folderNames.length) {
      itemsToRemove = await _bluebird.default.filter(itemsToRemove, x => _appiumSupport.fs.hasAccess(x));
    }

    itemsToRemove = await _bluebird.default.filter(itemsToRemove, async x => (await _appiumSupport.fs.stat(x)).isDirectory());

    if (!itemsToRemove.length) {
      _logger.default.debug(`No Simulator cache items for cleanup were matched in '${cachesRoot}'`);

      return 0;
    }

    _logger.default.debug(`Matched ${itemsToRemove.length} Simulator cache ` + `item${itemsToRemove.length === 1 ? '' : 's'} for cleanup: ${itemsToRemove}`);

    try {
      await _bluebird.default.all(itemsToRemove, x => _appiumSupport.fs.rimraf(x));
    } catch (e) {
      _logger.default.warn(`Got an exception while cleaning Simulator caches: ${e.message}`);
    }

    return itemsToRemove.length;
  }

  async tailLogsUntil(bootedIndicator, timeoutMs) {
    let simLog = _path.default.resolve(this.getLogDir(), 'system.log');

    await (0, _asyncbox.retryInterval)(200, 200, async () => {
      let exists = await _appiumSupport.fs.exists(simLog);

      if (!exists) {
        throw new Error(`Could not find Simulator log: '${simLog}'`);
      }
    });

    _logger.default.info(`Simulator log at '${simLog}'`);

    _logger.default.info(`Tailing simulator logs until we encounter the string "${bootedIndicator}"`);

    _logger.default.info(`We will time out after ${timeoutMs}ms`);

    try {
      await (0, _tailUntil.tailUntil)(simLog, bootedIndicator, timeoutMs);
    } catch (err) {
      _logger.default.debug('Simulator startup timed out. Continuing anyway.');
    }
  }

  async enableCalendarAccess(bundleID) {
    await this.calendar.enableCalendarAccess(bundleID);
  }

  async disableCalendarAccess(bundleID) {
    await this.calendar.disableCalendarAccess(bundleID);
  }

  async hasCalendarAccess(bundleID) {
    return await this.calendar.hasCalendarAccess(bundleID);
  }

  async _activateWindow() {
    return `
      tell application "System Events"
        tell process "Simulator"
          set frontmost to false
          set frontmost to true
        end tell
      end tell
    `;
  }

  async executeUIClientScript(appleScript) {
    const windowActivationScript = await this._activateWindow();
    const resultScript = `${windowActivationScript ? windowActivationScript + '\n' : ''}${appleScript}`;

    _logger.default.debug(`Executing UI Apple Script on Simulator with UDID ${this.udid}: ${resultScript}`);

    return await UI_CLIENT_ACCESS_GUARD.acquire(this.simulatorApp, async () => {
      try {
        const {
          stdout
        } = await (0, _teen_process.exec)('osascript', ['-e', resultScript]);
        return stdout;
      } catch (err) {
        _logger.default.errorAndThrow(`Could not complete operation. Make sure Simulator UI is running and the parent Appium application (e. g. Appium.app or Terminal.app) ` + `is present in System Preferences > Security & Privacy > Privacy > Accessibility list. If the operation is still unsuccessful then ` + `it is not supported by this Simulator. ` + `Original error: ${err.message}`);
      }
    });
  }

  async isBiometricEnrolled() {
    const output = await this.executeUIClientScript(`
      tell application "System Events"
        tell process "Simulator"
          set dstMenuItem to menu item "Touch ID Enrolled" of menu 1 of menu bar item "Hardware" of menu bar 1
          set isChecked to (value of attribute "AXMenuItemMarkChar" of dstMenuItem) is "✓"
        end tell
      end tell
    `);

    _logger.default.debug(`Touch ID enrolled state: ${output}`);

    return _lodash.default.isString(output) && output.trim() === 'true';
  }

  async enrollBiometric(isEnabled = true) {
    await this.executeUIClientScript(`
      tell application "System Events"
        tell process "Simulator"
          set dstMenuItem to menu item "Touch ID Enrolled" of menu 1 of menu bar item "Hardware" of menu bar 1
          set isChecked to (value of attribute "AXMenuItemMarkChar" of dstMenuItem) is "✓"
          if ${isEnabled ? 'not ' : ''}isChecked then
            click dstMenuItem
          end if
        end tell
      end tell
    `);
  }

  async sendBiometricMatch(shouldMatch = true) {
    await this.executeUIClientScript(`
      tell application "System Events"
        tell process "Simulator"
          set dstMenuItem to menu item "${shouldMatch ? 'Matching' : 'Non-matching'}" of menu 1 of menu item "Simulate Finger Touch" of menu 1 of menu bar item "Hardware" of menu bar 1
          click dstMenuItem
        end tell
      end tell
    `);
  }

  async dismissDatabaseAlert(increase = true) {
    let button = increase ? 'Increase' : 'Cancel';

    _logger.default.debug(`Attempting to dismiss database alert with '${button}' button`);

    await this.executeUIClientScript(`
      tell application "System Events"
        tell process "Simulator"
          click button "${button}" of window 1
        end tell
      end tell
    `);
  }

  async backupKeychains() {
    if (!(await _appiumSupport.fs.exists(this.keychainPath))) {
      return false;
    }

    const backupPath = await _appiumSupport.tempDir.path({
      prefix: `keychains_backup_${Math.floor((1 + Math.random()) * 0x10000).toString(16).substring(1)}`,
      suffix: '.zip'
    });
    const zipArgs = ['-r', backupPath, `${this.keychainPath}${_path.default.sep}`];

    _logger.default.debug(`Creating keychains backup with 'zip ${zipArgs.join(' ')}' command`);

    await (0, _teen_process.exec)('zip', zipArgs);

    if (_lodash.default.isString(this._keychainsBackupPath) && (await _appiumSupport.fs.exists(this._keychainsBackupPath))) {
      await _appiumSupport.fs.unlink(this._keychainsBackupPath);
    }

    this._keychainsBackupPath = backupPath;
    return true;
  }

  async restoreKeychains(excludePatterns = []) {
    if (!_lodash.default.isString(this._keychainsBackupPath) || !(await _appiumSupport.fs.exists(this._keychainsBackupPath))) {
      throw new Error(`The keychains backup archive does not exist. ` + `Are you sure it was created before?`);
    }

    if (_lodash.default.isString(excludePatterns)) {
      excludePatterns = excludePatterns.split(',').map(x => x.trim());
    }

    const {
      state
    } = await this.stat();
    const isServerRunning = state === 'Booted';
    let plistPath;

    if (isServerRunning) {
      plistPath = _path.default.resolve((await this.getLaunchDaemonsRoot()), 'com.apple.securityd.plist');

      if (!(await _appiumSupport.fs.exists(plistPath))) {
        throw new Error(`Cannot clear keychains because '${plistPath}' does not exist`);
      }

      await simctl.spawn(this.udid, ['launchctl', 'unload', plistPath]);
    }

    try {
      await _appiumSupport.fs.rimraf(this.keychainPath);
      await (0, _appiumSupport.mkdirp)(this.keychainPath);
      const unzipArgs = ['-o', this._keychainsBackupPath, ..._lodash.default.flatMap(excludePatterns.map(x => ['-x', x])), '-d', '/'];

      _logger.default.debug(`Restoring keychains with 'unzip ${unzipArgs.join(' ')}' command`);

      await (0, _teen_process.exec)('unzip', unzipArgs);
      await _appiumSupport.fs.unlink(this._keychainsBackupPath);
      this._keychainsBackupPath = null;
    } finally {
      if (isServerRunning && plistPath) {
        await simctl.spawn(this.udid, ['launchctl', 'load', plistPath]);
      }
    }

    return true;
  }

  async clearKeychains() {
    const plistPath = _path.default.resolve((await this.getLaunchDaemonsRoot()), 'com.apple.securityd.plist');

    if (!(await _appiumSupport.fs.exists(plistPath))) {
      throw new Error(`Cannot clear keychains because '${plistPath}' does not exist`);
    }

    await simctl.spawn(this.udid, ['launchctl', 'unload', plistPath]);

    try {
      if (await _appiumSupport.fs.exists(this.keychainPath)) {
        await _appiumSupport.fs.rimraf(this.keychainPath);
        await (0, _appiumSupport.mkdirp)(this.keychainPath);
      }
    } finally {
      await simctl.spawn(this.udid, ['launchctl', 'load', plistPath]);
    }
  }

  async setPermissions(bundleId, permissionsMapping) {
    await this.permissions.setAccess(permissionsMapping, bundleId);

    _logger.default.debug(`Set ${JSON.stringify(permissionsMapping)} access for '${bundleId}'`);
  }

  async getPermission(bundleId, serviceName) {
    const result = await this.permissions.getAccess(serviceName, bundleId);

    _logger.default.debug(`Got ${serviceName} access status for '${bundleId}': ${result}`);

    return result;
  }

  async getLaunchDaemonsRoot() {
    const devRoot = await (0, _utils.getDeveloperRoot)();
    return _path.default.resolve(devRoot, 'Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator.sdk/System/Library/LaunchDaemons');
  }

  static async _getDeviceStringPlatformVersion(platformVersion) {
    let reqVersion = platformVersion;

    if (!reqVersion) {
      reqVersion = await _appiumXcode.default.getMaxIOSSDK();

      _logger.default.warn(`No platform version set. Using max SDK version: ${reqVersion}`);

      if (!_lodash.default.isString(reqVersion)) {
        reqVersion = reqVersion % 1 ? String(reqVersion) : `${reqVersion}.0`;
      }
    }

    return reqVersion;
  }

  static async _getDeviceStringVersionString(platformVersion) {
    let reqVersion = await this._getDeviceStringPlatformVersion(platformVersion);
    return `(${reqVersion} Simulator)`;
  }

  static _getDeviceStringConfigFix() {
    return {
      'iPad Simulator (7.1 Simulator)': 'iPad 2 (7.1 Simulator)',
      'iPad Simulator (8.0 Simulator)': 'iPad 2 (8.0 Simulator)',
      'iPad Simulator (8.1 Simulator)': 'iPad 2 (8.1 Simulator)',
      'iPad Simulator (8.2 Simulator)': 'iPad 2 (8.2 Simulator)',
      'iPad Simulator (8.3 Simulator)': 'iPad 2 (8.3 Simulator)',
      'iPad Simulator (8.4 Simulator)': 'iPad 2 (8.4 Simulator)',
      'iPhone Simulator (7.1 Simulator)': 'iPhone 5s (7.1 Simulator)',
      'iPhone Simulator (8.4 Simulator)': 'iPhone 6 (8.4 Simulator)',
      'iPhone Simulator (8.3 Simulator)': 'iPhone 6 (8.3 Simulator)',
      'iPhone Simulator (8.2 Simulator)': 'iPhone 6 (8.2 Simulator)',
      'iPhone Simulator (8.1 Simulator)': 'iPhone 6 (8.1 Simulator)',
      'iPhone Simulator (8.0 Simulator)': 'iPhone 6 (8.0 Simulator)'
    };
  }

  static async getDeviceString(opts) {
    opts = Object.assign({}, {
      deviceName: null,
      platformVersion: null,
      forceIphone: false,
      forceIpad: false
    }, opts);
    let logOpts = {
      deviceName: opts.deviceName,
      platformVersion: opts.platformVersion,
      forceIphone: opts.forceIphone,
      forceIpad: opts.forceIpad
    };

    _logger.default.debug(`Getting device string from options: ${JSON.stringify(logOpts)}`);

    if ((opts.deviceName || '')[0] === '=') {
      return opts.deviceName.substring(1);
    }

    let isiPhone = !!opts.forceIphone || !opts.forceIpad;

    if (opts.deviceName) {
      let device = opts.deviceName.toLowerCase();

      if (device.indexOf('iphone') !== -1) {
        isiPhone = true;
      } else if (device.indexOf('ipad') !== -1) {
        isiPhone = false;
      }
    }

    let iosDeviceString = opts.deviceName || (isiPhone ? 'iPhone Simulator' : 'iPad Simulator');

    if (/^(iPhone|iPad)$/.test(iosDeviceString)) {
      iosDeviceString += ' Simulator';
    }

    if (/[^(iPhone|iPad)] Simulator/.test(iosDeviceString)) {
      iosDeviceString = iosDeviceString.replace(' Simulator', '');
    }

    iosDeviceString += ` ${await this._getDeviceStringVersionString(opts.platformVersion)}`;

    let CONFIG_FIX = this._getDeviceStringConfigFix();

    let configFix = CONFIG_FIX;

    if (configFix[iosDeviceString]) {
      iosDeviceString = configFix[iosDeviceString];

      _logger.default.debug(`Fixing device. Changed from '${opts.deviceName}' ` + `to '${iosDeviceString}'`);
    }

    _logger.default.debug(`Final device string is '${iosDeviceString}'`);

    return iosDeviceString;
  }

  async getWebInspectorSocket() {
    return null;
  }

}

exports.SimulatorXcode6 = SimulatorXcode6;

for (let [cmd, fn] of _lodash.default.toPairs(_index.default)) {
  SimulatorXcode6.prototype[cmd] = fn;
}

var _default = SimulatorXcode6;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9zaW11bGF0b3IteGNvZGUtNi5qcyJdLCJuYW1lcyI6WyJTVEFSVFVQX1RJTUVPVVQiLCJFWFRSQV9TVEFSVFVQX1RJTUUiLCJVSV9DTElFTlRfQUNDRVNTX0dVQVJEIiwiQXN5bmNMb2NrIiwiVUlfQ0xJRU5UX0JVTkRMRV9JRCIsIlNQUklOR0JPQVJEX0JVTkRMRV9JRCIsIkJPT1RfQ09NUExFVEVEX0VWRU5UIiwiU2ltdWxhdG9yWGNvZGU2IiwiRXZlbnRFbWl0dGVyIiwiY29uc3RydWN0b3IiLCJ1ZGlkIiwieGNvZGVWZXJzaW9uIiwiU3RyaW5nIiwiX3BsYXRmb3JtVmVyc2lvbiIsImtleWNoYWluUGF0aCIsInBhdGgiLCJyZXNvbHZlIiwiZ2V0RGlyIiwic2ltdWxhdG9yQXBwIiwiYXBwRGF0YUJ1bmRsZVBhdGhzIiwiaXNGcmVzaEZpbGVzIiwiZXh0cmFTdGFydHVwVGltZSIsImNhbGVuZGFyIiwiQ2FsZW5kYXIiLCJwZXJtaXNzaW9ucyIsIlBlcm1pc3Npb25zIiwidWlDbGllbnRCdW5kbGVJZCIsImdldFVJQ2xpZW50UGlkIiwic3Rkb3V0IiwiZSIsImlzTmFOIiwicGFyc2VJbnQiLCJ0cmltIiwibG9nIiwiZGVidWciLCJpc1VJQ2xpZW50UnVubmluZyIsIl8iLCJpc051bGwiLCJzdGFydHVwVGltZW91dCIsImdldFBsYXRmb3JtVmVyc2lvbiIsInNkayIsInN0YXQiLCJnZXRSb290RGlyIiwiaG9tZSIsInByb2Nlc3MiLCJlbnYiLCJIT01FIiwiZ2V0TG9nRGlyIiwiaW5zdGFsbEFwcCIsImFwcCIsInNpbWN0bCIsImlzQXBwSW5zdGFsbGVkIiwiYnVuZGxlSWQiLCJhcHBGaWxlIiwiYXBwRGlycyIsImdldEFwcERpcnMiLCJsZW5ndGgiLCJnZXRBcHBEaXIiLCJpZCIsInN1YkRpciIsImlzRW1wdHkiLCJpc0ZyZXNoIiwiYnVpbGRCdW5kbGVQYXRoTWFwIiwiYXBwbGljYXRpb25MaXN0IiwicGF0aEJ1bmRsZVBhaXIiLCJkaXIiLCJhcHBGaWxlcyIsImZzIiwiZ2xvYiIsIm1hdGNoIiwicmVhZEJ1bmRsZUlkIiwicGxpc3QiLCJtZXRhZGF0YSIsInNldHRpbmdzIiwicmVhZCIsIk1DTU1ldGFkYXRhSWRlbnRpZmllciIsImJ1bmRsZVBhdGhEaXJzIiwicmVhZGRpciIsImJ1bmRsZVBhdGhQYWlycyIsInJlZHVjZSIsImJ1bmRsZU1hcCIsImJ1bmRsZVBhdGgiLCJkZXZpY2VBcnIiLCJ0b1BhaXJzIiwiZ2V0RGV2aWNlcyIsImRldmljZSIsImZpbGVzIiwicHYiLCJwdXNoIiwibWFwIiwicyIsImV4aXN0ZW5jZXMiLCJmIiwiaGFzQWNjZXNzIiwiZnJlc2giLCJjb21wYWN0IiwiaXNSdW5uaW5nIiwic3RhdGUiLCJ3YWl0Rm9yQm9vdCIsImJvb3RlZEluZGljYXRvciIsImdldEJvb3RlZEluZGljYXRvclN0cmluZyIsInRhaWxMb2dzVW50aWwiLCJCIiwiZGVsYXkiLCJlbWl0IiwiaW5kaWNhdG9yIiwicGxhdGZvcm1WZXJzaW9uIiwid2FybiIsInN0YXJ0VUlDbGllbnQiLCJvcHRzIiwiT2JqZWN0IiwiYXNzaWduIiwic2NhbGVGYWN0b3IiLCJjb25uZWN0SGFyZHdhcmVLZXlib2FyZCIsImFyZ3MiLCJmb3JtYXR0ZWREZXZpY2VOYW1lIiwibmFtZSIsInJlcGxhY2UiLCJhcmd1bWVudE5hbWUiLCJpc0Jvb2xlYW4iLCJpbmZvIiwiam9pbiIsInRpbWVvdXQiLCJlcnIiLCJpbmNsdWRlcyIsInN0ZGVyciIsInJ1biIsImlzU2VydmVyUnVubmluZyIsInN0YXJ0VGltZSIsImhydGltZSIsInNodXRkb3duIiwibWVzc2FnZSIsImNsZWFuIiwiZW5kU2ltdWxhdG9yRGFlbW9uIiwiZXJhc2VEZXZpY2UiLCJzY3J1YkN1c3RvbUFwcCIsImFwcEJ1bmRsZUlkIiwiY2xlYW5DdXN0b21BcHAiLCJzY3J1YiIsImRlbGV0ZVByb21pc2VzIiwicmltcmFmIiwicmVsUm1QYXRoIiwicm1QYXRoIiwiYWxsIiwiZGlycyIsImRhdGEiLCJidW5kbGUiLCJ1bmRlZmluZWQiLCJzcmMiLCJsYXVuY2hBbmRRdWl0Iiwic2FmYXJpIiwib3BlblVybCIsIkVycm9yIiwibGF1bmNoY3RsQ21kIiwic3RvcENtZCIsInJlbW92ZUNtZCIsIndhaXRNcyIsImludGVydmFsTXMiLCJkZWxldGUiLCJkZWxldGVEZXZpY2UiLCJ1cGRhdGVTZXR0aW5ncyIsInVwZGF0ZXMiLCJ1cGRhdGVMb2NhdGlvblNldHRpbmdzIiwiYXV0aG9yaXplZCIsInNldFJlZHVjZU1vdGlvbiIsInJlZHVjZU1vdGlvbiIsInVwZGF0ZVNhZmFyaVNldHRpbmdzIiwidXBkYXRlZCIsInVwZGF0ZVNhZmFyaVVzZXJTZXR0aW5ncyIsInVwZGF0ZUxvY2FsZSIsImxhbmd1YWdlIiwibG9jYWxlIiwiY2FsZW5kYXJGb3JtYXQiLCJkZWxldGVTYWZhcmkiLCJjbGVhblNhZmFyaSIsImtlZXBQcmVmcyIsImxpYnJhcnlEaXIiLCJzYWZhcmlSb290Iiwic2FmYXJpTGlicmFyeURpciIsImZpbGVzVG9EZWxldGUiLCJmaWxlIiwicmVtb3ZlQXBwIiwibW92ZUJ1aWx0SW5BcHAiLCJhcHBOYW1lIiwiYXBwUGF0aCIsIm5ld0FwcFBhdGgiLCJjb3B5RmlsZSIsInVybCIsIlNBRkFSSV9CT09URURfSU5ESUNBVE9SIiwiU0FGQVJJX1NUQVJUVVBfVElNRU9VVCIsImNsZWFyQ2FjaGVzIiwiZm9sZGVyTmFtZXMiLCJjYWNoZXNSb290IiwiaXRlbXNUb1JlbW92ZSIsIngiLCJmaWx0ZXIiLCJpc0RpcmVjdG9yeSIsInRpbWVvdXRNcyIsInNpbUxvZyIsImV4aXN0cyIsImVuYWJsZUNhbGVuZGFyQWNjZXNzIiwiYnVuZGxlSUQiLCJkaXNhYmxlQ2FsZW5kYXJBY2Nlc3MiLCJoYXNDYWxlbmRhckFjY2VzcyIsIl9hY3RpdmF0ZVdpbmRvdyIsImV4ZWN1dGVVSUNsaWVudFNjcmlwdCIsImFwcGxlU2NyaXB0Iiwid2luZG93QWN0aXZhdGlvblNjcmlwdCIsInJlc3VsdFNjcmlwdCIsImFjcXVpcmUiLCJlcnJvckFuZFRocm93IiwiaXNCaW9tZXRyaWNFbnJvbGxlZCIsIm91dHB1dCIsImlzU3RyaW5nIiwiZW5yb2xsQmlvbWV0cmljIiwiaXNFbmFibGVkIiwic2VuZEJpb21ldHJpY01hdGNoIiwic2hvdWxkTWF0Y2giLCJkaXNtaXNzRGF0YWJhc2VBbGVydCIsImluY3JlYXNlIiwiYnV0dG9uIiwiYmFja3VwS2V5Y2hhaW5zIiwiYmFja3VwUGF0aCIsInRlbXBEaXIiLCJwcmVmaXgiLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJ0b1N0cmluZyIsInN1YnN0cmluZyIsInN1ZmZpeCIsInppcEFyZ3MiLCJzZXAiLCJfa2V5Y2hhaW5zQmFja3VwUGF0aCIsInVubGluayIsInJlc3RvcmVLZXljaGFpbnMiLCJleGNsdWRlUGF0dGVybnMiLCJzcGxpdCIsInBsaXN0UGF0aCIsImdldExhdW5jaERhZW1vbnNSb290Iiwic3Bhd24iLCJ1bnppcEFyZ3MiLCJmbGF0TWFwIiwiY2xlYXJLZXljaGFpbnMiLCJzZXRQZXJtaXNzaW9ucyIsInBlcm1pc3Npb25zTWFwcGluZyIsInNldEFjY2VzcyIsIkpTT04iLCJzdHJpbmdpZnkiLCJnZXRQZXJtaXNzaW9uIiwic2VydmljZU5hbWUiLCJyZXN1bHQiLCJnZXRBY2Nlc3MiLCJkZXZSb290IiwiX2dldERldmljZVN0cmluZ1BsYXRmb3JtVmVyc2lvbiIsInJlcVZlcnNpb24iLCJ4Y29kZSIsImdldE1heElPU1NESyIsIl9nZXREZXZpY2VTdHJpbmdWZXJzaW9uU3RyaW5nIiwiX2dldERldmljZVN0cmluZ0NvbmZpZ0ZpeCIsImdldERldmljZVN0cmluZyIsImRldmljZU5hbWUiLCJmb3JjZUlwaG9uZSIsImZvcmNlSXBhZCIsImxvZ09wdHMiLCJpc2lQaG9uZSIsInRvTG93ZXJDYXNlIiwiaW5kZXhPZiIsImlvc0RldmljZVN0cmluZyIsInRlc3QiLCJDT05GSUdfRklYIiwiY29uZmlnRml4IiwiZ2V0V2ViSW5zcGVjdG9yU29ja2V0IiwiY21kIiwiZm4iLCJleHRlbnNpb25zIiwi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akI7O0FBRUEsUUFBSVksU0FBUyxHQUFHRCxVQUFoQjs7QUFDQSxRQUFJQyxTQUFTLENBQUNILGVBQUQsQ0FBYixFQUFnQztBQUM5QkEsTUFBQUEsZUFBZSxHQUFHRyxTQUFTLENBQUNILGVBQUQsQ0FBM0I7O0FBQ0EzTyxzQkFBSUMsS0FBSixDQUFXLGdDQUErQjJFLElBQUksQ0FBQ3dKLFVBQVcsSUFBaEQsR0FDQyxPQUFNTyxlQUFnQixHQURqQztBQUVEOztBQUVEM08sb0JBQUlDLEtBQUosQ0FBVywyQkFBMEIwTyxlQUFnQixHQUFyRDs7QUFDQSxXQUFPQSxlQUFQO0FBQ0Q7O0FBTUQsUUFBTUkscUJBQU4sR0FBK0I7QUFFN0IsV0FBTyxJQUFQO0FBQ0Q7O0FBL3RDd0M7Ozs7QUFrdUMzQyxLQUFLLElBQUksQ0FBQ0MsR0FBRCxFQUFNQyxFQUFOLENBQVQsSUFBc0I5TyxnQkFBRStDLE9BQUYsQ0FBVWdNLGNBQVYsQ0FBdEIsRUFBNkM7QUFDM0M1USxFQUFBQSxlQUFlLENBQUM2USxTQUFoQixDQUEwQkgsR0FBMUIsSUFBaUNDLEVBQWpDO0FBQ0Q7O2VBRWMzUSxlIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgKiBhcyBzaW1jdGwgZnJvbSAnbm9kZS1zaW1jdGwnO1xuaW1wb3J0IHsgZGVmYXVsdCBhcyB4Y29kZSwgZ2V0UGF0aCBhcyBnZXRYY29kZVBhdGggfSBmcm9tICdhcHBpdW0teGNvZGUnO1xuaW1wb3J0IGxvZyBmcm9tICcuL2xvZ2dlcic7XG5pbXBvcnQgeyBmcywgdGVtcERpciwgbWtkaXJwIH0gZnJvbSAnYXBwaXVtLXN1cHBvcnQnO1xuaW1wb3J0IEIgZnJvbSAnYmx1ZWJpcmQnO1xuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCBBc3luY0xvY2sgZnJvbSAnYXN5bmMtbG9jayc7XG5pbXBvcnQgeyBraWxsQWxsU2ltdWxhdG9ycywgc2FmZVJpbVJhZiwgZ2V0RGV2ZWxvcGVyUm9vdCB9IGZyb20gJy4vdXRpbHMuanMnO1xuaW1wb3J0IHsgYXN5bmNtYXAsIHJldHJ5SW50ZXJ2YWwsIHdhaXRGb3JDb25kaXRpb24sIHJldHJ5IH0gZnJvbSAnYXN5bmNib3gnO1xuaW1wb3J0ICogYXMgc2V0dGluZ3MgZnJvbSAnLi9zZXR0aW5ncyc7XG5pbXBvcnQgeyBleGVjIH0gZnJvbSAndGVlbl9wcm9jZXNzJztcbmltcG9ydCB7IHRhaWxVbnRpbCB9IGZyb20gJy4vdGFpbC11bnRpbC5qcyc7XG5pbXBvcnQgZXh0ZW5zaW9ucyBmcm9tICcuL2V4dGVuc2lvbnMvaW5kZXgnO1xuaW1wb3J0IHsgRXZlbnRFbWl0dGVyIH0gZnJvbSAnZXZlbnRzJztcbmltcG9ydCBDYWxlbmRhciBmcm9tICcuL2NhbGVuZGFyJztcbmltcG9ydCBQZXJtaXNzaW9ucyBmcm9tICcuL3Blcm1pc3Npb25zJztcblxuY29uc3QgU1RBUlRVUF9USU1FT1VUID0gNjAgKiAxMDAwO1xuY29uc3QgRVhUUkFfU1RBUlRVUF9USU1FID0gMjAwMDtcbmNvbnN0IFVJX0NMSUVOVF9BQ0NFU1NfR1VBUkQgPSBuZXcgQXN5bmNMb2NrKCk7XG5jb25zdCBVSV9DTElFTlRfQlVORExFX0lEID0gJ2NvbS5hcHBsZS5pcGhvbmVzaW11bGF0b3InO1xuY29uc3QgU1BSSU5HQk9BUkRfQlVORExFX0lEID0gJ2NvbS5hcHBsZS5TcHJpbmdCb2FyZCc7XG5cbi8qXG4gKiBUaGlzIGV2ZW50IGlzIGVtaXR0ZWQgYXMgc29vbiBhcyBpT1MgU2ltdWxhdG9yXG4gKiBoYXMgZmluaXNoZWQgYm9vdGluZyBhbmQgaXQgaXMgcmVhZHkgdG8gYWNjZXB0IHhjcnVuIGNvbW1hbmRzLlxuICogVGhlIGV2ZW50IGhhbmRsZXIgaXMgY2FsbGVkIGFmdGVyICdydW4nIG1ldGhvZCBpcyBjb21wbGV0ZWRcbiAqIGZvciBYY29kZSA3IGFuZCBvbGRlciBhbmQgaXMgb25seSB1c2VmdWwgaW4gWGNvZGUgOCssXG4gKiBzaW5jZSBvbmUgY2FuIHN0YXJ0IGRvaW5nIHN0dWZmIChmb3IgZXhhbXBsZSBpbnN0YWxsL3VuaW5zdGFsbCBhbiBhcHApIGluIHBhcmFsbGVsXG4gKiB3aXRoIFNpbXVsYXRvciBVSSBzdGFydHVwLCB3aGljaCBzaG9ydGVucyBzZXNzaW9uIHN0YXJ0dXAgdGltZS5cbiAqL1xuY29uc3QgQk9PVF9DT01QTEVURURfRVZFTlQgPSAnYm9vdENvbXBsZXRlZCc7XG5cblxuY2xhc3MgU2ltdWxhdG9yWGNvZGU2IGV4dGVuZHMgRXZlbnRFbWl0dGVyIHtcblxuICAvKipcbiAgICogQ29uc3RydWN0cyB0aGUgb2JqZWN0IHdpdGggdGhlIGB1ZGlkYCBhbmQgdmVyc2lvbiBvZiBYY29kZS4gVXNlIHRoZSBleHBvcnRlZCBgZ2V0U2ltdWxhdG9yKHVkaWQpYCBtZXRob2QgaW5zdGVhZC5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IHVkaWQgLSBUaGUgU2ltdWxhdG9yIElELlxuICAgKiBAcGFyYW0ge29iamVjdH0geGNvZGVWZXJzaW9uIC0gVGhlIHRhcmdldCBYY29kZSB2ZXJzaW9uIGluIGZvcm1hdCB7bWFqb3IsIG1pbm9yLCBidWlsZH0uXG4gICAqL1xuICBjb25zdHJ1Y3RvciAodWRpZCwgeGNvZGVWZXJzaW9uKSB7XG4gICAgc3VwZXIoKTtcblxuICAgIHRoaXMudWRpZCA9IFN0cmluZyh1ZGlkKTtcbiAgICB0aGlzLnhjb2RlVmVyc2lvbiA9IHhjb2RlVmVyc2lvbjtcblxuICAgIC8vIHBsYXRmb3JtVmVyc2lvbiBjYW5ub3QgYmUgZm91bmQgaW5pdGlhbGx5LCBzaW5jZSBnZXR0aW5nIGl0IGhhcyBzaWRlIGVmZmVjdHMgZm9yXG4gICAgLy8gb3VyIGxvZ2ljIGZvciBmaWd1cmluZyBvdXQgaWYgYSBzaW0gaGFzIGJlZW4gcnVuXG4gICAgLy8gaXQgd2lsbCBiZSBzZXQgd2hlbiBpdCBpcyBuZWVkZWRcbiAgICB0aGlzLl9wbGF0Zm9ybVZlcnNpb24gPSBudWxsO1xuXG4gICAgdGhpcy5rZXljaGFpblBhdGggPSBwYXRoLnJlc29sdmUodGhpcy5nZXREaXIoKSwgJ0xpYnJhcnknLCAnS2V5Y2hhaW5zJyk7XG4gICAgdGhpcy5zaW11bGF0b3JBcHAgPSAnaU9TIFNpbXVsYXRvci5hcHAnO1xuXG4gICAgdGhpcy5hcHBEYXRhQnVuZGxlUGF0aHMgPSB7fTtcblxuICAgIC8vIGxpc3Qgb2YgZmlsZXMgdG8gY2hlY2sgZm9yIHdoZW4gc2VlaW5nIGlmIGEgc2ltdWxhdG9yIGlzIFwiZnJlc2hcIlxuICAgIC8vIChtZWFuaW5nIGl0IGhhcyBuZXZlciBiZWVuIGJvb3RlZCkuXG4gICAgLy8gSWYgdGhlc2UgZmlsZXMgYXJlIHByZXNlbnQsIHdlIGFzc3VtZSBpdCdzIGJlZW4gc3VjY2Vzc2Z1bGx5IGJvb3RlZFxuICAgIHRoaXMuaXNGcmVzaEZpbGVzID0gW1xuICAgICAgJ0xpYnJhcnkvQ29uZmlndXJhdGlvblByb2ZpbGVzJyxcbiAgICAgICdMaWJyYXJ5L0Nvb2tpZXMnLFxuICAgICAgJ0xpYnJhcnkvUHJlZmVyZW5jZXMvLkdsb2JhbFByZWZlcmVuY2VzLnBsaXN0JyxcbiAgICAgICdMaWJyYXJ5L1ByZWZlcmVuY2VzL2NvbS5hcHBsZS5zcHJpbmdib2FyZC5wbGlzdCcsXG4gICAgICAndmFyL3J1bi9zeXNsb2cucGlkJ1xuICAgIF07XG5cbiAgICAvLyBleHRyYSB0aW1lIHRvIHdhaXQgZm9yIHNpbXVsYXRvciB0byBiZSBkZWVtZWQgYm9vdGVkXG4gICAgdGhpcy5leHRyYVN0YXJ0dXBUaW1lID0gRVhUUkFfU1RBUlRVUF9USU1FO1xuXG4gICAgdGhpcy5jYWxlbmRhciA9IG5ldyBDYWxlbmRhcih4Y29kZVZlcnNpb24sIHRoaXMuZ2V0RGlyKCkpO1xuICAgIHRoaXMucGVybWlzc2lvbnMgPSBuZXcgUGVybWlzc2lvbnMoeGNvZGVWZXJzaW9uLCB0aGlzLmdldERpcigpLCB0aGlzLnVkaWQpO1xuICB9XG5cbiAgLyoqXG4gICAqIEByZXR1cm4ge3N0cmluZ30gQnVuZGxlIGlkZW50aWZpZXIgb2YgU2ltdWxhdG9yIFVJIGNsaWVudC5cbiAgICovXG4gIGdldCB1aUNsaWVudEJ1bmRsZUlkICgpIHtcbiAgICByZXR1cm4gVUlfQ0xJRU5UX0JVTkRMRV9JRDtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZXMgdGhlIGN1cnJlbnQgcHJvY2VzcyBpZCBvZiB0aGUgVUkgY2xpZW50XG4gICAqXG4gICAqIEByZXR1cm4gez9zdHJpbmd9IFRoZSBwcm9jZXNzIElEIG9yIG51bGwgaWYgdGhlIFVJIGNsaWVudCBpcyBub3QgcnVubmluZ1xuICAgKi9cbiAgYXN5bmMgZ2V0VUlDbGllbnRQaWQgKCkge1xuICAgIGxldCBzdGRvdXQ7XG4gICAgdHJ5IHtcbiAgICAgICh7c3Rkb3V0fSA9IGF3YWl0IGV4ZWMoJ3BncmVwJywgWyctZm4nLCBgJHt0aGlzLnNpbXVsYXRvckFwcH0vQ29udGVudHMvTWFjT1MvYF0pKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgaWYgKGlzTmFOKHBhcnNlSW50KHN0ZG91dCwgMTApKSkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIHN0ZG91dCA9IHN0ZG91dC50cmltKCk7XG4gICAgbG9nLmRlYnVnKGBHb3QgU2ltdWxhdG9yIFVJIGNsaWVudCBQSUQ6ICR7c3Rkb3V0fWApO1xuICAgIHJldHVybiBzdGRvdXQ7XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2sgdGhlIHN0YXRlIG9mIFNpbXVsYXRvciBVSSBjbGllbnQuXG4gICAqXG4gICAqIEByZXR1cm4ge2Jvb2xlYW59IFRydWUgb2YgaWYgVUkgY2xpZW50IGlzIHJ1bm5pbmcgb3IgZmFsc2Ugb3RoZXJ3aXNlLlxuICAgKi9cbiAgYXN5bmMgaXNVSUNsaWVudFJ1bm5pbmcgKCkge1xuICAgIHJldHVybiAhXy5pc051bGwoYXdhaXQgdGhpcy5nZXRVSUNsaWVudFBpZCgpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBIb3cgbG9uZyB0byB3YWl0IGJlZm9yZSB0aHJvd2luZyBhbiBlcnJvciBhYm91dCBTaW11bGF0b3Igc3RhcnR1cCB0aW1lb3V0IGhhcHBlbmVkLlxuICAgKlxuICAgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBudW1iZXIgb2YgbWlsbGlzZWNvbmRzLlxuICAgKi9cbiAgZ2V0IHN0YXJ0dXBUaW1lb3V0ICgpIHtcbiAgICByZXR1cm4gU1RBUlRVUF9USU1FT1VUO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB0aGUgcGxhdGZvcm0gdmVyc2lvbiBvZiB0aGUgY3VycmVudCBTaW11bGF0b3IuXG4gICAqXG4gICAqIEByZXR1cm4ge3N0cmluZ30gU0RLIHZlcnNpb24sIGZvciBleGFtcGxlICc4LjMnLlxuICAgKi9cbiAgYXN5bmMgZ2V0UGxhdGZvcm1WZXJzaW9uICgpIHtcbiAgICBpZiAoIXRoaXMuX3BsYXRmb3JtVmVyc2lvbikge1xuICAgICAgbGV0IHtzZGt9ID0gYXdhaXQgdGhpcy5zdGF0KCk7XG4gICAgICB0aGlzLl9wbGF0Zm9ybVZlcnNpb24gPSBzZGs7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLl9wbGF0Zm9ybVZlcnNpb247XG4gIH1cblxuICAvKipcbiAgICogUmV0cmlldmUgdGhlIGZ1bGwgcGF0aCB0byB0aGUgZGlyZWN0b3J5IHdoZXJlIFNpbXVsYXRvciBzdHVmZiBpcyBsb2NhdGVkLlxuICAgKlxuICAgKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBwYXRoIHN0cmluZy5cbiAgICovXG4gIGdldFJvb3REaXIgKCkge1xuICAgIGxldCBob21lID0gcHJvY2Vzcy5lbnYuSE9NRTtcbiAgICByZXR1cm4gcGF0aC5yZXNvbHZlKGhvbWUsICdMaWJyYXJ5JywgJ0RldmVsb3BlcicsICdDb3JlU2ltdWxhdG9yJywgJ0RldmljZXMnKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZSB0aGUgZnVsbCBwYXRoIHRvIHRoZSBkaXJlY3Rvcnkgd2hlcmUgU2ltdWxhdG9yIGFwcGxpY2F0aW9ucyBkYXRhIGlzIGxvY2F0ZWQuXG4gICAqXG4gICAqIEByZXR1cm4ge3N0cmluZ30gVGhlIHBhdGggc3RyaW5nLlxuICAgKi9cbiAgZ2V0RGlyICgpIHtcbiAgICByZXR1cm4gcGF0aC5yZXNvbHZlKHRoaXMuZ2V0Um9vdERpcigpLCB0aGlzLnVkaWQsICdkYXRhJyk7XG4gIH1cblxuICAvKipcbiAgICogUmV0cmlldmUgdGhlIGZ1bGwgcGF0aCB0byB0aGUgZGlyZWN0b3J5IHdoZXJlIFNpbXVsYXRvciBsb2dzIGFyZSBzdG9yZWQuXG4gICAqXG4gICAqIEByZXR1cm4ge3N0cmluZ30gVGhlIHBhdGggc3RyaW5nLlxuICAgKi9cbiAgZ2V0TG9nRGlyICgpIHtcbiAgICBsZXQgaG9tZSA9IHByb2Nlc3MuZW52LkhPTUU7XG4gICAgcmV0dXJuIHBhdGgucmVzb2x2ZShob21lLCAnTGlicmFyeScsICdMb2dzJywgJ0NvcmVTaW11bGF0b3InLCB0aGlzLnVkaWQpO1xuICB9XG5cbiAgLyoqXG4gICAqIEluc3RhbGwgdmFsaWQgLmFwcCBwYWNrYWdlIG9uIFNpbXVsYXRvci5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGFwcCAtIFRoZSBwYXRoIHRvIHRoZSAuYXBwIHBhY2thZ2UuXG4gICAqL1xuICBhc3luYyBpbnN0YWxsQXBwIChhcHApIHtcbiAgICByZXR1cm4gYXdhaXQgc2ltY3RsLmluc3RhbGxBcHAodGhpcy51ZGlkLCBhcHApO1xuICB9XG5cbiAgLyoqXG4gICAqIFZlcmlmeSB3aGV0aGVyIHRoZSBwYXJ0aWN1bGFyIGFwcGxpY2F0aW9uIGlzIGluc3RhbGxlZCBvbiBTaW11bGF0b3IuXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBidW5kbGVJZCAtIFRoZSBidW5kbGUgaWQgb2YgdGhlIGFwcGxpY2F0aW9uIHRvIGJlIGNoZWNrZWQuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBhcHBGdWxlIC0gQXBwbGljYXRpb24gbmFtZSBtaW51cyBcIi5hcHBcIiAoZm9yIGlPUyA3LjEpXG4gICAqIEByZXR1cm4ge2Jvb2xlYW59IFRydWUgaWYgdGhlIGdpdmVuIGFwcGxpY2F0aW9uIGlzIGluc3RhbGxlZFxuICAgKi9cbiAgYXN5bmMgaXNBcHBJbnN0YWxsZWQgKGJ1bmRsZUlkLCBhcHBGaWxlID0gbnVsbCkge1xuICAgIC8vIGBhcHBGaWxlYCBhcmd1bWVudCBvbmx5IG5lY2Vzc2FyeSBmb3IgaU9TIGJlbG93IHZlcnNpb24gOFxuICAgIGxldCBhcHBEaXJzID0gYXdhaXQgdGhpcy5nZXRBcHBEaXJzKGFwcEZpbGUsIGJ1bmRsZUlkKTtcbiAgICByZXR1cm4gYXBwRGlycy5sZW5ndGggIT09IDA7XG4gIH1cblxuICAvKipcbiAgICogUmV0cmlldmUgdGhlIGRpcmVjdG9yeSBmb3IgYSBwYXJ0aWN1bGFyIGFwcGxpY2F0aW9uJ3MgZGF0YS5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGlkIC0gRWl0aGVyIGEgYnVuZGxlSWQgKGUuZy4sIGNvbS5hcHBsZS5tb2JpbGVzYWZhcmkpIG9yLCBmb3IgaU9TIDcuMSwgdGhlIGFwcCBuYW1lIHdpdGhvdXQgYC5hcHBgIChlLmcuLCBNb2JpbGVTYWZhcmkpXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBzdWJkaXIgLSBUaGUgc3ViLWRpcmVjdG9yeSB3ZSBleHBlY3QgdG8gYmUgd2l0aGluIHRoZSBhcHBsaWNhdGlvbiBkaXJlY3RvcnkuIERlZmF1bHRzIHRvIFwiRGF0YVwiLlxuICAgKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSByb290IGFwcGxpY2F0aW9uIGZvbGRlci5cbiAgICovXG4gIGFzeW5jIGdldEFwcERpciAoaWQsIHN1YkRpciA9ICdEYXRhJykge1xuICAgIHRoaXMuYXBwRGF0YUJ1bmRsZVBhdGhzW3N1YkRpcl0gPSB0aGlzLmFwcERhdGFCdW5kbGVQYXRoc1tzdWJEaXJdIHx8IHt9O1xuICAgIGlmIChfLmlzRW1wdHkodGhpcy5hcHBEYXRhQnVuZGxlUGF0aHNbc3ViRGlyXSkgJiYgIWF3YWl0IHRoaXMuaXNGcmVzaCgpKSB7XG4gICAgICB0aGlzLmFwcERhdGFCdW5kbGVQYXRoc1tzdWJEaXJdID0gYXdhaXQgdGhpcy5idWlsZEJ1bmRsZVBhdGhNYXAoc3ViRGlyKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuYXBwRGF0YUJ1bmRsZVBhdGhzW3N1YkRpcl1baWRdO1xuICB9XG5cbiAgLyoqXG4gICAqIFRoZSB4Y29kZSA2IHNpbXVsYXRvcnMgYXJlIHJlYWxseSBhbm5veWluZywgYW5kIGJ1cnkgdGhlIG1haW4gYXBwXG4gICAqIGRpcmVjdG9yaWVzIGluc2lkZSBkaXJlY3RvcmllcyBqdXN0IG5hbWVkIHdpdGggSGFzaGVzLlxuICAgKiBUaGlzIGZ1bmN0aW9uIGZpbmRzIHRoZSBwcm9wZXIgZGlyZWN0b3J5IGJ5IHRyYXZlcnNpbmcgYWxsIG9mIHRoZW1cbiAgICogYW5kIHJlYWRpbmcgYSBtZXRhZGF0YSBwbGlzdCAoTW9iaWxlIENvbnRhaW5lciBNYW5hZ2VyKSB0byBnZXQgdGhlXG4gICAqIGJ1bmRsZSBpZC5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IHN1YmRpciAtIFRoZSBzdWItZGlyZWN0b3J5IHdlIGV4cGVjdCB0byBiZSB3aXRoaW4gdGhlIGFwcGxpY2F0aW9uIGRpcmVjdG9yeS4gRGVmYXVsdHMgdG8gXCJEYXRhXCIuXG4gICAqIEByZXR1cm4ge29iamVjdH0gVGhlIGxpc3Qgb2YgcGF0aC1idW5kbGUgcGFpcnMgdG8gYW4gb2JqZWN0IHdoZXJlIGJ1bmRsZUlkcyBhcmUgbWFwcGVkIHRvIHBhdGhzLlxuICAgKi9cbiAgYXN5bmMgYnVpbGRCdW5kbGVQYXRoTWFwIChzdWJEaXIgPSAnRGF0YScpIHtcbiAgICBsb2cuZGVidWcoJ0J1aWxkaW5nIGJ1bmRsZSBwYXRoIG1hcCcpO1xuICAgIGxldCBhcHBsaWNhdGlvbkxpc3Q7XG4gICAgbGV0IHBhdGhCdW5kbGVQYWlyO1xuICAgIGlmIChhd2FpdCB0aGlzLmdldFBsYXRmb3JtVmVyc2lvbigpID09PSAnNy4xJykge1xuICAgICAgLy8gYXBwcyBhdmFpbGFibGVcbiAgICAgIC8vICAgV2ViLmFwcCxcbiAgICAgIC8vICAgV2ViVmlld1NlcnZpY2UuYXBwLFxuICAgICAgLy8gICBNb2JpbGVTYWZhcmkuYXBwLFxuICAgICAgLy8gICBXZWJDb250ZW50QW5hbHlzaXNVSS5hcHAsXG4gICAgICAvLyAgIEREQWN0aW9uc1NlcnZpY2UuYXBwLFxuICAgICAgLy8gICBTdG9yZUtpdFVJU2VydmljZS5hcHBcbiAgICAgIGFwcGxpY2F0aW9uTGlzdCA9IHBhdGgucmVzb2x2ZSh0aGlzLmdldERpcigpLCAnQXBwbGljYXRpb25zJyk7XG4gICAgICBwYXRoQnVuZGxlUGFpciA9IGFzeW5jIChkaXIpID0+IHtcbiAgICAgICAgZGlyID0gcGF0aC5yZXNvbHZlKGFwcGxpY2F0aW9uTGlzdCwgZGlyKTtcbiAgICAgICAgbGV0IGFwcEZpbGVzID0gYXdhaXQgZnMuZ2xvYihgJHtkaXJ9LyouYXBwYCk7XG4gICAgICAgIGxldCBidW5kbGVJZCA9IGFwcEZpbGVzWzBdLm1hdGNoKC8uKlxcLyguKilcXC5hcHAvKVsxXTtcbiAgICAgICAgcmV0dXJuIHtwYXRoOiBkaXIsIGJ1bmRsZUlkfTtcbiAgICAgIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIGFwcGxpY2F0aW9uTGlzdCA9IHBhdGgucmVzb2x2ZSh0aGlzLmdldERpcigpLCAnQ29udGFpbmVycycsIHN1YkRpciwgJ0FwcGxpY2F0aW9uJyk7XG4gICAgICAvLyBnaXZlbiBhIGRpcmVjdG9yeSwgZmluZCB0aGUgcGxpc3QgZmlsZSBhbmQgcHVsbCB0aGUgYnVuZGxlIGlkIGZyb20gaXRcbiAgICAgIGxldCByZWFkQnVuZGxlSWQgPSBhc3luYyAoZGlyKSA9PiB7XG4gICAgICAgIGxldCBwbGlzdCA9IHBhdGgucmVzb2x2ZShkaXIsICcuY29tLmFwcGxlLm1vYmlsZV9jb250YWluZXJfbWFuYWdlci5tZXRhZGF0YS5wbGlzdCcpO1xuICAgICAgICBsZXQgbWV0YWRhdGEgPSBhd2FpdCBzZXR0aW5ncy5yZWFkKHBsaXN0KTtcbiAgICAgICAgcmV0dXJuIG1ldGFkYXRhLk1DTU1ldGFkYXRhSWRlbnRpZmllcjtcbiAgICAgIH07XG4gICAgICAvLyBnaXZlbiBhIGRpcmVjdG9yeSwgcmV0dXJuIHRoZSBwYXRoIGFuZCBidW5kbGUgaWQgYXNzb2NpYXRlZCB3aXRoIGl0XG4gICAgICBwYXRoQnVuZGxlUGFpciA9IGFzeW5jIChkaXIpID0+IHtcbiAgICAgICAgZGlyID0gcGF0aC5yZXNvbHZlKGFwcGxpY2F0aW9uTGlzdCwgZGlyKTtcbiAgICAgICAgbGV0IGJ1bmRsZUlkID0gYXdhaXQgcmVhZEJ1bmRsZUlkKGRpcik7XG4gICAgICAgIHJldHVybiB7cGF0aDogZGlyLCBidW5kbGVJZH07XG4gICAgICB9O1xuICAgIH1cblxuICAgIGxldCBidW5kbGVQYXRoRGlycyA9IGF3YWl0IGZzLnJlYWRkaXIoYXBwbGljYXRpb25MaXN0KTtcbiAgICBsZXQgYnVuZGxlUGF0aFBhaXJzID0gYXdhaXQgYXN5bmNtYXAoYnVuZGxlUGF0aERpcnMsIGFzeW5jIChkaXIpID0+IHtcbiAgICAgIHJldHVybiBhd2FpdCBwYXRoQnVuZGxlUGFpcihkaXIpO1xuICAgIH0sIGZhbHNlKTtcblxuICAgIC8vIHJlZHVjZSB0aGUgbGlzdCBvZiBwYXRoLWJ1bmRsZSBwYWlycyB0byBhbiBvYmplY3Qgd2hlcmUgYnVuZGxlSWRzIGFyZSBtYXBwZWQgdG8gcGF0aHNcbiAgICByZXR1cm4gYnVuZGxlUGF0aFBhaXJzLnJlZHVjZSgoYnVuZGxlTWFwLCBidW5kbGVQYXRoKSA9PiB7XG4gICAgICBidW5kbGVNYXBbYnVuZGxlUGF0aC5idW5kbGVJZF0gPSBidW5kbGVQYXRoLnBhdGg7XG4gICAgICByZXR1cm4gYnVuZGxlTWFwO1xuICAgIH0sIHt9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIHN0YXRlIGFuZCBzcGVjaWZpY3Mgb2YgdGhpcyBzaW0uXG4gICAqXG4gICAqIEByZXR1cm4ge29iamVjdH0gU2ltdWxhdG9yIHN0YXRzIG1hcHBpbmcsIGZvciBleGFtcGxlOlxuICAgKiB7IG5hbWU6ICdpUGhvbmUgNHMnLFxuICAgKiAgIHVkaWQ6ICdDMDlCMzRFNS03RENCLTQ0MkUtQjc5Qy1BQjZCQzAzNTc0MTcnLFxuICAgKiAgIHN0YXRlOiAnU2h1dGRvd24nLFxuICAgKiAgIHNkazogJzguMydcbiAgICogfVxuICAgKi9cbiAgYXN5bmMgc3RhdCAoKSB7XG4gICAgZm9yIChsZXQgW3NkaywgZGV2aWNlQXJyXSBvZiBfLnRvUGFpcnMoYXdhaXQgc2ltY3RsLmdldERldmljZXMoKSkpIHtcbiAgICAgIGZvciAobGV0IGRldmljZSBvZiBkZXZpY2VBcnIpIHtcbiAgICAgICAgaWYgKGRldmljZS51ZGlkID09PSB0aGlzLnVkaWQpIHtcbiAgICAgICAgICBkZXZpY2Uuc2RrID0gc2RrO1xuICAgICAgICAgIHJldHVybiBkZXZpY2U7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4ge307XG4gIH1cblxuICAvKipcbiAgICogVGhpcyBpcyBhIGJlc3QtYmV0IGhldXJpc3RpYyBmb3Igd2hldGhlciBvciBub3QgYSBzaW0gaGFzIGJlZW4gYm9vdGVkXG4gICAqIGJlZm9yZS4gV2UgdXN1YWxseSB3YW50IHRvIHN0YXJ0IGEgc2ltdWxhdG9yIHRvIFwid2FybVwiIGl0IHVwLCBoYXZlXG4gICAqIFhjb2RlIHBvcHVsYXRlIGl0IHdpdGggcGxpc3RzIGZvciB1cyB0byBtYW5pcHVsYXRlIGJlZm9yZSBhIHJlYWxcbiAgICogdGVzdCBydW4uXG4gICAqXG4gICAqIEByZXR1cm4ge2Jvb2xlYW59IFRydWUgaWYgdGhlIGN1cnJlbnQgU2ltdWxhdG9yIGhhcyBuZXZlciBiZWVuIHN0YXJ0ZWQgYmVmb3JlXG4gICAqL1xuICBhc3luYyBpc0ZyZXNoICgpIHtcbiAgICAvLyBpZiB0aGUgZm9sbG93aW5nIGZpbGVzIGRvbid0IGV4aXN0LCBpdCBoYXNuJ3QgYmVlbiBib290ZWQuXG4gICAgLy8gVEhJUyBJUyBOT1QgQU4gRVhIQVVTVElWRSBMSVNUXG4gICAgbGV0IGZpbGVzID0gdGhpcy5pc0ZyZXNoRmlsZXM7XG5cbiAgICBsZXQgcHYgPSBhd2FpdCB0aGlzLmdldFBsYXRmb3JtVmVyc2lvbigpO1xuICAgIGlmIChwdiAhPT0gJzcuMScpIHtcbiAgICAgIGZpbGVzLnB1c2goJ0xpYnJhcnkvUHJlZmVyZW5jZXMvY29tLmFwcGxlLlByZWZlcmVuY2VzLnBsaXN0Jyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGZpbGVzLnB1c2goJ0FwcGxpY2F0aW9ucycpO1xuICAgIH1cblxuICAgIGNvbnN0IGRpciA9IHRoaXMuZ2V0RGlyKCk7XG4gICAgZmlsZXMgPSBmaWxlcy5tYXAoKHMpID0+IHBhdGgucmVzb2x2ZShkaXIsIHMpKTtcblxuICAgIGNvbnN0IGV4aXN0ZW5jZXMgPSBhd2FpdCBhc3luY21hcChmaWxlcywgYXN5bmMgKGYpID0+IGF3YWl0IGZzLmhhc0FjY2VzcyhmKSk7XG4gICAgY29uc3QgZnJlc2ggPSBfLmNvbXBhY3QoZXhpc3RlbmNlcykubGVuZ3RoICE9PSBmaWxlcy5sZW5ndGg7XG4gICAgbG9nLmRlYnVnKGBDaGVja2luZyB3aGV0aGVyIHNpbXVsYXRvciBoYXMgYmVlbiBydW4gYmVmb3JlOiAke2ZyZXNoID8gJ25vJyA6ICd5ZXMnfWApO1xuXG4gICAgcmV0dXJuIGZyZXNoO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHJpZXZlcyB0aGUgc3RhdGUgb2YgdGhlIGN1cnJlbnQgU2ltdWxhdG9yLiBPbmUgc2hvdWxkIGRpc3Rpbmd1aXNoIHRoZVxuICAgKiBzdGF0ZXMgb2YgU2ltdWxhdG9yIFVJIGFuZCB0aGUgU2ltdWxhdG9yIGl0c2VsZi5cbiAgICpcbiAgICogQHJldHVybiB7Ym9vbGVhbn0gVHJ1ZSBpZiB0aGUgY3VycmVudCBTaW11bGF0b3IgaXMgcnVubmluZy5cbiAgICovXG4gIGFzeW5jIGlzUnVubmluZyAoKSB7XG4gICAgbGV0IHN0YXQgPSBhd2FpdCB0aGlzLnN0YXQoKTtcbiAgICByZXR1cm4gc3RhdC5zdGF0ZSA9PT0gJ0Jvb3RlZCc7XG4gIH1cblxuICAvKipcbiAgICogVmVyaWZ5IHdoZXRoZXIgdGhlIFNpbXVsYXRvciBib290aW5nIGlzIGNvbXBsZXRlZCBhbmQvb3Igd2FpdCBmb3IgaXRcbiAgICogdW50aWwgdGhlIHRpbWVvdXQgZXhwaXJlcy5cbiAgICpcbiAgICogQHBhcmFtIHtudW1iZXJ9IHN0YXJ0dXBUaW1lb3V0IC0gdGhlIG51bWJlciBvZiBtaWxsaXNlY29uZHMgdG8gd2FpdCB1bnRpbCBib290aW5nIGlzIGNvbXBsZXRlZC5cbiAgICogQGVtaXRzIEJPT1RfQ09NUExFVEVEX0VWRU5UIGlmIHRoZSBjdXJyZW50IFNpbXVsYXRvciBpcyByZWFkeSB0byBhY2NlcHQgc2ltY3RsIGNvbW1hbmRzLCBsaWtlICdpbnN0YWxsJy5cbiAgICovXG4gIGFzeW5jIHdhaXRGb3JCb290IChzdGFydHVwVGltZW91dCkge1xuICAgIC8vIHdhaXQgZm9yIHRoZSBzaW11bGF0b3IgdG8gYm9vdFxuICAgIC8vIHdhaXRpbmcgZm9yIHRoZSBzaW11bGF0b3Igc3RhdHVzIHRvIGJlICdib290ZWQnIGlzbid0IGdvb2QgZW5vdWdoXG4gICAgLy8gaXQgY2xhaW1zIHRvIGJlIGJvb3RlZCB3YXkgYmVmb3JlIGZpbmlzaGluZyBsb2FkaW5nXG4gICAgLy8gbGV0J3MgdGFpbCB0aGUgc2ltdWxhdG9yIHN5c3RlbSBsb2cgdW50aWwgd2Ugc2VlIGEgbWFnaWMgbGluZSAodGhpcy5ib290ZWRJbmRpY2F0b3IpXG4gICAgbGV0IGJvb3RlZEluZGljYXRvciA9IGF3YWl0IHRoaXMuZ2V0Qm9vdGVkSW5kaWNhdG9yU3RyaW5nKCk7XG4gICAgYXdhaXQgdGhpcy50YWlsTG9nc1VudGlsKGJvb3RlZEluZGljYXRvciwgc3RhcnR1cFRpbWVvdXQpO1xuXG4gICAgLy8gc28gc29ycnksIGJ1dCB3ZSBzaG91bGQgd2FpdCBhbm90aGVyIHR3byBzZWNvbmRzLCBqdXN0IHRvIG1ha2Ugc3VyZSB3ZSd2ZSByZWFsbHkgc3RhcnRlZFxuICAgIC8vIHdlIGNhbid0IGxvb2sgZm9yIGFub3RoZXIgbWFnaWMgbG9nIGxpbmUsIGJlY2F1c2UgdGhleSBzZWVtIHRvIGJlIGFwcC1kZXBlbmRlbnQgKG5vdCBzeXN0ZW0gZGVwZW5kZW50KVxuICAgIGxvZy5kZWJ1ZyhgV2FpdGluZyBhbiBleHRyYSAke3RoaXMuZXh0cmFTdGFydHVwVGltZX1tcyBmb3IgdGhlIHNpbXVsYXRvciB0byByZWFsbHkgZmluaXNoIGJvb3RpbmdgKTtcbiAgICBhd2FpdCBCLmRlbGF5KHRoaXMuZXh0cmFTdGFydHVwVGltZSk7XG4gICAgbG9nLmRlYnVnKCdEb25lIHdhaXRpbmcgZXh0cmEgdGltZSBmb3Igc2ltdWxhdG9yJyk7XG5cbiAgICB0aGlzLmVtaXQoQk9PVF9DT01QTEVURURfRVZFTlQpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgYSBtYWdpYyBzdHJpbmcsIHdoaWNoLCBpZiBwcmVzZW50IGluIGxvZ3MsIHJlZmxlY3RzIHRoZSBmYWN0IHRoYXQgc2ltdWxhdG9yIGJvb3RpbmcgaGFzIGJlZW4gY29tcGxldGVkLlxuICAgKlxuICAgKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBtYWdpYyBsb2cgc3RyaW5nLlxuICAgKi9cbiAgYXN5bmMgZ2V0Qm9vdGVkSW5kaWNhdG9yU3RyaW5nICgpIHtcbiAgICBsZXQgaW5kaWNhdG9yO1xuICAgIGxldCBwbGF0Zm9ybVZlcnNpb24gPSBhd2FpdCB0aGlzLmdldFBsYXRmb3JtVmVyc2lvbigpO1xuICAgIHN3aXRjaCAocGxhdGZvcm1WZXJzaW9uKSB7XG4gICAgICBjYXNlICc3LjEnOlxuICAgICAgY2FzZSAnOC4xJzpcbiAgICAgIGNhc2UgJzguMic6XG4gICAgICBjYXNlICc4LjMnOlxuICAgICAgY2FzZSAnOC40JzpcbiAgICAgICAgaW5kaWNhdG9yID0gJ3Byb2ZpbGVkOiBTZXJ2aWNlIHN0YXJ0aW5nLi4uJztcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICc5LjAnOlxuICAgICAgY2FzZSAnOS4xJzpcbiAgICAgIGNhc2UgJzkuMic6XG4gICAgICBjYXNlICc5LjMnOlxuICAgICAgICBpbmRpY2F0b3IgPSAnU3lzdGVtIGFwcCBcImNvbS5hcHBsZS5zcHJpbmdib2FyZFwiIGZpbmlzaGVkIHN0YXJ0dXAnO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJzEwLjAnOlxuICAgICAgICBpbmRpY2F0b3IgPSAnU3dpdGNoaW5nIHRvIGtleWJvYXJkJztcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBsb2cud2FybihgTm8gYm9vdCBpbmRpY2F0b3IgY2FzZSBmb3IgcGxhdGZvcm0gdmVyc2lvbiAnJHtwbGF0Zm9ybVZlcnNpb259J2ApO1xuICAgICAgICBpbmRpY2F0b3IgPSAnbm8gYm9vdCBpbmRpY2F0b3Igc3RyaW5nIGF2YWlsYWJsZSc7XG4gICAgfVxuICAgIHJldHVybiBpbmRpY2F0b3I7XG4gIH1cblxuICAvKipcbiAgICogU3RhcnQgdGhlIFNpbXVsYXRvciBVSSBjbGllbnQgd2l0aCB0aGUgZ2l2ZW4gYXJndW1lbnRzXG4gICAqXG4gICAqIEBwYXJhbSB7b2JqZWN0fSBvcHRzIC0gT25lIG9yIG1vcmUgb2YgYXZhaWxhYmxlIFNpbXVsYXRvciBVSSBjbGllbnQgb3B0aW9uczpcbiAgICogICAtIHtzdHJpbmd9IHNjYWxlRmFjdG9yOiBjYW4gYmUgb25lIG9mIFsnMS4wJywgJzAuNzUnLCAnMC41JywgJzAuMzMnLCAnMC4yNSddLlxuICAgKiAgIERlZmluZXMgdGhlIHdpbmRvdyBzY2FsZSB2YWx1ZSBmb3IgdGhlIFVJIGNsaWVudCB3aW5kb3cgZm9yIHRoZSBjdXJyZW50IFNpbXVsYXRvci5cbiAgICogICBFcXVhbHMgdG8gbnVsbCBieSBkZWZhdWx0LCB3aGljaCBrZWVwcyB0aGUgY3VycmVudCBzY2FsZSB1bmNoYW5nZWQuXG4gICAqICAgLSB7Ym9vbGVhbn0gY29ubmVjdEhhcmR3YXJlS2V5Ym9hcmQ6IHdoZXRoZXIgdG8gY29ubmVjdCB0aGUgaGFyZHdhcmUga2V5Ym9hcmQgdG8gdGhlXG4gICAqICAgU2ltdWxhdG9yIFVJIGNsaWVudC4gRXF1YWxzIHRvIGZhbHNlIGJ5IGRlZmF1bHQuXG4gICAqICAgLSB7bnVtYmVyfSBzdGFydHVwVGltZW91dDogbnVtYmVyIG9mIG1pbGxpc2Vjb25kcyB0byB3YWl0IHVudGlsIFNpbXVsYXRvciBib290aW5nXG4gICAqICAgcHJvY2VzcyBpcyBjb21wbGV0ZWQuIFRoZSBkZWZhdWx0IHRpbWVvdXQgd2lsbCBiZSB1c2VkIGlmIG5vdCBzZXQgZXhwbGljaXRseS5cbiAgICovXG4gIGFzeW5jIHN0YXJ0VUlDbGllbnQgKG9wdHMgPSB7fSkge1xuICAgIG9wdHMgPSBPYmplY3QuYXNzaWduKHtcbiAgICAgIHNjYWxlRmFjdG9yOiBudWxsLFxuICAgICAgY29ubmVjdEhhcmR3YXJlS2V5Ym9hcmQ6IGZhbHNlLFxuICAgICAgc3RhcnR1cFRpbWVvdXQ6IHRoaXMuc3RhcnR1cFRpbWVvdXQsXG4gICAgfSwgb3B0cyk7XG5cbiAgICBjb25zdCBzaW11bGF0b3JBcHAgPSBwYXRoLnJlc29sdmUoYXdhaXQgZ2V0WGNvZGVQYXRoKCksICdBcHBsaWNhdGlvbnMnLCB0aGlzLnNpbXVsYXRvckFwcCk7XG4gICAgY29uc3QgYXJncyA9IFsnLUZuJywgc2ltdWxhdG9yQXBwLCAnLS1hcmdzJywgJy1DdXJyZW50RGV2aWNlVURJRCcsIHRoaXMudWRpZF07XG5cbiAgICBpZiAob3B0cy5zY2FsZUZhY3Rvcikge1xuICAgICAgY29uc3Qgc3RhdCA9IGF3YWl0IHRoaXMuc3RhdCgpO1xuICAgICAgY29uc3QgZm9ybWF0dGVkRGV2aWNlTmFtZSA9IHN0YXQubmFtZS5yZXBsYWNlKC9cXHMrL2csICctJyk7XG4gICAgICBjb25zdCBhcmd1bWVudE5hbWUgPSBgLVNpbXVsYXRvcldpbmRvd0xhc3RTY2FsZS1jb20uYXBwbGUuQ29yZVNpbXVsYXRvci5TaW1EZXZpY2VUeXBlLiR7Zm9ybWF0dGVkRGV2aWNlTmFtZX1gO1xuICAgICAgYXJncy5wdXNoKGFyZ3VtZW50TmFtZSwgb3B0cy5zY2FsZUZhY3Rvcik7XG4gICAgfVxuXG4gICAgaWYgKF8uaXNCb29sZWFuKG9wdHMuY29ubmVjdEhhcmR3YXJlS2V5Ym9hcmQpKSB7XG4gICAgICBhcmdzLnB1c2goJy1Db25uZWN0SGFyZHdhcmVLZXlib2FyZCcsIG9wdHMuY29ubmVjdEhhcmR3YXJlS2V5Ym9hcmQgPyAnMScgOiAnMCcpO1xuICAgIH1cblxuICAgIGxvZy5pbmZvKGBTdGFydGluZyBTaW11bGF0b3IgVUkgd2l0aCBjb21tYW5kOiBvcGVuICR7YXJncy5qb2luKCcgJyl9YCk7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IGV4ZWMoJ29wZW4nLCBhcmdzLCB7dGltZW91dDogb3B0cy5zdGFydHVwVGltZW91dH0pO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgaWYgKCEoZXJyLnN0ZG91dCB8fCAnJykuaW5jbHVkZXMoJy0xMDgyNScpICYmICEoZXJyLnN0ZGVyciB8fCAnJykuaW5jbHVkZXMoJy0xMDgyNScpKSB7XG4gICAgICAgIHRocm93IGVycjtcbiAgICAgIH1cbiAgICAgIGxvZy53YXJuKGBFcnJvciB3aGlsZSBvcGVuaW5nIFVJOiAke2Vyci5zdGRvdXQgfHwgZXJyLnN0ZGVycn0uIENvbnRpbnVpbmdgKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRXhlY3V0ZXMgZ2l2ZW4gU2ltdWxhdG9yIHdpdGggb3B0aW9ucy4gVGhlIFNpbXVsYXRvciB3aWxsIG5vdCBiZSByZXN0YXJ0ZWQgaWZcbiAgICogaXQgaXMgYWxyZWFkeSBydW5uaW5nLlxuICAgKlxuICAgKiBAcGFyYW0ge29iamVjdH0gb3B0cyAtIE9uZSBvciBtb3JlIG9mIGF2YWlsYWJsZSBTaW11bGF0b3Igb3B0aW9ucy5cbiAgICogICBTZWUgeyNzdGFydFVJQ2xpZW50KG9wdHMpfSBkb2N1bWVudGF0aW9uIGZvciBtb3JlIGRldGFpbHMgb24gb3RoZXIgc3VwcG9ydGVkIGtleXMuXG4gICAqL1xuICBhc3luYyBydW4gKG9wdHMgPSB7fSkge1xuICAgIG9wdHMgPSBPYmplY3QuYXNzaWduKHtcbiAgICAgIHN0YXJ0dXBUaW1lb3V0OiB0aGlzLnN0YXJ0dXBUaW1lb3V0LFxuICAgIH0sIG9wdHMpO1xuICAgIGNvbnN0IHtzdGF0ZX0gPSBhd2FpdCB0aGlzLnN0YXQoKTtcbiAgICBjb25zdCBpc1NlcnZlclJ1bm5pbmcgPSBzdGF0ZSA9PT0gJ0Jvb3RlZCc7XG4gICAgY29uc3QgaXNVSUNsaWVudFJ1bm5pbmcgPSBhd2FpdCB0aGlzLmlzVUlDbGllbnRSdW5uaW5nKCk7XG4gICAgaWYgKGlzU2VydmVyUnVubmluZyAmJiBpc1VJQ2xpZW50UnVubmluZykge1xuICAgICAgbG9nLmluZm8oYEJvdGggU2ltdWxhdG9yIHdpdGggVURJRCAke3RoaXMudWRpZH0gYW5kIHRoZSBVSSBjbGllbnQgYXJlIGN1cnJlbnRseSBydW5uaW5nYCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IHN0YXJ0VGltZSA9IHByb2Nlc3MuaHJ0aW1lKCk7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRoaXMuc2h1dGRvd24oKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGxvZy53YXJuKGBFcnJvciBvbiBTaW11bGF0b3Igc2h1dGRvd246ICR7ZXJyLm1lc3NhZ2V9YCk7XG4gICAgfVxuICAgIGF3YWl0IHRoaXMuc3RhcnRVSUNsaWVudChvcHRzKTtcblxuICAgIGF3YWl0IHRoaXMud2FpdEZvckJvb3Qob3B0cy5zdGFydHVwVGltZW91dCk7XG4gICAgbG9nLmluZm8oYFNpbXVsYXRvciB3aXRoIFVESUQgJHt0aGlzLnVkaWR9IGJvb3RlZCBpbiAke3Byb2Nlc3MuaHJ0aW1lKHN0YXJ0VGltZSlbMF19IHNlY29uZHNgKTtcbiAgfVxuXG4gIC8vIFRPRE8ga2VlcCBrZXljaGFpbnNcbiAgLyoqXG4gICAqIFJlc2V0IHRoZSBjdXJyZW50IFNpbXVsYXRvciB0byB0aGUgY2xlYW4gc3RhdGUuXG4gICAqL1xuICBhc3luYyBjbGVhbiAoKSB7XG4gICAgYXdhaXQgdGhpcy5lbmRTaW11bGF0b3JEYWVtb24oKTtcbiAgICBsb2cuaW5mbyhgQ2xlYW5pbmcgc2ltdWxhdG9yICR7dGhpcy51ZGlkfWApO1xuICAgIGF3YWl0IHNpbWN0bC5lcmFzZURldmljZSh0aGlzLnVkaWQsIDEwMDAwKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTY3J1YiAoZGVsZXRlIHRoZSBwcmVmZXJlbmNlcyBhbmQgY2hhbmdlZCBmaWxlcykgdGhlIHBhcnRpY3VsYXIgYXBwbGljYXRpb24gb24gU2ltdWxhdG9yLlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gYXBwRmlsZSAtIEFwcGxpY2F0aW9uIG5hbWUgbWludXMgXCIuYXBwXCIuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBhcHBCdW5kbGVJZCAtIEJ1bmRsZSBpZGVudGlmaWVyIG9mIHRoZSBhcHBsaWNhdGlvbi5cbiAgICovXG4gIGFzeW5jIHNjcnViQ3VzdG9tQXBwIChhcHBGaWxlLCBhcHBCdW5kbGVJZCkge1xuICAgIHJldHVybiBhd2FpdCB0aGlzLmNsZWFuQ3VzdG9tQXBwKGFwcEZpbGUsIGFwcEJ1bmRsZUlkLCB0cnVlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDbGVhbi9zY3J1YiB0aGUgcGFydGljdWxhciBhcHBsaWNhdGlvbiBvbiBTaW11bGF0b3IuXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBhcHBGaWxlIC0gQXBwbGljYXRpb24gbmFtZSBtaW51cyBcIi5hcHBcIi5cbiAgICogQHBhcmFtIHtzdHJpbmd9IGFwcEJ1bmRsZUlkIC0gQnVuZGxlIGlkZW50aWZpZXIgb2YgdGhlIGFwcGxpY2F0aW9uLlxuICAgKiBAcGFyYW0ge2Jvb2xlYW59IHNjcnViIC0gSWYgYHNjcnViYCBpcyBmYWxzZSwgd2Ugd2FudCB0byBjbGVhbiBieSBkZWxldGluZyB0aGUgYXBwIGFuZCBhbGxcbiAgICogICBmaWxlcyBhc3NvY2lhdGVkIHdpdGggaXQuIElmIGBzY3J1YmAgaXMgdHJ1ZSwgd2UganVzdCB3YW50IHRvIGRlbGV0ZSB0aGUgcHJlZmVyZW5jZXMgYW5kXG4gICAqICAgY2hhbmdlZCBmaWxlcy5cbiAgICovXG4gIGFzeW5jIGNsZWFuQ3VzdG9tQXBwIChhcHBGaWxlLCBhcHBCdW5kbGVJZCwgc2NydWIgPSBmYWxzZSkge1xuICAgIGxvZy5kZWJ1ZyhgQ2xlYW5pbmcgYXBwIGRhdGEgZmlsZXMgZm9yICcke2FwcEZpbGV9JywgJyR7YXBwQnVuZGxlSWR9J2ApO1xuICAgIGlmICghc2NydWIpIHtcbiAgICAgIGxvZy5kZWJ1ZyhgRGVsZXRpbmcgYXBwIGFsdG9nZXRoZXJgKTtcbiAgICB9XG5cbiAgICAvLyBnZXQgdGhlIGRpcmVjdG9yaWVzIHRvIGJlIGRlbGV0ZWRcbiAgICBsZXQgYXBwRGlycyA9IGF3YWl0IHRoaXMuZ2V0QXBwRGlycyhhcHBGaWxlLCBhcHBCdW5kbGVJZCwgc2NydWIpO1xuXG4gICAgaWYgKGFwcERpcnMubGVuZ3RoID09PSAwKSB7XG4gICAgICBsb2cuZGVidWcoJ0NvdWxkIG5vdCBmaW5kIGFwcCBkaXJlY3RvcmllcyB0byBkZWxldGUuIEl0IGlzIHByb2JhYmx5IG5vdCBpbnN0YWxsZWQnKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBsZXQgZGVsZXRlUHJvbWlzZXMgPSBbXTtcblxuICAgIGZvciAobGV0IGRpciBvZiBhcHBEaXJzKSB7XG4gICAgICBsb2cuZGVidWcoYERlbGV0aW5nIGRpcmVjdG9yeTogJyR7ZGlyfSdgKTtcbiAgICAgIGRlbGV0ZVByb21pc2VzLnB1c2goZnMucmltcmFmKGRpcikpO1xuICAgIH1cblxuICAgIGlmIChhd2FpdCB0aGlzLmdldFBsYXRmb3JtVmVyc2lvbigpID49IDgpIHtcbiAgICAgIGxldCByZWxSbVBhdGggPSBgTGlicmFyeS9QcmVmZXJlbmNlcy8ke2FwcEJ1bmRsZUlkfS5wbGlzdGA7XG4gICAgICBsZXQgcm1QYXRoID0gcGF0aC5yZXNvbHZlKHRoaXMuZ2V0Um9vdERpcigpLCByZWxSbVBhdGgpO1xuICAgICAgbG9nLmRlYnVnKGBEZWxldGluZyBmaWxlOiAnJHtybVBhdGh9J2ApO1xuICAgICAgZGVsZXRlUHJvbWlzZXMucHVzaChmcy5yaW1yYWYocm1QYXRoKSk7XG4gICAgfVxuXG4gICAgYXdhaXQgQi5hbGwoZGVsZXRlUHJvbWlzZXMpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHJpZXZlIHBhdGhzIHRvIGRpcnMgd2hlcmUgYXBwbGljYXRpb24gZGF0YSBpcyBzdG9yZWQuIGlPUyA4KyBzdG9yZXMgYXBwIGRhdGEgaW4gdHdvIHBsYWNlcyxcbiAgICogYW5kIGlPUyA3LjEgaGFzIG9ubHkgb25lIGRpcmVjdG9yeVxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gYXBwRmlsZSAtIEFwcGxpY2F0aW9uIG5hbWUgbWludXMgXCIuYXBwXCIuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBhcHBCdW5kbGVJZCAtIEJ1bmRsZSBpZGVudGlmaWVyIG9mIHRoZSBhcHBsaWNhdGlvbi5cbiAgICogQHBhcmFtIHtib29sZWFufSBzY3J1YiAtIFRoZSBgQnVuZGxlYCBkaXJlY3RvcnkgaGFzIHRoZSBhY3R1YWwgYXBwIGluIGl0LiBJZiB3ZSBhcmUganVzdCBzY3J1YmJpbmcsXG4gICAqICAgd2Ugd2FudCB0aGlzIHRvIHN0YXkuIElmIHdlIGFyZSBjbGVhbmluZyB3ZSBkZWxldGUuXG4gICAqIEByZXR1cm4ge2FycmF5PHN0cmluZz59IEFycmF5IG9mIGFwcGxpY2F0aW9uIGRhdGEgcGF0aHMuXG4gICAqL1xuICBhc3luYyBnZXRBcHBEaXJzIChhcHBGaWxlLCBhcHBCdW5kbGVJZCwgc2NydWIgPSBmYWxzZSkge1xuICAgIGxldCBkaXJzID0gW107XG4gICAgaWYgKGF3YWl0IHRoaXMuZ2V0UGxhdGZvcm1WZXJzaW9uKCkgPj0gOCkge1xuICAgICAgbGV0IGRhdGEgPSBhd2FpdCB0aGlzLmdldEFwcERpcihhcHBCdW5kbGVJZCk7XG4gICAgICBpZiAoIWRhdGEpIHJldHVybiBkaXJzOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIGN1cmx5XG5cbiAgICAgIGxldCBidW5kbGUgPSAhc2NydWIgPyBhd2FpdCB0aGlzLmdldEFwcERpcihhcHBCdW5kbGVJZCwgJ0J1bmRsZScpIDogdW5kZWZpbmVkO1xuXG4gICAgICBmb3IgKGxldCBzcmMgb2YgW2RhdGEsIGJ1bmRsZV0pIHtcbiAgICAgICAgaWYgKHNyYykge1xuICAgICAgICAgIGRpcnMucHVzaChzcmMpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGxldCBkYXRhID0gYXdhaXQgdGhpcy5nZXRBcHBEaXIoYXBwRmlsZSk7XG4gICAgICBpZiAoZGF0YSkge1xuICAgICAgICBkaXJzLnB1c2goZGF0YSk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBkaXJzO1xuICB9XG5cbiAgLyoqXG4gICAqIEV4ZWN1dGUgdGhlIFNpbXVsYXRvciBpbiBvcmRlciB0byBoYXZlIHRoZSBpbml0aWFsIGZpbGUgc3RydWN0dXJlIGNyZWF0ZWQgYW5kIHNodXRkb3duIGl0IGFmdGVyd2FyZHMuXG4gICAqXG4gICAqIEBwYXJhbSB7Ym9vbGVhbn0gc2FmYXJpIC0gV2hldGhlciB0byBleGVjdXRlIG1vYmlsZSBTYWZhcmkgYWZ0ZXIgc3RhcnR1cC5cbiAgICogQHBhcmFtIHtudW1iZXJ9IHN0YXJ0dXBUaW1lb3V0IC0gSG93IGxvbmcgdG8gd2FpdCB1bnRpbCBTaW11bGF0b3IgYm9vdGluZyBpcyBjb21wbGV0ZWQgKGluIG1pbGxpc2Vjb25kcykuXG4gICAqL1xuICBhc3luYyBsYXVuY2hBbmRRdWl0IChzYWZhcmkgPSBmYWxzZSwgc3RhcnR1cFRpbWVvdXQgPSB0aGlzLnN0YXJ0dXBUaW1lb3V0KSB7XG4gICAgbG9nLmRlYnVnKCdBdHRlbXB0aW5nIHRvIGxhdW5jaCBhbmQgcXVpdCB0aGUgc2ltdWxhdG9yLCB0byBjcmVhdGUgZGlyZWN0b3J5IHN0cnVjdHVyZScpO1xuICAgIGxvZy5kZWJ1ZyhgV2lsbCBsYXVuY2ggd2l0aCBTYWZhcmk/ICR7c2FmYXJpfWApO1xuXG4gICAgYXdhaXQgdGhpcy5ydW4oc3RhcnR1cFRpbWVvdXQpO1xuXG4gICAgaWYgKHNhZmFyaSkge1xuICAgICAgYXdhaXQgdGhpcy5vcGVuVXJsKCdodHRwOi8vd3d3LmFwcGl1bS5pbycpO1xuICAgIH1cblxuICAgIC8vIHdhaXQgZm9yIHRoZSBzeXN0ZW0gdG8gY3JlYXRlIHRoZSBmaWxlcyB3ZSB3aWxsIG1hbmlwdWxhdGVcbiAgICAvLyBuZWVkIHF1aXRlIGEgaGlnaCByZXRyeSBudW1iZXIsIGluIG9yZGVyIHRvIGFjY29tbW9kYXRlIGlPUyA3LjFcbiAgICAvLyBsb2NhbGx5LCA3LjEgYXZlcmFnZXMgOC41IHJldHJpZXMgKGZyb20gNiAtIDEyKVxuICAgIC8vICAgICAgICAgIDggYXZlcmFnZXMgMC42IHJldHJpZXMgKGZyb20gMCAtIDIpXG4gICAgLy8gICAgICAgICAgOSBhdmVyYWdlcyAxNCByZXRyaWVzXG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHJldHJ5SW50ZXJ2YWwoNjAsIDI1MCwgYXN5bmMgKCkgPT4ge1xuICAgICAgICBpZiAoYXdhaXQgdGhpcy5pc0ZyZXNoKCkpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1NpbXVsYXRvciBmaWxlcyBub3QgZnVsbHkgY3JlYXRlZC4gV2FpdGluZyBhIGJpdCcpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGxvZy53YXJuKGBUaW1lb3V0IHdhaXRpbmcgZm9yIHNpbXVsYXRvciBmaWxlcyB0byBiZSBjcmVhdGVkLiBDb250aW51aW5nYCk7XG4gICAgfVxuXG4gICAgLy8gYW5kIHF1aXRcbiAgICBhd2FpdCB0aGlzLnNodXRkb3duKCk7XG4gIH1cblxuICAvKipcbiAgICogTG9va3MgZm9yIGxhdW5jaGQgZGFlbW9ucyBjb3JyZXNwb25kaW5nIHRvIHRoZSBzaW0gdWRpZCBhbmQgdHJpZXMgdG8gc3RvcCB0aGVtIGNsZWFubHlcbiAgICogVGhpcyBwcmV2ZW50cyB4Y3J1biBzaW1jdGwgZXJhc2UgZnJvbSBoYW5naW5nLlxuICAgKi9cbiAgYXN5bmMgZW5kU2ltdWxhdG9yRGFlbW9uICgpIHtcbiAgICBsb2cuZGVidWcoYEtpbGxpbmcgYW55IHNpbXVsYXRvciBkYWVtb25zIGZvciAke3RoaXMudWRpZH1gKTtcblxuICAgIGxldCBsYXVuY2hjdGxDbWQgPSBgbGF1bmNoY3RsIGxpc3QgfCBncmVwICR7dGhpcy51ZGlkfSB8IGN1dCAtZiAzIHwgeGFyZ3MgLW4gMSBsYXVuY2hjdGxgO1xuICAgIHRyeSB7XG4gICAgICBsZXQgc3RvcENtZCA9IGAke2xhdW5jaGN0bENtZH0gc3RvcGA7XG4gICAgICBhd2FpdCBleGVjKCdiYXNoJywgWyctYycsIHN0b3BDbWRdKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGxvZy53YXJuKGBDb3VsZCBub3Qgc3RvcCBzaW11bGF0b3IgZGFlbW9uczogJHtlcnIubWVzc2FnZX1gKTtcbiAgICAgIGxvZy5kZWJ1ZygnQ2Fycnlpbmcgb24gYW55d2F5IScpO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgbGV0IHJlbW92ZUNtZCA9IGAke2xhdW5jaGN0bENtZH0gcmVtb3ZlYDtcbiAgICAgIGF3YWl0IGV4ZWMoJ2Jhc2gnLCBbJy1jJywgcmVtb3ZlQ21kXSk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBsb2cud2FybihgQ291bGQgbm90IHJlbW92ZSBzaW11bGF0b3IgZGFlbW9uczogJHtlcnIubWVzc2FnZX1gKTtcbiAgICAgIGxvZy5kZWJ1ZygnQ2Fycnlpbmcgb24gYW55d2F5IScpO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgLy8gV2FpdHMgMTAgc2VjIGZvciB0aGUgc2ltdWxhdG9yIGxhdW5jaGQgc2VydmljZXMgdG8gc3RvcC5cbiAgICAgIGF3YWl0IHdhaXRGb3JDb25kaXRpb24oYXN5bmMgKCkgPT4ge1xuICAgICAgICBsZXQge3N0ZG91dH0gPSBhd2FpdCBleGVjKCdiYXNoJywgWyctYycsXG4gICAgICAgICAgYHBzIC1lICB8IGdyZXAgJHt0aGlzLnVkaWR9IHwgZ3JlcCBsYXVuY2hkX3NpbSB8IGdyZXAgLXYgYmFzaCB8IGdyZXAgLXYgZ3JlcCB8IGF3ayB7J3ByaW50JDEnfWBdKTtcbiAgICAgICAgcmV0dXJuIHN0ZG91dC50cmltKCkubGVuZ3RoID09PSAwO1xuICAgICAgfSwge3dhaXRNczogMTAwMDAsIGludGVydmFsTXM6IDUwMH0pO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgbG9nLndhcm4oYENvdWxkIG5vdCBlbmQgc2ltdWxhdG9yIGRhZW1vbiBmb3IgJHt0aGlzLnVkaWR9OiAke2Vyci5tZXNzYWdlfWApO1xuICAgICAgbG9nLmRlYnVnKCdDYXJyeWluZyBvbiBhbnl3YXkhJyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFNodXRkb3duIGFsbCB0aGUgcnVubmluZyBTaW11bGF0b3JzIGFuZCB0aGUgVUkgY2xpZW50LlxuICAgKi9cbiAgYXN5bmMgc2h1dGRvd24gKCkge1xuICAgIGF3YWl0IGtpbGxBbGxTaW11bGF0b3JzKCk7XG4gIH1cblxuICAvKipcbiAgICogRGVsZXRlIHRoZSBwYXJ0aWN1bGFyIFNpbXVsYXRvciBmcm9tIGRldmljZXMgbGlzdFxuICAgKi9cbiAgYXN5bmMgZGVsZXRlICgpIHtcbiAgICBhd2FpdCBzaW1jdGwuZGVsZXRlRGV2aWNlKHRoaXMudWRpZCk7XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIHRoZSBwYXJ0aWN1bGFyIHByZWZlcmVuY2UgZmlsZSB3aXRoIHRoZSBnaXZlbiBrZXkvdmFsdWUgcGFpcnMuXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBwbGlzdCAtIFRoZSBwcmVmZXJlbmNlcyBmaWxlIHRvIHVwZGF0ZS5cbiAgICogQHBhcmFtIHtvYmplY3R9IHVwZGF0ZXMgLSBUaGUga2V5L3ZhbHVlIHBhaXJzIHRvIHVwZGF0ZS5cbiAgICovXG4gIGFzeW5jIHVwZGF0ZVNldHRpbmdzIChwbGlzdCwgdXBkYXRlcykge1xuICAgIHJldHVybiBhd2FpdCBzZXR0aW5ncy51cGRhdGVTZXR0aW5ncyh0aGlzLCBwbGlzdCwgdXBkYXRlcyk7XG4gIH1cblxuICAvKipcbiAgICogQXV0aG9yaXplL2RlLWF1dGhvcml6ZSBsb2NhdGlvbiBzZXR0aW5ncyBmb3IgYSBwYXJ0aWN1bGFyIGFwcGxpY2F0aW9uLlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gYnVuZGxlSWQgLSBUaGUgYXBwbGljYXRpb24gSUQgdG8gdXBkYXRlLlxuICAgKiBAcGFyYW0ge2Jvb2xlYW59IGF1dGhvcml6ZWQgLSBXaGV0aGVyIG9yIG5vdCB0byBhdXRob3JpemUuXG4gICAqL1xuICBhc3luYyB1cGRhdGVMb2NhdGlvblNldHRpbmdzIChidW5kbGVJZCwgYXV0aG9yaXplZCkge1xuICAgIHJldHVybiBhd2FpdCBzZXR0aW5ncy51cGRhdGVMb2NhdGlvblNldHRpbmdzKHRoaXMsIGJ1bmRsZUlkLCBhdXRob3JpemVkKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBFbmFibGUvRGlzYWJsZSByZWR1Y2UgbW90aW9uLlxuICAgKlxuICAgKiBAcGFyYW0ge2Jvb2xlYW59IHJlZHVjZU1vdGlvbiAtIFdoZXRoZXIgb3Igbm90IHRvIGVuYWJsZSBpdC5cbiAgICovXG4gIGFzeW5jIHNldFJlZHVjZU1vdGlvbiAocmVkdWNlTW90aW9uID0gdHJ1ZSkge1xuICAgIGlmIChhd2FpdCB0aGlzLmlzRnJlc2goKSkge1xuICAgICAgYXdhaXQgdGhpcy5sYXVuY2hBbmRRdWl0KGZhbHNlLCBTVEFSVFVQX1RJTUVPVVQpO1xuICAgIH1cblxuICAgIGF3YWl0IHNldHRpbmdzLnNldFJlZHVjZU1vdGlvbih0aGlzLCByZWR1Y2VNb3Rpb24pO1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZSBzZXR0aW5ncyBmb3IgU2FmYXJpLlxuICAgKlxuICAgKiBAcGFyYW0ge29iamVjdH0gdXBkYXRlcyAtIFRoZSBoYXNoIG9mIGtleS92YWx1ZSBwYWlycyB0byB1cGRhdGUgZm9yIFNhZmFyaS5cbiAgICovXG4gIGFzeW5jIHVwZGF0ZVNhZmFyaVNldHRpbmdzICh1cGRhdGVzKSB7XG4gICAgbGV0IHVwZGF0ZWQgPSBhd2FpdCBzZXR0aW5ncy51cGRhdGVTYWZhcmlVc2VyU2V0dGluZ3ModGhpcywgdXBkYXRlcyk7XG4gICAgcmV0dXJuIGF3YWl0IHNldHRpbmdzLnVwZGF0ZVNldHRpbmdzKHRoaXMsICdtb2JpbGVTYWZhcmknLCB1cGRhdGVzKSB8fCB1cGRhdGVkO1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZSB0aGUgbG9jYWxlIGZvciB0aGUgU2ltdWxhdG9yLlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gbGFuZ3VhZ2UgLSBUaGUgbGFuZ3VhZ2UgZm9yIHRoZSBzaW11bGF0b3IuIEUuZy4sIGBcImZyX1VTXCJgLlxuICAgKiBAcGFyYW0ge3N0cmluZ30gbG9jYWxlIC0gVGhlIGxvY2FsZSB0byBzZXQgZm9yIHRoZSBzaW11bGF0b3IuIEUuZy4sIGBcImVuXCJgLlxuICAgKiBAcGFyYW0ge3N0cmluZ30gY2FsZW5kYXJGb3JtYXQgLSBUaGUgZm9ybWF0IG9mIHRoZSBjYWxlbmRhci5cbiAgICovXG4gIGFzeW5jIHVwZGF0ZUxvY2FsZSAobGFuZ3VhZ2UsIGxvY2FsZSwgY2FsZW5kYXJGb3JtYXQpIHtcbiAgICByZXR1cm4gYXdhaXQgc2V0dGluZ3MudXBkYXRlTG9jYWxlKHRoaXMsIGxhbmd1YWdlLCBsb2NhbGUsIGNhbGVuZGFyRm9ybWF0KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDb21wbGV0ZWx5IGRlbGV0ZSBtb2JpbGUgU2FmYXJpIGFwcGxpY2F0aW9uIGZyb20gdGhlIGN1cnJlbnQgU2ltdWxhdG9yLlxuICAgKi9cbiAgYXN5bmMgZGVsZXRlU2FmYXJpICgpIHtcbiAgICBsb2cuZGVidWcoJ0RlbGV0aW5nIFNhZmFyaSBhcHBzIGZyb20gc2ltdWxhdG9yJyk7XG5cbiAgICBsZXQgZGlycyA9IFtdO1xuXG4gICAgLy8gZ2V0IHRoZSBkYXRhIGRpcmVjdG9yeVxuICAgIGRpcnMucHVzaChhd2FpdCB0aGlzLmdldEFwcERpcignY29tLmFwcGxlLm1vYmlsZXNhZmFyaScpKTtcblxuICAgIGxldCBwdiA9IGF3YWl0IHRoaXMuZ2V0UGxhdGZvcm1WZXJzaW9uKCk7XG4gICAgaWYgKHB2ID49IDgpIHtcbiAgICAgIC8vIGdldCB0aGUgYnVuZGxlIGRpcmVjdG9yeVxuICAgICAgZGlycy5wdXNoKGF3YWl0IHRoaXMuZ2V0QXBwRGlyKCdjb20uYXBwbGUubW9iaWxlc2FmYXJpJywgJ0J1bmRsZScpKTtcbiAgICB9XG5cbiAgICBsZXQgZGVsZXRlUHJvbWlzZXMgPSBbXTtcbiAgICBmb3IgKGxldCBkaXIgb2YgXy5jb21wYWN0KGRpcnMpKSB7XG4gICAgICBsb2cuZGVidWcoYERlbGV0aW5nIGRpcmVjdG9yeTogJyR7ZGlyfSdgKTtcbiAgICAgIGRlbGV0ZVByb21pc2VzLnB1c2goZnMucmltcmFmKGRpcikpO1xuICAgIH1cbiAgICBhd2FpdCBCLmFsbChkZWxldGVQcm9taXNlcyk7XG4gIH1cblxuICAvKipcbiAgICogQ2xlYW4gdXAgdGhlIGRpcmVjdG9yaWVzIGZvciBtb2JpbGUgU2FmYXJpLlxuICAgKlxuICAgKiBAcGFyYW0ge2Jvb2xlYW59IGtlZXBQcmVmcyAtIFdoZXRoZXIgdG8ga2VlcCBTYWZhcmkgcHJlZmVyZW5jZXMgZnJvbSBiZWluZyBkZWxldGVkLlxuICAgKi9cbiAgYXN5bmMgY2xlYW5TYWZhcmkgKGtlZXBQcmVmcyA9IHRydWUpIHtcbiAgICBsb2cuZGVidWcoJ0NsZWFuaW5nIG1vYmlsZSBzYWZhcmkgZGF0YSBmaWxlcycpO1xuICAgIGlmIChhd2FpdCB0aGlzLmlzRnJlc2goKSkge1xuICAgICAgbG9nLmluZm8oJ0NvdWxkIG5vdCBmaW5kIFNhZmFyaSBzdXBwb3J0IGRpcmVjdG9yaWVzIHRvIGNsZWFuIG91dCBvbGQgJyArXG4gICAgICAgICAgICAgICAnZGF0YS4gUHJvYmFibHkgdGhlcmUgaXMgbm90aGluZyB0byBjbGVhbiBvdXQnKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBsZXQgbGlicmFyeURpciA9IHBhdGgucmVzb2x2ZSh0aGlzLmdldERpcigpLCAnTGlicmFyeScpO1xuICAgIGxldCBzYWZhcmlSb290ID0gYXdhaXQgdGhpcy5nZXRBcHBEaXIoJ2NvbS5hcHBsZS5tb2JpbGVzYWZhcmknKTtcbiAgICBpZiAoIXNhZmFyaVJvb3QpIHtcbiAgICAgIGxvZy5pbmZvKCdDb3VsZCBub3QgZmluZCBTYWZhcmkgc3VwcG9ydCBkaXJlY3RvcmllcyB0byBjbGVhbiBvdXQgb2xkICcgK1xuICAgICAgICAgICAgICAgJ2RhdGEuIFByb2JhYmx5IHRoZXJlIGlzIG5vdGhpbmcgdG8gY2xlYW4gb3V0Jyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGxldCBzYWZhcmlMaWJyYXJ5RGlyID0gcGF0aC5yZXNvbHZlKHNhZmFyaVJvb3QsICdMaWJyYXJ5Jyk7XG4gICAgbGV0IGZpbGVzVG9EZWxldGUgPSBbXG4gICAgICAnQ2FjaGVzL1NuYXBzaG90cy9jb20uYXBwbGUubW9iaWxlc2FmYXJpJyxcbiAgICAgICdDYWNoZXMvY29tLmFwcGxlLm1vYmlsZXNhZmFyaS8qJyxcbiAgICAgICdDYWNoZXMvY29tLmFwcGxlLldlYkFwcENhY2hlLyonLFxuICAgICAgJ0NhY2hlcy9jb20uYXBwbGUuV2ViS2l0Lk5ldHdvcmtpbmcvKicsXG4gICAgICAnQ2FjaGVzL2NvbS5hcHBsZS5XZWJLaXQuV2ViQ29udGVudC8qJyxcbiAgICAgICdJbWFnZSBDYWNoZS8qJyxcbiAgICAgICdXZWJLaXQvY29tLmFwcGxlLm1vYmlsZXNhZmFyaS8qJyxcbiAgICAgICdXZWJLaXQvR2VvbG9jYXRpb25TaXRlcy5wbGlzdCcsXG4gICAgICAnV2ViS2l0L0xvY2FsU3RvcmFnZS8qLionLFxuICAgICAgJ1NhZmFyaS8qJyxcbiAgICAgICdDb29raWVzLyouYmluYXJ5Y29va2llcycsXG4gICAgICAnQ2FjaGVzL2NvbS5hcHBsZS5VSVN0YXR1c0Jhci8qJyxcbiAgICAgICdDYWNoZXMvY29tLmFwcGxlLmtleWJvYXJkcy9pbWFnZXMvKicsXG4gICAgICAnQ2FjaGVzL2NvbS5hcHBsZS5TYWZhcmkuU2FmZUJyb3dzaW5nLyonLFxuICAgICAgJy4uL3RtcC9jb20uYXBwbGUubW9iaWxlc2FmYXJpLyonXG4gICAgXTtcbiAgICBsZXQgZGVsZXRlUHJvbWlzZXMgPSBbXTtcblxuICAgIGZvciAobGV0IGZpbGUgb2YgZmlsZXNUb0RlbGV0ZSkge1xuICAgICAgZGVsZXRlUHJvbWlzZXMucHVzaChmcy5yaW1yYWYocGF0aC5yZXNvbHZlKGxpYnJhcnlEaXIsIGZpbGUpKSk7XG4gICAgICBkZWxldGVQcm9taXNlcy5wdXNoKGZzLnJpbXJhZihwYXRoLnJlc29sdmUoc2FmYXJpTGlicmFyeURpciwgZmlsZSkpKTtcbiAgICB9XG5cbiAgICBpZiAoIWtlZXBQcmVmcykge1xuICAgICAgZGVsZXRlUHJvbWlzZXMucHVzaChmcy5yaW1yYWYocGF0aC5yZXNvbHZlKHNhZmFyaUxpYnJhcnlEaXIsICdQcmVmZXJlbmNlcy8qLnBsaXN0JykpKTtcbiAgICB9XG5cbiAgICBhd2FpdCBCLmFsbChkZWxldGVQcm9taXNlcyk7XG4gIH1cblxuICAvKipcbiAgICogVW5pbnN0YWxsIHRoZSBnaXZlbiBhcHBsaWNhdGlvbiBmcm9tIHRoZSBjdXJyZW50IFNpbXVsYXRvci5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGJ1bmRsZUlkIC0gVGhlIGJ1aW5kbGUgSUQgb2YgdGhlIGFwcGxpY2F0aW9uIHRvIGJlIHJlbW92ZWQuXG4gICAqL1xuICBhc3luYyByZW1vdmVBcHAgKGJ1bmRsZUlkKSB7XG4gICAgYXdhaXQgc2ltY3RsLnJlbW92ZUFwcCh0aGlzLnVkaWQsIGJ1bmRsZUlkKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBNb3ZlIGEgYnVpbHQtaW4gYXBwbGljYXRpb24gdG8gYSBuZXcgcGxhY2UgKGFjdHVhbGx5LCByZW5hbWUgaXQpLlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gYXBwTmFtZSAtIFRoZSBuYW1lIG9mIHRoZSBhcHAgdG8gYmUgbW92ZWQuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBhcHBQYXRoIC0gVGhlIGN1cnJlbnQgcGF0aCB0byB0aGUgYXBwbGljYXRpb24uXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBuZXdBcHBQYXRoIC0gVGhlIG5ldyBwYXRoIHRvIHRoZSBhcHBsaWNhdGlvbi5cbiAgICogICBJZiBzb21lIGFwcGxpY2F0aW9uIGFscmVhZHkgZXhpc3RzIGJ5IHRoaXMgcGF0aCB0aGVuIGl0J3MgZ29pbmcgdG8gYmUgcmVtb3ZlZC5cbiAgICovXG4gIGFzeW5jIG1vdmVCdWlsdEluQXBwIChhcHBOYW1lLCBhcHBQYXRoLCBuZXdBcHBQYXRoKSB7XG4gICAgYXdhaXQgc2FmZVJpbVJhZihuZXdBcHBQYXRoKTtcbiAgICBhd2FpdCBmcy5jb3B5RmlsZShhcHBQYXRoLCBuZXdBcHBQYXRoKTtcbiAgICBsb2cuZGVidWcoYENvcGllZCAnJHthcHBOYW1lfScgdG8gJyR7bmV3QXBwUGF0aH0nYCk7XG5cbiAgICBhd2FpdCBmcy5yaW1yYWYoYXBwUGF0aCk7XG4gICAgbG9nLmRlYnVnKGBUZW1wb3JhcmlseSBkZWxldGVkIG9yaWdpbmFsIGFwcCBhdCAnJHthcHBQYXRofSdgKTtcblxuICAgIHJldHVybiBbbmV3QXBwUGF0aCwgYXBwUGF0aF07XG4gIH1cblxuICAvKipcbiAgICogT3BlbiB0aGUgZ2l2ZW4gVVJMIGluIG1vYmlsZSBTYWZhcmkgYnJvd3Nlci5cbiAgICogVGhlIGJyb3dzZXIgd2lsbCBiZSBzdGFydGVkIGF1dG9tYXRpY2FsbHkgaWYgaXQgaXMgbm90IHJ1bm5pbmcuXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSB1cmwgLSBUaGUgVVJMIHRvIGJlIG9wZW5lZC5cbiAgICovXG4gIGFzeW5jIG9wZW5VcmwgKHVybCkge1xuICAgIGNvbnN0IFNBRkFSSV9CT09URURfSU5ESUNBVE9SID0gJ01vYmlsZVNhZmFyaVsnO1xuICAgIGNvbnN0IFNBRkFSSV9TVEFSVFVQX1RJTUVPVVQgPSAxNSAqIDEwMDA7XG4gICAgY29uc3QgRVhUUkFfU1RBUlRVUF9USU1FID0gMyAqIDEwMDA7XG5cbiAgICBpZiAoYXdhaXQgdGhpcy5pc1J1bm5pbmcoKSkge1xuICAgICAgYXdhaXQgcmV0cnkoNTAwMCwgc2ltY3RsLm9wZW5VcmwsIHRoaXMudWRpZCwgdXJsKTtcbiAgICAgIGF3YWl0IHRoaXMudGFpbExvZ3NVbnRpbChTQUZBUklfQk9PVEVEX0lORElDQVRPUiwgU0FGQVJJX1NUQVJUVVBfVElNRU9VVCk7XG4gICAgICAvLyBTbyBzb3JyeSwgYnV0IHRoZSBsb2dzIGhhdmUgbm90aGluZyBlbHNlIGZvciBTYWZhcmkgc3RhcnRpbmcuLiBqdXN0IGRlbGF5IGEgbGl0dGxlIGJpdFxuICAgICAgbG9nLmRlYnVnKGBTYWZhcmkgc3RhcnRlZCwgd2FpdGluZyAke0VYVFJBX1NUQVJUVVBfVElNRX1tcyBmb3IgaXQgdG8gZnVsbHkgc3RhcnRgKTtcbiAgICAgIGF3YWl0IEIuZGVsYXkoRVhUUkFfU1RBUlRVUF9USU1FKTtcbiAgICAgIGxvZy5kZWJ1ZygnRG9uZSB3YWl0aW5nIGZvciBTYWZhcmknKTtcbiAgICAgIHJldHVybjtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdUcmllZCB0byBvcGVuIGEgdXJsLCBidXQgdGhlIFNpbXVsYXRvciBpcyBub3QgQm9vdGVkJyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFBlcmZvcm0gU2ltdWxhdG9yIGNhY2hlcyBjbGVhbnVwLlxuICAgKlxuICAgKiBAcGFyYW0gey4uLnN0cmluZ30gZm9sZGVyTmFtZXMgLSBUaGUgbmFtZXMgb2YgQ2FjaGVzIHN1YmZvbGRlcnMgdG8gYmUgY2xlYW5lZC5cbiAgICogICBOb24tYWNjZXNzaWJsZS9ub24tZXhpc3Rpbmcgc3ViZm9sZGVycyB3aWxsIGJlIHNraXBwZWQuXG4gICAqICAgQWxsIGV4aXN0aW5nIHN1YmZvbGRlcnMgdW5kZXIgQ2FjaGVzIHdpbGwgYmUgZGVsZXRlZCBpZiB0aGlzIHBhcmFtZXRlciBpcyBvbWl0dGVkLlxuICAgKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgY291bnQgb2YgY2xlYW5lZCBjYWNoZSBpdGVtcy5cbiAgICogICBaZXJvIGlzIHJldHVybmVkIGlmIG5vIGl0ZW1zIHdlcmUgbWF0Y2hlZCBmb3IgY2xlYW51cCAoZWl0aGVyIG5vdCBhY2Nlc3NpYmxlIG9yIG5vdCBkaXJlY3RvcmllcykuXG4gICAqL1xuICBhc3luYyBjbGVhckNhY2hlcyAoLi4uZm9sZGVyTmFtZXMpIHtcbiAgICBjb25zdCBjYWNoZXNSb290ID0gcGF0aC5yZXNvbHZlKHRoaXMuZ2V0RGlyKCksICdMaWJyYXJ5JywgJ0NhY2hlcycpO1xuICAgIGlmICghKGF3YWl0IGZzLmhhc0FjY2VzcyhjYWNoZXNSb290KSkpIHtcbiAgICAgIGxvZy5kZWJ1ZyhgQ2FjaGVzIHJvb3QgYXQgJyR7Y2FjaGVzUm9vdH0nIGRvZXMgbm90IGV4aXN0IG9yIGlzIG5vdCBhY2Nlc3NpYmxlLiBOb3RoaW5nIHRvIGRvIHRoZXJlYCk7XG4gICAgICByZXR1cm4gMDtcbiAgICB9XG5cbiAgICBsZXQgaXRlbXNUb1JlbW92ZSA9IGZvbGRlck5hbWVzLmxlbmd0aCA/IGZvbGRlck5hbWVzIDogKGF3YWl0IGZzLnJlYWRkaXIoY2FjaGVzUm9vdCkpO1xuICAgIGl0ZW1zVG9SZW1vdmUgPSBpdGVtc1RvUmVtb3ZlLm1hcCgoeCkgPT4gcGF0aC5yZXNvbHZlKGNhY2hlc1Jvb3QsIHgpKTtcbiAgICBpZiAoZm9sZGVyTmFtZXMubGVuZ3RoKSB7XG4gICAgICBpdGVtc1RvUmVtb3ZlID0gYXdhaXQgQi5maWx0ZXIoaXRlbXNUb1JlbW92ZSwgKHgpID0+IGZzLmhhc0FjY2Vzcyh4KSk7XG4gICAgfVxuICAgIGl0ZW1zVG9SZW1vdmUgPSBhd2FpdCBCLmZpbHRlcihpdGVtc1RvUmVtb3ZlLCBhc3luYyAoeCkgPT4gKGF3YWl0IGZzLnN0YXQoeCkpLmlzRGlyZWN0b3J5KCkpO1xuICAgIGlmICghaXRlbXNUb1JlbW92ZS5sZW5ndGgpIHtcbiAgICAgIGxvZy5kZWJ1ZyhgTm8gU2ltdWxhdG9yIGNhY2hlIGl0ZW1zIGZvciBjbGVhbnVwIHdlcmUgbWF0Y2hlZCBpbiAnJHtjYWNoZXNSb290fSdgKTtcbiAgICAgIHJldHVybiAwO1xuICAgIH1cblxuICAgIGxvZy5kZWJ1ZyhgTWF0Y2hlZCAke2l0ZW1zVG9SZW1vdmUubGVuZ3RofSBTaW11bGF0b3IgY2FjaGUgYCArXG4gICAgICBgaXRlbSR7aXRlbXNUb1JlbW92ZS5sZW5ndGggPT09IDEgPyAnJyA6ICdzJ30gZm9yIGNsZWFudXA6ICR7aXRlbXNUb1JlbW92ZX1gKTtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgQi5hbGwoaXRlbXNUb1JlbW92ZSwgKHgpID0+IGZzLnJpbXJhZih4KSk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgbG9nLndhcm4oYEdvdCBhbiBleGNlcHRpb24gd2hpbGUgY2xlYW5pbmcgU2ltdWxhdG9yIGNhY2hlczogJHtlLm1lc3NhZ2V9YCk7XG4gICAgfVxuICAgIHJldHVybiBpdGVtc1RvUmVtb3ZlLmxlbmd0aDtcbiAgfVxuXG4gIC8qKlxuICAgKiBCbG9ja3MgdW50aWwgdGhlIGdpdmVuIGluZGljYXRlciBzdHJpbmcgYXBwZWFycyBpbiBTaW11bGF0b3IgbG9ncy5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGJvb3RlZEluZGljYXRvciAtIFRoZSBtYWdpYyBzdHJpbmcsIHdoaWNoIGFwcGVhcnMgaW4gbG9ncyBhZnRlciBTaW11bGF0b3IgYm9vdGluZyBpcyBjb21wbGV0ZWQuXG4gICAqIEBwYXJhbSB7bnVtYmVyfSB0aW1lb3V0TXMgLSBUaGUgbWF4aW11bW0gbnVtYmVyIG9mIG1pbGxpc2Vjb25kcyB0byB3YWl0IGZvciB0aGUgc3RyaW5nIGluZGljYXRvciBwcmVzZW5jZS5cbiAgICogQHJldHVybnMge1Byb21pc2V9IEEgcHJvbWlzZSB0aGF0IHJlc29sdmVzIHdoZW4gdGhlIGlvcyBzaW11bGF0b3IgbG9ncyBvdXRwdXQgYSBsaW5lIG1hdGNoaW5nIGBib290ZWRJbmRpY2F0b3JgXG4gICAqIHRpbWVzIG91dCBhZnRlciB0aW1lb3V0TXNcbiAgICovXG4gIGFzeW5jIHRhaWxMb2dzVW50aWwgKGJvb3RlZEluZGljYXRvciwgdGltZW91dE1zKSB7XG4gICAgbGV0IHNpbUxvZyA9IHBhdGgucmVzb2x2ZSh0aGlzLmdldExvZ0RpcigpLCAnc3lzdGVtLmxvZycpO1xuXG4gICAgLy8gd2UgbmVlZCB0byBtYWtlIHN1cmUgbG9nIGZpbGUgZXhpc3RzIGJlZm9yZSB3ZSBjYW4gdGFpbCBpdFxuICAgIGF3YWl0IHJldHJ5SW50ZXJ2YWwoMjAwLCAyMDAsIGFzeW5jICgpID0+IHtcbiAgICAgIGxldCBleGlzdHMgPSBhd2FpdCBmcy5leGlzdHMoc2ltTG9nKTtcbiAgICAgIGlmICghZXhpc3RzKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgQ291bGQgbm90IGZpbmQgU2ltdWxhdG9yIGxvZzogJyR7c2ltTG9nfSdgKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGxvZy5pbmZvKGBTaW11bGF0b3IgbG9nIGF0ICcke3NpbUxvZ30nYCk7XG4gICAgbG9nLmluZm8oYFRhaWxpbmcgc2ltdWxhdG9yIGxvZ3MgdW50aWwgd2UgZW5jb3VudGVyIHRoZSBzdHJpbmcgXCIke2Jvb3RlZEluZGljYXRvcn1cImApO1xuICAgIGxvZy5pbmZvKGBXZSB3aWxsIHRpbWUgb3V0IGFmdGVyICR7dGltZW91dE1zfW1zYCk7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRhaWxVbnRpbChzaW1Mb2csIGJvb3RlZEluZGljYXRvciwgdGltZW91dE1zKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGxvZy5kZWJ1ZygnU2ltdWxhdG9yIHN0YXJ0dXAgdGltZWQgb3V0LiBDb250aW51aW5nIGFueXdheS4nKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRW5hYmxlIENhbGVuZGFyIGFjY2VzcyBmb3IgdGhlIGdpdmVuIGFwcGxpY2F0aW9uLlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gYnVuZGxlSUQgLSBCdW5kbGUgSUQgb2YgdGhlIGFwcGxpY2F0aW9uLCBmb3Igd2hpY2ggdGhlIGFjY2VzcyBzaG91bGQgYmUgZ3JhbnRlZC5cbiAgICovXG4gIGFzeW5jIGVuYWJsZUNhbGVuZGFyQWNjZXNzIChidW5kbGVJRCkge1xuICAgIGF3YWl0IHRoaXMuY2FsZW5kYXIuZW5hYmxlQ2FsZW5kYXJBY2Nlc3MoYnVuZGxlSUQpO1xuICB9XG5cbiAgLyoqXG4gICAqIERpc2FibGUgQ2FsZW5kYXIgYWNjZXNzIGZvciB0aGUgZ2l2ZW4gYXBwbGljYXRpb24uXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBidW5kbGVJRCAtIEJ1bmRsZSBJRCBvZiB0aGUgYXBwbGljYXRpb24sIGZvciB3aGljaCB0aGUgYWNjZXNzIHNob3VsZCBiZSBkZW5pZWQuXG4gICAqL1xuICBhc3luYyBkaXNhYmxlQ2FsZW5kYXJBY2Nlc3MgKGJ1bmRsZUlEKSB7XG4gICAgYXdhaXQgdGhpcy5jYWxlbmRhci5kaXNhYmxlQ2FsZW5kYXJBY2Nlc3MoYnVuZGxlSUQpO1xuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrIHdoZXRoZXIgdGhlIGdpdmVuIGFwcGxpY2F0aW9uIGhhcyBhY2Nlc3MgdG8gQ2FsZW5kYXIuXG4gICAqXG4gICAqIEByZXR1cm4ge2Jvb2xlYW59IFRydWUgaWYgdGhlIGdpdmVuIGFwcGxpY2F0aW9uIGhhcyB0aGUgYWNjZXNzLlxuICAgKi9cbiAgYXN5bmMgaGFzQ2FsZW5kYXJBY2Nlc3MgKGJ1bmRsZUlEKSB7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuY2FsZW5kYXIuaGFzQ2FsZW5kYXJBY2Nlc3MoYnVuZGxlSUQpO1xuICB9XG5cbiAgLyoqXG4gICAqIEFjdGl2YXRlcyBTaW11bGF0b3Igd2luZG93LlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAcmV0dXJucyB7P3N0cmluZ30gSWYgdGhlIG1ldGhvZCByZXR1cm5zIGEgc3RyaW5nIHRoZW4gaXQgc2hvdWxkIGJlIGEgdmFsaWQgQXBwbGUgU2NyaXB0IHdoaWNoXG4gICAqIGlzIGFwcGVuZGVkIGJlZm9yZSBlYWNoIFVJIGNsaWVudCBjb21tYW5kIGlzIGV4ZWN1dGVkLiBPdGhlcndpc2UgdGhlIG1ldGhvZCBzaG91bGQgYWN0aXZhdGUgdGhlIHdpbmRvd1xuICAgKiBpdHNlbGYgYW5kIHJldHVybiBub3RoaW5nLlxuICAgKi9cbiAgYXN5bmMgX2FjdGl2YXRlV2luZG93ICgpIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSByZXF1aXJlLWF3YWl0XG4gICAgcmV0dXJuIGBcbiAgICAgIHRlbGwgYXBwbGljYXRpb24gXCJTeXN0ZW0gRXZlbnRzXCJcbiAgICAgICAgdGVsbCBwcm9jZXNzIFwiU2ltdWxhdG9yXCJcbiAgICAgICAgICBzZXQgZnJvbnRtb3N0IHRvIGZhbHNlXG4gICAgICAgICAgc2V0IGZyb250bW9zdCB0byB0cnVlXG4gICAgICAgIGVuZCB0ZWxsXG4gICAgICBlbmQgdGVsbFxuICAgIGA7XG4gIH1cblxuICAvKipcbiAgICogRXhlY3V0ZSBnaXZlbiBBcHBsZSBTY3JpcHQgaW5zaWRlIGEgY3JpdGljYWwgc2VjdGlvbiwgc28gb3RoZXJcbiAgICogc2Vzc2lvbnMgY2Fubm90IGluZmx1ZW5jZSB0aGUgVUkgY2xpZW50IGF0IHRoZSBzYW1lIHRpbWUuXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBhcHBsZVNjcmlwdCAtIFRoZSB2YWxpZCBBcHBsZSBTY3JpcHQgc25pcHBldCB0byBiZSBleGVjdXRlZC5cbiAgICogQHJldHVybiB7c3RyaW5nfSBUaGUgc3Rkb3V0IG91dHB1dCBwcm9kdWNlZCBieSB0aGUgc2NyaXB0LlxuICAgKiBAdGhyb3dzIHtFcnJvcn0gSWYgb3Nhc2NyaXB0IHRvb2wgcmV0dXJucyBub24temVybyBleGl0IGNvZGUuXG4gICAqL1xuICBhc3luYyBleGVjdXRlVUlDbGllbnRTY3JpcHQgKGFwcGxlU2NyaXB0KSB7XG4gICAgY29uc3Qgd2luZG93QWN0aXZhdGlvblNjcmlwdCA9IGF3YWl0IHRoaXMuX2FjdGl2YXRlV2luZG93KCk7XG4gICAgY29uc3QgcmVzdWx0U2NyaXB0ID0gYCR7d2luZG93QWN0aXZhdGlvblNjcmlwdCA/IHdpbmRvd0FjdGl2YXRpb25TY3JpcHQgKyAnXFxuJyA6ICcnfSR7YXBwbGVTY3JpcHR9YDtcbiAgICBsb2cuZGVidWcoYEV4ZWN1dGluZyBVSSBBcHBsZSBTY3JpcHQgb24gU2ltdWxhdG9yIHdpdGggVURJRCAke3RoaXMudWRpZH06ICR7cmVzdWx0U2NyaXB0fWApO1xuICAgIHJldHVybiBhd2FpdCBVSV9DTElFTlRfQUNDRVNTX0dVQVJELmFjcXVpcmUodGhpcy5zaW11bGF0b3JBcHAsIGFzeW5jICgpID0+IHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHtzdGRvdXR9ID0gYXdhaXQgZXhlYygnb3Nhc2NyaXB0JywgWyctZScsIHJlc3VsdFNjcmlwdF0pO1xuICAgICAgICByZXR1cm4gc3Rkb3V0O1xuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIGxvZy5lcnJvckFuZFRocm93KGBDb3VsZCBub3QgY29tcGxldGUgb3BlcmF0aW9uLiBNYWtlIHN1cmUgU2ltdWxhdG9yIFVJIGlzIHJ1bm5pbmcgYW5kIHRoZSBwYXJlbnQgQXBwaXVtIGFwcGxpY2F0aW9uIChlLiBnLiBBcHBpdW0uYXBwIG9yIFRlcm1pbmFsLmFwcCkgYCArXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGBpcyBwcmVzZW50IGluIFN5c3RlbSBQcmVmZXJlbmNlcyA+IFNlY3VyaXR5ICYgUHJpdmFjeSA+IFByaXZhY3kgPiBBY2Nlc3NpYmlsaXR5IGxpc3QuIElmIHRoZSBvcGVyYXRpb24gaXMgc3RpbGwgdW5zdWNjZXNzZnVsIHRoZW4gYCArXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGBpdCBpcyBub3Qgc3VwcG9ydGVkIGJ5IHRoaXMgU2ltdWxhdG9yLiBgICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgYE9yaWdpbmFsIGVycm9yOiAke2Vyci5tZXNzYWdlfWApO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB0aGUgY3VycmVudCBzdGF0ZSBvZiBCaW9tZXRyaWMgRW5yb2xsbWVudCBmZWF0dXJlLlxuICAgKlxuICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gRWl0aGVyIHRydWUgb3IgZmFsc2VcbiAgICogQHRocm93cyB7RXJyb3J9IElmIEVucm9sbG1lbnQgc3RhdGUgY2Fubm90IGJlIGRldGVybWluZWRcbiAgICovXG4gIGFzeW5jIGlzQmlvbWV0cmljRW5yb2xsZWQgKCkge1xuICAgIGNvbnN0IG91dHB1dCA9IGF3YWl0IHRoaXMuZXhlY3V0ZVVJQ2xpZW50U2NyaXB0KGBcbiAgICAgIHRlbGwgYXBwbGljYXRpb24gXCJTeXN0ZW0gRXZlbnRzXCJcbiAgICAgICAgdGVsbCBwcm9jZXNzIFwiU2ltdWxhdG9yXCJcbiAgICAgICAgICBzZXQgZHN0TWVudUl0ZW0gdG8gbWVudSBpdGVtIFwiVG91Y2ggSUQgRW5yb2xsZWRcIiBvZiBtZW51IDEgb2YgbWVudSBiYXIgaXRlbSBcIkhhcmR3YXJlXCIgb2YgbWVudSBiYXIgMVxuICAgICAgICAgIHNldCBpc0NoZWNrZWQgdG8gKHZhbHVlIG9mIGF0dHJpYnV0ZSBcIkFYTWVudUl0ZW1NYXJrQ2hhclwiIG9mIGRzdE1lbnVJdGVtKSBpcyBcIuKck1wiXG4gICAgICAgIGVuZCB0ZWxsXG4gICAgICBlbmQgdGVsbFxuICAgIGApO1xuICAgIGxvZy5kZWJ1ZyhgVG91Y2ggSUQgZW5yb2xsZWQgc3RhdGU6ICR7b3V0cHV0fWApO1xuICAgIHJldHVybiBfLmlzU3RyaW5nKG91dHB1dCkgJiYgb3V0cHV0LnRyaW0oKSA9PT0gJ3RydWUnO1xuICB9XG5cbiAgLyoqXG4gICAqIEVucm9sbHMgYmlvbWV0cmljIChUb3VjaElkLCBGYWNlSWQpIGZlYXR1cmUgdGVzdGluZyBpbiBTaW11bGF0b3IgVUkgY2xpZW50LlxuICAgKlxuICAgKiBAcGFyYW0ge2Jvb2xlYW59IGlzRW5hYmxlZCAtIERlZmluZXMgd2hldGhlciBiaW9tZXRyaWMgc3RhdGUgaXMgZW5hYmxlZC9kaXNhYmxlZFxuICAgKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlIGVucm9sbGVkIHN0YXRlIGNhbm5vdCBiZSBjaGFuZ2VkXG4gICAqL1xuICBhc3luYyBlbnJvbGxCaW9tZXRyaWMgKGlzRW5hYmxlZCA9IHRydWUpIHtcbiAgICBhd2FpdCB0aGlzLmV4ZWN1dGVVSUNsaWVudFNjcmlwdChgXG4gICAgICB0ZWxsIGFwcGxpY2F0aW9uIFwiU3lzdGVtIEV2ZW50c1wiXG4gICAgICAgIHRlbGwgcHJvY2VzcyBcIlNpbXVsYXRvclwiXG4gICAgICAgICAgc2V0IGRzdE1lbnVJdGVtIHRvIG1lbnUgaXRlbSBcIlRvdWNoIElEIEVucm9sbGVkXCIgb2YgbWVudSAxIG9mIG1lbnUgYmFyIGl0ZW0gXCJIYXJkd2FyZVwiIG9mIG1lbnUgYmFyIDFcbiAgICAgICAgICBzZXQgaXNDaGVja2VkIHRvICh2YWx1ZSBvZiBhdHRyaWJ1dGUgXCJBWE1lbnVJdGVtTWFya0NoYXJcIiBvZiBkc3RNZW51SXRlbSkgaXMgXCLinJNcIlxuICAgICAgICAgIGlmICR7aXNFbmFibGVkID8gJ25vdCAnIDogJyd9aXNDaGVja2VkIHRoZW5cbiAgICAgICAgICAgIGNsaWNrIGRzdE1lbnVJdGVtXG4gICAgICAgICAgZW5kIGlmXG4gICAgICAgIGVuZCB0ZWxsXG4gICAgICBlbmQgdGVsbFxuICAgIGApO1xuICB9XG5cbiAgLyoqXG4gICAqIFNlbmRzIGEgbm90aWZpY2F0aW9uIHRvIG1hdGNoL25vdCBtYXRjaCB0aGUgdG91Y2ggaWQuXG4gICAqXG4gICAqIEBwYXJhbSB7P2Jvb2xlYW59IHNob3VsZE1hdGNoIFt0cnVlXSAtIFNldCBpdCB0byB0cnVlIG9yIGZhbHNlIGluIG9yZGVyIHRvIGVtdWxhdGVcbiAgICogbWF0Y2hpbmcvbm90IG1hdGNoaW5nIHRoZSBjb3JyZXNwb25kaW5nIGJpb21ldHJpY1xuICAgKi9cbiAgYXN5bmMgc2VuZEJpb21ldHJpY01hdGNoIChzaG91bGRNYXRjaCA9IHRydWUpIHtcbiAgICBhd2FpdCB0aGlzLmV4ZWN1dGVVSUNsaWVudFNjcmlwdChgXG4gICAgICB0ZWxsIGFwcGxpY2F0aW9uIFwiU3lzdGVtIEV2ZW50c1wiXG4gICAgICAgIHRlbGwgcHJvY2VzcyBcIlNpbXVsYXRvclwiXG4gICAgICAgICAgc2V0IGRzdE1lbnVJdGVtIHRvIG1lbnUgaXRlbSBcIiR7c2hvdWxkTWF0Y2ggPyAnTWF0Y2hpbmcnIDogJ05vbi1tYXRjaGluZyd9XCIgb2YgbWVudSAxIG9mIG1lbnUgaXRlbSBcIlNpbXVsYXRlIEZpbmdlciBUb3VjaFwiIG9mIG1lbnUgMSBvZiBtZW51IGJhciBpdGVtIFwiSGFyZHdhcmVcIiBvZiBtZW51IGJhciAxXG4gICAgICAgICAgY2xpY2sgZHN0TWVudUl0ZW1cbiAgICAgICAgZW5kIHRlbGxcbiAgICAgIGVuZCB0ZWxsXG4gICAgYCk7XG4gIH1cblxuICAvKipcbiAgICogRXhlY3V0ZSBhIHNwZWNpYWwgQXBwbGUgc2NyaXB0LCB3aGljaCBjbGlja3MgdGhlIHBhcnRpY3VsYXIgYnV0dG9uIG9uIERhdGFiYXNlIGFsZXJ0LlxuICAgKlxuICAgKiBAcGFyYW0ge2Jvb2xlYW59IGluY3JlYXNlIC0gQ2xpY2sgdGhlIGJ1dHRvbiB3aXRoICdJbmNyZWFzZScgdGl0bGUgb24gdGhlIGFsZXJ0IGlmIHRoaXNcbiAgICogICBwYXJhbWV0ZXIgaXMgdHJ1ZS4gVGhlICdDYW5jZWwnIGJ1dHRvbiB3aWxsIGJlIGNsaWNrZWQgb3RoZXJ3aXNlLlxuICAgKi9cbiAgYXN5bmMgZGlzbWlzc0RhdGFiYXNlQWxlcnQgKGluY3JlYXNlID0gdHJ1ZSkge1xuICAgIGxldCBidXR0b24gPSBpbmNyZWFzZSA/ICdJbmNyZWFzZScgOiAnQ2FuY2VsJztcbiAgICBsb2cuZGVidWcoYEF0dGVtcHRpbmcgdG8gZGlzbWlzcyBkYXRhYmFzZSBhbGVydCB3aXRoICcke2J1dHRvbn0nIGJ1dHRvbmApO1xuICAgIGF3YWl0IHRoaXMuZXhlY3V0ZVVJQ2xpZW50U2NyaXB0KGBcbiAgICAgIHRlbGwgYXBwbGljYXRpb24gXCJTeXN0ZW0gRXZlbnRzXCJcbiAgICAgICAgdGVsbCBwcm9jZXNzIFwiU2ltdWxhdG9yXCJcbiAgICAgICAgICBjbGljayBidXR0b24gXCIke2J1dHRvbn1cIiBvZiB3aW5kb3cgMVxuICAgICAgICBlbmQgdGVsbFxuICAgICAgZW5kIHRlbGxcbiAgICBgKTtcbiAgfVxuXG4gIC8vcmVnaW9uIEtleWNoYWlucyBJbnRlcmFjdGlvblxuICAvKipcbiAgICogQ3JlYXRlIHRoZSBiYWNrdXAgb2Yga2V5Y2hhaW5zIGZvbGRlci5cbiAgICogVGhlIHByZXZpb3VzbHkgY3JlYXRlZCBiYWNrdXAgd2lsbCBiZSBhdXRvbWF0aWNhbGx5XG4gICAqIGRlbGV0ZWQgaWYgdGhpcyBtZXRob2Qgd2FzIGNhbGxlZCB0d2ljZSBpbiBhIHJvdyB3aXRob3V0XG4gICAqIGByZXN0b3JlS2V5Y2hhaW5zYCBiZWluZyBpbnZva2VkLlxuICAgKlxuICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gVHJ1ZSBpZiB0aGUgYmFja3VwIG9wZXJhdGlvbiB3YXMgc3VjY2Vzc2Z1bGwuXG4gICAqL1xuICBhc3luYyBiYWNrdXBLZXljaGFpbnMgKCkge1xuICAgIGlmICghYXdhaXQgZnMuZXhpc3RzKHRoaXMua2V5Y2hhaW5QYXRoKSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGNvbnN0IGJhY2t1cFBhdGggPSBhd2FpdCB0ZW1wRGlyLnBhdGgoe1xuICAgICAgcHJlZml4OiBga2V5Y2hhaW5zX2JhY2t1cF8ke01hdGguZmxvb3IoKDEgKyBNYXRoLnJhbmRvbSgpKSAqIDB4MTAwMDApLnRvU3RyaW5nKDE2KS5zdWJzdHJpbmcoMSl9YCxcbiAgICAgIHN1ZmZpeDogJy56aXAnLFxuICAgIH0pO1xuICAgIGNvbnN0IHppcEFyZ3MgPSBbXG4gICAgICAnLXInLCBiYWNrdXBQYXRoLFxuICAgICAgYCR7dGhpcy5rZXljaGFpblBhdGh9JHtwYXRoLnNlcH1gXG4gICAgXTtcbiAgICBsb2cuZGVidWcoYENyZWF0aW5nIGtleWNoYWlucyBiYWNrdXAgd2l0aCAnemlwICR7emlwQXJncy5qb2luKCcgJyl9JyBjb21tYW5kYCk7XG4gICAgYXdhaXQgZXhlYygnemlwJywgemlwQXJncyk7XG4gICAgaWYgKF8uaXNTdHJpbmcodGhpcy5fa2V5Y2hhaW5zQmFja3VwUGF0aCkgJiYgYXdhaXQgZnMuZXhpc3RzKHRoaXMuX2tleWNoYWluc0JhY2t1cFBhdGgpKSB7XG4gICAgICBhd2FpdCBmcy51bmxpbmsodGhpcy5fa2V5Y2hhaW5zQmFja3VwUGF0aCk7XG4gICAgfVxuICAgIHRoaXMuX2tleWNoYWluc0JhY2t1cFBhdGggPSBiYWNrdXBQYXRoO1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlc3RvcmUgdGhlIHByZXZpc291bHkgY3JlYXRlZCBrZXljaGFpbnMgYmFja3VwLlxuICAgKlxuICAgKiBAcGFyYW0gez9zdHJpbmd8QXJyYXk8c3RyaW5nPn0gZXhjbHVkZVBhdHRlcm5zIC0gVGhlIGxpc3RcbiAgICogb2YgZmlsZSBuYW1lIHBhdHRlcm5zIHRvIGJlIGV4Y2x1ZGVkIGZyb20gcmVzdG9yZS4gVGhlIGZvcm1hdFxuICAgKiBvZiBlYWNoIGl0ZW0gc2hvdWxkIGJlIHRoZSBzYW1lIGFzICcteCcgb3B0aW9uIGZvcm1hdCBmb3JcbiAgICogJ3VuemlwJyB1dGlsaXR5LiBUaGlzIGNhbiBhbHNvIGJlIGEgY29tbWEtc2VwYXJhdGVkIHN0cmluZyxcbiAgICogd2hpY2ggaXMgZ29pbmcgYmUgdHJhbnNmb3JtZWQgaW50byBhIGxpc3QgYXV0b21hdGljYWxseSxcbiAgICogZm9yIGV4YW1wbGU6ICcqLmRiKixibGFibGEuc3FsaXRlJ1xuICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gSWYgdGhlIHJlc3RvcmUgb3ByYXRpb24gd2FzIHN1Y2Nlc3NmdWwuXG4gICAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGVyZSBpcyBubyBrZXljaGFpbnMgYmFja3VwIGF2YWlsYWJsZSBmb3IgcmVzdG9yZS5cbiAgICovXG4gIGFzeW5jIHJlc3RvcmVLZXljaGFpbnMgKGV4Y2x1ZGVQYXR0ZXJucyA9IFtdKSB7XG4gICAgaWYgKCFfLmlzU3RyaW5nKHRoaXMuX2tleWNoYWluc0JhY2t1cFBhdGgpIHx8ICFhd2FpdCBmcy5leGlzdHModGhpcy5fa2V5Y2hhaW5zQmFja3VwUGF0aCkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgVGhlIGtleWNoYWlucyBiYWNrdXAgYXJjaGl2ZSBkb2VzIG5vdCBleGlzdC4gYCArXG4gICAgICAgICAgICAgICAgICAgICAgYEFyZSB5b3Ugc3VyZSBpdCB3YXMgY3JlYXRlZCBiZWZvcmU/YCk7XG4gICAgfVxuXG4gICAgaWYgKF8uaXNTdHJpbmcoZXhjbHVkZVBhdHRlcm5zKSkge1xuICAgICAgZXhjbHVkZVBhdHRlcm5zID0gZXhjbHVkZVBhdHRlcm5zLnNwbGl0KCcsJykubWFwKCh4KSA9PiB4LnRyaW0oKSk7XG4gICAgfVxuICAgIGNvbnN0IHtzdGF0ZX0gPSBhd2FpdCB0aGlzLnN0YXQoKTtcbiAgICBjb25zdCBpc1NlcnZlclJ1bm5pbmcgPSBzdGF0ZSA9PT0gJ0Jvb3RlZCc7XG4gICAgbGV0IHBsaXN0UGF0aDtcbiAgICBpZiAoaXNTZXJ2ZXJSdW5uaW5nKSB7XG4gICAgICBwbGlzdFBhdGggPSBwYXRoLnJlc29sdmUoYXdhaXQgdGhpcy5nZXRMYXVuY2hEYWVtb25zUm9vdCgpLCAnY29tLmFwcGxlLnNlY3VyaXR5ZC5wbGlzdCcpO1xuICAgICAgaWYgKCFhd2FpdCBmcy5leGlzdHMocGxpc3RQYXRoKSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCBjbGVhciBrZXljaGFpbnMgYmVjYXVzZSAnJHtwbGlzdFBhdGh9JyBkb2VzIG5vdCBleGlzdGApO1xuICAgICAgfVxuICAgICAgYXdhaXQgc2ltY3RsLnNwYXduKHRoaXMudWRpZCwgWydsYXVuY2hjdGwnLCAndW5sb2FkJywgcGxpc3RQYXRoXSk7XG4gICAgfVxuICAgIHRyeSB7XG4gICAgICBhd2FpdCBmcy5yaW1yYWYodGhpcy5rZXljaGFpblBhdGgpO1xuICAgICAgYXdhaXQgbWtkaXJwKHRoaXMua2V5Y2hhaW5QYXRoKTtcbiAgICAgIGNvbnN0IHVuemlwQXJncyA9IFtcbiAgICAgICAgJy1vJywgdGhpcy5fa2V5Y2hhaW5zQmFja3VwUGF0aCxcbiAgICAgICAgLi4uKF8uZmxhdE1hcChleGNsdWRlUGF0dGVybnMubWFwKCh4KSA9PiBbJy14JywgeF0pKSksXG4gICAgICAgICctZCcsICcvJ1xuICAgICAgXTtcbiAgICAgIGxvZy5kZWJ1ZyhgUmVzdG9yaW5nIGtleWNoYWlucyB3aXRoICd1bnppcCAke3VuemlwQXJncy5qb2luKCcgJyl9JyBjb21tYW5kYCk7XG4gICAgICBhd2FpdCBleGVjKCd1bnppcCcsIHVuemlwQXJncyk7XG4gICAgICBhd2FpdCBmcy51bmxpbmsodGhpcy5fa2V5Y2hhaW5zQmFja3VwUGF0aCk7XG4gICAgICB0aGlzLl9rZXljaGFpbnNCYWNrdXBQYXRoID0gbnVsbDtcbiAgICB9IGZpbmFsbHkge1xuICAgICAgaWYgKGlzU2VydmVyUnVubmluZyAmJiBwbGlzdFBhdGgpIHtcbiAgICAgICAgYXdhaXQgc2ltY3RsLnNwYXduKHRoaXMudWRpZCwgWydsYXVuY2hjdGwnLCAnbG9hZCcsIHBsaXN0UGF0aF0pO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDbGVhcnMgS2V5Y2hhaW5zIGZvciB0aGUgcGFydGljdWxhciBzaW11bGF0b3IgaW4gcnVudGltZSAodGhlcmUgaXMgbm8gbmVlZCB0byBzdG9wIGl0KS5cbiAgICpcbiAgICogQHRocm93cyB7RXJyb3J9IElmIGtleWNoYWluIGNsZWFudXAgaGFzIGZhaWxlZC5cbiAgICovXG4gIGFzeW5jIGNsZWFyS2V5Y2hhaW5zICgpIHtcbiAgICBjb25zdCBwbGlzdFBhdGggPSBwYXRoLnJlc29sdmUoYXdhaXQgdGhpcy5nZXRMYXVuY2hEYWVtb25zUm9vdCgpLCAnY29tLmFwcGxlLnNlY3VyaXR5ZC5wbGlzdCcpO1xuICAgIGlmICghYXdhaXQgZnMuZXhpc3RzKHBsaXN0UGF0aCkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgQ2Fubm90IGNsZWFyIGtleWNoYWlucyBiZWNhdXNlICcke3BsaXN0UGF0aH0nIGRvZXMgbm90IGV4aXN0YCk7XG4gICAgfVxuICAgIGF3YWl0IHNpbWN0bC5zcGF3bih0aGlzLnVkaWQsIFsnbGF1bmNoY3RsJywgJ3VubG9hZCcsIHBsaXN0UGF0aF0pO1xuICAgIHRyeSB7XG4gICAgICBpZiAoYXdhaXQgZnMuZXhpc3RzKHRoaXMua2V5Y2hhaW5QYXRoKSkge1xuICAgICAgICBhd2FpdCBmcy5yaW1yYWYodGhpcy5rZXljaGFpblBhdGgpO1xuICAgICAgICBhd2FpdCBta2RpcnAodGhpcy5rZXljaGFpblBhdGgpO1xuICAgICAgfVxuICAgIH0gZmluYWxseSB7XG4gICAgICBhd2FpdCBzaW1jdGwuc3Bhd24odGhpcy51ZGlkLCBbJ2xhdW5jaGN0bCcsICdsb2FkJywgcGxpc3RQYXRoXSk7XG4gICAgfVxuICB9XG5cbiAgLy9lbmRyZWdpb25cblxuICAvKipcbiAgICogU2V0cyB0aGUgcGVybWlzc2lvbnMgZm9yIHRoZSBwYXJ0aWN1bGFyIGFwcGxpY2F0aW9uIGJ1bmRsZS5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGJ1bmRsZUlkIC0gQXBwbGljYXRpb24gYnVuZGxlIGlkZW50aWZpZXIuXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBwZXJtaXNzaW9uc01hcHBpbmcgLSBBIG1hcHBpbmcgd2hlcmUga2F5c1xuICAgKiBhcmUgc2VydmljZSBuYW1lcyBhbmQgdmFsdWVzIGFyZSB0aGVpciBjb3JyZXNwb25kaW5nIHN0YXR1cyB2YWx1ZXMuXG4gICAqIFNlZSBodHRwczovL2dpdGh1Yi5jb20vd2l4L0FwcGxlU2ltdWxhdG9yVXRpbHNcbiAgICogZm9yIG1vcmUgZGV0YWlscyBvbiBhdmFpbGFibGUgc2VydmljZSBuYW1lcyBhbmQgc3RhdHVzZXMuXG4gICAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGVyZSB3YXMgYW4gZXJyb3Igd2hpbGUgY2hhbmdpbmcgcGVybWlzc2lvbnMuXG4gICAqL1xuICBhc3luYyBzZXRQZXJtaXNzaW9ucyAoYnVuZGxlSWQsIHBlcm1pc3Npb25zTWFwcGluZykge1xuICAgIGF3YWl0IHRoaXMucGVybWlzc2lvbnMuc2V0QWNjZXNzKHBlcm1pc3Npb25zTWFwcGluZywgYnVuZGxlSWQpO1xuICAgIGxvZy5kZWJ1ZyhgU2V0ICR7SlNPTi5zdHJpbmdpZnkocGVybWlzc2lvbnNNYXBwaW5nKX0gYWNjZXNzIGZvciAnJHtidW5kbGVJZH0nYCk7XG4gIH1cblxuICAvKipcbiAgICogUmV0cmlldmVzIGN1cnJlbnQgcGVybWlzc2lvbiBzdGF0dXMgZm9yIHRoZSBnaXZlbiBhcHBsaWNhdGlvbiBidW5kbGUuXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBidW5kbGVJZCAtIEFwcGxpY2F0aW9uIGJ1bmRsZSBpZGVudGlmaWVyLlxuICAgKiBAcGFyYW0ge3N0cmluZ30gc2VydmljZU5hbWUgLSBPbmUgb2YgYXZhaWxhYmxlIHNlcnZpY2UgbmFtZXMuXG4gICAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGVyZSB3YXMgYW4gZXJyb3Igd2hpbGUgcmV0cmlldmluZyBwZXJtaXNzaW9ucy5cbiAgICovXG4gIGFzeW5jIGdldFBlcm1pc3Npb24gKGJ1bmRsZUlkLCBzZXJ2aWNlTmFtZSkge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMucGVybWlzc2lvbnMuZ2V0QWNjZXNzKHNlcnZpY2VOYW1lLCBidW5kbGVJZCk7XG4gICAgbG9nLmRlYnVnKGBHb3QgJHtzZXJ2aWNlTmFtZX0gYWNjZXNzIHN0YXR1cyBmb3IgJyR7YnVuZGxlSWR9JzogJHtyZXN1bHR9YCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIGFzeW5jIGdldExhdW5jaERhZW1vbnNSb290ICgpIHtcbiAgICBjb25zdCBkZXZSb290ID0gYXdhaXQgZ2V0RGV2ZWxvcGVyUm9vdCgpO1xuICAgIHJldHVybiBwYXRoLnJlc29sdmUoZGV2Um9vdCxcbiAgICAgICdQbGF0Zm9ybXMvaVBob25lU2ltdWxhdG9yLnBsYXRmb3JtL0RldmVsb3Blci9TREtzL2lQaG9uZVNpbXVsYXRvci5zZGsvU3lzdGVtL0xpYnJhcnkvTGF1bmNoRGFlbW9ucycpO1xuICB9XG5cbiAgc3RhdGljIGFzeW5jIF9nZXREZXZpY2VTdHJpbmdQbGF0Zm9ybVZlcnNpb24gKHBsYXRmb3JtVmVyc2lvbikge1xuICAgIGxldCByZXFWZXJzaW9uID0gcGxhdGZvcm1WZXJzaW9uO1xuICAgIGlmICghcmVxVmVyc2lvbikge1xuICAgICAgcmVxVmVyc2lvbiA9IGF3YWl0IHhjb2RlLmdldE1heElPU1NESygpO1xuICAgICAgbG9nLndhcm4oYE5vIHBsYXRmb3JtIHZlcnNpb24gc2V0LiBVc2luZyBtYXggU0RLIHZlcnNpb246ICR7cmVxVmVyc2lvbn1gKTtcbiAgICAgIC8vIHRoaXMgd2lsbCBiZSBhIG51bWJlciwgYW5kIHBvc3NpYmx5IGFuIGludGVnZXIgKGUuZy4sIGlmIG1heCBpT1MgU0RLIGlzIDkpXG4gICAgICAvLyBzbyB0dXJuIGl0IGludG8gYSBzdHJpbmcgYW5kIGFkZCBhIC4wIGlmIG5lY2Vzc2FyeVxuICAgICAgaWYgKCFfLmlzU3RyaW5nKHJlcVZlcnNpb24pKSB7XG4gICAgICAgIHJlcVZlcnNpb24gPSAocmVxVmVyc2lvbiAlIDEpID8gU3RyaW5nKHJlcVZlcnNpb24pIDogYCR7cmVxVmVyc2lvbn0uMGA7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiByZXFWZXJzaW9uO1xuICB9XG5cbiAgLy8gY2hhbmdlIHRoZSBmb3JtYXQgaW4gc3ViY2xhc3NlcywgYXMgbmVjZXNzYXJ5XG4gIHN0YXRpYyBhc3luYyBfZ2V0RGV2aWNlU3RyaW5nVmVyc2lvblN0cmluZyAocGxhdGZvcm1WZXJzaW9uKSB7XG4gICAgbGV0IHJlcVZlcnNpb24gPSBhd2FpdCB0aGlzLl9nZXREZXZpY2VTdHJpbmdQbGF0Zm9ybVZlcnNpb24ocGxhdGZvcm1WZXJzaW9uKTtcblxuICAgIHJldHVybiBgKCR7cmVxVmVyc2lvbn0gU2ltdWxhdG9yKWA7XG4gIH1cblxuICAvLyBjaGFuZ2UgdGhlIGZvcm1hdCBpbiBzdWJjbGFzc2VzLCBhcyBuZWNlc3NhcnlcbiAgc3RhdGljIF9nZXREZXZpY2VTdHJpbmdDb25maWdGaXggKCkge1xuICAgIC8vIHNvbWUgZGV2aWNlcyBuZWVkIHRvIGJlIHVwZGF0ZWRcbiAgICByZXR1cm4ge1xuICAgICAgJ2lQYWQgU2ltdWxhdG9yICg3LjEgU2ltdWxhdG9yKSc6ICdpUGFkIDIgKDcuMSBTaW11bGF0b3IpJyxcbiAgICAgICdpUGFkIFNpbXVsYXRvciAoOC4wIFNpbXVsYXRvciknOiAnaVBhZCAyICg4LjAgU2ltdWxhdG9yKScsXG4gICAgICAnaVBhZCBTaW11bGF0b3IgKDguMSBTaW11bGF0b3IpJzogJ2lQYWQgMiAoOC4xIFNpbXVsYXRvciknLFxuICAgICAgJ2lQYWQgU2ltdWxhdG9yICg4LjIgU2ltdWxhdG9yKSc6ICdpUGFkIDIgKDguMiBTaW11bGF0b3IpJyxcbiAgICAgICdpUGFkIFNpbXVsYXRvciAoOC4zIFNpbXVsYXRvciknOiAnaVBhZCAyICg4LjMgU2ltdWxhdG9yKScsXG4gICAgICAnaVBhZCBTaW11bGF0b3IgKDguNCBTaW11bGF0b3IpJzogJ2lQYWQgMiAoOC40IFNpbXVsYXRvciknLFxuICAgICAgJ2lQaG9uZSBTaW11bGF0b3IgKDcuMSBTaW11bGF0b3IpJzogJ2lQaG9uZSA1cyAoNy4xIFNpbXVsYXRvciknLFxuICAgICAgJ2lQaG9uZSBTaW11bGF0b3IgKDguNCBTaW11bGF0b3IpJzogJ2lQaG9uZSA2ICg4LjQgU2ltdWxhdG9yKScsXG4gICAgICAnaVBob25lIFNpbXVsYXRvciAoOC4zIFNpbXVsYXRvciknOiAnaVBob25lIDYgKDguMyBTaW11bGF0b3IpJyxcbiAgICAgICdpUGhvbmUgU2ltdWxhdG9yICg4LjIgU2ltdWxhdG9yKSc6ICdpUGhvbmUgNiAoOC4yIFNpbXVsYXRvciknLFxuICAgICAgJ2lQaG9uZSBTaW11bGF0b3IgKDguMSBTaW11bGF0b3IpJzogJ2lQaG9uZSA2ICg4LjEgU2ltdWxhdG9yKScsXG4gICAgICAnaVBob25lIFNpbXVsYXRvciAoOC4wIFNpbXVsYXRvciknOiAnaVBob25lIDYgKDguMCBTaW11bGF0b3IpJ1xuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogVGFrZXMgYSBzZXQgb2Ygb3B0aW9ucyBhbmQgZmluZHMgdGhlIGNvcnJlY3QgZGV2aWNlIHN0cmluZyBpbiBvcmRlciBmb3IgSW5zdHJ1bWVudHMgdG9cbiAgICogaWRlbnRpZnkgdGhlIGNvcnJlY3Qgc2ltdWxhdG9yLlxuICAgKlxuICAgKiBAcGFyYW0ge29iamVjdH0gb3B0cyAtIFRoZSBvcHRpb25zIGF2YWlsYWJsZSBhcmU6XG4gICAqICAgLSBgZGV2aWNlTmFtZWAgLSBhIG5hbWUgZm9yIHRoZSBkZXZpY2UuIElmIHRoZSBnaXZlbiBkZXZpY2UgbmFtZSBzdGFydHMgd2l0aCBgPWAsIHRoZSBuYW1lLCBsZXNzIHRoZSBlcXVhbHMgc2lnbiwgaXMgcmV0dXJuZWQuXG4gICAqICAgLSBgcGxhdGZvcm1WZXJzaW9uYCAtIHRoZSB2ZXJzaW9uIG9mIGlPUyB0byB1c2UuIERlZmF1bHRzIHRvIHRoZSBjdXJyZW50IFhjb2RlJ3MgbWF4aW11bSBTREsgdmVyc2lvbi5cbiAgICogICAtIGBmb3JjZUlwaG9uZWAgLSBmb3JjZSB0aGUgY29uZmlndXJhdGlvbiBvZiB0aGUgZGV2aWNlIHN0cmluZyB0byBpUGhvbmUuIERlZmF1bHRzIHRvIGBmYWxzZWAuXG4gICAqICAgLSBgZm9yY2VJcGFkYCAtIGZvcmNlIHRoZSBjb25maWd1cmF0aW9uIG9mIHRoZSBkZXZpY2Ugc3RyaW5nIHRvIGlQYWQuIERlZmF1bHRzIHRvIGBmYWxzZWAuXG4gICAqICAgSWYgYm90aCBgZm9yY2VJcGhvbmVgIGFuZCBgZm9yY2VJcGFkYCBhcmUgdHJ1ZSwgdGhlIGRldmljZSB3aWxsIGJlIGZvcmNlZCB0byBpUGhvbmUuXG4gICAqXG4gICAqIEByZXR1cm4ge3N0cmluZ30gVGhlIGZvdW5kIGRldmljZSBzdHJpbmcuXG4gICAqL1xuICBzdGF0aWMgYXN5bmMgZ2V0RGV2aWNlU3RyaW5nIChvcHRzKSB7XG4gICAgb3B0cyA9IE9iamVjdC5hc3NpZ24oe30sIHtcbiAgICAgIGRldmljZU5hbWU6IG51bGwsXG4gICAgICBwbGF0Zm9ybVZlcnNpb246IG51bGwsXG4gICAgICBmb3JjZUlwaG9uZTogZmFsc2UsXG4gICAgICBmb3JjZUlwYWQ6IGZhbHNlXG4gICAgfSwgb3B0cyk7XG4gICAgbGV0IGxvZ09wdHMgPSB7XG4gICAgICBkZXZpY2VOYW1lOiBvcHRzLmRldmljZU5hbWUsXG4gICAgICBwbGF0Zm9ybVZlcnNpb246IG9wdHMucGxhdGZvcm1WZXJzaW9uLFxuICAgICAgZm9yY2VJcGhvbmU6IG9wdHMuZm9yY2VJcGhvbmUsXG4gICAgICBmb3JjZUlwYWQ6IG9wdHMuZm9yY2VJcGFkXG4gICAgfTtcbiAgICBsb2cuZGVidWcoYEdldHRpbmcgZGV2aWNlIHN0cmluZyBmcm9tIG9wdGlvbnM6ICR7SlNPTi5zdHJpbmdpZnkobG9nT3B0cyl9YCk7XG5cbiAgICAvLyBzaG9ydCBjaXJjdWl0IGlmIHdlIGFscmVhZHkgaGF2ZSBhIGRldmljZSBuYW1lXG4gICAgaWYgKChvcHRzLmRldmljZU5hbWUgfHwgJycpWzBdID09PSAnPScpIHtcbiAgICAgIHJldHVybiBvcHRzLmRldmljZU5hbWUuc3Vic3RyaW5nKDEpO1xuICAgIH1cblxuICAgIGxldCBpc2lQaG9uZSA9ICEhb3B0cy5mb3JjZUlwaG9uZSB8fCAhb3B0cy5mb3JjZUlwYWQ7XG5cbiAgICBpZiAob3B0cy5kZXZpY2VOYW1lKSB7XG4gICAgICBsZXQgZGV2aWNlID0gb3B0cy5kZXZpY2VOYW1lLnRvTG93ZXJDYXNlKCk7XG4gICAgICBpZiAoZGV2aWNlLmluZGV4T2YoJ2lwaG9uZScpICE9PSAtMSkge1xuICAgICAgICBpc2lQaG9uZSA9IHRydWU7XG4gICAgICB9IGVsc2UgaWYgKGRldmljZS5pbmRleE9mKCdpcGFkJykgIT09IC0xKSB7XG4gICAgICAgIGlzaVBob25lID0gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuXG4gICAgbGV0IGlvc0RldmljZVN0cmluZyA9IG9wdHMuZGV2aWNlTmFtZSB8fCAoaXNpUGhvbmUgPyAnaVBob25lIFNpbXVsYXRvcicgOiAnaVBhZCBTaW11bGF0b3InKTtcblxuICAgIC8vIGlmIHNvbWVvbmUgcGFzc2VzIGluIGp1c3QgXCJpUGhvbmVcIiwgbWFrZSB0aGF0IFwiaVBob25lIFNpbXVsYXRvclwiIHRvXG4gICAgLy8gY29uZm9ybSB0byBhbGwgdGhlIGxvZ2ljIGJlbG93XG4gICAgaWYgKC9eKGlQaG9uZXxpUGFkKSQvLnRlc3QoaW9zRGV2aWNlU3RyaW5nKSkge1xuICAgICAgaW9zRGV2aWNlU3RyaW5nICs9ICcgU2ltdWxhdG9yJztcbiAgICB9XG5cbiAgICAvLyB3ZSBzdXBwb3J0IGRldmljZU5hbWU6IFwiaVBob25lIFNpbXVsYXRvclwiLCBhbmQgYWxzbyB3YW50IHRvIHN1cHBvcnRcbiAgICAvLyBcImlQaG9uZSBYWVogU2ltdWxhdG9yXCIsIGJ1dCB0aGVzZSBzdHJpbmdzIGFyZW4ndCBpbiB0aGUgZGV2aWNlIGxpc3QuXG4gICAgLy8gU28sIGlmIHNvbWVvbmUgc2VudCBpbiBcImlQaG9uZSBYWVogU2ltdWxhdG9yXCIsIHN0cmlwIG9mZiBcIiBTaW11bGF0b3JcIlxuICAgIC8vIGluIG9yZGVyIHRvIGFsbG93IHRoZSBkZWZhdWx0IFwiaVBob25lIFhZWlwiIG1hdGNoXG4gICAgaWYgKC9bXihpUGhvbmV8aVBhZCldIFNpbXVsYXRvci8udGVzdChpb3NEZXZpY2VTdHJpbmcpKSB7XG4gICAgICBpb3NEZXZpY2VTdHJpbmcgPSBpb3NEZXZpY2VTdHJpbmcucmVwbGFjZSgnIFNpbXVsYXRvcicsICcnKTtcbiAgICB9XG4gICAgaW9zRGV2aWNlU3RyaW5nICs9IGAgJHthd2FpdCB0aGlzLl9nZXREZXZpY2VTdHJpbmdWZXJzaW9uU3RyaW5nKG9wdHMucGxhdGZvcm1WZXJzaW9uKX1gO1xuXG4gICAgbGV0IENPTkZJR19GSVggPSB0aGlzLl9nZXREZXZpY2VTdHJpbmdDb25maWdGaXgoKTtcblxuICAgIGxldCBjb25maWdGaXggPSBDT05GSUdfRklYO1xuICAgIGlmIChjb25maWdGaXhbaW9zRGV2aWNlU3RyaW5nXSkge1xuICAgICAgaW9zRGV2aWNlU3RyaW5nID0gY29uZmlnRml4W2lvc0RldmljZVN0cmluZ107XG4gICAgICBsb2cuZGVidWcoYEZpeGluZyBkZXZpY2UuIENoYW5nZWQgZnJvbSAnJHtvcHRzLmRldmljZU5hbWV9JyBgICtcbiAgICAgICAgICAgICAgICBgdG8gJyR7aW9zRGV2aWNlU3RyaW5nfSdgKTtcbiAgICB9XG5cbiAgICBsb2cuZGVidWcoYEZpbmFsIGRldmljZSBzdHJpbmcgaXMgJyR7aW9zRGV2aWNlU3RyaW5nfSdgKTtcbiAgICByZXR1cm4gaW9zRGV2aWNlU3RyaW5nO1xuICB9XG5cbiAgLyoqXG4gICAqIEByZXR1cm4gez9zdHJpbmd9IFRoZSBmdWxsIHBhdGggdG8gdGhlIHNpbXVsYXRvcidzIFdlYkluc3BlY3RvciBVbml4IERvbWFpbiBTb2NrZXRcbiAgICogICBvciBgbnVsbGAgaWYgdGhlcmUgaXMgbm8gc29ja2V0LlxuICAgKi9cbiAgYXN5bmMgZ2V0V2ViSW5zcGVjdG9yU29ja2V0ICgpIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSByZXF1aXJlLWF3YWl0XG4gICAgLy8gdGhlcmUgaXMgbm8gV2ViSW5zcGVjdG9yIHNvY2tldCBmb3IgdGhpcyB2ZXJzaW9uIG9mIFhjb2RlXG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbn1cblxuZm9yIChsZXQgW2NtZCwgZm5dIG9mIF8udG9QYWlycyhleHRlbnNpb25zKSkge1xuICBTaW11bGF0b3JYY29kZTYucHJvdG90eXBlW2NtZF0gPSBmbjtcbn1cblxuZXhwb3J0IGRlZmF1bHQgU2ltdWxhdG9yWGNvZGU2O1xuZXhwb3J0IHsgU2ltdWxhdG9yWGNvZGU2LCBCT09UX0NPTVBMRVRFRF9FVkVOVCwgU1BSSU5HQk9BUkRfQlVORExFX0lEIH07XG4iXSwiZmlsZSI6ImxpYi9zaW11bGF0b3IteGNvZGUtNi5qcyIsInNvdXJjZVJvb3QiOiIuLi8uLiJ9
