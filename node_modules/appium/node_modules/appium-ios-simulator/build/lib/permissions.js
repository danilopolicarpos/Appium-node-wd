"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

require("source-map-support/register");

var _lodash = _interopRequireDefault(require("lodash"));

var _appiumSupport = require("appium-support");

var _teen_process = require("teen_process");

var _logger = _interopRequireDefault(require("./logger"));

var _tccDb = _interopRequireDefault(require("./tcc-db"));

var _shellQuote = require("shell-quote");

const STATUS_UNSET = 'unset';
const STATUS_YES = 'yes';
const STATUS_NO = 'no';
const WIX_SIM_UTILS = 'applesimutils';
const SERVICES = {
  calendar: 'kTCCServiceCalendar',
  camera: 'kTCCServiceCamera',
  contacts: 'kTCCServiceAddressBook',
  homekit: 'kTCCServiceWillow',
  microphone: 'kTCCServiceMicrophone',
  photos: 'kTCCServicePhotos',
  reminders: 'kTCCServiceReminders',
  medialibrary: 'kTCCServiceMediaLibrary',
  motion: 'kTCCServiceMotion',
  health: 'kTCCServiceMSO',
  siri: 'kTCCServiceSiri',
  speech: 'kTCCServiceSpeechRecognition'
};

function toInternalServiceName(serviceName) {
  if (_lodash.default.has(SERVICES, _lodash.default.toLower(serviceName))) {
    return SERVICES[_lodash.default.toLower(serviceName)];
  }

  throw new Error(`'${serviceName}' is unknown. Only the following service names are supported: ${JSON.stringify(_lodash.default.keys(SERVICES))}`);
}

function formatStatus(status) {
  return [STATUS_UNSET, STATUS_NO].includes(status) ? _lodash.default.toUpper(status) : status;
}

async function execWix(args) {
  try {
    await _appiumSupport.fs.which(WIX_SIM_UTILS);
  } catch (e) {
    throw new Error(`${WIX_SIM_UTILS} binary has not been found in your PATH. ` + `Please install it ('brew tap wix/brew && brew install wix/brew/applesimutils') to ` + `be able to change application permissions`);
  }

  _logger.default.debug(`Executing: ${WIX_SIM_UTILS} ${(0, _shellQuote.quote)(args)}`);

  try {
    const {
      stdout
    } = await (0, _teen_process.exec)(WIX_SIM_UTILS, args);

    _logger.default.debug(`Command output: ${stdout}`);

    return stdout;
  } catch (e) {
    throw new Error(`Cannot execute "${WIX_SIM_UTILS} ${(0, _shellQuote.quote)(args)}". Original error: ${e.stderr || e.message}`);
  }
}

class Permissions {
  constructor(xcodeVersion, sharedResourcesDir, udid) {
    this.tccDb = new _tccDb.default(xcodeVersion, sharedResourcesDir);
    this.udid = udid;
  }

  async setAccess(permissionsMapping, bundleId) {
    const permissionsArg = _lodash.default.toPairs(permissionsMapping).map(x => `${x[0]}=${formatStatus(x[1])}`).join(',');

    return await execWix(['--byId', this.udid, '--bundle', bundleId, '--setPermissions', permissionsArg]);
  }

  async getAccess(serviceName, bundleId) {
    serviceName = toInternalServiceName(serviceName);

    for (const [sqlValue, status] of [['0', STATUS_NO], ['1', STATUS_YES]]) {
      const count = await this.tccDb.execQuery(`SELECT count(*) FROM 'access' WHERE client='?' AND allowed=? AND service='?'`, bundleId, sqlValue, serviceName);

      if (parseInt(count.split('=')[1], 10) > 0) {
        return status;
      }
    }

    return STATUS_UNSET;
  }

}

var _default = Permissions;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9wZXJtaXNzaW9ucy5qcyJdLCJuYW1lcyI6WyJTVEFUVVNfVU5TRVQiLCJTVEFUVVNfWUVTIiwiU1RBVFVTX05PIiwiV0lYX1NJTV9VVElMUyIsIlNFUlZJQ0VTIiwiY2FsZW5kYXIiLCJjYW1lcmEiLCJjb250YWN0cyIsImhvbWVraXQiLCJtaWNyb3Bob25lIiwicGhvdG9zIiwicmVtaW5kZXJzIiwibWVkaWFsaWJyYXJ5IiwibW90aW9uIiwiaGVhbHRoIiwic2lyaSIsInNwZWVjaCIsInRvSW50ZXJuYWxTZXJ2aWNlTmFtZSIsInNlcnZpY2VOYW1lIiwiXyIsImhhcyIsInRvTG93ZXIiLCJFcnJvciIsIkpTT04iLCJzdHJpbmdpZnkiLCJrZXlzIiwiZm9ybWF0U3RhdHVzIiwic3RhdHVzIiwiaW5jbHVkZXMiLCJ0b1VwcGVyIiwiZXhlY1dpeCIsImFyZ3MiLCJmcyIsIndoaWNoIiwiZSIsImxvZyIsImRlYnVnIiwic3Rkb3V0Iiwic3RkZXJyIiwibWVzc2FnZSIsIlBlcm1pc3Npb25zIiwiY29uc3RydWN0b3IiLCJ4Y29kZVZlcnNpb24iLCJzaGFyZWRSZXNvdXJjZXNEaXIiLCJ1ZGlkIiwidGNjRGIiLCJUQ0NEQiIsInNldEFjY2VzcyIsInBlcm1pc3Npb25zTWFwcGluZyIsImJ1bmRsZUlkIiwicGVybWlzc2lvbnNBcmciLCJ0b1BhaXJzIiwibWFwIiwieCIsImpvaW4iLCJnZXRBY2Nlc3MiLCJzcWxWYWx1ZSIsImNvdW50IiwiZXhlY1F1ZXJ5IiwicGFyc2VJbnQiLCJzcGxpdCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQSxNQUFNQSxZQUFZLEdBQUcsT0FBckI7QUFDQSxNQUFNQyxVQUFVLEdBQUcsS0FBbkI7QUFDQSxNQUFNQyxTQUFTLEdBQUcsSUFBbEI7QUFDQSxNQUFNQyxhQUFhLEdBQUcsZUFBdEI7QUFDQSxNQUFNQyxRQUFRLEdBQUc7QUFDZkMsRUFBQUEsUUFB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S0FBS2MsSUFESSxFQUVuQixVQUZtQixFQUVQSyxRQUZPLEVBR25CLGtCQUhtQixFQUdDQyxjQUhELENBQUQsQ0FBcEI7QUFLRDs7QUFXRCxRQUFNSyxTQUFOLENBQWlCckMsV0FBakIsRUFBOEIrQixRQUE5QixFQUF3QztBQUN0Qy9CLElBQUFBLFdBQVcsR0FBR0QscUJBQXFCLENBQUNDLFdBQUQsQ0FBbkM7O0FBRUEsU0FBSyxNQUFNLENBQUNzQyxRQUFELEVBQVc3QixNQUFYLENBQVgsSUFBaUMsQ0FBQyxDQUFDLEdBQUQsRUFBTXpCLFNBQU4sQ0FBRCxFQUFtQixDQUFDLEdBQUQsRUFBTUQsVUFBTixDQUFuQixDQUFqQyxFQUF3RTtBQUN0RSxZQUFNd0QsS0FBSyxHQUFHLE1BQU0sS0FBS1osS0FBTCxDQUFXYSxTQUFYLENBQXNCLDhFQUF0QixFQUNsQlQsUUFEa0IsRUFDUk8sUUFEUSxFQUNFdEMsV0FERixDQUFwQjs7QUFFQSxVQUFJeUMsUUFBUSxDQUFDRixLQUFLLENBQUNHLEtBQU4sQ0FBWSxHQUFaLEVBQWlCLENBQWpCLENBQUQsRUFBc0IsRUFBdEIsQ0FBUixHQUFvQyxDQUF4QyxFQUEyQztBQUN6QyxlQUFPakMsTUFBUDtBQUNEO0FBQ0Y7O0FBQ0QsV0FBTzNCLFlBQVA7QUFDRDs7QUE5Q2U7O2VBaURId0MsVyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgeyBmcyB9IGZyb20gJ2FwcGl1bS1zdXBwb3J0JztcbmltcG9ydCB7IGV4ZWMgfSBmcm9tICd0ZWVuX3Byb2Nlc3MnO1xuaW1wb3J0IGxvZyBmcm9tICcuL2xvZ2dlcic7XG5pbXBvcnQgVENDREIgZnJvbSAnLi90Y2MtZGInO1xuaW1wb3J0IHsgcXVvdGUgfSBmcm9tICdzaGVsbC1xdW90ZSc7XG5cbmNvbnN0IFNUQVRVU19VTlNFVCA9ICd1bnNldCc7XG5jb25zdCBTVEFUVVNfWUVTID0gJ3llcyc7XG5jb25zdCBTVEFUVVNfTk8gPSAnbm8nO1xuY29uc3QgV0lYX1NJTV9VVElMUyA9ICdhcHBsZXNpbXV0aWxzJztcbmNvbnN0IFNFUlZJQ0VTID0ge1xuICBjYWxlbmRhcjogJ2tUQ0NTZXJ2aWNlQ2FsZW5kYXInLFxuICBjYW1lcmE6ICdrVENDU2VydmljZUNhbWVyYScsXG4gIGNvbnRhY3RzOiAna1RDQ1NlcnZpY2VBZGRyZXNzQm9vaycsXG4gIGhvbWVraXQ6ICdrVENDU2VydmljZVdpbGxvdycsXG4gIG1pY3JvcGhvbmU6ICdrVENDU2VydmljZU1pY3JvcGhvbmUnLFxuICBwaG90b3M6ICdrVENDU2VydmljZVBob3RvcycsXG4gIHJlbWluZGVyczogJ2tUQ0NTZXJ2aWNlUmVtaW5kZXJzJyxcbiAgbWVkaWFsaWJyYXJ5OiAna1RDQ1NlcnZpY2VNZWRpYUxpYnJhcnknLFxuICBtb3Rpb246ICdrVENDU2VydmljZU1vdGlvbicsXG4gIGhlYWx0aDogJ2tUQ0NTZXJ2aWNlTVNPJyxcbiAgc2lyaTogJ2tUQ0NTZXJ2aWNlU2lyaScsXG4gIHNwZWVjaDogJ2tUQ0NTZXJ2aWNlU3BlZWNoUmVjb2duaXRpb24nLFxufTtcblxuZnVuY3Rpb24gdG9JbnRlcm5hbFNlcnZpY2VOYW1lIChzZXJ2aWNlTmFtZSkge1xuICBpZiAoXy5oYXMoU0VSVklDRVMsIF8udG9Mb3dlcihzZXJ2aWNlTmFtZSkpKSB7XG4gICAgcmV0dXJuIFNFUlZJQ0VTW18udG9Mb3dlcihzZXJ2aWNlTmFtZSldO1xuICB9XG4gIHRocm93IG5ldyBFcnJvcihgJyR7c2VydmljZU5hbWV9JyBpcyB1bmtub3duLiBPbmx5IHRoZSBmb2xsb3dpbmcgc2VydmljZSBuYW1lcyBhcmUgc3VwcG9ydGVkOiAke0pTT04uc3RyaW5naWZ5KF8ua2V5cyhTRVJWSUNFUykpfWApO1xufVxuXG5mdW5jdGlvbiBmb3JtYXRTdGF0dXMgKHN0YXR1cykge1xuICByZXR1cm4gW1NUQVRVU19VTlNFVCwgU1RBVFVTX05PXS5pbmNsdWRlcyhzdGF0dXMpID8gXy50b1VwcGVyKHN0YXR1cykgOiBzdGF0dXM7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGV4ZWNXaXggKGFyZ3MpIHtcbiAgdHJ5IHtcbiAgICBhd2FpdCBmcy53aGljaChXSVhfU0lNX1VUSUxTKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgJHtXSVhfU0lNX1VUSUxTfSBiaW5hcnkgaGFzIG5vdCBiZWVuIGZvdW5kIGluIHlvdXIgUEFUSC4gYCArXG4gICAgICBgUGxlYXNlIGluc3RhbGwgaXQgKCdicmV3IHRhcCB3aXgvYnJldyAmJiBicmV3IGluc3RhbGwgd2l4L2JyZXcvYXBwbGVzaW11dGlscycpIHRvIGAgK1xuICAgICAgYGJlIGFibGUgdG8gY2hhbmdlIGFwcGxpY2F0aW9uIHBlcm1pc3Npb25zYCk7XG4gIH1cblxuICBsb2cuZGVidWcoYEV4ZWN1dGluZzogJHtXSVhfU0lNX1VUSUxTfSAke3F1b3RlKGFyZ3MpfWApO1xuICB0cnkge1xuICAgIGNvbnN0IHtzdGRvdXR9ID0gYXdhaXQgZXhlYyhXSVhfU0lNX1VUSUxTLCBhcmdzKTtcbiAgICBsb2cuZGVidWcoYENvbW1hbmQgb3V0cHV0OiAke3N0ZG91dH1gKTtcbiAgICByZXR1cm4gc3Rkb3V0O1xuICB9IGNhdGNoIChlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBDYW5ub3QgZXhlY3V0ZSBcIiR7V0lYX1NJTV9VVElMU30gJHtxdW90ZShhcmdzKX1cIi4gT3JpZ2luYWwgZXJyb3I6ICR7ZS5zdGRlcnIgfHwgZS5tZXNzYWdlfWApO1xuICB9XG59XG5cbmNsYXNzIFBlcm1pc3Npb25zIHtcbiAgY29uc3RydWN0b3IgKHhjb2RlVmVyc2lvbiwgc2hhcmVkUmVzb3VyY2VzRGlyLCB1ZGlkKSB7XG4gICAgdGhpcy50Y2NEYiA9IG5ldyBUQ0NEQih4Y29kZVZlcnNpb24sIHNoYXJlZFJlc291cmNlc0Rpcik7XG4gICAgdGhpcy51ZGlkID0gdWRpZDtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXRzIHBlcm1pc3Npb25zIGZvciB0aGUgZ2l2ZW4gYXBwbGljYXRpb25cbiAgICpcbiAgICogQHBhcmFtIHtPYmplY3R9IHBlcm1pc3Npb25zTWFwcGluZyAtIEFuIG9iamVjdCwgd2hlcmUga2V5cyBhciAgc2VydmljZSBuYW1lc1xuICAgKiBhbmQgdmFsdWVzIGFyZSBjb3JyZXNwb25kaW5nIHN0YXRlIHZhbHVlcy4gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS93aXgvQXBwbGVTaW11bGF0b3JVdGlsc1xuICAgKiBmb3IgbW9yZSBkZXRhaWxzIG9uIGF2YWlsYWJsZSBzZXJ2aWNlIG5hbWVzIGFuZCBzdGF0dXNlcy5cbiAgICogQHBhcmFtIHtzdHJpbmd9IGJ1bmRsZUlkIC0gYnVuZGxlIGlkZW50aWZpZXIgb2YgdGhlIHRhcmdldCBhcHBsaWNhdGlvbi5cbiAgICogQHRocm93cyB7RXJyb3J9IElmIHRoZXJlIHdhcyBhbiBlcnJvciB3aGlsZSBjaGFuZ2luZyBwZXJtaXNzaW9ucy5cbiAgICovXG4gIGFzeW5jIHNldEFjY2VzcyAocGVybWlzc2lvbnNNYXBwaW5nLCBidW5kbGVJZCkge1xuICAgIGNvbnN0IHBlcm1pc3Npb25zQXJnID0gXy50b1BhaXJzKHBlcm1pc3Npb25zTWFwcGluZylcbiAgICAgIC5tYXAoKHgpID0+IGAke3hbMF19PSR7Zm9ybWF0U3RhdHVzKHhbMV0pfWApXG4gICAgICAuam9pbignLCcpO1xuICAgIHJldHVybiBhd2FpdCBleGVjV2l4KFtcbiAgICAgICctLWJ5SWQnLCB0aGlzLnVkaWQsXG4gICAgICAnLS1idW5kbGUnLCBidW5kbGVJZCxcbiAgICAgICctLXNldFBlcm1pc3Npb25zJywgcGVybWlzc2lvbnNBcmcsXG4gICAgXSk7XG4gIH1cblxuICAvKipcbiAgICogUmV0cmlldmVzIHRoZSBjdXJyZW50IHBlcm1pc3Npb24gc3RhdHVzIGZvciB0aGUgZ2l2ZW4gc2VydmljZSBhbmQgYXBwbGljYXRpb24uXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBzZXJ2aWNlTmFtZSAtIHRoZSBuYW1lIG9mIHRoZSBzZXJ2aWNlLiBTaG91bGQgYmUgb25lIG9mXG4gICAqIGBTRVJWSUNFU2Aga2V5cy5cbiAgICogQHBhcmFtIHtzdHJpbmd9IGJ1bmRsZUlkIC0gYnVuZGxlIGlkZW50aWZpZXIgb2YgdGhlIHRhcmdldCBhcHBsaWNhdGlvbi5cbiAgICogQHJldHVybnMge3N0cmluZ30gLSBUaGUgY3VycmVudCBzdGF0dXM6IHllcy9uby91bnNldFxuICAgKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlcmUgd2FzIGFuIGVycm9yIHdoaWxlIHJldHJpZXZpbmcgcGVybWlzc2lvbnMuXG4gICAqL1xuICBhc3luYyBnZXRBY2Nlc3MgKHNlcnZpY2VOYW1lLCBidW5kbGVJZCkge1xuICAgIHNlcnZpY2VOYW1lID0gdG9JbnRlcm5hbFNlcnZpY2VOYW1lKHNlcnZpY2VOYW1lKTtcblxuICAgIGZvciAoY29uc3QgW3NxbFZhbHVlLCBzdGF0dXNdIG9mIFtbJzAnLCBTVEFUVVNfTk9dLCBbJzEnLCBTVEFUVVNfWUVTXV0pIHtcbiAgICAgIGNvbnN0IGNvdW50ID0gYXdhaXQgdGhpcy50Y2NEYi5leGVjUXVlcnkoYFNFTEVDVCBjb3VudCgqKSBGUk9NICdhY2Nlc3MnIFdIRVJFIGNsaWVudD0nPycgQU5EIGFsbG93ZWQ9PyBBTkQgc2VydmljZT0nPydgLFxuICAgICAgICBidW5kbGVJZCwgc3FsVmFsdWUsIHNlcnZpY2VOYW1lKTtcbiAgICAgIGlmIChwYXJzZUludChjb3VudC5zcGxpdCgnPScpWzFdLCAxMCkgPiAwKSB7XG4gICAgICAgIHJldHVybiBzdGF0dXM7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBTVEFUVVNfVU5TRVQ7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgUGVybWlzc2lvbnM7Il0sImZpbGUiOiJsaWIvcGVybWlzc2lvbnMuanMiLCJzb3VyY2VSb290IjoiLi4vLi4ifQ==
