"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.helpers = exports.commands = void 0;

require("source-map-support/register");

var _logger = _interopRequireDefault(require("../logger"));

var _lodash = _interopRequireDefault(require("lodash"));

var _appiumBaseDriver = require("appium-base-driver");

let commands = {},
    helpers = {},
    extensions = {};
exports.helpers = helpers;
exports.commands = commands;

function toBool(s) {
  return _lodash.default.isString(s) ? s.toLowerCase() === 'true' : !!s;
}

commands.getAttribute = async function (attribute, elementId) {
  return await this.uiautomator2.jwproxy.command(`/element/${elementId}/attribute/${attribute}`, 'GET', {});
};

commands.elementDisplayed = async function (elementId) {
  return toBool((await this.getAttribute('displayed', elementId)));
};

commands.elementEnabled = async function (elementId) {
  return toBool((await this.getAttribute('enabled', elementId)));
};

commands.elementSelected = async function (elementId) {
  return toBool((await this.getAttribute('selected', elementId)));
};

commands.getName = async function (elementId) {
  return await this.uiautomator2.jwproxy.command(`/element/${elementId}/name`, 'GET', {});
};

commands.getLocation = async function (elementId) {
  _logger.default.info(`calling get location: ${elementId}`);

  return await this.uiautomator2.jwproxy.command(`/element/${elementId}/location`, 'GET', {});
};

commands.getSize = async function (elementId) {
  return await this.uiautomator2.jwproxy.command(`/element/${elementId}/size`, 'GET', {});
};

commands.touchLongClick = async function (element, x, y, duration) {
  let params = {
    element,
    x,
    y,
    duration
  };
  return await this.uiautomator2.jwproxy.command(`/touch/longclick`, 'POST', {
    params
  });
};

commands.touchDown = async function (element, x, y) {
  let params = {
    element,
    x,
    y
  };
  return await this.uiautomator2.jwproxy.command(`/touch/down`, 'POST', {
    params
  });
};

commands.touchUp = async function (element, x, y) {
  let params = {
    element,
    x,
    y
  };
  return await this.uiautomator2.jwproxy.command(`/touch/up`, 'POST', {
    params
  });
};

commands.touchMove = async function (element, x, y) {
  let params = {
    element,
    x,
    y
  };
  return await this.uiautomator2.jwproxy.command(`/touch/move`, 'POST', {
    params
  });
};

helpers.doSetElementValue = async function (params) {
  return await this.uiautomator2.jwproxy.command(`/element/${params.elementId}/value`, 'POST', params);
};

commands.setValueImmediate = async function (keys, elementId) {
  return await this.uiautomator2.jwproxy.command(`/element/${elementId}/value`, 'POST', {
    elementId,
    text: _lodash.default.isArray(keys) ? keys.join('') : keys,
    replace: false,
    unicodeKeyboard: this.opts.unicodeKeyboard
  });
};

commands.getText = async function (elementId) {
  return await this.uiautomator2.jwproxy.command(`/element/${elementId}/text`, 'GET', {});
};

commands.click = async function (element) {
  return await this.uiautomator2.jwproxy.command(`/element/${element}/click`, 'POST', {
    element
  });
};

commands.getElementScreenshot = async function (element) {
  return await this.uiautomator2.jwproxy.command(`/element/${element}/screenshot`, 'GET', {});
};

commands.tap = async function (element, x = 0, y = 0, count = 1) {
  for (let i = 0; i < count; i++) {
    if (element) {
      let params = {
        element
      };

      if (x !== 0 || y !== 0) {
        params.x = x;
        params.y = y;
      }

      await this.uiautomator2.jwproxy.command(`/element/${element}/click`, 'POST', params);
    } else {
      await this.uiautomator2.jwproxy.command(`/appium/tap`, 'POST', {
        x,
        y
      });
    }
  }
};

commands.clear = async function (elementId) {
  return await this.uiautomator2.jwproxy.command(`/element/${elementId}/clear`, 'POST', {
    elementId
  });
};

commands.getElementRect = async function (elementId) {
  if (this.isWebContext()) {
    _logger.default.debug(`Detected downstream chromedriver protocol: ${this.chromedriver.jwproxy.downstreamProtocol}`);

    if (this.chromedriver.jwproxy.downstreamProtocol === _appiumBaseDriver.BaseDriver.DRIVER_PROTOCOL.MJSONWP) {
      const {
        x,
        y
      } = await this.chromedriver.jwproxy.command(`/element/${elementId}/location`, 'GET');
      const {
        width,
        height
      } = await this.chromedriver.jwproxy.command(`/element/${elementId}/size`, 'GET');
      return {
        x,
        y,
        width,
        height
      };
    }

    return await this.chromedriver.jwproxy.command(`/element/${elementId}/rect`, 'GET');
  }

  return await this.uiautomator2.jwproxy.command(`/element/${elementId}/rect`, 'GET');
};

Object.assign(extensions, commands, helpers);
var _default = extensions;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jb21tYW5kcy9lbGVtZW50LmpzIl0sIm5hbWVzIjpbImNvbW1hbmRzIiwiaGVscGVycyIsImV4dGVuc2lvbnMiLCJ0b0Jvb2wiLCJzIiwiXyIsImlzU3RyaW5nIiwidG9Mb3dlckNhc2UiLCJnZXRBdHRyaWJ1dGUiLCJhdHRyaWJ1dGUiLCJlbGVtZW50SWQiLCJ1aWF1dG9tYXRvcjIiLCJqd3Byb3h5IiwiY29tbWFuZCIsImVsZW1lbnREaXNwbGF5ZWQiLCJlbGVtZW50RW5hYmxlZCIsImVsZW1lbnRTZWxlY3RlZCIsImdldE5hbWUiLCJnZXRMb2NhdGlvbiIsImxvZyIsImluZm8iLCJnZXRTaXplIiwidG91Y2hMb25nQ2xpY2siLCJlbGVtZW50IiwieCIsInkiLCJkdXJhdGlvbiIsInBhcmFtcyIsInRvdWNoRG93biIsInRvdWNoVXAiLCJ0b3VjaE1vdmUiLCJkb1NldEVsZW1lbnRWYWx1ZSIsInNldFZhbHVlSW1tZWRpYXRlIiwia2V5cyIsInRleHQiLCJpc0FycmF5Iiwiam9pbiIsInJlcGxhY2UiLCJ1bmljb2RlS2V5Ym9hcmQiLCJvcHRzIiwiZ2V0VGV4dCIsImNsaWNrIiwiZ2V0RWxlbWVudFNjcmVlbnNob3QiLCJ0YXAiLCJjb3VudCIsImkiLCJjbGVhciIsImdldEVsZW1lbnRSZWN0IiwiaXNXZWJDb250ZXh0IiwiZGVidWciLCJjaHJvbWVkcml2ZXIiLCJkb3duc3RyZWFtUHJvdG9jb2wiLCJCYXNlRHJpdmVyIiwiRFJJVkVSX1BST1RPQ09MIiwiTUpTT05XUCIsIndpZHRoIiwiaGVpZ2h0IiwiT2JqZWN0IiwiYXNzaWduIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUVBLElBQUlBLFFBQVEsR0FBRyxFQUFmO0FBQUEsSUFBbUJDLE9BQU8sR0FBRyxFQUE3QjtBQUFBLElBQWlDQyxVQUFVLEdBQUcsRUFBOUM7Ozs7QUFFQSxTQUFTQyxNQUFULENBQWlCQyxDQUFqQixFQUFvQjtBQUNsQixTQUFPQyxn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WCxDQUEyQkMsT0FBaEYsRUFBeUY7QUFDdkYsWUFBTTtBQUFDOUIsUUFBQUEsQ0FBRDtBQUFJQyxRQUFBQTtBQUFKLFVBQVMsTUFBTSxLQUFLeUIsWUFBTCxDQUFrQnRDLE9BQWxCLENBQTBCQyxPQUExQixDQUFtQyxZQUFXSCxTQUFVLFdBQXhELEVBQW9FLEtBQXBFLENBQXJCO0FBQ0EsWUFBTTtBQUFDNkMsUUFBQUEsS0FBRDtBQUFRQyxRQUFBQTtBQUFSLFVBQWtCLE1BQU0sS0FBS04sWUFBTCxDQUFrQnRDLE9BQWxCLENBQTBCQyxPQUExQixDQUFtQyxZQUFXSCxTQUFVLE9BQXhELEVBQWdFLEtBQWhFLENBQTlCO0FBQ0EsYUFBTztBQUFDYyxRQUFBQSxDQUFEO0FBQUlDLFFBQUFBLENBQUo7QUFBTzhCLFFBQUFBLEtBQVA7QUFBY0MsUUFBQUE7QUFBZCxPQUFQO0FBQ0Q7O0FBQ0QsV0FBTyxNQUFNLEtBQUtOLFlBQUwsQ0FBa0J0QyxPQUFsQixDQUEwQkMsT0FBMUIsQ0FBbUMsWUFBV0gsU0FBVSxPQUF4RCxFQUFnRSxLQUFoRSxDQUFiO0FBQ0Q7O0FBQ0QsU0FBTyxNQUFNLEtBQUtDLFlBQUwsQ0FBa0JDLE9BQWxCLENBQTBCQyxPQUExQixDQUFtQyxZQUFXSCxTQUFVLE9BQXhELEVBQWdFLEtBQWhFLENBQWI7QUFDRCxDQVhEOztBQWFBK0MsTUFBTSxDQUFDQyxNQUFQLENBQWN4RCxVQUFkLEVBQTBCRixRQUExQixFQUFvQ0MsT0FBcEM7ZUFFZUMsVSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBsb2cgZnJvbSAnLi4vbG9nZ2VyJztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgeyBCYXNlRHJpdmVyIH0gZnJvbSAnYXBwaXVtLWJhc2UtZHJpdmVyJztcblxubGV0IGNvbW1hbmRzID0ge30sIGhlbHBlcnMgPSB7fSwgZXh0ZW5zaW9ucyA9IHt9O1xuXG5mdW5jdGlvbiB0b0Jvb2wgKHMpIHtcbiAgcmV0dXJuIF8uaXNTdHJpbmcocykgPyAocy50b0xvd2VyQ2FzZSgpID09PSAndHJ1ZScpIDogISFzO1xufVxuXG5jb21tYW5kcy5nZXRBdHRyaWJ1dGUgPSBhc3luYyBmdW5jdGlvbiAoYXR0cmlidXRlLCBlbGVtZW50SWQpIHtcbiAgcmV0dXJuIGF3YWl0IHRoaXMudWlhdXRvbWF0b3IyLmp3cHJveHkuY29tbWFuZChgL2VsZW1lbnQvJHtlbGVtZW50SWR9L2F0dHJpYnV0ZS8ke2F0dHJpYnV0ZX1gLCAnR0VUJywge30pO1xufTtcblxuY29tbWFuZHMuZWxlbWVudERpc3BsYXllZCA9IGFzeW5jIGZ1bmN0aW9uIChlbGVtZW50SWQpIHtcbiAgcmV0dXJuIHRvQm9vbChhd2FpdCB0aGlzLmdldEF0dHJpYnV0ZSgnZGlzcGxheWVkJywgZWxlbWVudElkKSk7XG59O1xuXG5jb21tYW5kcy5lbGVtZW50RW5hYmxlZCA9IGFzeW5jIGZ1bmN0aW9uIChlbGVtZW50SWQpIHtcbiAgcmV0dXJuIHRvQm9vbChhd2FpdCB0aGlzLmdldEF0dHJpYnV0ZSgnZW5hYmxlZCcsIGVsZW1lbnRJZCkpO1xufTtcblxuY29tbWFuZHMuZWxlbWVudFNlbGVjdGVkID0gYXN5bmMgZnVuY3Rpb24gKGVsZW1lbnRJZCkge1xuICByZXR1cm4gdG9Cb29sKGF3YWl0IHRoaXMuZ2V0QXR0cmlidXRlKCdzZWxlY3RlZCcsIGVsZW1lbnRJZCkpO1xufTtcblxuY29tbWFuZHMuZ2V0TmFtZSA9IGFzeW5jIGZ1bmN0aW9uIChlbGVtZW50SWQpIHtcbiAgcmV0dXJuIGF3YWl0IHRoaXMudWlhdXRvbWF0b3IyLmp3cHJveHkuY29tbWFuZChgL2VsZW1lbnQvJHtlbGVtZW50SWR9L25hbWVgLCAnR0VUJywge30pO1xufTtcblxuY29tbWFuZHMuZ2V0TG9jYXRpb24gPSBhc3luYyBmdW5jdGlvbiAoZWxlbWVudElkKSB7XG4gIGxvZy5pbmZvKGBjYWxsaW5nIGdldCBsb2NhdGlvbjogJHtlbGVtZW50SWR9YCk7XG4gIHJldHVybiBhd2FpdCB0aGlzLnVpYXV0b21hdG9yMi5qd3Byb3h5LmNvbW1hbmQoYC9lbGVtZW50LyR7ZWxlbWVudElkfS9sb2NhdGlvbmAsICdHRVQnLCB7fSk7XG59O1xuXG5jb21tYW5kcy5nZXRTaXplID0gYXN5bmMgZnVuY3Rpb24gKGVsZW1lbnRJZCkge1xuICByZXR1cm4gYXdhaXQgdGhpcy51aWF1dG9tYXRvcjIuandwcm94eS5jb21tYW5kKGAvZWxlbWVudC8ke2VsZW1lbnRJZH0vc2l6ZWAsICdHRVQnLCB7fSk7XG59O1xuXG5jb21tYW5kcy50b3VjaExvbmdDbGljayA9IGFzeW5jIGZ1bmN0aW9uIChlbGVtZW50LCB4LCB5LCBkdXJhdGlvbikge1xuICBsZXQgcGFyYW1zID0ge2VsZW1lbnQsIHgsIHksIGR1cmF0aW9ufTtcbiAgcmV0dXJuIGF3YWl0IHRoaXMudWlhdXRvbWF0b3IyLmp3cHJveHkuY29tbWFuZChgL3RvdWNoL2xvbmdjbGlja2AsICdQT1NUJywge3BhcmFtc30pO1xufTtcblxuY29tbWFuZHMudG91Y2hEb3duID0gYXN5bmMgZnVuY3Rpb24gKGVsZW1lbnQsIHgsIHkpIHtcbiAgbGV0IHBhcmFtcyA9IHtlbGVtZW50LCB4LCB5fTtcbiAgcmV0dXJuIGF3YWl0IHRoaXMudWlhdXRvbWF0b3IyLmp3cHJveHkuY29tbWFuZChgL3RvdWNoL2Rvd25gLCAnUE9TVCcsIHtwYXJhbXN9KTtcbn07XG5cbmNvbW1hbmRzLnRvdWNoVXAgPSBhc3luYyBmdW5jdGlvbiAoZWxlbWVudCwgeCwgeSkge1xuICBsZXQgcGFyYW1zID0ge2VsZW1lbnQsIHgsIHl9O1xuICByZXR1cm4gYXdhaXQgdGhpcy51aWF1dG9tYXRvcjIuandwcm94eS5jb21tYW5kKGAvdG91Y2gvdXBgLCAnUE9TVCcsIHtwYXJhbXN9KTtcbn07XG5cbmNvbW1hbmRzLnRvdWNoTW92ZSA9IGFzeW5jIGZ1bmN0aW9uIChlbGVtZW50LCB4LCB5KSB7XG4gIGxldCBwYXJhbXMgPSB7ZWxlbWVudCwgeCwgeX07XG4gIHJldHVybiBhd2FpdCB0aGlzLnVpYXV0b21hdG9yMi5qd3Byb3h5LmNvbW1hbmQoYC90b3VjaC9tb3ZlYCwgJ1BPU1QnLCB7cGFyYW1zfSk7XG59O1xuXG5oZWxwZXJzLmRvU2V0RWxlbWVudFZhbHVlID0gYXN5bmMgZnVuY3Rpb24gKHBhcmFtcykge1xuICByZXR1cm4gYXdhaXQgdGhpcy51aWF1dG9tYXRvcjIuandwcm94eS5jb21tYW5kKGAvZWxlbWVudC8ke3BhcmFtcy5lbGVtZW50SWR9L3ZhbHVlYCwgJ1BPU1QnLCBwYXJhbXMpO1xufTtcblxuY29tbWFuZHMuc2V0VmFsdWVJbW1lZGlhdGUgPSBhc3luYyBmdW5jdGlvbiAoa2V5cywgZWxlbWVudElkKSB7XG4gIHJldHVybiBhd2FpdCB0aGlzLnVpYXV0b21hdG9yMi5qd3Byb3h5LmNvbW1hbmQoYC9lbGVtZW50LyR7ZWxlbWVudElkfS92YWx1ZWAsICdQT1NUJywge1xuICAgIGVsZW1lbnRJZCxcbiAgICB0ZXh0OiBfLmlzQXJyYXkoa2V5cykgPyBrZXlzLmpvaW4oJycpIDoga2V5cyxcbiAgICByZXBsYWNlOiBmYWxzZSxcbiAgICB1bmljb2RlS2V5Ym9hcmQ6IHRoaXMub3B0cy51bmljb2RlS2V5Ym9hcmQsXG4gIH0pO1xufTtcblxuY29tbWFuZHMuZ2V0VGV4dCA9IGFzeW5jIGZ1bmN0aW9uIChlbGVtZW50SWQpIHtcbiAgcmV0dXJuIGF3YWl0IHRoaXMudWlhdXRvbWF0b3IyLmp3cHJveHkuY29tbWFuZChgL2VsZW1lbnQvJHtlbGVtZW50SWR9L3RleHRgLCAnR0VUJywge30pO1xufTtcblxuY29tbWFuZHMuY2xpY2sgPSBhc3luYyBmdW5jdGlvbiAoZWxlbWVudCkge1xuICByZXR1cm4gYXdhaXQgdGhpcy51aWF1dG9tYXRvcjIuandwcm94eS5jb21tYW5kKGAvZWxlbWVudC8ke2VsZW1lbnR9L2NsaWNrYCwgJ1BPU1QnLCB7ZWxlbWVudH0pO1xufTtcblxuY29tbWFuZHMuZ2V0RWxlbWVudFNjcmVlbnNob3QgPSBhc3luYyBmdW5jdGlvbiAoZWxlbWVudCkge1xuICByZXR1cm4gYXdhaXQgdGhpcy51aWF1dG9tYXRvcjIuandwcm94eS5jb21tYW5kKGAvZWxlbWVudC8ke2VsZW1lbnR9L3NjcmVlbnNob3RgLCAnR0VUJywge30pO1xufTtcblxuY29tbWFuZHMudGFwID0gYXN5bmMgZnVuY3Rpb24gKGVsZW1lbnQsIHggPSAwLCB5ID0gMCwgY291bnQgPSAxKSB7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgY291bnQ7IGkrKykge1xuICAgIGlmIChlbGVtZW50KSB7XG4gICAgICAvLyB3ZSBhcmUgZWl0aGVyIHRhcHBpbmcgb24gdGhlIGRlZmF1bHQgbG9jYXRpb24gb2YgdGhlIGVsZW1lbnRcbiAgICAgIC8vIG9yIGFuIG9mZnNldCBmcm9tIHRoZSB0b3AgbGVmdCBjb3JuZXJcbiAgICAgIGxldCBwYXJhbXMgPSB7ZWxlbWVudH07XG4gICAgICBpZiAoeCAhPT0gMCB8fCB5ICE9PSAwKSB7XG4gICAgICAgIHBhcmFtcy54ID0geDtcbiAgICAgICAgcGFyYW1zLnkgPSB5O1xuICAgICAgfVxuICAgICAgYXdhaXQgdGhpcy51aWF1dG9tYXRvcjIuandwcm94eS5jb21tYW5kKGAvZWxlbWVudC8ke2VsZW1lbnR9L2NsaWNrYCwgJ1BPU1QnLCBwYXJhbXMpO1xuICAgIH0gZWxzZSB7XG4gICAgICBhd2FpdCB0aGlzLnVpYXV0b21hdG9yMi5qd3Byb3h5LmNvbW1hbmQoYC9hcHBpdW0vdGFwYCwgJ1BPU1QnLCB7eCwgeX0pO1xuICAgIH1cbiAgfVxufTtcblxuY29tbWFuZHMuY2xlYXIgPSBhc3luYyBmdW5jdGlvbiAoZWxlbWVudElkKSB7XG4gIHJldHVybiBhd2FpdCB0aGlzLnVpYXV0b21hdG9yMi5qd3Byb3h5LmNvbW1hbmQoYC9lbGVtZW50LyR7ZWxlbWVudElkfS9jbGVhcmAsICdQT1NUJywge2VsZW1lbnRJZH0pO1xufTtcblxuY29tbWFuZHMuZ2V0RWxlbWVudFJlY3QgPSBhc3luYyBmdW5jdGlvbiAoZWxlbWVudElkKSB7XG4gIGlmICh0aGlzLmlzV2ViQ29udGV4dCgpKSB7XG4gICAgbG9nLmRlYnVnKGBEZXRlY3RlZCBkb3duc3RyZWFtIGNocm9tZWRyaXZlciBwcm90b2NvbDogJHt0aGlzLmNocm9tZWRyaXZlci5qd3Byb3h5LmRvd25zdHJlYW1Qcm90b2NvbH1gKTtcbiAgICBpZiAodGhpcy5jaHJvbWVkcml2ZXIuandwcm94eS5kb3duc3RyZWFtUHJvdG9jb2wgPT09IEJhc2VEcml2ZXIuRFJJVkVSX1BST1RPQ09MLk1KU09OV1ApIHtcbiAgICAgIGNvbnN0IHt4LCB5fSA9IGF3YWl0IHRoaXMuY2hyb21lZHJpdmVyLmp3cHJveHkuY29tbWFuZChgL2VsZW1lbnQvJHtlbGVtZW50SWR9L2xvY2F0aW9uYCwgJ0dFVCcpO1xuICAgICAgY29uc3Qge3dpZHRoLCBoZWlnaHR9ID0gYXdhaXQgdGhpcy5jaHJvbWVkcml2ZXIuandwcm94eS5jb21tYW5kKGAvZWxlbWVudC8ke2VsZW1lbnRJZH0vc2l6ZWAsICdHRVQnKTtcbiAgICAgIHJldHVybiB7eCwgeSwgd2lkdGgsIGhlaWdodH07XG4gICAgfVxuICAgIHJldHVybiBhd2FpdCB0aGlzLmNocm9tZWRyaXZlci5qd3Byb3h5LmNvbW1hbmQoYC9lbGVtZW50LyR7ZWxlbWVudElkfS9yZWN0YCwgJ0dFVCcpO1xuICB9XG4gIHJldHVybiBhd2FpdCB0aGlzLnVpYXV0b21hdG9yMi5qd3Byb3h5LmNvbW1hbmQoYC9lbGVtZW50LyR7ZWxlbWVudElkfS9yZWN0YCwgJ0dFVCcpO1xufTtcblxuT2JqZWN0LmFzc2lnbihleHRlbnNpb25zLCBjb21tYW5kcywgaGVscGVycyk7XG5leHBvcnQgeyBjb21tYW5kcywgaGVscGVycyB9O1xuZXhwb3J0IGRlZmF1bHQgZXh0ZW5zaW9ucztcbiJdLCJmaWxlIjoibGliL2NvbW1hbmRzL2VsZW1lbnQuanMiLCJzb3VyY2VSb290IjoiLi4vLi4vLi4ifQ==
