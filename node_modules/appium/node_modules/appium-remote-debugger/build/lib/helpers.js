"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.appInfoFromDict = appInfoFromDict;
exports.pageArrayFromDict = pageArrayFromDict;
exports.getDebuggerAppKey = getDebuggerAppKey;
exports.getPossibleDebuggerAppKeys = getPossibleDebuggerAppKeys;
exports.checkParams = checkParams;
exports.wrapScriptForFrame = wrapScriptForFrame;
exports.getScriptForAtom = getScriptForAtom;
exports.simpleStringify = simpleStringify;
exports.deferredPromise = deferredPromise;
exports.isTargetBased = isTargetBased;

require("source-map-support/register");

var _logger = _interopRequireDefault(require("./logger"));

var _atoms = _interopRequireDefault(require("./atoms"));

var _lodash = _interopRequireDefault(require("lodash"));

var _assert = _interopRequireDefault(require("assert"));

var _bluebird = _interopRequireDefault(require("bluebird"));

var _appiumSupport = require("appium-support");

const WEB_CONTENT_BUNDLE_ID = 'com.apple.WebKit.WebContent';
const MIN_PLATFORM_FOR_TARGET_BASED = '12.2';

function appInfoFromDict(dict) {
  const id = dict.WIRApplicationIdentifierKey;
  const isProxy = _lodash.default.isString(dict.WIRIsApplicationProxyKey) ? dict.WIRIsApplicationProxyKey.toLowerCase() === 'true' : dict.WIRIsApplicationProxyKey;
  const entry = {
    id,
    isProxy,
    name: dict.WIRApplicationNameKey,
    bundleId: dict.WIRApplicationBundleIdentifierKey,
    hostId: dict.WIRHostApplicationIdentifierKey,
    isActive: dict.WIRIsApplicationActiveKey,
    isAutomationEnabled: !!dict.WIRRemoteAutomationEnabledKey
  };
  return [id, entry];
}

function pageArrayFromDict(pageDict) {
  if (pageDict.id) {
    return [pageDict];
  }

  let newPageArray = [];

  for (const dict of _lodash.default.values(pageDict)) {
    if (_lodash.default.isUndefined(dict.WIRTypeKey) || dict.WIRTypeKey === 'WIRTypeWeb') {
      newPageArray.push({
        id: dict.WIRPageIdentifierKey,
        title: dict.WIRTitleKey,
        url: dict.WIRURLKey,
        isKey: !_lodash.default.isUndefined(dict.WIRConnectionIdentifierKey)
      });
    }
  }

  return newPageArray;
}

function getDebuggerAppKey(bundleId, platformVersion, appDict) {
  let appId;

  if (parseFloat(platformVersion) >= 8) {
    for (const [key, data] of _lodash.default.toPairs(appDict)) {
      if (data.bundleId === bundleId) {
        appId = key;
        break;
      }
    }

    if (appId) {
      _logger.default.debug(`Found app id key '${appId}' for bundle '${bundleId}'`);

      let proxiedAppIds = [];

      for (const [key, data] of _lodash.default.toPairs(appDict)) {
        if (data.isProxy && data.hostId === appId) {
          _logger.default.debug(`Found separate bundleId '${data.bundleId}' ` + `acting as proxy for '${bundleId}', with app id '${key}'`);

          proxiedAppIds.push(key);
        }
      }

      if (proxiedAppIds.length) {
        appId = _lodash.default.last(proxiedAppIds);

        _logger.default.debug(`Using proxied app id '${appId}'`);
      }
    }
  } else {
    if (_lodash.default.has(appDict, bundleId)) {
      appId = bundleId;
    }
  }

  return appId;
}

function appIdForBundle(bundleId, appDict) {
  let appId;

  for (const [key, data] of _lodash.default.toPairs(appDict)) {
    if (data.bundleId === bundleId) {
      appId = key;
      break;
    }
  }

  if (!appId && bundleId !== WEB_CONTENT_BUNDLE_ID) {
    return appIdForBundle(WEB_CONTENT_BUNDLE_ID, appDict);
  }

  return appId;
}

function getPossibleDebuggerAppKeys(bundleId, platformVersion, appDict) {
  let proxiedAppIds = [];

  if (parseFloat(platformVersion) >= 8) {
    const appId = appIdForBundle(bundleId, appDict);

    if (appId) {
      proxiedAppIds.push(appId);

      _logger.default.debug(`Found app id key '${appId}' for bundle '${bundleId}'`);

      for (const [key, data] of _lodash.default.toPairs(appDict)) {
        if (data.isProxy && data.hostId === appId) {
          _logger.default.debug(`Found separate bundleId '${data.bundleId}' ` + `acting as proxy for '${bundleId}', with app id '${key}'`);

          proxiedAppIds.push(key);
        }
      }
    }
  } else {
    if (_lodash.default.has(appDict, bundleId)) {
      proxiedAppIds = [bundleId];
    }
  }

  return proxiedAppIds;
}

function checkParams(params) {
  let errors = [];

  for (const [param, value] of _lodash.default.toPairs(params)) {
    try {
      _assert.default.ok(value);
    } catch (err) {
      errors.push(param);
    }
  }

  if (errors.length) {
    return errors;
  }
}

async function wrapScriptForFrame(script, frame) {
  _logger.default.debug(`Wrapping script for frame '${frame}'`);

  let elFromCache = await (0, _atoms.default)('get_element_from_cache');
  return `(function (window) { var document = window.document; ` + `return (${script}); })((${elFromCache.toString('utf8')})(${JSON.stringify(frame)}))`;
}

async function getScriptForAtom(atom, args, frames, asyncCallBack = null) {
  let atomSrc = await (0, _atoms.default)(atom);
  let script;

  if (frames.length > 0) {
    script = atomSrc;

    for (const frame of frames) {
      script = await wrapScriptForFrame(script, frame);
    }
  } else {
    _logger.default.debug(`Executing '${atom}' atom in default context`);

    script = `(${atomSrc})`;
  }

  args = args.map(JSON.stringify);

  if (asyncCallBack) {
    script += `(${args.join(',')}, ${asyncCallBack}, true )`;
  } else {
    script += `(${args.join(',')})`;
  }

  return script;
}

function simpleStringify(value, multiline = false) {
  if (!value) {
    return JSON.stringify(value);
  }

  let cleanValue = _lodash.default.clone(value);

  for (const property of ['ceil', 'clone', 'floor', 'round', 'scale', 'toString']) {
    delete cleanValue[property];
  }

  return multiline ? JSON.stringify(cleanValue, null, 2) : JSON.stringify(cleanValue);
}

function deferredPromise() {
  let resolve;
  let reject;
  const promise = new _bluebird.default((res, rej) => {
    resolve = res;
    reject = rej;
  });
  return {
    promise,
    resolve,
    reject
  };
}

function isTargetBased(isSafari, platformVersion) {
  const isHighVersion = _appiumSupport.util.compareVersions(platformVersion, '>=', MIN_PLATFORM_FOR_TARGET_BASED);

  _logger.default.debug(`Checking which communication style to use (${isSafari ? '' : 'non-'}Safari on platform version '${platformVersion}')`);

  _logger.default.debug(`Platform version equal or higher than '${MIN_PLATFORM_FOR_TARGET_BASED}': ${isHighVersion}`);

  return isSafari && isHighVersion;
}require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9oZWxwZXJzLmpzIl0sIm5hbWVzIjpbIldFQl9DT05URU5UX0JVTkRMRV9JRCIsIk1JTl9QTEFURk9STV9GT1JfVEFSR0VUX0JBU0VEIiwiYXBwSW5mb0Zyb21EaWN0IiwiZGljdCIsImlkIiwiV0lSQXBwbGljYXRpb25JZGVudGlmaWVyS2V5IiwiaXNQcm94eSIsIl8iLCJpc1N0cmluZyIsIldJUklzQXBwbGljYXRpb25Qcm94eUtleSIsInRvTG93ZXJDYXNlIiwiZW50cnkiLCJuYW1lIiwiV0lSQXBwbGljYXRpb25OYW1lS2V5IiwiYnVuZGxlSWQiLCJXSVJBcHBsaWNhdGlvbkJ1bmRsZUlkZW50aWZpZXJLZXkiLCJob3N0SWQiLCJXSVJIb3N0QXBwbGljYXRpb25JZGVudGlmaWVyS2V5IiwiaXNBY3RpdmUiLCJXSVJJc0FwcGxpY2F0aW9uQWN0aXZlS2V5IiwiaXNBdXRvbWF0aW9uRW5hYmxlZCIsIldJUlJlbW90ZUF1dG9tYXRpb25FbmFibGVkS2V5IiwicGFnZUFycmF5RnJvbURpY3QiLCJwYWdlRGljdCIsIm5ld1BhZ2VBcnJheSIsInZhbHVlcyIsImlzVW5kZWZpbmVkIiwiV0lSVHlwZUtleSIsInB1c2giLCJXSVJQYWdlSWRlbnRpZmllcktleSIsInRpdGxlIiwiV0lSVGl0bGVLZXkiLCJ1cmwiLCJXSVJVUkxLZXkiLCJpc0tleSIsIldJUkNvbm5lY3Rpb25JZGVudGlmaWVyS2V5IiwiZ2V0RGVidWdnZXJBcHBLZXkiLCJwbGF0Zm9ybVZlcnNpb24iLCJhcHBEaWN0IiwiYXBwSWQiLCJwYXJzZUZsb2F0Iiwia2V5IiwiZGF0YSIsInRvUGFpcnMiLCJsb2ciLCJkZWJ1ZyIsInByb3hpZWRBcHBJZHMiLCJsZW5ndGgiLCJsYXN0IiwiaGFzIiwiYXBwSWRGb3JCdW5kbGUiLCJnZXRQb3NzaWJsZURlYnVnZ2VyQXBwS2V5cyIsImNoZWNrUGFyYW1zIiwicGFyYW1zIiwiZXJyb3JzIiwicGFyYW0iLCJ2YWx1ZSIsImFzc2VydCIsIm9rIiwiZXJyIiwid3JhcFNjcmlwdEZvckZyYW1lIiwic2NyaXB0IiwiZnJhbWUiLCJlbEZyb21DYWNoZSIsInRvU3RyaW5nIiwiSlNPTiIsInN0cmluZ2lmeSIsImdldFNjcmlwdEZvckF0b20iLCJhdG9tIiwiYXJncyIsImZyYW1lcyIsImFzeW5jQ2FsbEJhY2siLCJhdG9tU3JjIiwibWFwIiwiam9pbiIsInNpbXBsZVN0cmluZ2lmeSIsIm11bHRpbGluZSIsImNsZWFuVmFsdWUiLCJjbG9uZSIsInByb3BlcnR5IiwiZGVmZXJyZWRQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsInByb21pc2UiLCJCIiwicmVzIiwicmVqIiwiaXNUYXJnZXRCYXNlZCIsImlzU2FmYXJpIiwiaXNIaWdoVmVyc2lvbiIsInV0aWwiLCJjb21wYXJlVmVyc2lvbnMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBR0EsTUFBTUEscUJBQXFCLEdBQUcsNkJBQTlCO0FBQ0EsTUFBTUMsNkJBQTZCLEdBQUcsTUFBdEM7O0FBTUEsU0FBU0MsZUFBVCxDQUEwQkMsSUFBMUIsRUFBZ0M7QUFDOUIsUUFBTUMsRUFBRSxHQUFHRCxJQUFJLENBQUNFLDJCQUFoQjtBQUNBLFFBQU1DLE9BQU8sR0FBR0MsZ0JBQUVDLFFBQUYsQ0FBV0wsSUFBSSxDQUFDTSx3QkFBaEIsSUFDWk4sSUFBSSxDQUFDTSx3QkFBTCxDQUE4QkMsV0FBOUIsT0FBZ0QsTUFEcEMsR0FFWlAsSUFBSSxDQUFDTSx3QkFGVDtBQUdBLFFBQU1FLEtBQUssR0FBRztBQUNaUCxJQUFBQSxFQURZO0FBRVpFLElBQUFBLE9BRlk7QUFHWk0sSUFBQUEsSUFBSSxFQUFFVCxJQUFJLENBQUNVLHFCQUhDO0FBSVpDLElBQUFBLFFBQVEsRUFBRVgsSUFBSSxDQUFDWSxpQ0FKSDtBQUtaQyxJQUFBQSxNQUFNLEVBQUViLElBQUksQ0FBQ2MsK0JBTEQ7QUFNWkMsSUFBQUEsUUFBUSxFQUFFZixJQUFJLENBQUNn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LFNBQU9ILFNBQVMsR0FBR1gsSUFBSSxDQUFDQyxTQUFMLENBQWVXLFVBQWYsRUFBMkIsSUFBM0IsRUFBaUMsQ0FBakMsQ0FBSCxHQUF5Q1osSUFBSSxDQUFDQyxTQUFMLENBQWVXLFVBQWYsQ0FBekQ7QUFDRDs7QUFFRCxTQUFTRyxlQUFULEdBQTRCO0FBRTFCLE1BQUlDLE9BQUo7QUFDQSxNQUFJQyxNQUFKO0FBQ0EsUUFBTUMsT0FBTyxHQUFHLElBQUlDLGlCQUFKLENBQU0sQ0FBQ0MsR0FBRCxFQUFNQyxHQUFOLEtBQWM7QUFDbENMLElBQUFBLE9BQU8sR0FBR0ksR0FBVjtBQUNBSCxJQUFBQSxNQUFNLEdBQUdJLEdBQVQ7QUFDRCxHQUhlLENBQWhCO0FBSUEsU0FBTztBQUNMSCxJQUFBQSxPQURLO0FBRUxGLElBQUFBLE9BRks7QUFHTEMsSUFBQUE7QUFISyxHQUFQO0FBS0Q7O0FBRUQsU0FBU0ssYUFBVCxDQUF3QkMsUUFBeEIsRUFBa0NuRCxlQUFsQyxFQUFtRDtBQUVqRCxRQUFNb0QsYUFBYSxHQUFHQyxvQkFBS0MsZUFBTCxDQUFxQnRELGVBQXJCLEVBQXNDLElBQXRDLEVBQTRDcEMsNkJBQTVDLENBQXRCOztBQUNBMkMsa0JBQUlDLEtBQUosQ0FBVyw4Q0FBNkMyQyxRQUFRLEdBQUcsRUFBSCxHQUFRLE1BQU8sK0JBQThCbkQsZUFBZ0IsSUFBN0g7O0FBQ0FPLGtCQUFJQyxLQUFKLENBQVcsMENBQXlDNUMsNkJBQThCLE1BQUt3RixhQUFjLEVBQXJHOztBQUNBLFNBQU9ELFFBQVEsSUFBSUMsYUFBbkI7QUFDRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBsb2cgZnJvbSAnLi9sb2dnZXInO1xuaW1wb3J0IGdldEF0b20gZnJvbSAnLi9hdG9tcyc7XG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IGFzc2VydCBmcm9tICdhc3NlcnQnO1xuaW1wb3J0IEIgZnJvbSAnYmx1ZWJpcmQnO1xuaW1wb3J0IHsgdXRpbCB9IGZyb20gJ2FwcGl1bS1zdXBwb3J0JztcblxuXG5jb25zdCBXRUJfQ09OVEVOVF9CVU5ETEVfSUQgPSAnY29tLmFwcGxlLldlYktpdC5XZWJDb250ZW50JztcbmNvbnN0IE1JTl9QTEFURk9STV9GT1JfVEFSR0VUX0JBU0VEID0gJzEyLjInO1xuXG4vKlxuICogVGFrZXMgYSBkaWN0aW9uYXJ5IGZyb20gdGhlIHJlbW90ZSBkZWJ1Z2dlciBhbmQgbWFrZXMgYSBtb3JlIG1hbmFnZWFibGVcbiAqIGRpY3Rpb25hcnkgd2hvc2Uga2V5cyBhcmUgdW5kZXJzdGFuZGFibGVcbiAqL1xuZnVuY3Rpb24gYXBwSW5mb0Zyb21EaWN0IChkaWN0KSB7XG4gIGNvbnN0IGlkID0gZGljdC5XSVJBcHBsaWNhdGlvbklkZW50aWZpZXJLZXk7XG4gIGNvbnN0IGlzUHJveHkgPSBfLmlzU3RyaW5nKGRpY3QuV0lSSXNBcHBsaWNhdGlvblByb3h5S2V5KVxuICAgID8gZGljdC5XSVJJc0FwcGxpY2F0aW9uUHJveHlLZXkudG9Mb3dlckNhc2UoKSA9PT0gJ3RydWUnXG4gICAgOiBkaWN0LldJUklzQXBwbGljYXRpb25Qcm94eUtleTtcbiAgY29uc3QgZW50cnkgPSB7XG4gICAgaWQsXG4gICAgaXNQcm94eSxcbiAgICBuYW1lOiBkaWN0LldJUkFwcGxpY2F0aW9uTmFtZUtleSxcbiAgICBidW5kbGVJZDogZGljdC5XSVJBcHBsaWNhdGlvbkJ1bmRsZUlkZW50aWZpZXJLZXksXG4gICAgaG9zdElkOiBkaWN0LldJUkhvc3RBcHBsaWNhdGlvbklkZW50aWZpZXJLZXksXG4gICAgaXNBY3RpdmU6IGRpY3QuV0lSSXNBcHBsaWNhdGlvbkFjdGl2ZUtleSxcbiAgICBpc0F1dG9tYXRpb25FbmFibGVkOiAhIWRpY3QuV0lSUmVtb3RlQXV0b21hdGlvbkVuYWJsZWRLZXksXG4gIH07XG5cbiAgcmV0dXJuIFtpZCwgZW50cnldO1xufVxuXG4vKlxuICogVGFrZSBhIGRpY3Rpb25hcnkgZnJvbSB0aGUgcmVtb3RlIGRlYnVnZ2VyIGFuZCBtYWtlcyBhIG1vcmUgbWFuYWdlYWJsZVxuICogZGljdGlvbmFyeSBvZiBwYWdlcyBhdmFpbGFibGUuXG4gKi9cbmZ1bmN0aW9uIHBhZ2VBcnJheUZyb21EaWN0IChwYWdlRGljdCkge1xuICBpZiAocGFnZURpY3QuaWQpIHtcbiAgICAvLyB0aGUgcGFnZSBpcyBhbHJlYWR5IHRyYW5zbGF0ZWQsIHNvIHdyYXAgaW4gYW4gYXJyYXkgYW5kIHBhc3MgYmFja1xuICAgIHJldHVybiBbcGFnZURpY3RdO1xuICB9XG4gIGxldCBuZXdQYWdlQXJyYXkgPSBbXTtcbiAgZm9yIChjb25zdCBkaWN0IG9mIF8udmFsdWVzKHBhZ2VEaWN0KSkge1xuICAgIC8vIGNvdW50IG9ubHkgV0lSVHlwZVdlYiBwYWdlcyBhbmQgaWdub3JlIGFsbCBvdGhlcnMgKFdJUlR5cGVKYXZhU2NyaXB0IGV0YylcbiAgICBpZiAoXy5pc1VuZGVmaW5lZChkaWN0LldJUlR5cGVLZXkpIHx8IGRpY3QuV0lSVHlwZUtleSA9PT0gJ1dJUlR5cGVXZWInKSB7XG4gICAgICBuZXdQYWdlQXJyYXkucHVzaCh7XG4gICAgICAgIGlkOiBkaWN0LldJUlBhZ2VJZGVudGlmaWVyS2V5LFxuICAgICAgICB0aXRsZTogZGljdC5XSVJUaXRsZUtleSxcbiAgICAgICAgdXJsOiBkaWN0LldJUlVSTEtleSxcbiAgICAgICAgaXNLZXk6ICFfLmlzVW5kZWZpbmVkKGRpY3QuV0lSQ29ubmVjdGlvbklkZW50aWZpZXJLZXkpLFxuICAgICAgfSk7XG4gICAgfVxuICB9XG4gIHJldHVybiBuZXdQYWdlQXJyYXk7XG59XG5cbi8qXG4gKiBHaXZlbiBhIGJ1bmRsZSBpZCwgZmluZHMgdGhlIGNvcnJlY3QgcmVtb3RlIGRlYnVnZ2VyIGFwcCB0aGF0IGlzXG4gKiBjb25uZWN0ZWQuXG4gKi9cbmZ1bmN0aW9uIGdldERlYnVnZ2VyQXBwS2V5IChidW5kbGVJZCwgcGxhdGZvcm1WZXJzaW9uLCBhcHBEaWN0KSB7XG4gIGxldCBhcHBJZDtcbiAgaWYgKHBhcnNlRmxvYXQocGxhdGZvcm1WZXJzaW9uKSA+PSA4KSB7XG4gICAgZm9yIChjb25zdCBba2V5LCBkYXRhXSBvZiBfLnRvUGFpcnMoYXBwRGljdCkpIHtcbiAgICAgIGlmIChkYXRhLmJ1bmRsZUlkID09PSBidW5kbGVJZCkge1xuICAgICAgICBhcHBJZCA9IGtleTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuICAgIC8vIG5vdyB3ZSBuZWVkIHRvIGRldGVybWluZSBpZiB3ZSBzaG91bGQgcGljayBhIHByb3h5IGZvciB0aGlzIGluc3RlYWRcbiAgICBpZiAoYXBwSWQpIHtcbiAgICAgIGxvZy5kZWJ1ZyhgRm91bmQgYXBwIGlkIGtleSAnJHthcHBJZH0nIGZvciBidW5kbGUgJyR7YnVuZGxlSWR9J2ApO1xuICAgICAgbGV0IHByb3hpZWRBcHBJZHMgPSBbXTtcbiAgICAgIGZvciAoY29uc3QgW2tleSwgZGF0YV0gb2YgXy50b1BhaXJzKGFwcERpY3QpKSB7XG4gICAgICAgIGlmIChkYXRhLmlzUHJveHkgJiYgZGF0YS5ob3N0SWQgPT09IGFwcElkKSB7XG4gICAgICAgICAgbG9nLmRlYnVnKGBGb3VuZCBzZXBhcmF0ZSBidW5kbGVJZCAnJHtkYXRhLmJ1bmRsZUlkfScgYCArXG4gICAgICAgICAgICAgICAgICAgIGBhY3RpbmcgYXMgcHJveHkgZm9yICcke2J1bmRsZUlkfScsIHdpdGggYXBwIGlkICcke2tleX0nYCk7XG4gICAgICAgICAgcHJveGllZEFwcElkcy5wdXNoKGtleSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChwcm94aWVkQXBwSWRzLmxlbmd0aCkge1xuICAgICAgICAvLyB1c2UgdGhlIGxhc3QgYXBwIGJlaW5nIHByb3hpZWRcbiAgICAgICAgYXBwSWQgPSBfLmxhc3QocHJveGllZEFwcElkcyk7XG4gICAgICAgIGxvZy5kZWJ1ZyhgVXNpbmcgcHJveGllZCBhcHAgaWQgJyR7YXBwSWR9J2ApO1xuICAgICAgfVxuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBpZiAoXy5oYXMoYXBwRGljdCwgYnVuZGxlSWQpKSB7XG4gICAgICBhcHBJZCA9IGJ1bmRsZUlkO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBhcHBJZDtcbn1cblxuZnVuY3Rpb24gYXBwSWRGb3JCdW5kbGUgKGJ1bmRsZUlkLCBhcHBEaWN0KSB7XG4gIGxldCBhcHBJZDtcbiAgZm9yIChjb25zdCBba2V5LCBkYXRhXSBvZiBfLnRvUGFpcnMoYXBwRGljdCkpIHtcbiAgICBpZiAoZGF0YS5idW5kbGVJZCA9PT0gYnVuZGxlSWQpIHtcbiAgICAgIGFwcElkID0ga2V5O1xuICAgICAgYnJlYWs7XG4gICAgfVxuICB9XG5cbiAgLy8gaWYgbm90aGluZyBpcyBmb3VuZCwgdHJ5IHRvIGdldCB0aGUgZ2VuZXJpYyBhcHBcbiAgaWYgKCFhcHBJZCAmJiBidW5kbGVJZCAhPT0gV0VCX0NPTlRFTlRfQlVORExFX0lEKSB7XG4gICAgcmV0dXJuIGFwcElkRm9yQnVuZGxlKFdFQl9DT05URU5UX0JVTkRMRV9JRCwgYXBwRGljdCk7XG4gIH1cblxuICByZXR1cm4gYXBwSWQ7XG59XG5cbmZ1bmN0aW9uIGdldFBvc3NpYmxlRGVidWdnZXJBcHBLZXlzIChidW5kbGVJZCwgcGxhdGZvcm1WZXJzaW9uLCBhcHBEaWN0KSB7XG4gIGxldCBwcm94aWVkQXBwSWRzID0gW107XG4gIGlmIChwYXJzZUZsb2F0KHBsYXRmb3JtVmVyc2lvbikgPj0gOCkge1xuICAgIGNvbnN0IGFwcElkID0gYXBwSWRGb3JCdW5kbGUoYnVuZGxlSWQsIGFwcERpY3QpO1xuXG4gICAgLy8gbm93IHdlIG5lZWQgdG8gZGV0ZXJtaW5lIGlmIHdlIHNob3VsZCBwaWNrIGEgcHJveHkgZm9yIHRoaXMgaW5zdGVhZFxuICAgIGlmIChhcHBJZCkge1xuICAgICAgcHJveGllZEFwcElkcy5wdXNoKGFwcElkKTtcbiAgICAgIGxvZy5kZWJ1ZyhgRm91bmQgYXBwIGlkIGtleSAnJHthcHBJZH0nIGZvciBidW5kbGUgJyR7YnVuZGxlSWR9J2ApO1xuICAgICAgZm9yIChjb25zdCBba2V5LCBkYXRhXSBvZiBfLnRvUGFpcnMoYXBwRGljdCkpIHtcbiAgICAgICAgaWYgKGRhdGEuaXNQcm94eSAmJiBkYXRhLmhvc3RJZCA9PT0gYXBwSWQpIHtcbiAgICAgICAgICBsb2cuZGVidWcoYEZvdW5kIHNlcGFyYXRlIGJ1bmRsZUlkICcke2RhdGEuYnVuZGxlSWR9JyBgICtcbiAgICAgICAgICAgICAgICAgICAgYGFjdGluZyBhcyBwcm94eSBmb3IgJyR7YnVuZGxlSWR9Jywgd2l0aCBhcHAgaWQgJyR7a2V5fSdgKTtcbiAgICAgICAgICBwcm94aWVkQXBwSWRzLnB1c2goa2V5KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBpZiAoXy5oYXMoYXBwRGljdCwgYnVuZGxlSWQpKSB7XG4gICAgICBwcm94aWVkQXBwSWRzID0gW2J1bmRsZUlkXTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gcHJveGllZEFwcElkcztcbn1cblxuZnVuY3Rpb24gY2hlY2tQYXJhbXMgKHBhcmFtcykge1xuICBsZXQgZXJyb3JzID0gW107XG4gIGZvciAoY29uc3QgW3BhcmFtLCB2YWx1ZV0gb2YgXy50b1BhaXJzKHBhcmFtcykpIHtcbiAgICB0cnkge1xuICAgICAgYXNzZXJ0Lm9rKHZhbHVlKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGVycm9ycy5wdXNoKHBhcmFtKTtcbiAgICB9XG4gIH1cbiAgaWYgKGVycm9ycy5sZW5ndGgpIHtcbiAgICByZXR1cm4gZXJyb3JzO1xuICB9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHdyYXBTY3JpcHRGb3JGcmFtZSAoc2NyaXB0LCBmcmFtZSkge1xuICBsb2cuZGVidWcoYFdyYXBwaW5nIHNjcmlwdCBmb3IgZnJhbWUgJyR7ZnJhbWV9J2ApO1xuICBsZXQgZWxGcm9tQ2FjaGUgPSBhd2FpdCBnZXRBdG9tKCdnZXRfZWxlbWVudF9mcm9tX2NhY2hlJyk7XG4gIHJldHVybiBgKGZ1bmN0aW9uICh3aW5kb3cpIHsgdmFyIGRvY3VtZW50ID0gd2luZG93LmRvY3VtZW50OyBgICtcbiAgICAgICAgIGByZXR1cm4gKCR7c2NyaXB0fSk7IH0pKCgke2VsRnJvbUNhY2hlLnRvU3RyaW5nKCd1dGY4Jyl9KSgke0pTT04uc3RyaW5naWZ5KGZyYW1lKX0pKWA7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldFNjcmlwdEZvckF0b20gKGF0b20sIGFyZ3MsIGZyYW1lcywgYXN5bmNDYWxsQmFjayA9IG51bGwpIHtcbiAgbGV0IGF0b21TcmMgPSBhd2FpdCBnZXRBdG9tKGF0b20pO1xuICBsZXQgc2NyaXB0O1xuICBpZiAoZnJhbWVzLmxlbmd0aCA+IDApIHtcbiAgICBzY3JpcHQgPSBhdG9tU3JjO1xuICAgIGZvciAoY29uc3QgZnJhbWUgb2YgZnJhbWVzKSB7XG4gICAgICBzY3JpcHQgPSBhd2FpdCB3cmFwU2NyaXB0Rm9yRnJhbWUoc2NyaXB0LCBmcmFtZSk7XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIGxvZy5kZWJ1ZyhgRXhlY3V0aW5nICcke2F0b219JyBhdG9tIGluIGRlZmF1bHQgY29udGV4dGApO1xuICAgIHNjcmlwdCA9IGAoJHthdG9tU3JjfSlgO1xuICB9XG5cbiAgLy8gYWRkIHRoZSBhcmd1bWVudHMsIGFzIHN0cmluZ3NcbiAgYXJncyA9IGFyZ3MubWFwKEpTT04uc3RyaW5naWZ5KTtcbiAgaWYgKGFzeW5jQ2FsbEJhY2spIHtcbiAgICBzY3JpcHQgKz0gYCgke2FyZ3Muam9pbignLCcpfSwgJHthc3luY0NhbGxCYWNrfSwgdHJ1ZSApYDtcbiAgfSBlbHNlIHtcbiAgICBzY3JpcHQgKz0gYCgke2FyZ3Muam9pbignLCcpfSlgO1xuICB9XG5cbiAgcmV0dXJuIHNjcmlwdDtcbn1cblxuZnVuY3Rpb24gc2ltcGxlU3RyaW5naWZ5ICh2YWx1ZSwgbXVsdGlsaW5lID0gZmFsc2UpIHtcbiAgaWYgKCF2YWx1ZSkge1xuICAgIHJldHVybiBKU09OLnN0cmluZ2lmeSh2YWx1ZSk7XG4gIH1cblxuICAvLyB3ZSBnZXQgYmFjayBvYmplY3RzIHNvbWV0aW1lcyB3aXRoIHN0cmluZyB2ZXJzaW9ucyBvZiBmdW5jdGlvbnNcbiAgLy8gd2hpY2ggbXVkZHkgdGhlIGxvZ3NcbiAgbGV0IGNsZWFuVmFsdWUgPSBfLmNsb25lKHZhbHVlKTtcbiAgZm9yIChjb25zdCBwcm9wZXJ0eSBvZiBbJ2NlaWwnLCAnY2xvbmUnLCAnZmxvb3InLCAncm91bmQnLCAnc2NhbGUnLCAndG9TdHJpbmcnXSkge1xuICAgIGRlbGV0ZSBjbGVhblZhbHVlW3Byb3BlcnR5XTtcbiAgfVxuICByZXR1cm4gbXVsdGlsaW5lID8gSlNPTi5zdHJpbmdpZnkoY2xlYW5WYWx1ZSwgbnVsbCwgMikgOiBKU09OLnN0cmluZ2lmeShjbGVhblZhbHVlKTtcbn1cblxuZnVuY3Rpb24gZGVmZXJyZWRQcm9taXNlICgpIHtcbiAgLy8gaHR0cDovL2JsdWViaXJkanMuY29tL2RvY3MvYXBpL2RlZmVycmVkLW1pZ3JhdGlvbi5odG1sXG4gIGxldCByZXNvbHZlO1xuICBsZXQgcmVqZWN0O1xuICBjb25zdCBwcm9taXNlID0gbmV3IEIoKHJlcywgcmVqKSA9PiB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgcHJvbWlzZS9wYXJhbS1uYW1lc1xuICAgIHJlc29sdmUgPSByZXM7XG4gICAgcmVqZWN0ID0gcmVqO1xuICB9KTtcbiAgcmV0dXJuIHtcbiAgICBwcm9taXNlLFxuICAgIHJlc29sdmUsXG4gICAgcmVqZWN0XG4gIH07XG59XG5cbmZ1bmN0aW9uIGlzVGFyZ2V0QmFzZWQgKGlzU2FmYXJpLCBwbGF0Zm9ybVZlcnNpb24pIHtcbiAgLy8gb24gaU9TIDEyLjIgdGhlIG1lc3NhZ2VzIGdldCBzZW50IHRocm91Z2ggdGhlIFRhcmdldCBkb21haW5cbiAgY29uc3QgaXNIaWdoVmVyc2lvbiA9IHV0aWwuY29tcGFyZVZlcnNpb25zKHBsYXRmb3JtVmVyc2lvbiwgJz49JywgTUlOX1BMQVRGT1JNX0ZPUl9UQVJHRVRfQkFTRUQpO1xuICBsb2cuZGVidWcoYENoZWNraW5nIHdoaWNoIGNvbW11bmljYXRpb24gc3R5bGUgdG8gdXNlICgke2lzU2FmYXJpID8gJycgOiAnbm9uLSd9U2FmYXJpIG9uIHBsYXRmb3JtIHZlcnNpb24gJyR7cGxhdGZvcm1WZXJzaW9ufScpYCk7XG4gIGxvZy5kZWJ1ZyhgUGxhdGZvcm0gdmVyc2lvbiBlcXVhbCBvciBoaWdoZXIgdGhhbiAnJHtNSU5fUExBVEZPUk1fRk9SX1RBUkdFVF9CQVNFRH0nOiAke2lzSGlnaFZlcnNpb259YCk7XG4gIHJldHVybiBpc1NhZmFyaSAmJiBpc0hpZ2hWZXJzaW9uO1xufVxuXG5leHBvcnQge1xuICBhcHBJbmZvRnJvbURpY3QsIHBhZ2VBcnJheUZyb21EaWN0LCBnZXREZWJ1Z2dlckFwcEtleSxcbiAgZ2V0UG9zc2libGVEZWJ1Z2dlckFwcEtleXMsIGNoZWNrUGFyYW1zLCB3cmFwU2NyaXB0Rm9yRnJhbWUsIGdldFNjcmlwdEZvckF0b20sXG4gIHNpbXBsZVN0cmluZ2lmeSwgZGVmZXJyZWRQcm9taXNlLCBpc1RhcmdldEJhc2VkLFxufTtcbiJdLCJmaWxlIjoibGliL2hlbHBlcnMuanMiLCJzb3VyY2VSb290IjoiLi4vLi4ifQ==
