"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.configureBinaryLog = configureBinaryLog;
exports.resolveExecutablePath = resolveExecutablePath;
exports.getNpmPackageInfo = getNpmPackageInfo;
exports.authorizeIos = exports.inquirer = exports.nokOptional = exports.okOptional = exports.nok = exports.ok = exports.pkgRoot = void 0;

require("source-map-support/register");

var _bluebird = _interopRequireDefault(require("bluebird"));

var _path = _interopRequireDefault(require("path"));

var _inquirer2 = _interopRequireDefault(require("inquirer"));

var _logger = _interopRequireDefault(require("../lib/logger"));

var _authorizeIos = _interopRequireDefault(require("authorize-ios"));

var _appiumSupport = require("appium-support");

var _teen_process = require("teen_process");

const authorizeIos = _authorizeIos.default;
exports.authorizeIos = authorizeIos;
const pkgRoot = process.env.NO_PRECOMPILE ? _path.default.resolve(__dirname, '..') : _path.default.resolve(__dirname, '..', '..');
exports.pkgRoot = pkgRoot;

const ok = message => {
  return {
    ok: true,
    optional: false,
    message
  };
};

exports.ok = ok;

const nok = message => {
  return {
    ok: false,
    optional: false,
    message
  };
};

exports.nok = nok;

const okOptional = message => {
  return {
    ok: true,
    optional: true,
    message
  };
};

exports.okOptional = okOptional;

const nokOptional = message => {
  return {
    ok: false,
    optional: true,
    message
  };
};

exports.nokOptional = nokOptional;
const inquirer = {
  prompt: _bluebird.default.promisify(function (question, cb) {
    _inquirer2.default.prompt(question, function (resp) {
      cb(null, resp);
    });
  })
};
exports.inquirer = inquirer;

function configureBinaryLog(opts) {
  let actualLog = _logger.default.unwrap().log;

  _logger.default.unwrap().log = function (level, prefix, msg) {
    let l = this.levels[level];
    if (l < this.levels[this.level]) return;
    actualLog(level, prefix, msg);
  };

  _logger.default.level = opts.debug ? 'debug' : 'info';
}

async function resolveExecutablePath(cmd) {
  let executablePath;

  try {
    executablePath = await _appiumSupport.fs.which(cmd);

    if (executablePath && (await _appiumSupport.fs.exists(executablePath))) {
      return executablePath;
    }
  } catch (err) {
    if (/not found/gi.test(err.message)) {
      _logger.default.debug(err);
    } else {
      _logger.default.warn(err);
    }
  }

  _logger.default.debug(`No executable path of '${cmd}'.`);

  if (executablePath) {
    _logger.default.debug(`Does '${executablePath}' exist?`);
  }

  return null;
}

async function getNpmPackageInfo(packageName) {
  const npmPath = await resolveExecutablePath(`npm${_appiumSupport.system.isWindows() ? `.cmd` : ''}`);

  if (!npmPath) {
    return nokOptional(`'npm' binary not found in PATH: ${process.env.PATH}`);
  }

  let pJson = {};

  try {
    const {
      stdout
    } = await (0, _teen_process.exec)(npmPath, ['list', '-g', '-l', '-j', packageName]);
    pJson = JSON.parse(stdout);
  } catch (err) {
    _logger.default.debug(err);

    return null;
  }

  if (pJson.dependencies && pJson.dependencies[packageName]) {
    return {
      version: pJson.dependencies[packageName].version,
      path: pJson.path
    };
  }

  return null;
}require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi91dGlscy5qcyJdLCJuYW1lcyI6WyJhdXRob3JpemVJb3MiLCJhdXRob3JpemUiLCJwa2dSb290IiwicHJvY2VzcyIsImVudiIsIk5PX1BSRUNPTVBJTEUiLCJwYXRoIiwicmVzb2x2ZSIsIl9fZGlybmFtZSIsIm9rIiwibWVzc2FnZSIsIm9wdGlvbmFsIiwibm9rIiwib2tPcHRpb25hbCIsIm5va09wdGlvbmFsIiwiaW5xdWlyZXIiLCJwcm9tcHQiLCJCIiwicHJvbWlzaWZ5IiwicXVlc3Rpb24iLCJjYiIsIl9pbnF1aXJlciIsInJlc3AiLCJjb25maWd1cmVCaW5hcnlMb2ciLCJvcHRzIiwiYWN0dWFsTG9nIiwibG9nIiwidW53cmFwIiwibGV2ZWwiLCJwcmVmaXgiLCJtc2ciLCJsIiwibGV2ZWxzIiwiZGVidWciLCJyZXNvbHZlRXhlY3V0YWJsZVBhdGgiLCJjbWQiLCJleGVjdXRhYmxlUGF0aCIsImZzIiwid2hpY2giLCJleGlzdHMiLCJlcnIiLCJ0ZXN0Iiwid2FybiIsImdldE5wbVBhY2thZ2VJbmZvIiwicGFja2FnZU5hbWUiLCJucG1QYXRoIiwic3lzdGVtIiwiaXNXaW5kb3dzIiwiUEFUSCIsInBKc29uIiwic3Rkb3V0IiwiSlNPTiIsInBhcnNlIiwiZGVwZW5kZW5jaWVzIiwidmVyc2lvbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFHQSxNQUFNQSxZQUFZLEdBQUdDLHFCQUFyQjs7QUFFQSxNQUFNQyxPQUFPLEdBQUdDLE9BQU8sQ0FBQ0MsR0FBUixDQUFZQyxhQUFaLEdBQ2RDLGNBQUtDLE9BQUwsQ0FBYUMsU0FBYixFQUF3QixJQUF4QixDQURjLEdBQ2tCRixjQUFLQyxPQUFMLENBQWFDLFNBQWIsRUFBd0IsSUFBeEIsRUFBOEIsSUFBOUIsQ0FEbEM7OztBQUdBLE1BQU1DLEVBQUUsR0FBSUMsT0FBRCxJQUFhO0FBQUUsU0FBTztBQUFDRCxJQUFB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RUFBYztBQUNaLFdBQU8vQixXQUFXLENBQUUsbUNBQWtDWCxPQUFPLENBQUNDLEdBQVIsQ0FBWTRDLElBQUssRUFBckQsQ0FBbEI7QUFDRDs7QUFFRCxNQUFJQyxLQUFLLEdBQUcsRUFBWjs7QUFDQSxNQUFJO0FBQ0YsVUFBTTtBQUFDQyxNQUFBQTtBQUFELFFBQVcsTUFBTSx3QkFBS0wsT0FBTCxFQUFjLENBQUMsTUFBRCxFQUFTLElBQVQsRUFBZSxJQUFmLEVBQXFCLElBQXJCLEVBQTJCRCxXQUEzQixDQUFkLENBQXZCO0FBQ0FLLElBQUFBLEtBQUssR0FBR0UsSUFBSSxDQUFDQyxLQUFMLENBQVdGLE1BQVgsQ0FBUjtBQUNELEdBSEQsQ0FHRSxPQUFPVixHQUFQLEVBQVk7QUFDWmQsb0JBQUlPLEtBQUosQ0FBVU8sR0FBVjs7QUFDQSxXQUFPLElBQVA7QUFDRDs7QUFFRCxNQUFJUyxLQUFLLENBQUNJLFlBQU4sSUFBc0JKLEtBQUssQ0FBQ0ksWUFBTixDQUFtQlQsV0FBbkIsQ0FBMUIsRUFBMkQ7QUFDekQsV0FBTztBQUFDVSxNQUFBQSxPQUFPLEVBQUVMLEtBQUssQ0FBQ0ksWUFBTixDQUFtQlQsV0FBbkIsRUFBZ0NVLE9BQTFDO0FBQW1EaEQsTUFBQUEsSUFBSSxFQUFFMkMsS0FBSyxDQUFDM0M7QUFBL0QsS0FBUDtBQUNEOztBQUVELFNBQU8sSUFBUDtBQUNEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEIgZnJvbSAnYmx1ZWJpcmQnO1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgX2lucXVpcmVyIGZyb20gJ2lucXVpcmVyJztcbmltcG9ydCBsb2cgZnJvbSAnLi4vbGliL2xvZ2dlcic7XG5pbXBvcnQgYXV0aG9yaXplIGZyb20gJ2F1dGhvcml6ZS1pb3MnO1xuaW1wb3J0IHsgZnMsIHN5c3RlbSB9IGZyb20gJ2FwcGl1bS1zdXBwb3J0JztcbmltcG9ydCB7IGV4ZWMgfSBmcm9tICd0ZWVuX3Byb2Nlc3MnO1xuXG4vLyByZW5hbWUgdG8gbWFrZSBtb3JlIHNlbnNlXG5jb25zdCBhdXRob3JpemVJb3MgPSBhdXRob3JpemU7XG5cbmNvbnN0IHBrZ1Jvb3QgPSBwcm9jZXNzLmVudi5OT19QUkVDT01QSUxFID9cbiAgcGF0aC5yZXNvbHZlKF9fZGlybmFtZSwgJy4uJykgOiBwYXRoLnJlc29sdmUoX19kaXJuYW1lLCAnLi4nLCAnLi4nKTtcblxuY29uc3Qgb2sgPSAobWVzc2FnZSkgPT4geyByZXR1cm4ge29rOiB0cnVlLCBvcHRpb25hbDogZmFsc2UsIG1lc3NhZ2V9OyB9O1xuY29uc3Qgbm9rID0gKG1lc3NhZ2UpID0+IHsgcmV0dXJuIHtvazogZmFsc2UsIG9wdGlvbmFsOiBmYWxzZSwgbWVzc2FnZX07IH07XG5jb25zdCBva09wdGlvbmFsID0gKG1lc3NhZ2UpID0+IHsgcmV0dXJuIHtvazogdHJ1ZSwgb3B0aW9uYWw6IHRydWUsIG1lc3NhZ2V9OyB9O1xuY29uc3Qgbm9rT3B0aW9uYWwgPSAobWVzc2FnZSkgPT4geyByZXR1cm4ge29rOiBmYWxzZSwgb3B0aW9uYWw6IHRydWUsIG1lc3NhZ2V9OyB9O1xuXG5jb25zdCBpbnF1aXJlciA9IHtcbiAgcHJvbXB0OiBCLnByb21pc2lmeShmdW5jdGlvbiAocXVlc3Rpb24sIGNiKSB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgcHJvbWlzZS9wcmVmZXItYXdhaXQtdG8tY2FsbGJhY2tzXG4gICAgX2lucXVpcmVyLnByb21wdChxdWVzdGlvbiwgZnVuY3Rpb24gKHJlc3ApIHsgY2IobnVsbCwgcmVzcCk7IH0pOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHByb21pc2UvcHJlZmVyLWF3YWl0LXRvLWNhbGxiYWNrc1xuICB9KVxufTtcblxuZnVuY3Rpb24gY29uZmlndXJlQmluYXJ5TG9nIChvcHRzKSB7XG4gIGxldCBhY3R1YWxMb2cgPSBsb2cudW53cmFwKCkubG9nO1xuICBsb2cudW53cmFwKCkubG9nID0gZnVuY3Rpb24gKGxldmVsLCBwcmVmaXgsIG1zZykge1xuICAgIGxldCBsID0gdGhpcy5sZXZlbHNbbGV2ZWxdO1xuICAgIGlmIChsIDwgdGhpcy5sZXZlbHNbdGhpcy5sZXZlbF0pIHJldHVybjsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBjdXJseVxuICAgIGFjdHVhbExvZyhsZXZlbCwgcHJlZml4LCBtc2cpO1xuICB9O1xuICBsb2cubGV2ZWwgPSBvcHRzLmRlYnVnID8gJ2RlYnVnJyA6ICdpbmZvJztcbn1cblxuLyoqXG4gKiBSZXR1cm4gYW4gZXhlY3V0YWJsZSBwYXRoIG9mIGNtZFxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBjbWQgU3RhbmRhcmQgb3V0cHV0IGJ5IGNvbW1hbmRcbiAqIEByZXR1cm4gez9zdHJpbmd9IFRoZSBmdWxsIHBhdGggb2YgY21kLiBgbnVsbGAgaWYgdGhlIGNtZCBpcyBub3QgZm91bmQuXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHJlc29sdmVFeGVjdXRhYmxlUGF0aCAoY21kKSB7XG4gIGxldCBleGVjdXRhYmxlUGF0aDtcbiAgdHJ5IHtcbiAgICBleGVjdXRhYmxlUGF0aCA9IGF3YWl0IGZzLndoaWNoKGNtZCk7XG4gICAgaWYgKGV4ZWN1dGFibGVQYXRoICYmIGF3YWl0IGZzLmV4aXN0cyhleGVjdXRhYmxlUGF0aCkpIHtcbiAgICAgIHJldHVybiBleGVjdXRhYmxlUGF0aDtcbiAgICB9XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGlmICgoL25vdCBmb3VuZC9naSkudGVzdChlcnIubWVzc2FnZSkpIHtcbiAgICAgIGxvZy5kZWJ1ZyhlcnIpO1xuICAgIH0gZWxzZSB7XG4gICAgICBsb2cud2FybihlcnIpO1xuICAgIH1cbiAgfVxuICBsb2cuZGVidWcoYE5vIGV4ZWN1dGFibGUgcGF0aCBvZiAnJHtjbWR9Jy5gKTtcbiAgaWYgKGV4ZWN1dGFibGVQYXRoKSB7XG4gICAgbG9nLmRlYnVnKGBEb2VzICcke2V4ZWN1dGFibGVQYXRofScgZXhpc3Q/YCk7XG4gIH1cbiAgcmV0dXJuIG51bGw7XG59XG5cbi8qKlxuICogQHR5cGVkZWYge09iamVjdH0gTnBtUGFja2FnZUluZm9cbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSB2ZXJzaW9uIC0gdmVyc2lvblxuICogQHByb3BlcnR5IHtzdHJpbmd9IHBhdGggLSBBIHBhdGggdG8gbnBtIHJvb3RcbiAqL1xuLyoqXG4gKiBSZXR1cm5zIHRoZSBwYXRoIGFuZCB2ZXJzaW9uIG9mIGdpdmVuIHBhY2thZ2UgbmFtZVxuICogQHBhcmFtIHtzdHJpbmd9IHBhY2thZ2VOYW1lIEEgcGFja2FnZSBuYW1lIHRvIGdldCBwYXRoIGFuZCB2ZXJzaW9uIGRhdGFcbiAqIEByZXR1cm4gez9OcG1QYWNrYWdlSW5mb31cbiAqL1xuYXN5bmMgZnVuY3Rpb24gZ2V0TnBtUGFja2FnZUluZm8gKHBhY2thZ2VOYW1lKSB7XG4gIGNvbnN0IG5wbVBhdGggPSBhd2FpdCByZXNvbHZlRXhlY3V0YWJsZVBhdGgoYG5wbSR7c3lzdGVtLmlzV2luZG93cygpID8gYC5jbWRgIDogJyd9YCk7XG4gIGlmICghbnBtUGF0aCkge1xuICAgIHJldHVybiBub2tPcHRpb25hbChgJ25wbScgYmluYXJ5IG5vdCBmb3VuZCBpbiBQQVRIOiAke3Byb2Nlc3MuZW52LlBBVEh9YCk7XG4gIH1cblxuICBsZXQgcEpzb24gPSB7fTtcbiAgdHJ5IHtcbiAgICBjb25zdCB7c3Rkb3V0fSA9IGF3YWl0IGV4ZWMobnBtUGF0aCwgWydsaXN0JywgJy1nJywgJy1sJywgJy1qJywgcGFja2FnZU5hbWVdKTtcbiAgICBwSnNvbiA9IEpTT04ucGFyc2Uoc3Rkb3V0KTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgbG9nLmRlYnVnKGVycik7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBpZiAocEpzb24uZGVwZW5kZW5jaWVzICYmIHBKc29uLmRlcGVuZGVuY2llc1twYWNrYWdlTmFtZV0pIHtcbiAgICByZXR1cm4ge3ZlcnNpb246IHBKc29uLmRlcGVuZGVuY2llc1twYWNrYWdlTmFtZV0udmVyc2lvbiwgcGF0aDogcEpzb24ucGF0aH07XG4gIH1cblxuICByZXR1cm4gbnVsbDtcbn1cblxuZXhwb3J0IHsgcGtnUm9vdCwgb2ssIG5vaywgb2tPcHRpb25hbCwgbm9rT3B0aW9uYWwsIGlucXVpcmVyLCBjb25maWd1cmVCaW5hcnlMb2csXG4gIGF1dGhvcml6ZUlvcywgcmVzb2x2ZUV4ZWN1dGFibGVQYXRoLCBnZXROcG1QYWNrYWdlSW5mb307XG4iXSwiZmlsZSI6ImxpYi91dGlscy5qcyIsInNvdXJjZVJvb3QiOiIuLi8uLiJ9
