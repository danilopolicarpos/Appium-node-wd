"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.OptionalMjpegConsumerCommandCheck = exports.OptionalFfmpegCommandCheck = exports.OptionalOpencv4nodejsCommandCheck = exports.NodeVersionCheck = exports.NodeBinaryCheck = void 0;

require("source-map-support/register");

var _utils = require("./utils");

var _teen_process = require("teen_process");

var _doctor = require("./doctor");

var _nodeDetector = _interopRequireDefault(require("./node-detector"));

var _os = require("os");

require("colors");

let checks = [];

class NodeBinaryCheck extends _doctor.DoctorCheck {
  async diagnose() {
    let nodePath = await _nodeDetector.default.detect();
    return nodePath ? (0, _utils.ok)(`The Node.js binary was found at: ${nodePath}`) : (0, _utils.nok)('The Node.js binary was NOT found!');
  }

  fix() {
    return `Manually setup ${'Node.js'.bold}.`;
  }

}

exports.NodeBinaryCheck = NodeBinaryCheck;
checks.push(new NodeBinaryCheck());

class NodeVersionCheck extends _doctor.DoctorCheck {
  async diagnose() {
    let nodePath = await _nodeDetector.default.detect();

    if (!nodePath) {
      return (0, _utils.nok)('Node is not installed, so no version to check!');
    }

    let {
      stdout
    } = await (0, _teen_process.exec)(nodePath, ['--version']);
    let versionString = stdout.replace('v', '').trim();
    let version = parseInt(versionString, 10);

    if (Number.isNaN(version)) {
      return (0, _utils.nok)(`Unable to find node version (version = '${versionString}')`);
    }

    return version >= 4 ? (0, _utils.ok)(`Node version is ${versionString}`) : (0, _utils.nok)('Node version should be at least 4!');
  }

  fix() {
    return `Manually upgrade ${'Node.js'.bold}.`;
  }

}

exports.NodeVersionCheck = NodeVersionCheck;
checks.push(new NodeVersionCheck());

class OptionalOpencv4nodejsCommandCheck extends _doctor.DoctorCheck {
  async diagnose() {
    const packageName = 'opencv4nodejs';
    const packageInfo = await (0, _utils.getNpmPackageInfo)(packageName);

    if (packageInfo) {
      return (0, _utils.okOptional)(`${packageName} is installed at: ${packageInfo.path}. Installed version is: ${packageInfo.version}`);
    }

    return (0, _utils.nokOptional)(`${packageName} cannot be found.`);
  }

  async fix() {
    return `Why ${'opencv4nodejs'.bold} is needed and how to install it: https://github.com/appium/appium/blob/master/docs/en/writing-running-appium/image-comparison.md`;
  }

}

exports.OptionalOpencv4nodejsCommandCheck = OptionalOpencv4nodejsCommandCheck;
checks.push(new OptionalOpencv4nodejsCommandCheck());

class OptionalFfmpegCommandCheck extends _doctor.DoctorCheck {
  async diagnose() {
    const ffmpegPath = await (0, _utils.resolveExecutablePath)('ffmpeg');
    return ffmpegPath ? (0, _utils.okOptional)(`ffmpeg is installed at: ${ffmpegPath}. ${(await (0, _teen_process.exec)('ffmpeg', ['-version'])).stdout.split(_os.EOL)[0]}`) : (0, _utils.nokOptional)('ffmpeg cannot be found');
  }

  async fix() {
    return `${'ffmpeg'.bold} is needed to record screen features. Please read https://www.ffmpeg.org/ to install it`;
  }

}

exports.OptionalFfmpegCommandCheck = OptionalFfmpegCommandCheck;
checks.push(new OptionalFfmpegCommandCheck());

class OptionalMjpegConsumerCommandCheck extends _doctor.DoctorCheck {
  async diagnose() {
    const packageName = 'mjpeg-consumer';
    const packageInfo = await (0, _utils.getNpmPackageInfo)(packageName);

    if (packageInfo) {
      return (0, _utils.okOptional)(`${packageName} is installed at: ${packageInfo.path}. Installed version is: ${packageInfo.version}`);
    }

    return (0, _utils.nokOptional)(`${packageName} cannot be found.`);
  }

  async fix() {
    return `${'mjpeg-consumer'.bold} module is required to use MJPEG-over-HTTP features. Please install it with 'npm i -g mjpeg-consumer'.`;
  }

}

exports.OptionalMjpegConsumerCommandCheck = OptionalMjpegConsumerCommandCheck;
checks.push(new OptionalMjpegConsumerCommandCheck());
var _default = checks;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9nZW5lcmFsLmpzIl0sIm5hbWVzIjpbImNoZWNrcyIsIk5vZGVCaW5hcnlDaGVjayIsIkRvY3RvckNoZWNrIiwiZGlhZ25vc2UiLCJub2RlUGF0aCIsIk5vZGVEZXRlY3RvciIsImRldGVjdCIsImZpeCIsImJvbGQiLCJwdXNoIiwiTm9kZVZlcnNpb25DaGVjayIsInN0ZG91dCIsInZlcnNpb25TdHJpbmciLCJyZXBsYWNlIiwidHJpbSIsInZlcnNpb24iLCJwYXJzZUludCIsIk51bWJlciIsImlzTmFOIiwiT3B0aW9uYWxPcGVuY3Y0bm9kZWpzQ29tbWFuZENoZWNrIiwicGFja2FnZU5hbWUiLCJwYWNrYWdlSW5mbyIsInBhdGgiLCJPcHRpb25hbEZmbXBlZ0NvbW1hbmRDaGVjayIsImZmbXBlZ1BhdGgiLCJzcGxpdCIsIkVPTCIsIk9wdGlvbmFsTWpwZWdDb25zdW1lckNvbW1hbmRDaGVjayJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQSxJQUFJQSxNQUFNLEdBQUcsRUFBYjs7QUFHQSxNQUFNQyxlQUFOLFNBQThCQyxtQkFBOUIsQ0FBMEM7QUFDeEMsUUFBTUMsUUFBTixHQUFrQjtBQUNoQixRQUFJQyxRQUFRLEdBQUcsTUFBTUMsc0JBQWFDLE1BQWIsRUFBckI7QUFDQSxXQUFPRixRQUFRLEdBQUcsZUFBSSxvQ0FBbUNBLFFBQVMsRUFBaEQsQ0FBSCxHQUNiLGdCQUFJLG1DQUFKLENBREY7QUFFRDs7QUFFREcsRUFBQUEsR0FBRyxHQUFJO0FBQ0wsV0FBUSxrQkFBaUIsVUFBVUMsSUFBSyxHQUF4QztBQUNEOztBQVR1Qzs7O0FBVzFDUixNQUFNLENBQUNTLElBQVAsQ0FBWSxJQUFJUixlQUFKLEVBQVo7O0FBR0EsTUFBTVMsZ0JBQU4sU0FBK0JSLG1CQUEvQixDQUEyQztBQUN6QyxRQUFNQyxRQUFOLEdBQWtCO0FBQ2hCLFFBQUlDLFFBQVEsR0FBRyxNQUFNQyxzQkFBYUMs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LElBQUlrQixpQ0FBSixFQUFaO2VBS2UzQixNIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgb2ssIG5vaywgb2tPcHRpb25hbCwgbm9rT3B0aW9uYWwsIHJlc29sdmVFeGVjdXRhYmxlUGF0aCwgZ2V0TnBtUGFja2FnZUluZm8gfSBmcm9tICcuL3V0aWxzJztcbmltcG9ydCB7IGV4ZWMgfSBmcm9tICd0ZWVuX3Byb2Nlc3MnO1xuaW1wb3J0IHsgRG9jdG9yQ2hlY2sgfSBmcm9tICcuL2RvY3Rvcic7XG5pbXBvcnQgTm9kZURldGVjdG9yIGZyb20gJy4vbm9kZS1kZXRlY3Rvcic7XG5pbXBvcnQgeyBFT0wgfSBmcm9tICdvcyc7XG5pbXBvcnQgJ2NvbG9ycyc7XG5cbmxldCBjaGVja3MgPSBbXTtcblxuLy8gTm9kZSBCaW5hcnlcbmNsYXNzIE5vZGVCaW5hcnlDaGVjayBleHRlbmRzIERvY3RvckNoZWNrIHtcbiAgYXN5bmMgZGlhZ25vc2UgKCkge1xuICAgIGxldCBub2RlUGF0aCA9IGF3YWl0IE5vZGVEZXRlY3Rvci5kZXRlY3QoKTtcbiAgICByZXR1cm4gbm9kZVBhdGggPyBvayhgVGhlIE5vZGUuanMgYmluYXJ5IHdhcyBmb3VuZCBhdDogJHtub2RlUGF0aH1gKSA6XG4gICAgICBub2soJ1RoZSBOb2RlLmpzIGJpbmFyeSB3YXMgTk9UIGZvdW5kIScpO1xuICB9XG5cbiAgZml4ICgpIHtcbiAgICByZXR1cm4gYE1hbnVhbGx5IHNldHVwICR7J05vZGUuanMnLmJvbGR9LmA7XG4gIH1cbn1cbmNoZWNrcy5wdXNoKG5ldyBOb2RlQmluYXJ5Q2hlY2soKSk7XG5cbi8vIE5vZGUgdmVyc2lvblxuY2xhc3MgTm9kZVZlcnNpb25DaGVjayBleHRlbmRzIERvY3RvckNoZWNrIHtcbiAgYXN5bmMgZGlhZ25vc2UgKCkge1xuICAgIGxldCBub2RlUGF0aCA9IGF3YWl0IE5vZGVEZXRlY3Rvci5kZXRlY3QoKTtcbiAgICBpZiAoIW5vZGVQYXRoKSB7XG4gICAgICByZXR1cm4gbm9rKCdOb2RlIGlzIG5vdCBpbnN0YWxsZWQsIHNvIG5vIHZlcnNpb24gdG8gY2hlY2shJyk7XG4gICAgfVxuICAgIGxldCB7c3Rkb3V0fSA9IGF3YWl0IGV4ZWMobm9kZVBhdGgsIFsnLS12ZXJzaW9uJ10pO1xuICAgIGxldCB2ZXJzaW9uU3RyaW5nID0gc3Rkb3V0LnJlcGxhY2UoJ3YnLCAnJykudHJpbSgpO1xuICAgIGxldCB2ZXJzaW9uID0gcGFyc2VJbnQodmVyc2lvblN0cmluZywgMTApO1xuICAgIGlmIChOdW1iZXIuaXNOYU4odmVyc2lvbikpIHtcbiAgICAgIHJldHVybiBub2soYFVuYWJsZSB0byBmaW5kIG5vZGUgdmVyc2lvbiAodmVyc2lvbiA9ICcke3ZlcnNpb25TdHJpbmd9JylgKTtcbiAgICB9XG4gICAgcmV0dXJuIHZlcnNpb24gPj0gNCA/IG9rKGBOb2RlIHZlcnNpb24gaXMgJHt2ZXJzaW9uU3RyaW5nfWApIDpcbiAgICAgIG5vaygnTm9kZSB2ZXJzaW9uIHNob3VsZCBiZSBhdCBsZWFzdCA0IScpO1xuICB9XG5cbiAgZml4ICgpIHtcbiAgICByZXR1cm4gYE1hbnVhbGx5IHVwZ3JhZGUgJHsnTm9kZS5qcycuYm9sZH0uYDtcbiAgfVxufVxuY2hlY2tzLnB1c2gobmV3IE5vZGVWZXJzaW9uQ2hlY2soKSk7XG5cbmNsYXNzIE9wdGlvbmFsT3BlbmN2NG5vZGVqc0NvbW1hbmRDaGVjayBleHRlbmRzIERvY3RvckNoZWNrIHtcbiAgYXN5bmMgZGlhZ25vc2UgKCkge1xuICAgIGNvbnN0IHBhY2thZ2VOYW1lID0gJ29wZW5jdjRub2RlanMnO1xuICAgIGNvbnN0IHBhY2thZ2VJbmZvID0gYXdhaXQgZ2V0TnBtUGFja2FnZUluZm8ocGFja2FnZU5hbWUpO1xuXG4gICAgaWYgKHBhY2thZ2VJbmZvKSB7XG4gICAgICByZXR1cm4gb2tPcHRpb25hbChgJHtwYWNrYWdlTmFtZX0gaXMgaW5zdGFsbGVkIGF0OiAke3BhY2thZ2VJbmZvLnBhdGh9LiBJbnN0YWxsZWQgdmVyc2lvbiBpczogJHtwYWNrYWdlSW5mby52ZXJzaW9ufWApO1xuICAgIH1cbiAgICByZXR1cm4gbm9rT3B0aW9uYWwoYCR7cGFja2FnZU5hbWV9IGNhbm5vdCBiZSBmb3VuZC5gKTtcbiAgfVxuXG4gIGFzeW5jIGZpeCAoKSB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgcmVxdWlyZS1hd2FpdFxuICAgIHJldHVybiBgV2h5ICR7J29wZW5jdjRub2RlanMnLmJvbGR9IGlzIG5lZWRlZCBhbmQgaG93IHRvIGluc3RhbGwgaXQ6IGh0dHBzOi8vZ2l0aHViLmNvbS9hcHBpdW0vYXBwaXVtL2Jsb2IvbWFzdGVyL2RvY3MvZW4vd3JpdGluZy1ydW5uaW5nLWFwcGl1bS9pbWFnZS1jb21wYXJpc29uLm1kYDtcbiAgfVxufVxuY2hlY2tzLnB1c2gobmV3IE9wdGlvbmFsT3BlbmN2NG5vZGVqc0NvbW1hbmRDaGVjaygpKTtcblxuY2xhc3MgT3B0aW9uYWxGZm1wZWdDb21tYW5kQ2hlY2sgZXh0ZW5kcyBEb2N0b3JDaGVjayB7XG4gIGFzeW5jIGRpYWdub3NlICgpIHtcbiAgICBjb25zdCBmZm1wZWdQYXRoID0gYXdhaXQgcmVzb2x2ZUV4ZWN1dGFibGVQYXRoKCdmZm1wZWcnKTtcbiAgICByZXR1cm4gZmZtcGVnUGF0aFxuICAgICAgPyBva09wdGlvbmFsKGBmZm1wZWcgaXMgaW5zdGFsbGVkIGF0OiAke2ZmbXBlZ1BhdGh9LiAkeyhhd2FpdCBleGVjKCdmZm1wZWcnLCBbJy12ZXJzaW9uJ10pKS5zdGRvdXQuc3BsaXQoRU9MKVswXX1gKVxuICAgICAgOiBub2tPcHRpb25hbCgnZmZtcGVnIGNhbm5vdCBiZSBmb3VuZCcpO1xuICB9XG5cbiAgYXN5bmMgZml4ICgpIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSByZXF1aXJlLWF3YWl0XG4gICAgcmV0dXJuIGAkeydmZm1wZWcnLmJvbGR9IGlzIG5lZWRlZCB0byByZWNvcmQgc2NyZWVuIGZlYXR1cmVzLiBQbGVhc2UgcmVhZCBodHRwczovL3d3dy5mZm1wZWcub3JnLyB0byBpbnN0YWxsIGl0YDtcbiAgfVxufVxuY2hlY2tzLnB1c2gobmV3IE9wdGlvbmFsRmZtcGVnQ29tbWFuZENoZWNrKCkpO1xuXG5cbmNsYXNzIE9wdGlvbmFsTWpwZWdDb25zdW1lckNvbW1hbmRDaGVjayBleHRlbmRzIERvY3RvckNoZWNrIHtcbiAgYXN5bmMgZGlhZ25vc2UgKCkge1xuICAgIGNvbnN0IHBhY2thZ2VOYW1lID0gJ21qcGVnLWNvbnN1bWVyJztcbiAgICBjb25zdCBwYWNrYWdlSW5mbyA9IGF3YWl0IGdldE5wbVBhY2thZ2VJbmZvKHBhY2thZ2VOYW1lKTtcblxuICAgIGlmIChwYWNrYWdlSW5mbykge1xuICAgICAgcmV0dXJuIG9rT3B0aW9uYWwoYCR7cGFja2FnZU5hbWV9IGlzIGluc3RhbGxlZCBhdDogJHtwYWNrYWdlSW5mby5wYXRofS4gSW5zdGFsbGVkIHZlcnNpb24gaXM6ICR7cGFja2FnZUluZm8udmVyc2lvbn1gKTtcbiAgICB9XG4gICAgcmV0dXJuIG5va09wdGlvbmFsKGAke3BhY2thZ2VOYW1lfSBjYW5ub3QgYmUgZm91bmQuYCk7XG4gIH1cblxuICBhc3luYyBmaXggKCkgeyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHJlcXVpcmUtYXdhaXRcbiAgICByZXR1cm4gYCR7J21qcGVnLWNvbnN1bWVyJy5ib2xkfSBtb2R1bGUgaXMgcmVxdWlyZWQgdG8gdXNlIE1KUEVHLW92ZXItSFRUUCBmZWF0dXJlcy4gUGxlYXNlIGluc3RhbGwgaXQgd2l0aCAnbnBtIGkgLWcgbWpwZWctY29uc3VtZXInLmA7XG4gIH1cbn1cbmNoZWNrcy5wdXNoKG5ldyBPcHRpb25hbE1qcGVnQ29uc3VtZXJDb21tYW5kQ2hlY2soKSk7XG5cblxuZXhwb3J0IHsgTm9kZUJpbmFyeUNoZWNrLCBOb2RlVmVyc2lvbkNoZWNrLFxuICBPcHRpb25hbE9wZW5jdjRub2RlanNDb21tYW5kQ2hlY2ssIE9wdGlvbmFsRmZtcGVnQ29tbWFuZENoZWNrLCBPcHRpb25hbE1qcGVnQ29uc3VtZXJDb21tYW5kQ2hlY2sgfTtcbmV4cG9ydCBkZWZhdWx0IGNoZWNrcztcbiJdLCJmaWxlIjoibGliL2dlbmVyYWwuanMiLCJzb3VyY2VSb290IjoiLi4vLi4ifQ==
