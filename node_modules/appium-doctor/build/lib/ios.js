"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.OptionalIfuseCommandCheck = exports.OptionalIOSWebkitDebugProxyCommandCheck = exports.OptionalIOSDeployCommandCheck = exports.OptionalIdevicelocationCommandCheck = exports.OptionalApplesimutilsCommandCheck = exports.OptionalIdbCommandCheck = exports.CarthageCheck = exports.AuthorizationDbCheck = exports.DevToolsSecurityCheck = exports.XcodeCmdLineToolsCheck = exports.XcodeCheck = exports.fixes = void 0;

require("source-map-support/register");

var _utils = require("./utils");

var _appiumSupport = require("appium-support");

var _teen_process = require("teen_process");

var _doctor = require("./doctor");

var _logger = _interopRequireDefault(require("./logger"));

var _carthageDetector = _interopRequireDefault(require("./carthage-detector"));

var _prompt = require("./prompt");

var _env = _interopRequireDefault(require("./env"));

var _os = require("os");

var _lodash = _interopRequireDefault(require("lodash"));

require("colors");

let checks = [];
let fixes = {};
exports.fixes = fixes;

class XcodeCheck extends _doctor.DoctorCheck {
  async diagnose() {
    let xcodePath;

    try {
      await (0, _teen_process.exec)('xcrun', ['simctl', 'help']);
      const {
        stdout
      } = await (0, _teen_process.exec)('xcode-select', ['-p']);
      xcodePath = (stdout || '').replace('\n', '');
    } catch (err) {
      return (0, _utils.nok)('Xcode is NOT installed!');
    }

    return xcodePath && (await _appiumSupport.fs.exists(xcodePath)) ? (0, _utils.ok)(`Xcode is installed at: ${xcodePath}`) : (0, _utils.nok)(`Xcode cannot be found at '${xcodePath}'!`);
  }

  async fix() {
    return `Manually install ${'Xcode'.bold}, and make sure 'xcode-select -p' command shows proper path like '/Applications/Xcode.app/Contents/Developer'`;
  }

}

exports.XcodeCheck = XcodeCheck;
checks.push(new XcodeCheck());

class XcodeCmdLineToolsCheck extends _doctor.DoctorCheck {
  constructor() {
    super({
      autofix: true
    });
  }

  async diagnose() {
    const errMess = 'Xcode Command Line Tools are NOT installed!';

    try {
      const stdout = (await (0, _teen_process.exec)('xcode-select', ['-p'])).stdout;
      return (0, _utils.ok)(`Xcode Command Line Tools are installed in: ${stdout.trim()}`);
    } catch (err) {
      _logger.default.debug(err);

      return (0, _utils.nok)(errMess);
    }
  }

  async fix() {
    _logger.default.info(`The following command need be executed: xcode-select --install`);

    let yesno = await (0, _prompt.fixIt)();

    if (yesno === 'yes') {
      await (0, _teen_process.exec)('xcode-select', ['--install']);
    } else {
      _logger.default.info(`Skipping you will need to install ${'Xcode'.bold} manually.`);

      throw new _doctor.FixSkippedError();
    }
  }

}

exports.XcodeCmdLineToolsCheck = XcodeCmdLineToolsCheck;
checks.push(new XcodeCmdLineToolsCheck());

fixes.authorizeIosFix = async function () {
  _logger.default.info(`The authorize iOS script need to be run.`);

  let yesno = await (0, _prompt.fixIt)();

  if (yesno === 'yes') {
    await (0, _utils.authorizeIos)();
  } else {
    _logger.default.info(`Skipping you will need to run ${'the authorize iOS'.bold} manually.`);

    throw new _doctor.FixSkippedError();
  }
};

class DevToolsSecurityCheck extends _doctor.DoctorCheck {
  constructor() {
    super({
      autofix: true
    });
  }

  async diagnose() {
    const errMess = 'DevToolsSecurity is NOT enabled!';
    let stdout;

    try {
      stdout = (await (0, _teen_process.exec)('DevToolsSecurity', [])).stdout;
    } catch (err) {
      _logger.default.debug(err);

      return (0, _utils.nok)(errMess);
    }

    return stdout && stdout.match(/enabled/) ? (0, _utils.ok)('DevToolsSecurity is enabled.') : (0, _utils.nok)(errMess);
  }

  async fix() {
    return await fixes.authorizeIosFix();
  }

}

exports.DevToolsSecurityCheck = DevToolsSecurityCheck;
checks.push(new DevToolsSecurityCheck());

class AuthorizationDbCheck extends _doctor.DoctorCheck {
  constructor() {
    super({
      autofix: true
    });
  }

  async diagnose() {
    const successMess = 'The Authorization DB is set up properly.';
    const errMess = 'The Authorization DB is NOT set up properly.';
    let stdout;

    try {
      ({
        stdout
      } = await (0, _teen_process.exec)('security', ['authorizationdb', 'read', 'system.privilege.taskport']));
    } catch (err) {
      _logger.default.warn(err);

      return (0, _utils.nok)(errMess);
    }

    return stdout && (stdout.match(/is-developer/) || stdout.match(/allow/)) ? (0, _utils.ok)(successMess) : (0, _utils.nok)(errMess);
  }

  async fix() {
    return await fixes.authorizeIosFix();
  }

}

exports.AuthorizationDbCheck = AuthorizationDbCheck;
checks.push(new AuthorizationDbCheck());

class CarthageCheck extends _doctor.DoctorCheck {
  async diagnose() {
    let carthagePath = await _carthageDetector.default.detect();
    let version;

    if (carthagePath) {
      try {
        const {
          stdout
        } = await (0, _teen_process.exec)(carthagePath, ['version']);
        version = _lodash.default.last(stdout.match(/(\d+\.\d+\.\d+)/g));

        if (!_appiumSupport.util.coerceVersion(version, false)) {
          _logger.default.warn(`Cannot parse Carthage version from ${stdout}`);
        }
      } catch (err) {
        _logger.default.warn(err);
      }
    }

    return carthagePath ? (0, _utils.ok)(`Carthage was found at: ${carthagePath}${version ? `. Installed version is: ${version}` : ''}`) : (0, _utils.nok)(`Carthage was NOT found!`);
  }

  async fix() {
    return `Please install ${'Carthage'.bold}. Visit https://github.com/Carthage` + '/Carthage#installing-carthage for more information.';
  }

}

exports.CarthageCheck = CarthageCheck;
checks.push(new CarthageCheck());
checks.push(new _env.default('HOME'));

class OptionalIdbCommandCheck extends _doctor.DoctorCheck {
  async diagnose() {
    const fbIdbPath = await (0, _utils.resolveExecutablePath)('idb');
    const fbCompanionIdbPath = await (0, _utils.resolveExecutablePath)('idb_companion');

    if (fbIdbPath && fbCompanionIdbPath) {
      return (0, _utils.okOptional)('idb and idb_companion are installed');
    }

    if (!fbIdbPath && fbCompanionIdbPath) {
      return (0, _utils.nokOptional)('idb is not installed');
    } else if (fbIdbPath && !fbCompanionIdbPath) {
      return (0, _utils.nokOptional)('idb_companion is not installed');
    }

    return (0, _utils.nokOptional)('idb and idb_companion are not installed');
  }

  async fix() {
    return `Why ${'idb'.bold} is needed and how to install it: https://github.com/appium/appium-idb`;
  }

}

exports.OptionalIdbCommandCheck = OptionalIdbCommandCheck;
checks.push(new OptionalIdbCommandCheck());

class OptionalApplesimutilsCommandCheck extends _doctor.DoctorCheck {
  async diagnose() {
    const applesimutilsPath = await (0, _utils.resolveExecutablePath)('applesimutils');
    return applesimutilsPath ? (0, _utils.okOptional)(`applesimutils is installed at: ${applesimutilsPath}. Installed versions are: ${(await (0, _teen_process.exec)('brew', ['list', '--versions', 'applesimutils'])).stdout.trim()}`) : (0, _utils.nokOptional)('applesimutils cannot be found');
  }

  async fix() {
    return `Why ${'applesimutils'.bold} is needed and how to install it: http://appium.io/docs/en/drivers/ios-xcuitest/`;
  }

}

exports.OptionalApplesimutilsCommandCheck = OptionalApplesimutilsCommandCheck;
checks.push(new OptionalApplesimutilsCommandCheck());

class OptionalIdevicelocationCommandCheck extends _doctor.DoctorCheck {
  async diagnose() {
    const idevicelocationPath = await (0, _utils.resolveExecutablePath)('idevicelocation');
    return idevicelocationPath ? (0, _utils.okOptional)(`idevicelocation is installed at: ${idevicelocationPath}`) : (0, _utils.nokOptional)('idevicelocation cannot be found');
  }

  async fix() {
    return `${'idevicelocation'.bold} is used to set geolocation for real device. Please read https://github.com/JonGabilondoAngulo/idevicelocation to install it`;
  }

}

exports.OptionalIdevicelocationCommandCheck = OptionalIdevicelocationCommandCheck;
checks.push(new OptionalIdevicelocationCommandCheck());

class OptionalIOSDeployCommandCheck extends _doctor.DoctorCheck {
  async diagnose() {
    const iosDeployPath = await (0, _utils.resolveExecutablePath)('ios-deploy');
    return iosDeployPath ? (0, _utils.okOptional)(`ios-deploy is installed at: ${iosDeployPath}. Installed version is: ${(await (0, _teen_process.exec)(iosDeployPath, ['-V'])).stdout.trim()}`) : (0, _utils.nokOptional)('ios-deploy cannot be found');
  }

  async fix() {
    return `${'ios-deploy'.bold} is used to install iOS applications to real device. Please read http://appium.io/docs/en/drivers/ios-xcuitest-real-devices/ to install it`;
  }

}

exports.OptionalIOSDeployCommandCheck = OptionalIOSDeployCommandCheck;
checks.push(new OptionalIOSDeployCommandCheck());

class OptionalIOSWebkitDebugProxyCommandCheck extends _doctor.DoctorCheck {
  async diagnose() {
    const iosWebkitDebugProxyPath = await (0, _utils.resolveExecutablePath)('ios_webkit_debug_proxy');

    if (iosWebkitDebugProxyPath) {
      const version = (await (0, _teen_process.exec)(iosWebkitDebugProxyPath, ['-V'])).stdout.split(_os.EOL);
      return (0, _utils.okOptional)(`ios_webkit_debug_proxy is installed at: ${iosWebkitDebugProxyPath}. Installed version is: ${version[0].replace('ios_webkit_debug_proxy ', '')}, ${version[1]}`);
    }

    return (0, _utils.nokOptional)('ios_webkit_debug_proxy cannot be found');
  }

  async fix() {
    return `${'ios_webkit_debug_proxy'.bold} is used to proxy requests from Appium to MobileSafari running on real device. Please read https://github.com/google/ios-webkit-debug-proxy to install it`;
  }

}

exports.OptionalIOSWebkitDebugProxyCommandCheck = OptionalIOSWebkitDebugProxyCommandCheck;
checks.push(new OptionalIOSWebkitDebugProxyCommandCheck());

class OptionalIfuseCommandCheck extends _doctor.DoctorCheck {
  async diagnose() {
    const ifusePath = await (0, _utils.resolveExecutablePath)('ifuse');

    if (ifusePath) {
      const version = (await (0, _teen_process.exec)(ifusePath, ['-V'])).stderr;
      return (0, _utils.okOptional)(`ifuse is installed at: ${ifusePath}.${version ? ` Installed version is: ${/[0-9.]+/.exec(version)[0]}` : ''}`);
    }

    return (0, _utils.nokOptional)('ifuse cannot be found');
  }

  async fix() {
    return `${'ifuse'.bold} is used to manage files/folders against a real device. Please read https://github.com/appium/appium/blob/master/docs/en/writing-running-appium/ios/ios-xctest-file-movement.md to install it`;
  }

}

exports.OptionalIfuseCommandCheck = OptionalIfuseCommandCheck;
checks.push(new OptionalIfuseCommandCheck());
var _default = checks;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9pb3MuanMiXSwibmFtZXMiOlsiY2hlY2tzIiwiZml4ZXMiLCJYY29kZUNoZWNrIiwiRG9jdG9yQ2hlY2siLCJkaWFnbm9zZSIsInhjb2RlUGF0aCIsInN0ZG91dCIsInJlcGxhY2UiLCJlcnIiLCJmcyIsImV4aXN0cyIsImZpeCIsImJvbGQiLCJwdXNoIiwiWGNvZGVDbWRMaW5lVG9vbHNDaGVjayIsImNvbnN0cnVjdG9yIiwiYXV0b2ZpeCIsImVyck1lc3MiLCJ0cmltIiwibG9nIiwiZGVidWciLCJpbmZvIiwieWVzbm8iLCJGaXhTa2lwcGVkRXJyb3IiLCJhdXRob3JpemVJb3NGaXgiLCJEZXZUb29sc1NlY3VyaXR5Q2hlY2siLCJtYXRjaCIsIkF1dGhvcml6YXRpb25EYkNoZWNrIiwic3VjY2Vzc01lc3MiLCJ3YXJuIiwiQ2FydGhhZ2VDaGVjayIsImNhcnRoYWdlUGF0aCIsIkNhcnRoYWdlRGV0ZWN0b3IiLCJkZXRlY3QiLCJ2ZXJzaW9uIiwiXyIsImxhc3QiLCJ1dGlsIiwiY29lcmNlVmVyc2lvbiIsIkVudlZhckFuZFBhdGhDaGVjayIsIk9wdGlvbmFsSWRiQ29tbWFuZENoZWNrIiwiZmJJZGJQYXRoIiwiZmJDb21wYW5pb25JZGJQYXRoIiwiT3B0aW9uYWxBcHBsZXNpbXV0aWxzQ29tbWFuZENoZWNrIiwiYXBwbGVzaW11dGlsc1BhdGgiLCJPcHRpb25hbElkZXZpY2Vsb2NhdGlvbkNvbW1hbmRDaGVjayIsImlkZXZpY2Vsb2NhdGlvblBhdGgiLCJPcHRpb25hbElPU0RlcGxveUNvbW1hbmRDaGVjayIsImlvc0RlcGxveVBhdGgiLCJPcHRpb25hbElPU1dlYmtpdERlYnVnUHJveHlDb21tYW5kQ2hlY2siLCJpb3NXZWJraXREZWJ1Z1Byb3h5UGF0aCIsInNwbGl0IiwiRU9MIiwiT3B0aW9uYWxJZnVzZUNvbW1hbmRDaGVjayIsImlmdXNlUGF0aCIsInN0ZGVyciIsImV4ZWMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7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QUF3QixDQUF4QixDQUEyQixFQUF4RCxHQUE0RCxFQUFHLEVBQXpILENBQVA7QUFDRDs7QUFDRCxXQUFPLHdCQUFZLHVCQUFaLENBQVA7QUFDRDs7QUFFRCxRQUFNdkIsR0FBTixHQUFhO0FBQ1gsV0FBUSxHQUFFLFFBQVFDLElBQUssK0xBQXZCO0FBQ0Q7O0FBWmlEOzs7QUFjcERaLE1BQU0sQ0FBQ2EsSUFBUCxDQUFZLElBQUl3Qyx5QkFBSixFQUFaO2VBUWVyRCxNIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgb2ssIG5vaywgb2tPcHRpb25hbCwgbm9rT3B0aW9uYWwsIGF1dGhvcml6ZUlvcywgcmVzb2x2ZUV4ZWN1dGFibGVQYXRoIH0gZnJvbSAnLi91dGlscyc7IC8vIGVzbGludC1kaXNhYmxlLWxpbmVcbmltcG9ydCB7IGZzLCB1dGlsIH0gZnJvbSAnYXBwaXVtLXN1cHBvcnQnO1xuaW1wb3J0IHsgZXhlYyB9IGZyb20gJ3RlZW5fcHJvY2Vzcyc7XG5pbXBvcnQgeyBEb2N0b3JDaGVjaywgRml4U2tpcHBlZEVycm9yIH0gZnJvbSAnLi9kb2N0b3InO1xuaW1wb3J0IGxvZyBmcm9tICcuL2xvZ2dlcic7XG5pbXBvcnQgQ2FydGhhZ2VEZXRlY3RvciBmcm9tICcuL2NhcnRoYWdlLWRldGVjdG9yJztcbmltcG9ydCB7IGZpeEl0IH0gZnJvbSAnLi9wcm9tcHQnO1xuaW1wb3J0IEVudlZhckFuZFBhdGhDaGVjayBmcm9tICcuL2Vudic7XG5pbXBvcnQgeyBFT0wgfSBmcm9tICdvcyc7XG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0ICdjb2xvcnMnO1xuXG5sZXQgY2hlY2tzID0gW107XG5sZXQgZml4ZXMgPSB7fTtcblxuLy8gQ2hlY2sgZm9yIFhjb2RlLlxuY2xhc3MgWGNvZGVDaGVjayBleHRlbmRzIERvY3RvckNoZWNrIHtcbiAgYXN5bmMgZGlhZ25vc2UgKCkge1xuICAgIGxldCB4Y29kZVBhdGg7XG4gICAgdHJ5IHtcbiAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9hcHBpdW0vYXBwaXVtL2lzc3Vlcy8xMjA5MyNpc3N1ZWNvbW1lbnQtNDU5MzU4MTIwIGNhbiBoYXBwZW5cbiAgICAgIGF3YWl0IGV4ZWMoJ3hjcnVuJywgWydzaW1jdGwnLCAnaGVscCddKTtcblxuICAgICAgY29uc3Qge3N0ZG91dH0gPSBhd2FpdCBleGVjKCd4Y29kZS1zZWxlY3QnLCBbJy1wJ10pO1xuICAgICAgeGNvZGVQYXRoID0gKHN0ZG91dCB8fCAnJykucmVwbGFjZSgnXFxuJywgJycpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgcmV0dXJuIG5vaygnWGNvZGUgaXMgTk9UIGluc3RhbGxlZCEnKTtcbiAgICB9XG4gICAgcmV0dXJuIHhjb2RlUGF0aCAmJiBhd2FpdCBmcy5leGlzdHMoeGNvZGVQYXRoKSA/IG9rKGBYY29kZSBpcyBpbnN0YWxsZWQgYXQ6ICR7eGNvZGVQYXRofWApIDpcbiAgICAgIG5vayhgWGNvZGUgY2Fubm90IGJlIGZvdW5kIGF0ICcke3hjb2RlUGF0aH0nIWApO1xuICB9XG5cbiAgYXN5bmMgZml4ICgpIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSByZXF1aXJlLWF3YWl0XG4gICAgcmV0dXJuIGBNYW51YWxseSBpbnN0YWxsICR7J1hjb2RlJy5ib2xkfSwgYW5kIG1ha2Ugc3VyZSAneGNvZGUtc2VsZWN0IC1wJyBjb21tYW5kIHNob3dzIHByb3BlciBwYXRoIGxpa2UgJy9BcHBsaWNhdGlvbnMvWGNvZGUuYXBwL0NvbnRlbnRzL0RldmVsb3BlcidgO1xuICB9XG59XG5jaGVja3MucHVzaChuZXcgWGNvZGVDaGVjaygpKTtcblxuLy8gQ2hlY2sgZm9yIFhjb2RlIENvbW1hbmQgTGluZSBUb29scy5cbmNsYXNzIFhjb2RlQ21kTGluZVRvb2xzQ2hlY2sgZXh0ZW5kcyBEb2N0b3JDaGVjayB7XG4gIGNvbnN0cnVjdG9yICgpIHtcbiAgICBzdXBlcih7YXV0b2ZpeDogdHJ1ZX0pO1xuICB9XG5cbiAgYXN5bmMgZGlhZ25vc2UgKCkge1xuICAgIGNvbnN0IGVyck1lc3MgPSAnWGNvZGUgQ29tbWFuZCBMaW5lIFRvb2xzIGFyZSBOT1QgaW5zdGFsbGVkISc7XG4gICAgdHJ5IHtcbiAgICAgIC8vIGh0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzE1MzcxOTI1L2hvdy10by1jaGVjay1pZi1jb21tYW5kLWxpbmUtdG9vbHMtaXMtaW5zdGFsbGVkXG4gICAgICBjb25zdCBzdGRvdXQgPSAoYXdhaXQgZXhlYygneGNvZGUtc2VsZWN0JywgWyctcCddKSkuc3Rkb3V0O1xuICAgICAgcmV0dXJuIG9rKGBYY29kZSBDb21tYW5kIExpbmUgVG9vbHMgYXJlIGluc3RhbGxlZCBpbjogJHtzdGRvdXQudHJpbSgpfWApO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgbG9nLmRlYnVnKGVycik7XG4gICAgICByZXR1cm4gbm9rKGVyck1lc3MpO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGZpeCAoKSB7XG4gICAgbG9nLmluZm8oYFRoZSBmb2xsb3dpbmcgY29tbWFuZCBuZWVkIGJlIGV4ZWN1dGVkOiB4Y29kZS1zZWxlY3QgLS1pbnN0YWxsYCk7XG4gICAgbGV0IHllc25vID0gYXdhaXQgZml4SXQoKTtcbiAgICBpZiAoeWVzbm8gPT09ICd5ZXMnKSB7XG4gICAgICBhd2FpdCBleGVjKCd4Y29kZS1zZWxlY3QnLCBbJy0taW5zdGFsbCddKTtcbiAgICB9IGVsc2Uge1xuICAgICAgbG9nLmluZm8oYFNraXBwaW5nIHlvdSB3aWxsIG5lZWQgdG8gaW5zdGFsbCAkeydYY29kZScuYm9sZH0gbWFudWFsbHkuYCk7XG4gICAgICB0aHJvdyBuZXcgRml4U2tpcHBlZEVycm9yKCk7XG4gICAgfVxuICB9XG59XG5cbmNoZWNrcy5wdXNoKG5ldyBYY29kZUNtZExpbmVUb29sc0NoZWNrKCkpO1xuXG4vLyBBdXRvbWF0aWNhbGx5IHJ1biBhdXRob3JpemUgaU9TIGlmIHJlcXVlc3RlZFxuZml4ZXMuYXV0aG9yaXplSW9zRml4ID0gYXN5bmMgZnVuY3Rpb24gKCkge1xuICBsb2cuaW5mbyhgVGhlIGF1dGhvcml6ZSBpT1Mgc2NyaXB0IG5lZWQgdG8gYmUgcnVuLmApO1xuICBsZXQgeWVzbm8gPSBhd2FpdCBmaXhJdCgpO1xuICBpZiAoeWVzbm8gPT09ICd5ZXMnKSB7XG4gICAgYXdhaXQgYXV0aG9yaXplSW9zKCk7XG4gIH0gZWxzZSB7XG4gICAgbG9nLmluZm8oYFNraXBwaW5nIHlvdSB3aWxsIG5lZWQgdG8gcnVuICR7J3RoZSBhdXRob3JpemUgaU9TJy5ib2xkfSBtYW51YWxseS5gKTtcbiAgICB0aHJvdyBuZXcgRml4U2tpcHBlZEVycm9yKCk7XG4gIH1cbn07XG5cbi8vIERldiBUb29scyBTZWN1cml0eVxuY2xhc3MgRGV2VG9vbHNTZWN1cml0eUNoZWNrIGV4dGVuZHMgRG9jdG9yQ2hlY2sge1xuICBjb25zdHJ1Y3RvciAoKSB7XG4gICAgc3VwZXIoe2F1dG9maXg6IHRydWV9KTtcbiAgfVxuXG4gIGFzeW5jIGRpYWdub3NlICgpIHtcbiAgICBjb25zdCBlcnJNZXNzID0gJ0RldlRvb2xzU2VjdXJpdHkgaXMgTk9UIGVuYWJsZWQhJztcbiAgICBsZXQgc3Rkb3V0O1xuICAgIHRyeSB7XG4gICAgICBzdGRvdXQgPSAoYXdhaXQgZXhlYygnRGV2VG9vbHNTZWN1cml0eScsIFtdKSkuc3Rkb3V0O1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgbG9nLmRlYnVnKGVycik7XG4gICAgICByZXR1cm4gbm9rKGVyck1lc3MpO1xuICAgIH1cbiAgICByZXR1cm4gc3Rkb3V0ICYmIHN0ZG91dC5tYXRjaCgvZW5hYmxlZC8pID8gb2soJ0RldlRvb2xzU2VjdXJpdHkgaXMgZW5hYmxlZC4nKVxuICAgICAgOiBub2soZXJyTWVzcyk7XG4gIH1cbiAgYXN5bmMgZml4ICgpIHtcbiAgICByZXR1cm4gYXdhaXQgZml4ZXMuYXV0aG9yaXplSW9zRml4KCk7XG4gIH1cbn1cbmNoZWNrcy5wdXNoKG5ldyBEZXZUb29sc1NlY3VyaXR5Q2hlY2soKSk7XG5cbi8vIEF1dGhvcml6YXRpb24gREJcbmNsYXNzIEF1dGhvcml6YXRpb25EYkNoZWNrIGV4dGVuZHMgRG9jdG9yQ2hlY2sge1xuICBjb25zdHJ1Y3RvciAoKSB7XG4gICAgc3VwZXIoe2F1dG9maXg6IHRydWV9KTtcbiAgfVxuXG4gIGFzeW5jIGRpYWdub3NlICgpIHtcbiAgICBjb25zdCBzdWNjZXNzTWVzcyA9ICdUaGUgQXV0aG9yaXphdGlvbiBEQiBpcyBzZXQgdXAgcHJvcGVybHkuJztcbiAgICBjb25zdCBlcnJNZXNzID0gJ1RoZSBBdXRob3JpemF0aW9uIERCIGlzIE5PVCBzZXQgdXAgcHJvcGVybHkuJztcbiAgICBsZXQgc3Rkb3V0O1xuICAgIHRyeSB7XG4gICAgICAoe3N0ZG91dH0gPSBhd2FpdCBleGVjKCdzZWN1cml0eScsIFsnYXV0aG9yaXphdGlvbmRiJywgJ3JlYWQnLCAnc3lzdGVtLnByaXZpbGVnZS50YXNrcG9ydCddKSk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBsb2cud2FybihlcnIpO1xuICAgICAgcmV0dXJuIG5vayhlcnJNZXNzKTtcbiAgICB9XG4gICAgcmV0dXJuIHN0ZG91dCAmJiAoc3Rkb3V0Lm1hdGNoKC9pcy1kZXZlbG9wZXIvKSB8fCBzdGRvdXQubWF0Y2goL2FsbG93LykpID9cbiAgICAgIG9rKHN1Y2Nlc3NNZXNzKSA6IG5vayhlcnJNZXNzKTtcbiAgfVxuICBhc3luYyBmaXggKCkge1xuICAgIHJldHVybiBhd2FpdCBmaXhlcy5hdXRob3JpemVJb3NGaXgoKTtcbiAgfVxufVxuY2hlY2tzLnB1c2gobmV3IEF1dGhvcml6YXRpb25EYkNoZWNrKCkpO1xuXG4vLyBDaGVjayBmb3IgQ2FydGhhZ2UgKGZvciBXREEpXG5jbGFzcyBDYXJ0aGFnZUNoZWNrIGV4dGVuZHMgRG9jdG9yQ2hlY2sge1xuICBhc3luYyBkaWFnbm9zZSAoKSB7XG4gICAgbGV0IGNhcnRoYWdlUGF0aCA9IGF3YWl0IENhcnRoYWdlRGV0ZWN0b3IuZGV0ZWN0KCk7XG5cbiAgICBsZXQgdmVyc2lvbjtcbiAgICBpZiAoY2FydGhhZ2VQYXRoKSB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCB7c3Rkb3V0fSA9IGF3YWl0IGV4ZWMoY2FydGhhZ2VQYXRoLCBbJ3ZlcnNpb24nXSk7XG4gICAgICAgIC8vICdQbGVhc2UgdXBkYXRlIHRvIHRoZSBsYXRlc3QgQ2FydGhhZ2UgdmVyc2lvbjogMC4zMy4wLiBZb3UgY3VycmVudGx5IGFyZSBvbiAwLjMyLjBcXG4wLjMyLjBcXG4nIG9yICcwLjMyLjBcXG4nXG4gICAgICAgIC8vIDAuMzIuMCBpcyB0aGUgY3VycmVudCB2ZXJzaW9uLiAwLjMzLjAgaXMgYW4gYXZhaWxhYmxlIG5ld2VyIHZlcnNpb24uXG4gICAgICAgIHZlcnNpb24gPSBfLmxhc3Qoc3Rkb3V0Lm1hdGNoKC8oXFxkK1xcLlxcZCtcXC5cXGQrKS9nKSk7XG4gICAgICAgIGlmICghdXRpbC5jb2VyY2VWZXJzaW9uKHZlcnNpb24sIGZhbHNlKSkge1xuICAgICAgICAgIGxvZy53YXJuKGBDYW5ub3QgcGFyc2UgQ2FydGhhZ2UgdmVyc2lvbiBmcm9tICR7c3Rkb3V0fWApO1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgbG9nLndhcm4oZXJyKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gY2FydGhhZ2VQYXRoXG4gICAgICA/IG9rKGBDYXJ0aGFnZSB3YXMgZm91bmQgYXQ6ICR7Y2FydGhhZ2VQYXRofSR7IHZlcnNpb24gPyBgLiBJbnN0YWxsZWQgdmVyc2lvbiBpczogJHt2ZXJzaW9ufWAgOiAnJ31gKVxuICAgICAgOiBub2soYENhcnRoYWdlIHdhcyBOT1QgZm91bmQhYCk7XG4gIH1cblxuICBhc3luYyBmaXggKCkgeyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHJlcXVpcmUtYXdhaXRcbiAgICByZXR1cm4gYFBsZWFzZSBpbnN0YWxsICR7J0NhcnRoYWdlJy5ib2xkfS4gVmlzaXQgaHR0cHM6Ly9naXRodWIuY29tL0NhcnRoYWdlYCArXG4gICAgICAgICAgICcvQ2FydGhhZ2UjaW5zdGFsbGluZy1jYXJ0aGFnZSBmb3IgbW9yZSBpbmZvcm1hdGlvbi4nO1xuICB9XG59XG5jaGVja3MucHVzaChuZXcgQ2FydGhhZ2VDaGVjaygpKTtcblxuY2hlY2tzLnB1c2gobmV3IEVudlZhckFuZFBhdGhDaGVjaygnSE9NRScpKTtcblxuY2xhc3MgT3B0aW9uYWxJZGJDb21tYW5kQ2hlY2sgZXh0ZW5kcyBEb2N0b3JDaGVjayB7XG4gIGFzeW5jIGRpYWdub3NlICgpIHtcbiAgICBjb25zdCBmYklkYlBhdGggPSBhd2FpdCByZXNvbHZlRXhlY3V0YWJsZVBhdGgoJ2lkYicpO1xuICAgIGNvbnN0IGZiQ29tcGFuaW9uSWRiUGF0aCA9IGF3YWl0IHJlc29sdmVFeGVjdXRhYmxlUGF0aCgnaWRiX2NvbXBhbmlvbicpO1xuICAgIGlmIChmYklkYlBhdGggJiYgZmJDb21wYW5pb25JZGJQYXRoKSB7XG4gICAgICByZXR1cm4gb2tPcHRpb25hbCgnaWRiIGFuZCBpZGJfY29tcGFuaW9uIGFyZSBpbnN0YWxsZWQnKTtcbiAgICB9XG5cbiAgICBpZiAoIWZiSWRiUGF0aCAmJiBmYkNvbXBhbmlvbklkYlBhdGgpIHtcbiAgICAgIHJldHVybiBub2tPcHRpb25hbCgnaWRiIGlzIG5vdCBpbnN0YWxsZWQnKTtcbiAgICB9IGVsc2UgaWYgKGZiSWRiUGF0aCAmJiAhZmJDb21wYW5pb25JZGJQYXRoKSB7XG4gICAgICByZXR1cm4gbm9rT3B0aW9uYWwoJ2lkYl9jb21wYW5pb24gaXMgbm90IGluc3RhbGxlZCcpO1xuICAgIH1cbiAgICByZXR1cm4gbm9rT3B0aW9uYWwoJ2lkYiBhbmQgaWRiX2NvbXBhbmlvbiBhcmUgbm90IGluc3RhbGxlZCcpO1xuICB9XG5cbiAgYXN5bmMgZml4ICgpIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSByZXF1aXJlLWF3YWl0XG4gICAgcmV0dXJuIGBXaHkgJHsnaWRiJy5ib2xkfSBpcyBuZWVkZWQgYW5kIGhvdyB0byBpbnN0YWxsIGl0OiBodHRwczovL2dpdGh1Yi5jb20vYXBwaXVtL2FwcGl1bS1pZGJgO1xuICB9XG59XG5jaGVja3MucHVzaChuZXcgT3B0aW9uYWxJZGJDb21tYW5kQ2hlY2soKSk7XG5cbmNsYXNzIE9wdGlvbmFsQXBwbGVzaW11dGlsc0NvbW1hbmRDaGVjayBleHRlbmRzIERvY3RvckNoZWNrIHtcbiAgYXN5bmMgZGlhZ25vc2UgKCkge1xuICAgIGNvbnN0IGFwcGxlc2ltdXRpbHNQYXRoID0gYXdhaXQgcmVzb2x2ZUV4ZWN1dGFibGVQYXRoKCdhcHBsZXNpbXV0aWxzJyk7XG4gICAgcmV0dXJuIGFwcGxlc2ltdXRpbHNQYXRoXG4gICAgICA/IG9rT3B0aW9uYWwoYGFwcGxlc2ltdXRpbHMgaXMgaW5zdGFsbGVkIGF0OiAke2FwcGxlc2ltdXRpbHNQYXRofS4gSW5zdGFsbGVkIHZlcnNpb25zIGFyZTogJHsoYXdhaXQgZXhlYygnYnJldycsIFsnbGlzdCcsICctLXZlcnNpb25zJywgJ2FwcGxlc2ltdXRpbHMnXSkpLnN0ZG91dC50cmltKCl9YClcbiAgICAgIDogbm9rT3B0aW9uYWwoJ2FwcGxlc2ltdXRpbHMgY2Fubm90IGJlIGZvdW5kJyk7XG4gIH1cblxuICBhc3luYyBmaXggKCkgeyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHJlcXVpcmUtYXdhaXRcbiAgICByZXR1cm4gYFdoeSAkeydhcHBsZXNpbXV0aWxzJy5ib2xkfSBpcyBuZWVkZWQgYW5kIGhvdyB0byBpbnN0YWxsIGl0OiBodHRwOi8vYXBwaXVtLmlvL2RvY3MvZW4vZHJpdmVycy9pb3MteGN1aXRlc3QvYDtcbiAgfVxufVxuY2hlY2tzLnB1c2gobmV3IE9wdGlvbmFsQXBwbGVzaW11dGlsc0NvbW1hbmRDaGVjaygpKTtcblxuY2xhc3MgT3B0aW9uYWxJZGV2aWNlbG9jYXRpb25Db21tYW5kQ2hlY2sgZXh0ZW5kcyBEb2N0b3JDaGVjayB7XG4gIGFzeW5jIGRpYWdub3NlICgpIHtcbiAgICBjb25zdCBpZGV2aWNlbG9jYXRpb25QYXRoID0gYXdhaXQgcmVzb2x2ZUV4ZWN1dGFibGVQYXRoKCdpZGV2aWNlbG9jYXRpb24nKTtcbiAgICByZXR1cm4gaWRldmljZWxvY2F0aW9uUGF0aFxuICAgICAgPyBva09wdGlvbmFsKGBpZGV2aWNlbG9jYXRpb24gaXMgaW5zdGFsbGVkIGF0OiAke2lkZXZpY2Vsb2NhdGlvblBhdGh9YClcbiAgICAgIDogbm9rT3B0aW9uYWwoJ2lkZXZpY2Vsb2NhdGlvbiBjYW5ub3QgYmUgZm91bmQnKTtcbiAgfVxuXG4gIGFzeW5jIGZpeCAoKSB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgcmVxdWlyZS1hd2FpdFxuICAgIHJldHVybiBgJHsnaWRldmljZWxvY2F0aW9uJy5ib2xkfSBpcyB1c2VkIHRvIHNldCBnZW9sb2NhdGlvbiBmb3IgcmVhbCBkZXZpY2UuIFBsZWFzZSByZWFkIGh0dHBzOi8vZ2l0aHViLmNvbS9Kb25HYWJpbG9uZG9Bbmd1bG8vaWRldmljZWxvY2F0aW9uIHRvIGluc3RhbGwgaXRgO1xuICB9XG59XG5jaGVja3MucHVzaChuZXcgT3B0aW9uYWxJZGV2aWNlbG9jYXRpb25Db21tYW5kQ2hlY2soKSk7XG5cbmNsYXNzIE9wdGlvbmFsSU9TRGVwbG95Q29tbWFuZENoZWNrIGV4dGVuZHMgRG9jdG9yQ2hlY2sge1xuICBhc3luYyBkaWFnbm9zZSAoKSB7XG4gICAgY29uc3QgaW9zRGVwbG95UGF0aCA9IGF3YWl0IHJlc29sdmVFeGVjdXRhYmxlUGF0aCgnaW9zLWRlcGxveScpO1xuICAgIHJldHVybiBpb3NEZXBsb3lQYXRoXG4gICAgICA/IG9rT3B0aW9uYWwoYGlvcy1kZXBsb3kgaXMgaW5zdGFsbGVkIGF0OiAke2lvc0RlcGxveVBhdGh9LiBJbnN0YWxsZWQgdmVyc2lvbiBpczogJHsoYXdhaXQgZXhlYyhpb3NEZXBsb3lQYXRoLCBbJy1WJ10pKS5zdGRvdXQudHJpbSgpfWApXG4gICAgICA6IG5va09wdGlvbmFsKCdpb3MtZGVwbG95IGNhbm5vdCBiZSBmb3VuZCcpO1xuICB9XG5cbiAgYXN5bmMgZml4ICgpIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSByZXF1aXJlLWF3YWl0XG4gICAgcmV0dXJuIGAkeydpb3MtZGVwbG95Jy5ib2xkfSBpcyB1c2VkIHRvIGluc3RhbGwgaU9TIGFwcGxpY2F0aW9ucyB0byByZWFsIGRldmljZS4gUGxlYXNlIHJlYWQgaHR0cDovL2FwcGl1bS5pby9kb2NzL2VuL2RyaXZlcnMvaW9zLXhjdWl0ZXN0LXJlYWwtZGV2aWNlcy8gdG8gaW5zdGFsbCBpdGA7XG4gIH1cbn1cbmNoZWNrcy5wdXNoKG5ldyBPcHRpb25hbElPU0RlcGxveUNvbW1hbmRDaGVjaygpKTtcblxuY2xhc3MgT3B0aW9uYWxJT1NXZWJraXREZWJ1Z1Byb3h5Q29tbWFuZENoZWNrIGV4dGVuZHMgRG9jdG9yQ2hlY2sge1xuICBhc3luYyBkaWFnbm9zZSAoKSB7XG4gICAgY29uc3QgaW9zV2Via2l0RGVidWdQcm94eVBhdGggPSBhd2FpdCByZXNvbHZlRXhlY3V0YWJsZVBhdGgoJ2lvc193ZWJraXRfZGVidWdfcHJveHknKTtcbiAgICBpZiAoaW9zV2Via2l0RGVidWdQcm94eVBhdGgpIHtcbiAgICAgIGNvbnN0IHZlcnNpb24gPSAoYXdhaXQgZXhlYyhpb3NXZWJraXREZWJ1Z1Byb3h5UGF0aCwgWyctViddKSkuc3Rkb3V0LnNwbGl0KEVPTCk7XG4gICAgICByZXR1cm4gb2tPcHRpb25hbChgaW9zX3dlYmtpdF9kZWJ1Z19wcm94eSBpcyBpbnN0YWxsZWQgYXQ6ICR7aW9zV2Via2l0RGVidWdQcm94eVBhdGh9LiBJbnN0YWxsZWQgdmVyc2lvbiBpczogJHtcbiAgICAgICAgdmVyc2lvblswXS5yZXBsYWNlKCdpb3Nfd2Via2l0X2RlYnVnX3Byb3h5ICcsICcnKX0sICR7dmVyc2lvblsxXX1gKTtcbiAgICB9XG4gICAgcmV0dXJuIG5va09wdGlvbmFsKCdpb3Nfd2Via2l0X2RlYnVnX3Byb3h5IGNhbm5vdCBiZSBmb3VuZCcpO1xuICB9XG5cbiAgYXN5bmMgZml4ICgpIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSByZXF1aXJlLWF3YWl0XG4gICAgcmV0dXJuIGAkeydpb3Nfd2Via2l0X2RlYnVnX3Byb3h5Jy5ib2xkfSBpcyB1c2VkIHRvIHByb3h5IHJlcXVlc3RzIGZyb20gQXBwaXVtIHRvIE1vYmlsZVNhZmFyaSBydW5uaW5nIG9uIHJlYWwgZGV2aWNlLiBQbGVhc2UgcmVhZCBodHRwczovL2dpdGh1Yi5jb20vZ29vZ2xlL2lvcy13ZWJraXQtZGVidWctcHJveHkgdG8gaW5zdGFsbCBpdGA7XG4gIH1cbn1cbmNoZWNrcy5wdXNoKG5ldyBPcHRpb25hbElPU1dlYmtpdERlYnVnUHJveHlDb21tYW5kQ2hlY2soKSk7XG5cbmNsYXNzIE9wdGlvbmFsSWZ1c2VDb21tYW5kQ2hlY2sgZXh0ZW5kcyBEb2N0b3JDaGVjayB7XG4gIGFzeW5jIGRpYWdub3NlICgpIHtcbiAgICBjb25zdCBpZnVzZVBhdGggPSBhd2FpdCByZXNvbHZlRXhlY3V0YWJsZVBhdGgoJ2lmdXNlJyk7XG4gICAgaWYgKGlmdXNlUGF0aCkge1xuICAgICAgY29uc3QgdmVyc2lvbiA9IChhd2FpdCBleGVjKGlmdXNlUGF0aCwgWyctViddKSkuc3RkZXJyO1xuICAgICAgcmV0dXJuIG9rT3B0aW9uYWwoYGlmdXNlIGlzIGluc3RhbGxlZCBhdDogJHtpZnVzZVBhdGh9LiR7IHZlcnNpb24gPyBgIEluc3RhbGxlZCB2ZXJzaW9uIGlzOiAkey9bMC05Ll0rLy5leGVjKHZlcnNpb24pWzBdfWAgOiAnJ31gKTtcbiAgICB9XG4gICAgcmV0dXJuIG5va09wdGlvbmFsKCdpZnVzZSBjYW5ub3QgYmUgZm91bmQnKTtcbiAgfVxuXG4gIGFzeW5jIGZpeCAoKSB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgcmVxdWlyZS1hd2FpdFxuICAgIHJldHVybiBgJHsnaWZ1c2UnLmJvbGR9IGlzIHVzZWQgdG8gbWFuYWdlIGZpbGVzL2ZvbGRlcnMgYWdhaW5zdCBhIHJlYWwgZGV2aWNlLiBQbGVhc2UgcmVhZCBodHRwczovL2dpdGh1Yi5jb20vYXBwaXVtL2FwcGl1bS9ibG9iL21hc3Rlci9kb2NzL2VuL3dyaXRpbmctcnVubmluZy1hcHBpdW0vaW9zL2lvcy14Y3Rlc3QtZmlsZS1tb3ZlbWVudC5tZCB0byBpbnN0YWxsIGl0YDtcbiAgfVxufVxuY2hlY2tzLnB1c2gobmV3IE9wdGlvbmFsSWZ1c2VDb21tYW5kQ2hlY2soKSk7XG5cblxuZXhwb3J0IHtcbiAgZml4ZXMsIFhjb2RlQ2hlY2ssIFhjb2RlQ21kTGluZVRvb2xzQ2hlY2ssIERldlRvb2xzU2VjdXJpdHlDaGVjayxcbiAgQXV0aG9yaXphdGlvbkRiQ2hlY2ssIENhcnRoYWdlQ2hlY2ssIE9wdGlvbmFsSWRiQ29tbWFuZENoZWNrLCBPcHRpb25hbEFwcGxlc2ltdXRpbHNDb21tYW5kQ2hlY2ssIE9wdGlvbmFsSWRldmljZWxvY2F0aW9uQ29tbWFuZENoZWNrLFxuICBPcHRpb25hbElPU0RlcGxveUNvbW1hbmRDaGVjaywgT3B0aW9uYWxJT1NXZWJraXREZWJ1Z1Byb3h5Q29tbWFuZENoZWNrLCBPcHRpb25hbElmdXNlQ29tbWFuZENoZWNrXG59O1xuZXhwb3J0IGRlZmF1bHQgY2hlY2tzO1xuIl0sImZpbGUiOiJsaWIvaW9zLmpzIiwic291cmNlUm9vdCI6Ii4uLy4uIn0=
